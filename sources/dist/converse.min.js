/*! For license information please see converse.min.js.LICENSE.txt */
(()=>{var e,t,n,s,i={7706:(e,t,n)=>{"use strict";const s=n(171),i=n(8713);e.exports={atob:s,btoa:i}},171:e=>{"use strict";function t(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}e.exports=function(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let n="",s=0,i=0;for(let r=0;r<e.length;r++)s<<=6,s|=t(e[r]),i+=6,24===i&&(n+=String.fromCharCode((16711680&s)>>16),n+=String.fromCharCode((65280&s)>>8),n+=String.fromCharCode(255&s),s=i=0);return 12===i?(s>>=4,n+=String.fromCharCode(s)):18===i&&(s>>=2,n+=String.fromCharCode((65280&s)>>8),n+=String.fromCharCode(255&s)),n}},8713:e=>{"use strict";function t(e){if(e>=0&&e<64)return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]}e.exports=function(e){let n;for(e=`${e}`,n=0;n<e.length;n++)if(e.charCodeAt(n)>255)return null;let s="";for(n=0;n<e.length;n+=3){const i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(n)>>2,i[1]=(3&e.charCodeAt(n))<<4,e.length>n+1&&(i[1]|=e.charCodeAt(n+1)>>4,i[2]=(15&e.charCodeAt(n+1))<<2),e.length>n+2&&(i[2]|=e.charCodeAt(n+2)>>6,i[3]=63&e.charCodeAt(n+2));for(let e=0;e<i.length;e++)void 0===i[e]?s+="=":s+=t(i[e])}return s}},8826:(e,t,n)=>{e.exports={default:n(5820),__esModule:!0}},1060:(e,t,n)=>{e.exports={default:n(3248),__esModule:!0}},3415:(e,t,n)=>{e.exports={default:n(9830),__esModule:!0}},8681:(e,t,n)=>{"use strict";t.__esModule=!0;var s,i=(s=n(3415))&&s.__esModule?s:{default:s};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,n){return function s(r,o){try{var a=t[r](o),c=a.value}catch(e){return void n(e)}if(!a.done)return i.default.resolve(c).then((function(e){s("next",e)}),(function(e){s("throw",e)}));e(c)}("next")}))}}},8584:(e,t,n)=>{"use strict";t.__esModule=!0;var s,i=(s=n(8826))&&s.__esModule?s:{default:s};t.default=function(e,t,n){return t in e?(0,i.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},7034:(e,t,n)=>{var s=function(){return this}()||Function("return this")(),i=s.regeneratorRuntime&&Object.getOwnPropertyNames(s).indexOf("regeneratorRuntime")>=0,r=i&&s.regeneratorRuntime;if(s.regeneratorRuntime=void 0,e.exports=n(4267),i)s.regeneratorRuntime=r;else try{delete s.regeneratorRuntime}catch(e){s.regeneratorRuntime=void 0}},4267:e=>{!function(t){"use strict";var n,s=Object.prototype,i=s.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",l=t.regeneratorRuntime;if(l)e.exports=l;else{(l=t.regeneratorRuntime=e.exports).wrap=y;var d="suspendedStart",u="suspendedYield",h="executing",m="completed",f={},g={};g[o]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(N([])));v&&v!==s&&i.call(v,o)&&(g=v);var b=x.prototype=w.prototype=Object.create(g);S.prototype=b.constructor=x,x.constructor=S,x[c]=S.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},l.awrap=function(e){return{__await:e}},E(A.prototype),A.prototype[a]=function(){return this},l.AsyncIterator=A,l.async=function(e,t,n,s){var i=new A(y(e,t,n,s));return l.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(b),b[c]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var s=t.pop();if(s in e)return n.value=s,n.done=!1,n}return n.done=!0,n}},l.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(s,i){return a.type="throw",a.arg=e,t.next=s,i&&(t.method="next",t.arg=n),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var i=s.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,s){return this.delegate={iterator:N(e),resultName:t,nextLoc:s},"next"===this.method&&(this.arg=n),f}}}function y(e,t,n,s){var i=t&&t.prototype instanceof w?t:w,r=Object.create(i.prototype),o=new j(s||[]);return r._invoke=function(e,t,n){var s=d;return function(i,r){if(s===h)throw new Error("Generator is already running");if(s===m){if("throw"===i)throw r;return O()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var a=C(o,n);if(a){if(a===f)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(s===d)throw s=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);s=h;var c=_(e,t,n);if("normal"===c.type){if(s=n.done?m:u,c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(s=m,n.method="throw",n.arg=c.arg)}}}(e,n,o),r}function _(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function S(){}function x(){}function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function A(e){function t(n,s,r,o){var a=_(e[n],e,s);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,r,o)}),(function(e){t("throw",e,r,o)})):Promise.resolve(l).then((function(e){c.value=e,r(c)}),o)}o(a.arg)}var n;this._invoke=function(e,s){function i(){return new Promise((function(n,i){t(e,s,n,i)}))}return n=n?n.then(i,i):i()}}function C(e,t){var s=e.iterator[t.method];if(s===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var i=_(s,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,f;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,f):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,r=function t(){for(;++s<e.length;)if(i.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},1161:(e,t,n)=>{e.exports=n(7034)},6434:function(e,t,n){var s,i;void 0===(i="function"==typeof(s=function(){"use strict";var e=void 0!==n.g?n.g:this||window,t=document,s=t.documentElement,i=e.BSN={},r=i.supports=[],o="data-toggle",a="data-dismiss",c="Alert",l="Button",d="Collapse",u="Dropdown",h="Modal",m="Popover",f="Tab",g="data-backdrop",p="data-target",v="data-title",b="aria-expanded",y="aria-hidden",_="aria-selected",w="click",S="focus",x="hover",E="keydown",A="keyup",C="resize",T="onmouseleave"in t?["mouseenter","mouseleave"]:["mouseover","mouseout"],k="show",j="shown",N="hide",O="hidden",$="change",I="getAttribute",M="Transition",R="Duration",D="Webkit",L="tabindex",z="active",P="show",F="collapsing",U="left",B="right",q="top",H="bottom",G=/\b(top|bottom|left|right)+/,W=0,V="fixed-top",J="fixed-bottom",K=D+M in s.style||M.toLowerCase()in s.style,Y=D+M in s.style?D.toLowerCase()+M+"End":M.toLowerCase()+"end",Q=D+R in s.style?D.toLowerCase()+M+R:M.toLowerCase()+R,X=function(e){e.focus?e.focus():e.setActive()},Z=function(e,t){e.classList.add(t)},ee=function(e,t){e.classList.remove(t)},te=function(e,t){return e.classList.contains(t)},ne=function(e,t){return[].slice.call(e.getElementsByClassName(t))},se=function(e,n){return"object"==typeof e?e:(n||t).querySelector(e)},ie=function(e,n){var s=n.charAt(0),i=n.substr(1);if("."===s){for(;e&&e!==t;e=e.parentNode)if(null!==se(n,e.parentNode)&&te(e,i))return e}else if("#"===s)for(;e&&e!==t;e=e.parentNode)if(e.id===i)return e;return!1},re=function(e,t,n,s){s=s||!1,e.addEventListener(t,n,s)},oe=function(e,t,n,s){s=s||!1,e.removeEventListener(t,n,s)},ae=function(e,t,n,s){re(e,t,(function i(r){n(r),oe(e,t,i,s)}),s)},ce=!!function(){var t=!1;try{var n=Object.defineProperty({},"passive",{get:function(){t=!0}});ae(e,"testPassive",null,n)}catch(e){}return t}()&&{passive:!0},le=function(t){var n=K?e.getComputedStyle(t)[Q]:0;return"number"!=typeof(n=parseFloat(n))||isNaN(n)?0:1e3*n},de=function(e,t){var n=0;le(e)?ae(e,Y,(function(e){!n&&t(e),n=1})):setTimeout((function(){!n&&t(),n=1}),17)},ue=function(e,t,n){var s=new CustomEvent(e+".bs."+t);s.relatedTarget=n,this.dispatchEvent(s)},he=function(n,i,r,o){var a,c,l,d,u,h,m=i.offsetWidth,f=i.offsetHeight,g=s.clientWidth||t.body.clientWidth,p=s.clientHeight||t.body.clientHeight,v=n.getBoundingClientRect(),b=o===t.body?{y:e.pageYOffset||s.scrollTop,x:e.pageXOffset||s.scrollLeft}:{x:o.offsetLeft+o.scrollLeft,y:o.offsetTop+o.scrollTop},y=v.right-v.left,_=v.bottom-v.top,w=te(i,"popover"),S=se(".arrow",i),x=v.top+_/2-f/2<0,E=v.left+y/2-m/2<0,A=v.left+m/2+y/2>=g,C=v.top+f/2+_/2>=p,T=v.top-f<0,k=v.left-m<0,j=v.top+f+_>=p,N=v.left+m+y>=g;r=(r=(r=(r=(r=(r===U||r===B)&&k&&N?q:r)===q&&T?H:r)===H&&j?q:r)===U&&k?B:r)===B&&N?U:r,-1===i.className.indexOf(r)&&(i.className=i.className.replace(G,r)),u=S.offsetWidth,h=S.offsetHeight,r===U||r===B?(c=r===U?v.left+b.x-m-(w?u:0):v.left+b.x+y,x?(a=v.top+b.y,l=_/2-u):C?(a=v.top+b.y-f+_,l=f-_/2-u):(a=v.top+b.y-f/2+_/2,l=f/2-(w?.9*h:h/2))):r!==q&&r!==H||(a=r===q?v.top+b.y-f-(w?h:0):v.top+b.y+_,E?(c=0,d=v.left+y/2-u):A?(c=g-1.01*m,d=m-(g-v.left)+y/2-u/2):(c=v.left+b.x-m/2+y/2,d=m/2-(w?u:u/2))),i.style.top=a+"px",i.style.left=c+"px",l&&(S.style.top=l+"px"),d&&(S.style.left=d+"px")};i.version="2.0.27";var me=function(e){e=se(e);var t=this,n="alert",s=ie(e,".alert"),i=function(n){s=ie(n.target,".alert"),(e=se('[data-dismiss="alert"]',s))&&s&&(e===n.target||e.contains(n.target))&&t.close()},r=function(){ue.call(s,"closed",n),oe(e,w,i),s.parentNode.removeChild(s)};this.close=function(){s&&e&&te(s,P)&&(ue.call(s,"close",n),ee(s,P),s&&(te(s,"fade")?de(s,r):r()))},c in e||re(e,w,i),e.Alert=t};r.push([c,me,'[data-dismiss="alert"]']);var fe=function(e){e=se(e);var n=!1,s="button",i="checked",r="LABEL",o="INPUT",a=function(t){var a=t.target.tagName===r?t.target:t.target.parentNode.tagName===r?t.target.parentNode:null;if(a){var c=ne(a.parentNode,"btn"),l=a.getElementsByTagName(o)[0];if(l){if("checkbox"===l.type&&(l.checked?(ee(a,z),l.getAttribute(i),l.removeAttribute(i),l.checked=!1):(Z(a,z),l.getAttribute(i),l.setAttribute(i,i),l.checked=!0),n||(n=!0,ue.call(l,$,s),ue.call(e,$,s))),"radio"===l.type&&!n&&(!l.checked||0===t.screenX&&0==t.screenY)){Z(a,z),Z(a,S),l.setAttribute(i,i),l.checked=!0,ue.call(l,$,s),ue.call(e,$,s),n=!0;for(var d=0,u=c.length;d<u;d++){var h=c[d],m=h.getElementsByTagName(o)[0];h!==a&&te(h,z)&&(ee(h,z),m.removeAttribute(i),m.checked=!1,ue.call(m,$,s))}}setTimeout((function(){n=!1}),50)}}},c=function(e){Z(e.target.parentNode,S)},d=function(e){ee(e.target.parentNode,S)};if(!(l in e)){re(e,w,a),re(e,A,(function(e){32===(e.which||e.keyCode)&&e.target===t.activeElement&&a(e)})),re(e,E,(function(e){32===(e.which||e.keyCode)&&e.preventDefault()}));for(var u=ne(e,"btn"),h=0;h<u.length;h++){var m=u[h].getElementsByTagName(o)[0];re(m,S,c),re(m,"blur",d)}}var f=ne(e,"btn"),g=f.length;for(h=0;h<g;h++)!te(f[h],z)&&se("input:checked",f[h])&&Z(f[h],z);e.Button=this};r.push([l,fe,'[data-toggle="buttons"]']);var ge=function(e,t){e=se(e),t=t||{};var n,s,i,r,o,a=null,c=null,l=this,u=e.getAttribute("data-parent"),h="collapse",m="collapsed",f=function(e,t){ue.call(e,N,h),e.isAnimating=!0,e.style.height=e.scrollHeight+"px",ee(e,h),ee(e,P),Z(e,F),e.offsetWidth,e.style.height="0px",de(e,(function(){e.isAnimating=!1,e.setAttribute(b,"false"),t.setAttribute(b,"false"),ee(e,F),Z(e,h),e.style.height="",ue.call(e,O,h)}))};this.toggle=function(e){e.preventDefault(),te(c,P)?l.hide():l.show()},this.hide=function(){c.isAnimating||(f(c,e),Z(e,m))},this.show=function(){var t,i;a&&(n=se(".collapse.show",a),s=n&&(se('[data-target="#'+n.id+'"]',a)||se('[href="#'+n.id+'"]',a))),(!c.isAnimating||n&&!n.isAnimating)&&(s&&n!==c&&(f(n,s),Z(s,m)),i=e,ue.call(t=c,k,h),t.isAnimating=!0,Z(t,F),ee(t,h),t.style.height=t.scrollHeight+"px",de(t,(function(){t.isAnimating=!1,t.setAttribute(b,"true"),i.setAttribute(b,"true"),ee(t,F),Z(t,h),Z(t,P),t.style.height="",ue.call(t,j,h)})),ee(e,m))},d in e||re(e,w,l.toggle),(i=e.href&&e.getAttribute("href"),r=e.getAttribute(p),o=i||r&&"#"===r.charAt(0)&&r,c=o&&se(o)).isAnimating=!1,a=se(t.parent)||u&&ie(e,u),e.Collapse=l};r.push([d,ge,'[data-toggle="collapse"]']);var pe=function(e,n){e=se(e),this.persist=!0===n||"true"===e.getAttribute("data-persist")||!1;var s=this,i=e.parentNode,r="dropdown",a=null,c=se(".dropdown-menu",i),l=function(){for(var e=c.children,t=[],n=0;n<e.length;n++)e[n].children.length&&"A"===e[n].children[0].tagName&&t.push(e[n].children[0]),"A"===e[n].tagName&&t.push(e[n]);return t}(),d=function(e){(e.href&&"#"===e.href.slice(-1)||e.parentNode&&e.parentNode.href&&"#"===e.parentNode.href.slice(-1))&&this.preventDefault()},h=function(){var n=e.open?re:oe;n(t,w,m),n(t,E,g),n(t,A,p),n(t,S,m,!0)},m=function(t){var n=t.target,i=n&&(n.getAttribute(o)||n.parentNode&&I in n.parentNode&&n.parentNode.getAttribute(o));(t.type!==S||n!==e&&n!==c&&!c.contains(n))&&(n!==c&&!c.contains(n)||!s.persist&&!i)&&(a=n===e||e.contains(n)?e:null,y(),d.call(t,n))},f=function(t){a=e,v(),d.call(t,t.target)},g=function(e){var t=e.which||e.keyCode;38!==t&&40!==t||e.preventDefault()},p=function(n){var i=n.which||n.keyCode,r=t.activeElement,o=l.indexOf(r),d=r===e,u=c.contains(r),h=r.parentNode===c||r.parentNode.parentNode===c;h&&(o=d?0:38===i?o>1?o-1:0:40===i&&o<l.length-1?o+1:o,l[o]&&X(l[o])),(l.length&&h||!l.length&&(u||d)||!u)&&e.open&&27===i&&(s.toggle(),a=null)},v=function(){ue.call(i,k,r,a),Z(c,P),Z(i,P),e.setAttribute(b,!0),ue.call(i,j,r,a),e.open=!0,oe(e,w,f),setTimeout((function(){X(c.getElementsByTagName("INPUT")[0]||e),h()}),1)},y=function(){ue.call(i,N,r,a),ee(c,P),ee(i,P),e.setAttribute(b,!1),ue.call(i,O,r,a),e.open=!1,h(),X(e),setTimeout((function(){re(e,w,f)}),1)};e.open=!1,this.toggle=function(){te(i,P)&&e.open?y():v()},u in e||(!1 in c&&c.setAttribute(L,"0"),re(e,w,f)),e.Dropdown=s};r.push([u,pe,'[data-toggle="dropdown"]']);var ve=function(n,i){n=se(n);var r="modal",o="static",c="modalTrigger",l="modal-backdrop",d=n.getAttribute(p)||n.getAttribute("href"),u=se(d),m=te(n,r)?n:u;if(te(n,r)&&(n=null),m){i=i||{},this.keyboard=!1!==i.keyboard&&"false"!==m.getAttribute("data-keyboard"),this.backdrop=i.backdrop!==o&&m.getAttribute(g)!==o||o,this.backdrop=!1!==i.backdrop&&"false"!==m.getAttribute(g)&&this.backdrop,this.animation=!!te(m,"fade"),this.content=i.content,m.isAnimating=!1;var f,v,b,_,S,x=this,A=null,T=ne(s,V).concat(ne(s,J)),$=function(){var n,s=e.getComputedStyle(t.body),i=parseInt(s.paddingRight,10);if(f&&(t.body.style.paddingRight=i+v+"px",m.style.paddingRight=v+"px",T.length))for(var r=0;r<T.length;r++)n=e.getComputedStyle(T[r]).paddingRight,T[r].style.paddingRight=parseInt(n)+v+"px"},I=function(){var n,i,r;f=t.body.clientWidth<(r=s.getBoundingClientRect(),e.innerWidth||r.right-Math.abs(r.left)),(i=t.createElement("div")).className="modal-scrollbar-measure",t.body.appendChild(i),n=i.offsetWidth-i.clientWidth,t.body.removeChild(i),v=n},M=function(){(b=se(".modal-backdrop"))&&null!==b&&"object"==typeof b&&(W=0,t.body.removeChild(b),b=null)},R=function(){X(m),m.isAnimating=!1,ue.call(m,j,r,A),re(e,C,x.update,ce),re(m,w,z),re(t,E,L)},D=function(){m.style.display="",n&&X(n),ue.call(m,O,r),ne(t,"modal show")[0]||(function(){if(t.body.style.paddingRight="",m.style.paddingRight="",T.length)for(var e=0;e<T.length;e++)T[e].style.paddingRight=""}(),ee(t.body,"modal-open"),b&&te(b,"fade")?(ee(b,P),de(b,M)):M(),oe(e,C,x.update,ce),oe(m,w,z),oe(t,E,L)),m.isAnimating=!1},L=function(e){m.isAnimating||x.keyboard&&27==e.which&&te(m,P)&&x.hide()},z=function(e){if(!m.isAnimating){var t=e.target;te(m,P)&&(t.parentNode.getAttribute(a)===r||t.getAttribute(a)===r||t===m&&x.backdrop!==o)&&(x.hide(),A=null,e.preventDefault())}};this.toggle=function(){te(m,P)?this.hide():this.show()},this.show=function(){te(m,P)||m.isAnimating||(clearTimeout(S),S=setTimeout((function(){m.isAnimating=!0,ue.call(m,k,r,A);var e,n=ne(t,"modal show")[0];n&&n!==m&&(c in n&&n.modalTrigger.Modal.hide(),h in n&&n.Modal.hide()),x.backdrop&&!W&&!b&&(e=t.createElement("div"),null===(b=se(".modal-backdrop"))&&(e.setAttribute("class",l+(x.animation?" fade":"")),b=e,t.body.appendChild(b)),W=1),b&&!te(b,P)&&(b.offsetWidth,_=le(b),Z(b,P)),setTimeout((function(){m.style.display="block",I(),$(),Z(t.body,"modal-open"),Z(m,P),m.setAttribute(y,!1),te(m,"fade")?de(m,R):R()}),K&&b&&_?_:1)}),1))},this.hide=function(){!m.isAnimating&&te(m,P)&&(clearTimeout(S),S=setTimeout((function(){m.isAnimating=!0,ue.call(m,N,r),b=se(".modal-backdrop"),_=b&&le(b),ee(m,P),m.setAttribute(y,!0),setTimeout((function(){te(m,"fade")?de(m,D):D()}),K&&b&&_?_:2)}),2))},this.setContent=function(e){se(".modal-content",m).innerHTML=e},this.update=function(){te(m,P)&&(I(),$())},n&&!(h in n)&&re(n,w,(function(e){if(!m.isAnimating){var t=e.target;(t=t.hasAttribute(p)||t.hasAttribute("href")?t:t.parentNode)!==n||te(m,P)||(m.modalTrigger=n,A=n,x.show(),e.preventDefault())}})),x.content&&x.setContent(x.content),n?(n.Modal=x,m.modalTrigger=n):m.Modal=x}};r.push([h,ve,'[data-toggle="modal"]']);var be=function(n,s){n=se(n),s=s||{};var i=n.getAttribute("data-trigger"),r=n.getAttribute("data-animation"),o=n.getAttribute("data-placement"),a=n.getAttribute("data-dismissible"),c=n.getAttribute("data-delay"),l=n.getAttribute("data-container"),d="popover",u="class",h="div",f="fade",g="data-content",p='<button type="button" class="close">×</button>',b=se(s.container),y=se(l),_=ie(n,".modal"),S=ie(n,".fixed-top"),E=ie(n,".fixed-bottom");this.template=s.template?s.template:null,this.trigger=s.trigger?s.trigger:i||x,this.animation=s.animation&&s.animation!==f?s.animation:r||f,this.placement=s.placement?s.placement:o||q,this.delay=parseInt(s.delay||c)||200,this.dismissible=!(!s.dismissible&&"true"!==a),this.container=b||y||S||E||_||t.body;var A=this,$=s.title||n.getAttribute(v)||null,I=s.content||n.getAttribute(g)||null;if(I||this.template){var M=null,R=0,D=this.placement,L=function(e){null!==M&&e.target===se(".close",M)&&A.hide()},z=function(s){w!=A.trigger&&"focus"!=A.trigger||!A.dismissible&&s(n,"blur",A.hide),A.dismissible&&s(t,w,L),s(e,C,A.hide,ce)},F=function(){z(re),ue.call(n,j,d)},U=function(){z(oe),A.container.removeChild(M),R=null,M=null,ue.call(n,O,d)};this.toggle=function(){null===M?A.show():A.hide()},this.show=function(){clearTimeout(R),R=setTimeout((function(){null===M&&(D=A.placement,function(){$=s.title||n.getAttribute(v),I=(I=s.content||n.getAttribute(g))?I.trim():null,M=t.createElement(h);var e=t.createElement(h);if(e.setAttribute(u,"arrow"),M.appendChild(e),null!==I&&null===A.template){if(M.setAttribute("role","tooltip"),null!==$){var i=t.createElement("h3");i.setAttribute(u,"popover-header"),i.innerHTML=A.dismissible?$+p:$,M.appendChild(i)}var r=t.createElement(h);r.setAttribute(u,"popover-body"),r.innerHTML=A.dismissible&&null===$?I+p:I,M.appendChild(r)}else{var o=t.createElement(h);A.template=A.template.trim(),o.innerHTML=A.template,M.innerHTML=o.firstChild.innerHTML}A.container.appendChild(M),M.style.display="block",M.setAttribute(u,"popover bs-popover-"+D+" "+A.animation)}(),he(n,M,D,A.container),!te(M,P)&&Z(M,P),ue.call(n,k,d),A.animation?de(M,F):F())}),20)},this.hide=function(){clearTimeout(R),R=setTimeout((function(){M&&null!==M&&te(M,P)&&(ue.call(n,N,d),ee(M,P),A.animation?de(M,U):U())}),A.delay)},m in n||(A.trigger===x?(re(n,T[0],A.show),A.dismissible||re(n,T[1],A.hide)):w!=A.trigger&&"focus"!=A.trigger||re(n,A.trigger,A.toggle)),n.Popover=A}};r.push([m,be,'[data-toggle="popover"]']);var ye=function(e,t){var n=(e=se(e)).getAttribute("data-height"),s="tab";t=t||{},this.height=!!K&&(t.height||"true"===n);var i,r,o,a,c,l,d,u=this,h=ie(e,".nav"),m=!1,g=h&&se(".dropdown-toggle",h),p=function(){m.style.height="",ee(m,F),h.isAnimating=!1},v=function(){m?l?p():setTimeout((function(){m.style.height=d+"px",m.offsetWidth,de(m,p)}),50):h.isAnimating=!1,ue.call(i,j,s,r)},b=function(){m&&(o.style.float=U,a.style.float=U,c=o.scrollHeight),Z(a,z),ue.call(i,k,s,r),ee(o,z),ue.call(r,O,s,i),m&&(d=a.scrollHeight,l=d===c,Z(m,F),m.style.height=c+"px",m.offsetHeight,o.style.float="",a.style.float=""),te(a,"fade")?setTimeout((function(){Z(a,P),de(a,v)}),20):v()};if(h){h.isAnimating=!1;var y=function(){var e,t=ne(h,z);return 1!==t.length||te(t[0].parentNode,"dropdown")?t.length>1&&(e=t[t.length-1]):e=t[0],e},S=function(){return se(y().getAttribute("href"))};this.show=function(){a=se((i=i||e).getAttribute("href")),r=y(),o=S(),h.isAnimating=!0,ee(r,z),r.setAttribute(_,"false"),Z(i,z),i.setAttribute(_,"true"),g&&(te(e.parentNode,"dropdown-menu")?te(g,z)||Z(g,z):te(g,z)&&ee(g,z)),ue.call(r,N,s,i),te(o,"fade")?(ee(o,P),de(o,b)):b()},f in e||re(e,w,(function(e){e.preventDefault(),i=e.currentTarget,!h.isAnimating&&!te(i,z)&&u.show()})),u.height&&(m=S().parentNode),e.Tab=u}};r.push([f,ye,'[data-toggle="tab"]']);var _e=function(e,t){for(var n=0,s=t.length;n<s;n++)new e(t[n])},we=i.initCallback=function(e){e=e||t;for(var n=0,s=r.length;n<s;n++)_e(r[n][1],e.querySelectorAll(r[n][2]))};return t.body?we():re(t,"DOMContentLoaded",(function(){we()})),{Alert:me,Button:fe,Collapse:ge,Dropdown:pe,Modal:ve,Popover:be,Tab:ye}})?s.apply(t,[]):s)||(e.exports=i)},5820:(e,t,n)=>{n(964);var s=n(7913).Object;e.exports=function(e,t,n){return s.defineProperty(e,t,n)}},3248:(e,t,n)=>{n(4180),e.exports=n(7913).Object.keys},9830:(e,t,n)=>{n(6542),n(4815),n(8160),n(8314),n(8245),n(5953),e.exports=n(7913).Promise},472:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},5057:e=>{e.exports=function(){}},9945:e=>{e.exports=function(e,t,n,s){if(!(e instanceof t)||void 0!==s&&s in e)throw TypeError(n+": incorrect invocation!");return e}},7237:(e,t,n)=>{var s=n(9900);e.exports=function(e){if(!s(e))throw TypeError(e+" is not an object!");return e}},7097:(e,t,n)=>{var s=n(6591),i=n(1872),r=n(8367);e.exports=function(e){return function(t,n,o){var a,c=s(t),l=i(c.length),d=r(o,l);if(e&&n!=n){for(;l>d;)if((a=c[d++])!=a)return!0}else for(;l>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}}},8874:(e,t,n)=>{var s=n(4606),i=n(9506)("toStringTag"),r="Arguments"==s(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:r?s(t):"Object"==(o=s(t))&&"function"==typeof t.callee?"Arguments":o}},4606:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},7913:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},8773:(e,t,n)=>{var s=n(472);e.exports=function(e,t,n){if(s(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,s){return e.call(t,n,s)};case 3:return function(n,s,i){return e.call(t,n,s,i)}}return function(){return e.apply(t,arguments)}}},1011:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},6580:(e,t,n)=>{e.exports=!n(7287)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},6590:(e,t,n)=>{var s=n(9900),i=n(5677).document,r=s(i)&&s(i.createElement);e.exports=function(e){return r?i.createElement(e):{}}},4330:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},9749:(e,t,n)=>{var s=n(5677),i=n(7913),r=n(8773),o=n(51),a=n(3945),c=function(e,t,n){var l,d,u,h=e&c.F,m=e&c.G,f=e&c.S,g=e&c.P,p=e&c.B,v=e&c.W,b=m?i:i[t]||(i[t]={}),y=b.prototype,_=m?s:f?s[t]:(s[t]||{}).prototype;for(l in m&&(n=t),n)(d=!h&&_&&void 0!==_[l])&&a(b,l)||(u=d?_[l]:n[l],b[l]=m&&"function"!=typeof _[l]?n[l]:p&&d?r(u,s):v&&_[l]==u?function(e){var t=function(t,n,s){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,s)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(u):g&&"function"==typeof u?r(Function.call,u):u,g&&((b.virtual||(b.virtual={}))[l]=u,e&c.R&&y&&!y[l]&&o(y,l,u)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},7287:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},5614:(e,t,n)=>{var s=n(8773),i=n(352),r=n(2887),o=n(7237),a=n(1872),c=n(7670),l={},d={},u=e.exports=function(e,t,n,u,h){var m,f,g,p,v=h?function(){return e}:c(e),b=s(n,u,t?2:1),y=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(r(v)){for(m=a(e.length);m>y;y++)if((p=t?b(o(f=e[y])[0],f[1]):b(e[y]))===l||p===d)return p}else for(g=v.call(e);!(f=g.next()).done;)if((p=i(g,b,f.value,t))===l||p===d)return p};u.BREAK=l,u.RETURN=d},5677:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},3945:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},51:(e,t,n)=>{var s=n(8301),i=n(7269);e.exports=n(6580)?function(e,t,n){return s.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},8387:(e,t,n)=>{var s=n(5677).document;e.exports=s&&s.documentElement},1430:(e,t,n)=>{e.exports=!n(6580)&&!n(7287)((function(){return 7!=Object.defineProperty(n(6590)("div"),"a",{get:function(){return 7}}).a}))},2229:e=>{e.exports=function(e,t,n){var s=void 0===n;switch(t.length){case 0:return s?e():e.call(n);case 1:return s?e(t[0]):e.call(n,t[0]);case 2:return s?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return s?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return s?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},9734:(e,t,n)=>{var s=n(4606);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==s(e)?e.split(""):Object(e)}},2887:(e,t,n)=>{var s=n(3829),i=n(9506)("iterator"),r=Array.prototype;e.exports=function(e){return void 0!==e&&(s.Array===e||r[i]===e)}},9900:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},352:(e,t,n)=>{var s=n(7237);e.exports=function(e,t,n,i){try{return i?t(s(n)[0],n[1]):t(n)}catch(t){var r=e.return;throw void 0!==r&&s(r.call(e)),t}}},4419:(e,t,n)=>{"use strict";var s=n(8933),i=n(7269),r=n(8536),o={};n(51)(o,n(9506)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=s(o,{next:i(1,n)}),r(e,t+" Iterator")}},2361:(e,t,n)=>{"use strict";var s=n(7560),i=n(9749),r=n(836),o=n(51),a=n(3829),c=n(4419),l=n(8536),d=n(2008),u=n(9506)("iterator"),h=!([].keys&&"next"in[].keys()),m="keys",f="values",g=function(){return this};e.exports=function(e,t,n,p,v,b,y){c(n,t,p);var _,w,S,x=function(e){if(!h&&e in T)return T[e];switch(e){case m:case f:return function(){return new n(this,e)}}return function(){return new n(this,e)}},E=t+" Iterator",A=v==f,C=!1,T=e.prototype,k=T[u]||T["@@iterator"]||v&&T[v],j=k||x(v),N=v?A?x("entries"):j:void 0,O="Array"==t&&T.entries||k;if(O&&(S=d(O.call(new e)))!==Object.prototype&&S.next&&(l(S,E,!0),s||"function"==typeof S[u]||o(S,u,g)),A&&k&&k.name!==f&&(C=!0,j=function(){return k.call(this)}),s&&!y||!h&&!C&&T[u]||o(T,u,j),a[t]=j,a[E]=g,v)if(_={values:A?j:x(f),keys:b?j:x(m),entries:N},y)for(w in _)w in T||r(T,w,_[w]);else i(i.P+i.F*(h||C),t,_);return _}},3540:(e,t,n)=>{var s=n(9506)("iterator"),i=!1;try{var r=[7][s]();r.return=function(){i=!0},Array.from(r,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var r=[7],o=r[s]();o.next=function(){return{done:n=!0}},r[s]=function(){return o},e(r)}catch(e){}return n}},4362:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},3829:e=>{e.exports={}},7560:e=>{e.exports=!0},7231:(e,t,n)=>{var s=n(5677),i=n(8226).set,r=s.MutationObserver||s.WebKitMutationObserver,o=s.process,a=s.Promise,c="process"==n(4606)(o);e.exports=function(){var e,t,n,l=function(){var s,i;for(c&&(s=o.domain)&&s.exit();e;){i=e.fn,e=e.next;try{i()}catch(s){throw e?n():t=void 0,s}}t=void 0,s&&s.enter()};if(c)n=function(){o.nextTick(l)};else if(!r||s.navigator&&s.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);n=function(){d.then(l)}}else n=function(){i.call(s,l)};else{var u=!0,h=document.createTextNode("");new r(l).observe(h,{characterData:!0}),n=function(){h.data=u=!u}}return function(s){var i={fn:s,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},7789:(e,t,n)=>{"use strict";var s=n(472);function i(e){var t,n;this.promise=new e((function(e,s){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=s})),this.resolve=s(t),this.reject=s(n)}e.exports.f=function(e){return new i(e)}},8933:(e,t,n)=>{var s=n(7237),i=n(8138),r=n(4330),o=n(4261)("IE_PROTO"),a=function(){},c=function(){var e,t=n(6590)("iframe"),s=r.length;for(t.style.display="none",n(8387).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;s--;)delete c.prototype[r[s]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=s(e),n=new a,a.prototype=null,n[o]=e):n=c(),void 0===t?n:i(n,t)}},8301:(e,t,n)=>{var s=n(7237),i=n(1430),r=n(3216),o=Object.defineProperty;t.f=n(6580)?Object.defineProperty:function(e,t,n){if(s(e),t=r(t,!0),s(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},8138:(e,t,n)=>{var s=n(8301),i=n(7237),r=n(1302);e.exports=n(6580)?Object.defineProperties:function(e,t){i(e);for(var n,o=r(t),a=o.length,c=0;a>c;)s.f(e,n=o[c++],t[n]);return e}},2008:(e,t,n)=>{var s=n(3945),i=n(6581),r=n(4261)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),s(e,r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},9483:(e,t,n)=>{var s=n(3945),i=n(6591),r=n(7097)(!1),o=n(4261)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),c=0,l=[];for(n in a)n!=o&&s(a,n)&&l.push(n);for(;t.length>c;)s(a,n=t[c++])&&(~r(l,n)||l.push(n));return l}},1302:(e,t,n)=>{var s=n(9483),i=n(4330);e.exports=Object.keys||function(e){return s(e,i)}},8438:(e,t,n)=>{var s=n(9749),i=n(7913),r=n(7287);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),s(s.S+s.F*r((function(){n(1)})),"Object",o)}},5472:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},3243:(e,t,n)=>{var s=n(7237),i=n(9900),r=n(7789);e.exports=function(e,t){if(s(e),i(t)&&t.constructor===e)return t;var n=r.f(e);return(0,n.resolve)(t),n.promise}},7269:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2853:(e,t,n)=>{var s=n(51);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:s(e,i,t[i]);return e}},836:(e,t,n)=>{e.exports=n(51)},5003:(e,t,n)=>{"use strict";var s=n(5677),i=n(7913),r=n(8301),o=n(6580),a=n(9506)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:s[e];o&&t&&!t[a]&&r.f(t,a,{configurable:!0,get:function(){return this}})}},8536:(e,t,n)=>{var s=n(8301).f,i=n(3945),r=n(9506)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,r)&&s(e,r,{configurable:!0,value:t})}},4261:(e,t,n)=>{var s=n(7626)("keys"),i=n(1497);e.exports=function(e){return s[e]||(s[e]=i(e))}},7626:(e,t,n)=>{var s=n(7913),i=n(5677),r="__core-js_shared__",o=i[r]||(i[r]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:s.version,mode:n(7560)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},6647:(e,t,n)=>{var s=n(7237),i=n(472),r=n(9506)("species");e.exports=function(e,t){var n,o=s(e).constructor;return void 0===o||null==(n=s(o)[r])?t:i(n)}},4757:(e,t,n)=>{var s=n(1517),i=n(1011);e.exports=function(e){return function(t,n){var r,o,a=String(i(t)),c=s(n),l=a.length;return c<0||c>=l?e?"":void 0:(r=a.charCodeAt(c))<55296||r>56319||c+1===l||(o=a.charCodeAt(c+1))<56320||o>57343?e?a.charAt(c):r:e?a.slice(c,c+2):o-56320+(r-55296<<10)+65536}}},8226:(e,t,n)=>{var s,i,r,o=n(8773),a=n(2229),c=n(8387),l=n(6590),d=n(5677),u=d.process,h=d.setImmediate,m=d.clearImmediate,f=d.MessageChannel,g=d.Dispatch,p=0,v={},b=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},y=function(e){b.call(e.data)};h&&m||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++p]=function(){a("function"==typeof e?e:Function(e),t)},s(p),p},m=function(e){delete v[e]},"process"==n(4606)(u)?s=function(e){u.nextTick(o(b,e,1))}:g&&g.now?s=function(e){g.now(o(b,e,1))}:f?(r=(i=new f).port2,i.port1.onmessage=y,s=o(r.postMessage,r,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(s=function(e){d.postMessage(e+"","*")},d.addEventListener("message",y,!1)):s="onreadystatechange"in l("script")?function(e){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),b.call(e)}}:function(e){setTimeout(o(b,e,1),0)}),e.exports={set:h,clear:m}},8367:(e,t,n)=>{var s=n(1517),i=Math.max,r=Math.min;e.exports=function(e,t){return(e=s(e))<0?i(e+t,0):r(e,t)}},1517:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},6591:(e,t,n)=>{var s=n(9734),i=n(1011);e.exports=function(e){return s(i(e))}},1872:(e,t,n)=>{var s=n(1517),i=Math.min;e.exports=function(e){return e>0?i(s(e),9007199254740991):0}},6581:(e,t,n)=>{var s=n(1011);e.exports=function(e){return Object(s(e))}},3216:(e,t,n)=>{var s=n(9900);e.exports=function(e,t){if(!s(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!s(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!s(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!s(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},1497:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},8877:(e,t,n)=>{var s=n(5677).navigator;e.exports=s&&s.userAgent||""},9506:(e,t,n)=>{var s=n(7626)("wks"),i=n(1497),r=n(5677).Symbol,o="function"==typeof r;(e.exports=function(e){return s[e]||(s[e]=o&&r[e]||(o?r:i)("Symbol."+e))}).store=s},7670:(e,t,n)=>{var s=n(8874),i=n(9506)("iterator"),r=n(3829);e.exports=n(7913).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||r[s(e)]}},66:(e,t,n)=>{"use strict";var s=n(5057),i=n(4362),r=n(3829),o=n(6591);e.exports=n(2361)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),r.Arguments=r.Array,s("keys"),s("values"),s("entries")},964:(e,t,n)=>{var s=n(9749);s(s.S+s.F*!n(6580),"Object",{defineProperty:n(8301).f})},4180:(e,t,n)=>{var s=n(6581),i=n(1302);n(8438)("keys",(function(){return function(e){return i(s(e))}}))},6542:()=>{},8314:(e,t,n)=>{"use strict";var s,i,r,o,a=n(7560),c=n(5677),l=n(8773),d=n(8874),u=n(9749),h=n(9900),m=n(472),f=n(9945),g=n(5614),p=n(6647),v=n(8226).set,b=n(7231)(),y=n(7789),_=n(5472),w=n(8877),S=n(3243),x="Promise",E=c.TypeError,A=c.process,C=A&&A.versions,T=C&&C.v8||"",k=c.Promise,j="process"==d(A),N=function(){},O=i=y.f,$=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[n(9506)("species")]=function(e){e(N,N)};return(j||"function"==typeof PromiseRejectionEvent)&&e.then(N)instanceof t&&0!==T.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(e){}}(),I=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},M=function(e,t){if(!e._n){e._n=!0;var n=e._c;b((function(){for(var s=e._v,i=1==e._s,r=0,o=function(t){var n,r,o,a=i?t.ok:t.fail,c=t.resolve,l=t.reject,d=t.domain;try{a?(i||(2==e._h&&L(e),e._h=1),!0===a?n=s:(d&&d.enter(),n=a(s),d&&(d.exit(),o=!0)),n===t.promise?l(E("Promise-chain cycle")):(r=I(n))?r.call(n,c,l):c(n)):l(s)}catch(e){d&&!o&&d.exit(),l(e)}};n.length>r;)o(n[r++]);e._c=[],e._n=!1,t&&!e._h&&R(e)}))}},R=function(e){v.call(c,(function(){var t,n,s,i=e._v,r=D(e);if(r&&(t=_((function(){j?A.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(s=c.console)&&s.error&&s.error("Unhandled promise rejection",i)})),e._h=j||D(e)?2:1),e._a=void 0,r&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){v.call(c,(function(){var t;j?A.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},z=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},P=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw E("Promise can't be resolved itself");(t=I(e))?b((function(){var s={_w:n,_d:!1};try{t.call(e,l(P,s,1),l(z,s,1))}catch(e){z.call(s,e)}})):(n._v=e,n._s=1,M(n,!1))}catch(e){z.call({_w:n,_d:!1},e)}}};$||(k=function(e){f(this,k,x,"_h"),m(e),s.call(this);try{e(l(P,this,1),l(z,this,1))}catch(e){z.call(this,e)}},(s=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(2853)(k.prototype,{then:function(e,t){var n=O(p(this,k));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=j?A.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&M(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),r=function(){var e=new s;this.promise=e,this.resolve=l(P,e,1),this.reject=l(z,e,1)},y.f=O=function(e){return e===k||e===o?new r(e):i(e)}),u(u.G+u.W+u.F*!$,{Promise:k}),n(8536)(k,x),n(5003)(x),o=n(7913).Promise,u(u.S+u.F*!$,x,{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),u(u.S+u.F*(a||!$),x,{resolve:function(e){return S(a&&this===o?k:this,e)}}),u(u.S+u.F*!($&&n(3540)((function(e){k.all(e).catch(N)}))),x,{all:function(e){var t=this,n=O(t),s=n.resolve,i=n.reject,r=_((function(){var n=[],r=0,o=1;g(e,!1,(function(e){var a=r++,c=!1;n.push(void 0),o++,t.resolve(e).then((function(e){c||(c=!0,n[a]=e,--o||s(n))}),i)})),--o||s(n)}));return r.e&&i(r.v),n.promise},race:function(e){var t=this,n=O(t),s=n.reject,i=_((function(){g(e,!1,(function(e){t.resolve(e).then(n.resolve,s)}))}));return i.e&&s(i.v),n.promise}})},4815:(e,t,n)=>{"use strict";var s=n(4757)(!0);n(2361)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=s(t,n),this._i+=e.length,{value:e,done:!1})}))},8245:(e,t,n)=>{"use strict";var s=n(9749),i=n(7913),r=n(5677),o=n(6647),a=n(3243);s(s.P+s.R,"Promise",{finally:function(e){var t=o(this,i.Promise||r.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},5953:(e,t,n)=>{"use strict";var s=n(9749),i=n(7789),r=n(5472);s(s.S,"Promise",{try:function(e){var t=i.f(this),n=r(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},8160:(e,t,n)=>{n(66);for(var s=n(5677),i=n(51),r=n(3829),o=n(9506)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var l=a[c],d=s[l],u=d&&d.prototype;u&&!u[o]&&i(u,o,l),r[l]=r.Array}},1246:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,s){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(s)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(i[o]=!0)}for(var a=0;a<e.length;a++){var c=[].concat(e[a]);s&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},7620:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}e.exports=function(e){var n,s,i=(s=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var s,i,r=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(s=n.next()).done)&&(r.push(s.value),!t||r.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return r}}(n,s)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?t(e,n):void 0}}(n,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=i[1],o=i[3];if(!o)return r;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),l="/*# ".concat(c," */"),d=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[r].concat(d).concat([l]).join("\n")}return[r].join("\n")}},8169:function(e){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",s="second",i="minute",r="hour",o="day",a="week",c="month",l="quarter",d="year",u="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=function(e,t,n){var s=String(e);return!s||s.length>=t?e:""+Array(t+1-s.length).join(n)+e},v={s:p,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),s=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+p(s,2,"0")+":"+p(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var s=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(s,c),r=n-i<0,o=t.clone().add(s+(r?-1:1),c);return+(-(s+(n-i)/(r?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:d,w:a,d:o,D:u,h:r,m:i,s,ms:n,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",y={};y[b]=g;var _=function(e){return e instanceof E},w=function(e,t,n){var s;if(!e)return b;if("string"==typeof e)y[e]&&(s=e),t&&(y[e]=t,s=e);else{var i=e.name;y[i]=e,s=i}return!n&&s&&(b=s),s||!n&&b},S=function(e,t){if(_(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new E(n)},x=v;x.l=w,x.i=_,x.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function g(e){this.$L=w(e.locale,null,!0),this.parse(e)}var p=g.prototype;return p.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(x.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var s=t.match(m);if(s){var i=s[2]-1||0,r=(s[7]||"0").substring(0,3);return n?new Date(Date.UTC(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)):new Date(s[1],i,s[3]||1,s[4]||0,s[5]||0,s[6]||0,r)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},p.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},p.$utils=function(){return x},p.isValid=function(){return!(this.$d.toString()===h)},p.isSame=function(e,t){var n=S(e);return this.startOf(t)<=n&&n<=this.endOf(t)},p.isAfter=function(e,t){return S(e)<this.startOf(t)},p.isBefore=function(e,t){return this.endOf(t)<S(e)},p.$g=function(e,t,n){return x.u(e)?this[t]:this.set(n,e)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(e,t){var n=this,l=!!x.u(t)||t,h=x.p(e),m=function(e,t){var s=x.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return l?s:s.endOf(o)},f=function(e,t){return x.w(n.toDate()[e].apply(n.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,p=this.$M,v=this.$D,b="set"+(this.$u?"UTC":"");switch(h){case d:return l?m(1,0):m(31,11);case c:return l?m(1,p):m(0,p+1);case a:var y=this.$locale().weekStart||0,_=(g<y?g+7:g)-y;return m(l?v-_:v+(6-_),p);case o:case u:return f(b+"Hours",0);case r:return f(b+"Minutes",1);case i:return f(b+"Seconds",2);case s:return f(b+"Milliseconds",3);default:return this.clone()}},p.endOf=function(e){return this.startOf(e,!1)},p.$set=function(e,t){var a,l=x.p(e),h="set"+(this.$u?"UTC":""),m=(a={},a[o]=h+"Date",a[u]=h+"Date",a[c]=h+"Month",a[d]=h+"FullYear",a[r]=h+"Hours",a[i]=h+"Minutes",a[s]=h+"Seconds",a[n]=h+"Milliseconds",a)[l],f=l===o?this.$D+(t-this.$W):t;if(l===c||l===d){var g=this.clone().set(u,1);g.$d[m](f),g.init(),this.$d=g.set(u,Math.min(this.$D,g.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},p.set=function(e,t){return this.clone().$set(e,t)},p.get=function(e){return this[x.p(e)]()},p.add=function(n,l){var u,h=this;n=Number(n);var m=x.p(l),f=function(e){var t=S(h);return x.w(t.date(t.date()+Math.round(e*n)),h)};if(m===c)return this.set(c,this.$M+n);if(m===d)return this.set(d,this.$y+n);if(m===o)return f(1);if(m===a)return f(7);var g=(u={},u[i]=e,u[r]=t,u[s]=1e3,u)[m]||1,p=this.$d.getTime()+n*g;return x.w(p,this)},p.subtract=function(e,t){return this.add(-1*e,t)},p.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var s=e||"YYYY-MM-DDTHH:mm:ssZ",i=x.z(this),r=this.$H,o=this.$m,a=this.$M,c=n.weekdays,l=n.months,d=function(e,n,i,r){return e&&(e[n]||e(t,s))||i[n].substr(0,r)},u=function(e){return x.s(r%12||12,e,"0")},m=n.meridiem||function(e,t,n){var s=e<12?"AM":"PM";return n?s.toLowerCase():s},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:x.s(a+1,2,"0"),MMM:d(n.monthsShort,a,l,3),MMMM:d(l,a),D:this.$D,DD:x.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,c,2),ddd:d(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(r),HH:x.s(r,2,"0"),h:u(1),hh:u(2),a:m(r,o,!0),A:m(r,o,!1),m:String(o),mm:x.s(o,2,"0"),s:String(this.$s),ss:x.s(this.$s,2,"0"),SSS:x.s(this.$ms,3,"0"),Z:i};return s.replace(f,(function(e,t){return t||g[e]||i.replace(":","")}))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(n,u,h){var m,f=x.p(u),g=S(n),p=(g.utcOffset()-this.utcOffset())*e,v=this-g,b=x.m(this,g);return b=(m={},m[d]=b/12,m[c]=b,m[l]=b/3,m[a]=(v-p)/6048e5,m[o]=(v-p)/864e5,m[r]=v/t,m[i]=v/e,m[s]=v/1e3,m)[f]||v,h?b:x.a(b)},p.daysInMonth=function(){return this.endOf(c).$D},p.$locale=function(){return y[this.$L]},p.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),s=w(e,t,!0);return s&&(n.$L=s),n},p.clone=function(){return x.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},g}(),A=E.prototype;return S.prototype=A,[["$ms",n],["$s",s],["$m",i],["$H",r],["$W",o],["$M",c],["$y",d],["$D",u]].forEach((function(e){A[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,E,S),e.$i=!0),S},S.locale=w,S.isDayjs=_,S.unix=function(e){return S(1e3*e)},S.en=y[b],S.Ls=y,S.p={},S}()},8674:function(e){e.exports=function(){"use strict";return function(e,t,n){var s=t.prototype,i=s.format;n.en.ordinal=function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"},s.format=function(e){var t=this,n=this.$locale(),s=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return s.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return s.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return s.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return i.bind(this)(r)}}}()},1041:function(e){e.exports=function(){"use strict";var e=Object.hasOwnProperty,t=Object.setPrototypeOf,n=Object.isFrozen,s=Object.getPrototypeOf,i=Object.getOwnPropertyDescriptor,r=Object.freeze,o=Object.seal,a=Object.create,c="undefined"!=typeof Reflect&&Reflect,l=c.apply,d=c.construct;l||(l=function(e,t,n){return e.apply(t,n)}),r||(r=function(e){return e}),o||(o=function(e){return e}),d||(d=function(e,t){return new(Function.prototype.bind.apply(e,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t))))});var u,h=S(Array.prototype.forEach),m=S(Array.prototype.pop),f=S(Array.prototype.push),g=S(String.prototype.toLowerCase),p=S(String.prototype.match),v=S(String.prototype.replace),b=S(String.prototype.indexOf),y=S(String.prototype.trim),_=S(RegExp.prototype.test),w=(u=TypeError,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return d(u,t)});function S(e){return function(t){for(var n=arguments.length,s=Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return l(e,t,s)}}function x(e,s){t&&t(e,null);for(var i=s.length;i--;){var r=s[i];if("string"==typeof r){var o=g(r);o!==r&&(n(s)||(s[i]=o),r=o)}e[r]=!0}return e}function E(t){var n=a(null),s=void 0;for(s in t)l(e,t,[s])&&(n[s]=t[s]);return n}function A(e,t){for(;null!==e;){var n=i(e,t);if(n){if(n.get)return S(n.get);if("function"==typeof n.value)return S(n.value)}e=s(e)}return function(e){return console.warn("fallback value for",e),null}}var C=r(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),T=r(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),k=r(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),j=r(["animate","color-profile","cursor","discard","fedropshadow","feimage","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),N=r(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),O=r(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$=r(["#text"]),I=r(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),M=r(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),R=r(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),D=r(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),L=o(/\{\{[\s\S]*|[\s\S]*\}\}/gm),z=o(/<%[\s\S]*|[\s\S]*%>/gm),P=o(/^data-[\-\w.\u00B7-\uFFFF]/),F=o(/^aria-[\-\w]+$/),U=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),B=o(/^(?:\w+script|data):/i),q=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function G(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var W=function(){return"undefined"==typeof window?null:window},V=function(e,t){if("object"!==(void 0===e?"undefined":H(e))||"function"!=typeof e.createPolicy)return null;var n=null,s="data-tt-policy-suffix";t.currentScript&&t.currentScript.hasAttribute(s)&&(n=t.currentScript.getAttribute(s));var i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}};return function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W(),n=function(t){return e(t)};if(n.version="2.3.1",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var s=t.document,i=t.document,o=t.DocumentFragment,a=t.HTMLTemplateElement,c=t.Node,l=t.Element,d=t.NodeFilter,u=t.NamedNodeMap,S=void 0===u?t.NamedNodeMap||t.MozNamedAttrMap:u,J=t.Text,K=t.Comment,Y=t.DOMParser,Q=t.trustedTypes,X=l.prototype,Z=A(X,"cloneNode"),ee=A(X,"nextSibling"),te=A(X,"childNodes"),ne=A(X,"parentNode");if("function"==typeof a){var se=i.createElement("template");se.content&&se.content.ownerDocument&&(i=se.content.ownerDocument)}var ie=V(Q,s),re=ie&&Le?ie.createHTML(""):"",oe=i,ae=oe.implementation,ce=oe.createNodeIterator,le=oe.createDocumentFragment,de=oe.getElementsByTagName,ue=s.importNode,he={};try{he=E(i).documentMode?i.documentMode:{}}catch(e){}var me={};n.isSupported="function"==typeof ne&&ae&&void 0!==ae.createHTMLDocument&&9!==he;var fe=L,ge=z,pe=P,ve=F,be=B,ye=q,_e=U,we=null,Se=x({},[].concat(G(C),G(T),G(k),G(N),G($))),xe=null,Ee=x({},[].concat(G(I),G(M),G(R),G(D))),Ae=null,Ce=null,Te=!0,ke=!0,je=!1,Ne=!1,Oe=!1,$e=!1,Ie=!1,Me=!1,Re=!1,De=!0,Le=!1,ze=!0,Pe=!0,Fe=!1,Ue={},Be=null,qe=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),He=null,Ge=x({},["audio","video","img","source","image","track"]),We=null,Ve=x({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Je="http://www.w3.org/1998/Math/MathML",Ke="http://www.w3.org/2000/svg",Ye="http://www.w3.org/1999/xhtml",Qe=Ye,Xe=!1,Ze=null,et=i.createElement("form"),tt=function(e){Ze&&Ze===e||(e&&"object"===(void 0===e?"undefined":H(e))||(e={}),e=E(e),we="ALLOWED_TAGS"in e?x({},e.ALLOWED_TAGS):Se,xe="ALLOWED_ATTR"in e?x({},e.ALLOWED_ATTR):Ee,We="ADD_URI_SAFE_ATTR"in e?x(E(Ve),e.ADD_URI_SAFE_ATTR):Ve,He="ADD_DATA_URI_TAGS"in e?x(E(Ge),e.ADD_DATA_URI_TAGS):Ge,Be="FORBID_CONTENTS"in e?x({},e.FORBID_CONTENTS):qe,Ae="FORBID_TAGS"in e?x({},e.FORBID_TAGS):{},Ce="FORBID_ATTR"in e?x({},e.FORBID_ATTR):{},Ue="USE_PROFILES"in e&&e.USE_PROFILES,Te=!1!==e.ALLOW_ARIA_ATTR,ke=!1!==e.ALLOW_DATA_ATTR,je=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Ne=e.SAFE_FOR_TEMPLATES||!1,Oe=e.WHOLE_DOCUMENT||!1,Me=e.RETURN_DOM||!1,Re=e.RETURN_DOM_FRAGMENT||!1,De=!1!==e.RETURN_DOM_IMPORT,Le=e.RETURN_TRUSTED_TYPE||!1,Ie=e.FORCE_BODY||!1,ze=!1!==e.SANITIZE_DOM,Pe=!1!==e.KEEP_CONTENT,Fe=e.IN_PLACE||!1,_e=e.ALLOWED_URI_REGEXP||_e,Qe=e.NAMESPACE||Ye,Ne&&(ke=!1),Re&&(Me=!0),Ue&&(we=x({},[].concat(G($))),xe=[],!0===Ue.html&&(x(we,C),x(xe,I)),!0===Ue.svg&&(x(we,T),x(xe,M),x(xe,D)),!0===Ue.svgFilters&&(x(we,k),x(xe,M),x(xe,D)),!0===Ue.mathMl&&(x(we,N),x(xe,R),x(xe,D))),e.ADD_TAGS&&(we===Se&&(we=E(we)),x(we,e.ADD_TAGS)),e.ADD_ATTR&&(xe===Ee&&(xe=E(xe)),x(xe,e.ADD_ATTR)),e.ADD_URI_SAFE_ATTR&&x(We,e.ADD_URI_SAFE_ATTR),e.FORBID_CONTENTS&&(Be===qe&&(Be=E(Be)),x(Be,e.FORBID_CONTENTS)),Pe&&(we["#text"]=!0),Oe&&x(we,["html","head","body"]),we.table&&(x(we,["tbody"]),delete Ae.tbody),r&&r(e),Ze=e)},nt=x({},["mi","mo","mn","ms","mtext"]),st=x({},["foreignobject","desc","title","annotation-xml"]),it=x({},T);x(it,k),x(it,j);var rt=x({},N);x(rt,O);var ot=function(e){var t=ne(e);t&&t.tagName||(t={namespaceURI:Ye,tagName:"template"});var n=g(e.tagName),s=g(t.tagName);if(e.namespaceURI===Ke)return t.namespaceURI===Ye?"svg"===n:t.namespaceURI===Je?"svg"===n&&("annotation-xml"===s||nt[s]):Boolean(it[n]);if(e.namespaceURI===Je)return t.namespaceURI===Ye?"math"===n:t.namespaceURI===Ke?"math"===n&&st[s]:Boolean(rt[n]);if(e.namespaceURI===Ye){if(t.namespaceURI===Ke&&!st[s])return!1;if(t.namespaceURI===Je&&!nt[s])return!1;var i=x({},["title","style","font","a","script"]);return!rt[n]&&(i[n]||!it[n])}return!1},at=function(e){f(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=re}catch(t){e.remove()}}},ct=function(e,t){try{f(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){f(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!xe[e])if(Me||Re)try{at(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},lt=function(e){var t=void 0,n=void 0;if(Ie)e="<remove></remove>"+e;else{var s=p(e,/^[\r\n\t ]+/);n=s&&s[0]}var r=ie?ie.createHTML(e):e;if(Qe===Ye)try{t=(new Y).parseFromString(r,"text/html")}catch(e){}if(!t||!t.documentElement){t=ae.createDocument(Qe,"template",null);try{t.documentElement.innerHTML=Xe?"":r}catch(e){}}var o=t.body||t.documentElement;return e&&n&&o.insertBefore(i.createTextNode(n),o.childNodes[0]||null),Qe===Ye?de.call(t,Oe?"html":"body")[0]:Oe?t.documentElement:o},dt=function(e){return ce.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT,null,!1)},ut=function(e){return!(e instanceof J||e instanceof K||"string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof S&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI&&"function"==typeof e.insertBefore)},ht=function(e){return"object"===(void 0===c?"undefined":H(c))?e instanceof c:e&&"object"===(void 0===e?"undefined":H(e))&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},mt=function(e,t,s){me[e]&&h(me[e],(function(e){e.call(n,t,s,Ze)}))},ft=function(e){var t=void 0;if(mt("beforeSanitizeElements",e,null),ut(e))return at(e),!0;if(p(e.nodeName,/[\u0080-\uFFFF]/))return at(e),!0;var s=g(e.nodeName);if(mt("uponSanitizeElement",e,{tagName:s,allowedTags:we}),!ht(e.firstElementChild)&&(!ht(e.content)||!ht(e.content.firstElementChild))&&_(/<[/\w]/g,e.innerHTML)&&_(/<[/\w]/g,e.textContent))return at(e),!0;if("select"===s&&_(/<template/i,e.innerHTML))return at(e),!0;if(!we[s]||Ae[s]){if(Pe&&!Be[s]){var i=ne(e)||e.parentNode,r=te(e)||e.childNodes;if(r&&i)for(var o=r.length-1;o>=0;--o)i.insertBefore(Z(r[o],!0),ee(e))}return at(e),!0}return e instanceof l&&!ot(e)?(at(e),!0):"noscript"!==s&&"noembed"!==s||!_(/<\/no(script|embed)/i,e.innerHTML)?(Ne&&3===e.nodeType&&(t=e.textContent,t=v(t,fe," "),t=v(t,ge," "),e.textContent!==t&&(f(n.removed,{element:e.cloneNode()}),e.textContent=t)),mt("afterSanitizeElements",e,null),!1):(at(e),!0)},gt=function(e,t,n){if(ze&&("id"===t||"name"===t)&&(n in i||n in et))return!1;if(ke&&!Ce[t]&&_(pe,t));else if(Te&&_(ve,t));else{if(!xe[t]||Ce[t])return!1;if(We[t]);else if(_(_e,v(n,ye,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==b(n,"data:")||!He[e])if(je&&!_(be,v(n,ye,"")));else if(n)return!1}return!0},pt=function(e){var t=void 0,s=void 0,i=void 0,r=void 0;mt("beforeSanitizeAttributes",e,null);var o=e.attributes;if(o){var a={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:xe};for(r=o.length;r--;){var c=t=o[r],l=c.name,d=c.namespaceURI;if(s=y(t.value),i=g(l),a.attrName=i,a.attrValue=s,a.keepAttr=!0,a.forceKeepAttr=void 0,mt("uponSanitizeAttribute",e,a),s=a.attrValue,!a.forceKeepAttr&&(ct(l,e),a.keepAttr))if(_(/\/>/i,s))ct(l,e);else{Ne&&(s=v(s,fe," "),s=v(s,ge," "));var u=e.nodeName.toLowerCase();if(gt(u,i,s))try{d?e.setAttributeNS(d,l,s):e.setAttribute(l,s),m(n.removed)}catch(e){}}}mt("afterSanitizeAttributes",e,null)}},vt=function e(t){var n=void 0,s=dt(t);for(mt("beforeSanitizeShadowDOM",t,null);n=s.nextNode();)mt("uponSanitizeShadowNode",n,null),ft(n)||(n.content instanceof o&&e(n.content),pt(n));mt("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(e,i){var r=void 0,a=void 0,l=void 0,d=void 0,u=void 0;if((Xe=!e)&&(e="\x3c!--\x3e"),"string"!=typeof e&&!ht(e)){if("function"!=typeof e.toString)throw w("toString is not a function");if("string"!=typeof(e=e.toString()))throw w("dirty is not a string, aborting")}if(!n.isSupported){if("object"===H(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof e)return t.toStaticHTML(e);if(ht(e))return t.toStaticHTML(e.outerHTML)}return e}if($e||tt(i),n.removed=[],"string"==typeof e&&(Fe=!1),Fe);else if(e instanceof c)1===(a=(r=lt("\x3c!----\x3e")).ownerDocument.importNode(e,!0)).nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?r=a:r.appendChild(a);else{if(!Me&&!Ne&&!Oe&&-1===e.indexOf("<"))return ie&&Le?ie.createHTML(e):e;if(!(r=lt(e)))return Me?null:re}r&&Ie&&at(r.firstChild);for(var h=dt(Fe?e:r);l=h.nextNode();)3===l.nodeType&&l===d||ft(l)||(l.content instanceof o&&vt(l.content),pt(l),d=l);if(d=null,Fe)return e;if(Me){if(Re)for(u=le.call(r.ownerDocument);r.firstChild;)u.appendChild(r.firstChild);else u=r;return De&&(u=ue.call(s,u,!0)),u}var m=Oe?r.outerHTML:r.innerHTML;return Ne&&(m=v(m,fe," "),m=v(m,ge," ")),ie&&Le?ie.createHTML(m):m},n.setConfig=function(e){tt(e),$e=!0},n.clearConfig=function(){Ze=null,$e=!1},n.isValidAttribute=function(e,t,n){Ze||tt({});var s=g(e),i=g(t);return gt(s,i,n)},n.addHook=function(e,t){"function"==typeof t&&(me[e]=me[e]||[],f(me[e],t))},n.removeHook=function(e){me[e]&&m(me[e])},n.removeHooks=function(e){me[e]&&(me[e]=[])},n.removeAllHooks=function(){me={}},n}()}()},2329:(e,t)=>{var n,s;s=function(e){"use strict";e=e||{};var t,n,s,i,r,o,a,c,l,d,u,h,m,f,g={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1,element:null,dataUrl:!1,win:window};(h={}).ff="undefined"!=typeof InstallTrigger,h.chrome=!!window.chrome,h.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,h.ie=!1,h.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h.supported=h.chrome||h.ff||h.opera;var p=[];u=function(){},c=!1;var v={ready:function(){c=!0,v.reset(),u()},reset:function(){c&&(p=[],l=!1,d=!1,o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),_.setIcon(r),window.clearTimeout(m),window.clearTimeout(void 0))},start:function(){if(c&&!d&&p.length>0){d=!0;var e=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach((function(e){e in p[0].options&&(t[e]=p[0].options[e])})),x.run(p[0].options,(function(){l=p[0],d=!1,p.length>0&&(p.shift(),v.start())}),!1)};l?x.run(l.options,(function(){e()}),!0):e()}}},b={},y=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=i*e.x,e.y=s*e.y,e.w=i*e.w,e.h=s*e.h,e.len=(""+e.n).length,e};b.circle=function(e){var n=!1;2===(e=y(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,n=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,n=!0),o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+t.fontFamily,o.textAlign="center",n?(o.moveTo(e.x+e.w/2,e.y),o.lineTo(e.x+e.w-e.h/2,e.y),o.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),o.lineTo(e.x+e.w,e.y+e.h-e.h/2),o.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),o.lineTo(e.x+e.h/2,e.y+e.h),o.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),o.lineTo(e.x,e.y+e.h/2),o.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):o.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fill(),o.closePath(),o.beginPath(),o.stroke(),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()},b.rectangle=function(e){2===(e=y(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w),o.clearRect(0,0,i,s),o.drawImage(a,0,0,i,s),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+t.fontFamily,o.textAlign="center",o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fillRect(e.x,e.y,e.w,e.h),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()};var _={};function w(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,s){return t+t+n+n+s+s}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!!t&&{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}function S(e,t){var n,s={};for(n in e)s[n]=e[n];for(n in t)s[n]=t[n];return s}_.getIcons=function(){var e=[];return t.element?e=[t.element]:t.elementId?(e=[f.getElementById(t.elementId)])[0].setAttribute("href",e[0].getAttribute("src")):0===(e=function(){for(var e=[],t=f.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++)/(^|\s)icon(\s|$)/i.test(t[n].getAttribute("rel"))&&e.push(t[n]);return e}()).length&&((e=[f.createElement("link")])[0].setAttribute("rel","icon"),f.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach((function(e){e.setAttribute("type","image/png")})),e},_.setIcon=function(e){var t=e.toDataURL("image/png");_.setIconSrc(t)},_.setIconSrc=function(e){if(t.dataUrl&&t.dataUrl(e),t.element)t.element.setAttribute("href",e),t.element.setAttribute("src",e);else if(t.elementId){var s=f.getElementById(t.elementId);s.setAttribute("href",e),s.setAttribute("src",e)}else if(h.ff||h.opera){var i=n[n.length-1],r=f.createElement("link");n=[r],h.opera&&r.setAttribute("rel","icon"),r.setAttribute("rel","icon"),r.setAttribute("type","image/png"),f.getElementsByTagName("head")[0].appendChild(r),r.setAttribute("href",e),i.parentNode&&i.parentNode.removeChild(i)}else n.forEach((function(t){t.setAttribute("href",e)}))};var x={duration:40,types:{}};return x.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],x.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],x.run=function(e,n,s,i){var o=x.types[f.hidden||f.msHidden||f.webkitHidden||f.mozHidden?"none":t.animation];i=!0===s?void 0!==i?i:o.length-1:void 0!==i?i:0,n=n||function(){},i<o.length&&i>=0?(b[t.type](S(e,o[i])),m=setTimeout((function(){s?i-=1:i+=1,x.run(e,n,s,i)}),x.duration),_.setIcon(r)):n()},function(){(t=S(g,e)).bgColor=w(t.bgColor),t.textColor=w(t.textColor),t.position=t.position.toLowerCase(),t.animation=x.types[""+t.animation]?t.animation:g.animation,f=t.win.document;var c=t.position.indexOf("up")>-1,l=t.position.indexOf("left")>-1;if(c||l)for(var d in x.types)for(var u=0;u<x.types[d].length;u++){var h=x.types[d][u];c&&(h.y<.6?h.y=h.y-.4:h.y=h.y-2*h.y+(1-h.w)),l&&(h.x<.6?h.x=h.x-.4:h.x=h.x-2*h.x+(1-h.h)),x.types[d][u]=h}t.type=b[""+t.type]?t.type:g.type,n=_.getIcons(),r=document.createElement("canvas"),a=document.createElement("img");var m=n[n.length-1];m.hasAttribute("href")?(a.setAttribute("crossOrigin","anonymous"),a.onload=function(){s=a.height>0?a.height:32,i=a.width>0?a.width:32,r.height=s,r.width=i,o=r.getContext("2d"),v.ready()},a.setAttribute("src",m.getAttribute("href"))):(s=32,i=32,a.height=s,a.width=i,r.height=s,r.width=i,o=r.getContext("2d"),v.ready())}(),{badge:function(e,t){t=("string"==typeof t?{animation:t}:t)||{},u=function(){try{if("number"==typeof e?e>0:""!==e){var n={type:"badge",options:{n:e}};if("animation"in t&&x.types[""+t.animation]&&(n.options.animation=""+t.animation),"type"in t&&b[""+t.type]&&(n.options.type=""+t.type),["bgColor","textColor"].forEach((function(e){e in t&&(n.options[e]=w(t[e]))})),["fontStyle","fontFamily"].forEach((function(e){e in t&&(n.options[e]=t[e])})),p.push(n),p.length>100)throw new Error("Too many badges requests in queue.");v.start()}else v.reset()}catch(e){throw new Error("Error setting badge. Message: "+e.message)}},c&&u()},setOpt:function(e,n){var s=e;null==n&&"[object Object]"==Object.prototype.toString.call(e)||((s={})[e]=n);for(var i=Object.keys(s),r=0;r<i.length;r++)"bgColor"==i[r]||"textColor"==i[r]?t[i[r]]=w(s[i[r]]):t[i[r]]=s[i[r]];p.push(l),v.start()},reset:v.reset,browser:{supported:h.supported}}},void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)},3964:function(e){e.exports=function(){"use strict";var e=/^(b|B)$/,t={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},n={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]},s={floor:Math.floor,ceil:Math.ceil};function i(i){var r,o,a,c,l,d,u,h,m,f,g,p,v,b,y,_,w,S,x,E,A,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=[],k=0;if(isNaN(i))throw new TypeError("Invalid number");if(a=!0===C.bits,y=!0===C.unix,p=!0===C.pad,o=C.base||2,v=void 0!==C.round?C.round:y?1:2,u=void 0!==C.locale?C.locale:"",h=C.localeOptions||{},_=void 0!==C.separator?C.separator:"",w=void 0!==C.spacer?C.spacer:y?"":" ",x=C.symbols||{},S=2===o&&C.standard||"jedec",g=C.output||"string",l=!0===C.fullform,d=C.fullforms instanceof Array?C.fullforms:[],r=void 0!==C.exponent?C.exponent:-1,E=s[C.roundingMethod]||Math.round,m=(f=Number(i))<0,c=o>2?1e3:1024,A=!1===isNaN(C.precision)?parseInt(C.precision,10):0,m&&(f=-f),(-1===r||isNaN(r))&&(r=Math.floor(Math.log(f)/Math.log(c)))<0&&(r=0),r>8&&(A>0&&(A+=8-r),r=8),"exponent"===g)return r;if(0===f)T[0]=0,b=T[1]=y?"":t[S][a?"bits":"bytes"][r];else{k=f/(2===o?Math.pow(2,10*r):Math.pow(1e3,r)),a&&(k*=8)>=c&&r<8&&(k/=c,r++);var j=Math.pow(10,r>0?v:0);T[0]=E(k*j)/j,T[0]===c&&r<8&&void 0===C.exponent&&(T[0]=1,r++),b=T[1]=10===o&&1===r?a?"kb":"kB":t[S][a?"bits":"bytes"][r],y&&(T[1]="jedec"===S?T[1].charAt(0):r>0?T[1].replace(/B$/,""):T[1],e.test(T[1])&&(T[0]=Math.floor(T[0]),T[1]=""))}if(m&&(T[0]=-T[0]),A>0&&(T[0]=T[0].toPrecision(A)),T[1]=x[T[1]]||T[1],!0===u?T[0]=T[0].toLocaleString():u.length>0?T[0]=T[0].toLocaleString(u,h):_.length>0&&(T[0]=T[0].toString().replace(".",_)),p&&!1===Number.isInteger(T[0])&&v>0){var N=_||".",O=T[0].toString().split(N),$=O[1]||"",I=$.length,M=v-I;T[0]="".concat(O[0]).concat(N).concat($.padEnd(I+M,"0"))}return l&&(T[1]=d[r]?d[r]:n[S][r]+(a?"bit":"byte")+(1===T[0]?"":"s")),"array"===g?T:"object"===g?{value:T[0],symbol:T[1],exponent:r,unit:b}:T.join(w)}return i.partial=function(e){return function(t){return i(t,e)}},i}()},2501:(e,t,n)=>{"use strict";var s,i,r=n.g.MutationObserver||n.g.WebKitMutationObserver;if(r){var o=0,a=new r(u),c=n.g.document.createTextNode("");a.observe(c,{characterData:!0}),s=function(){c.data=o=++o%2}}else if(n.g.setImmediate||void 0===n.g.MessageChannel)s="document"in n.g&&"onreadystatechange"in n.g.document.createElement("script")?function(){var e=n.g.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},n.g.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new n.g.MessageChannel;l.port1.onmessage=u,s=function(){l.port2.postMessage(0)}}var d=[];function u(){var e,t;i=!0;for(var n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}i=!1}e.exports=function(e){1!==d.push(e)||i||s()}},6336:function(e,t){!function(n,s){var i=Array.prototype,r=Object.prototype,o=i.slice,a=r.hasOwnProperty,c=i.forEach,l={},d={forEach:function(e,t,n){var s,i,r;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(s=0,i=e.length;s<i;s++)if(s in e&&t.call(n,e[s],s,e)===l)return}else for(r in e)if(a.call(e,r)&&t.call(n,e[r],r,e)===l)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},u=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return u.PF.compile(e||"nplurals=2; plural=(n != 1);")}function m(e,t){this._key=e,this._i18n=t}u.context_delimiter=String.fromCharCode(4),d.extend(m.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?u.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(u.prototype,{translate:function(e){return new m(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,s,s,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,s,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,s,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,s,s,e,t,n)},dngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,s,t,n,i)},dcngettext:function(e,t,n,i){return this.dcnpgettext.call(this,e,s,t,n,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,s,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,i){return this.dcnpgettext.call(this,s,e,t,n,i)},dnpgettext:function(e,t,n,s,i){return this.dcnpgettext.call(this,e,t,n,s,i)},dcnpgettext:function(e,t,n,s,i){var r;if(s=s||n,e=e||this._textdomain,!this.options)return(r=new u).dcnpgettext.call(r,void 0,void 0,n,s,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,c,l=t?t+u.context_delimiter+n:n,d=this.options.locale_data,m=d[e],f=(d.messages||this.defaults.locale_data.messages)[""],g=m[""].plural_forms||m[""]["Plural-Forms"]||m[""]["plural-forms"]||f.plural_forms||f["Plural-Forms"]||f["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(g)(i)}if(!m)throw new Error("No domain named `"+e+"` could be found.");return!(o=m[l])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[n,s],!0===this.options.debug&&console.log(a[h(g)(i)]),a[h()(i)]):(a=o[c])||(a=[n,s])[h()(i)]}});var f,g=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,s){var i,r,o,a,c,l,d,u=1,h=n.length,m="",f=[];for(r=0;r<h;r++)if("string"===(m=e(n[r])))f.push(n[r]);else if("array"===m){if((a=n[r])[2])for(i=s[u],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw g('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?s[a[1]]:s[u++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw g("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(i).length,c=a[6]?t(l,d):"",f.push(a[5]?i+c:c+i)}return f.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],s=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))s.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))s.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){i|=1;var r=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";r.push(a[1])}n[2]=r}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";s.push(n)}t=t.substring(n[0].length)}return s},n}(),p=function(e,t){return t.unshift(e),g.apply(null,t)};u.parse_plural=function(e,t){return e=e.replace(/n/g,t),u.parse_expression(e)},u.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?p(e,[].slice.call(t)):g.apply(this,[].slice.call(arguments))},u.prototype.sprintf=function(){return u.sprintf.apply(this,arguments)},(u.PF={}).parse=function(e){var t=u.PF.extractPluralExpr(e);return u.PF.parser.parse.call(u.PF.parser,t)},u.PF.compile=function(e){var t=u.PF.parse(e);return function(e){return!0===(n=u.PF.interpreter(t)(e))?1:n||0;var n}},u.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return u.PF.interpreter(e.expr)(t);case"TERNARY":return u.PF.interpreter(e.expr)(t)?u.PF.interpreter(e.truthy)(t):u.PF.interpreter(e.falsey)(t);case"OR":return u.PF.interpreter(e.left)(t)||u.PF.interpreter(e.right)(t);case"AND":return u.PF.interpreter(e.left)(t)&&u.PF.interpreter(e.right)(t);case"LT":return u.PF.interpreter(e.left)(t)<u.PF.interpreter(e.right)(t);case"GT":return u.PF.interpreter(e.left)(t)>u.PF.interpreter(e.right)(t);case"LTE":return u.PF.interpreter(e.left)(t)<=u.PF.interpreter(e.right)(t);case"GTE":return u.PF.interpreter(e.left)(t)>=u.PF.interpreter(e.right)(t);case"EQ":return u.PF.interpreter(e.left)(t)==u.PF.interpreter(e.right)(t);case"NEQ":return u.PF.interpreter(e.left)(t)!=u.PF.interpreter(e.right)(t);case"MOD":return u.PF.interpreter(e.left)(t)%u.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},u.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,s=e.match(n);if(!(s.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(s[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},u.PF.parser=((f={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,s,i,r,o){var a=r.length-1;switch(i){case 1:return{type:"GROUP",expr:r[a-1]};case 2:this.$={type:"TERNARY",expr:r[a-4],truthy:r[a-2],falsey:r[a]};break;case 3:this.$={type:"OR",left:r[a-2],right:r[a]};break;case 4:this.$={type:"AND",left:r[a-2],right:r[a]};break;case 5:this.$={type:"LT",left:r[a-2],right:r[a]};break;case 6:this.$={type:"LTE",left:r[a-2],right:r[a]};break;case 7:this.$={type:"GT",left:r[a-2],right:r[a]};break;case 8:this.$={type:"GTE",left:r[a-2],right:r[a]};break;case 9:this.$={type:"NEQ",left:r[a-2],right:r[a]};break;case 10:this.$={type:"EQ",left:r[a-2],right:r[a]};break;case 11:this.$={type:"MOD",left:r[a-2],right:r[a]};break;case 12:this.$={type:"GROUP",expr:r[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],s=[null],i=[],r=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function u(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,m,f,g,p,v,b,y,_,w={};;){if(f=n[n.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null==h&&(h=u()),g=r[f]&&r[f][h]),void 0===g||!g.length||!g[0]){if(!l){for(v in _=[],r[f])this.terminals_[v]&&v>2&&_.push("'"+this.terminals_[v]+"'");var S="";S=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:_})}if(3==l){if(1==h)throw new Error(S||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=u()}for(;!(2..toString()in r[f]);){if(0==f)throw new Error(S||"Parsing halted.");1,n.length=n.length-2,s.length=s.length-1,i.length=i.length-1,f=n[n.length-1]}m=h,h=2,g=r[f=n[n.length-1]]&&r[f][2],l=3}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:n.push(h),s.push(this.lexer.yytext),i.push(this.lexer.yylloc),n.push(g[1]),h=null,m?(h=m,m=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,l>0&&l--);break;case 2:if(b=this.productions_[g[1]][1],w.$=s[s.length-b],w._$={first_line:i[i.length-(b||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(b||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(p=this.performAction.call(w,o,c,a,this.yy,g[1],s,i)))return p;b&&(n=n.slice(0,-1*b*2),s=s.slice(0,-1*b),i=i.slice(0,-1*b)),n.push(this.productions_[g[1]][0]),s.push(w.$),i.push(w._$),y=r[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}}).lexer={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),s=0;s<n.length;s++)if(e=this._input.match(this.rules[n[s]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[s],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,s){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}},f),e.exports&&(t=e.exports=u),t.Jed=u}()},7152:(e,t,n)=>{"use strict";var s=n(2501);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){s((function(){var s;try{s=t(n)}catch(t){return r.reject(e,t)}s===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,s)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var n=!1;function s(t){n||(n=!0,r.reject(e,t))}function i(t){n||(n=!0,r.resolve(e,t))}var o=f((function(){t(i,s)}));"error"===o.status&&s(o.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?u(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=f(h,t);if("error"===n.status)return r.reject(e,n.value);var s=n.value;if(s)m(e,s);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:r.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return r.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)d(e[c],c);return l;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||s||(s=!0,r.resolve(l,o))}),(function(e){s||(s=!0,r.reject(l,e))}))}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var s,o=-1,a=new this(i);++o<t;)s=e[o],this.resolve(s).then((function(e){n||(n=!0,r.resolve(a,e))}),(function(e){n||(n=!0,r.reject(a,e))}));return a}},5004:(e,t,n)=>{"use strict";"function"!=typeof n.g.Promise&&(n.g.Promise=n(7152))},2272:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t=/^~~local_forage_type~([^~]+)~/,n="__lfsc__:".length,s=n+"arbf".length,i=Object.prototype.toString;function r(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var s=new ArrayBuffer(t),i=new Uint8Array(s),r=0,o=0;r<n;r+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&d}return s}function o(e){for(var t=new Uint8Array(e),n="",s=0;s<t.length;s+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[s]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[s])<<4|t[s+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[s+1])<<2|t[s+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[s+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function a(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var s=e instanceof Date?new Date(e):e.constructor();try{for(var i=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(Object.keys(e)),r=i.next();!r.done;r=i.next()){var o=r.value;Object.prototype.hasOwnProperty.call(e,o)&&(e.isActiveClone=null,s[o]=a(e[o]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return s}function c(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function l(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function u(e,t){var n=this;if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(c(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var m={bufferToString:o,deserialize:function(e){if("__lfsc__:"!==e.substring(0,n))return JSON.parse(e);var i,o=e.substring(s),a=e.substring(n,s);if("blob"===a&&t.test(o)){var c=o.match(t);i=c[1],o=o.substring(c[0].length)}var l=r(o);switch(a){case"arbf":return l;case"blob":return function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}([l],{type:i});case"si08":return new Int8Array(l);case"ui08":return new Uint8Array(l);case"uic8":return new Uint8ClampedArray(l);case"si16":return new Int16Array(l);case"ur16":return new Uint16Array(l);case"si32":return new Int32Array(l);case"ui32":return new Uint32Array(l);case"fl32":return new Float32Array(l);case"fl64":return new Float64Array(l);default:throw new Error("Unkown type: "+a)}},serialize:function(e,t){var n="";if(e&&(n=i.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===i.call(e.buffer))){var s=void 0,r="__lfsc__:";e instanceof ArrayBuffer?(s=e,r+="arbf"):(s=e.buffer,"[object Int8Array]"===n?r+="si08":"[object Uint8Array]"===n?r+="ui08":"[object Uint8ClampedArray]"===n?r+="uic8":"[object Int16Array]"===n?r+="si16":"[object Uint16Array]"===n?r+="ur16":"[object Int32Array]"===n?r+="si32":"[object Uint32Array]"===n?r+="ui32":"[object Float32Array]"===n?r+="fl32":"[object Float64Array]"===n?r+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(r+o(s))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+o(this.result);t("__lfsc__:blob"+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},stringToBuffer:r},f={},g=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return f[t]||(f[t]=new e(t)),f[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete f[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();e._support=!0,e._driver="localforage-driver-memory",e._initStorage=function(e){var t=e?a(e):{},n=c(t,this._defaultConfig),s=g.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=m,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=s,Promise.resolve()},e.clear=function(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return l(n,e),n},e.dropInstance=function(e,t){var n=u.apply(this,arguments),s=n.promise,i=n.callback;return l(s.then((function(e){g.resolve(e).drop()})),i),s},e.getItem=function(e,t){var n=this;e=h(e);var s=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return l(s,t),s},e.iterate=function(e,t){var n=this,s=this.ready().then((function(){for(var t=n._dbInfo.mStore,s=t.keys(),i=0;i<s.length;i++){var r=t.get(s[i]);if(r&&(r=n._dbInfo.serializer.deserialize(r)),void 0!==(r=e(r,s[i],i+1)))return r}}));return l(s,t),s},e.key=function(e,t){var n=this,s=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return l(s,t),s},e.keys=function(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return l(n,e),n},e.length=function(e){var t=this.keys().then((function(e){return e.length}));return l(t,e),t},e.removeItem=function(e,t){var n=this;e=h(e);var s=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return l(s,t),s},e.setItem=function(e,t,n){var s=this;e=h(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,r){s._dbInfo.serializer.serialize(t,(function(t,o){if(o)r(o);else try{s._dbInfo.mStore.set(e,t),i(n)}catch(e){r(e)}}))}))}));return l(i,n),i},Object.defineProperty(e,"__esModule",{value:!0})}(t)},7667:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,s){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var r=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];r.push(s(t(c),n(c)))}}else for(var l in e)e.hasOwnProperty(l)&&r.push(s(l,e[l]));return r}function r(e,t,n,r){var o=this,a=o.ready().then((function(){return new Promise((function(s,r){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),d=l.objectStore(c.storeName);function u(e){var t=e.target||this;a=t.error||t.transaction.error,r(a)}l.oncomplete=function(){s(e)},l.onabort=l.onerror=function(e){r(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=u}))}))}));return s(a,r),a}function o(e,t,r,o){var a=this,c=new Promise((function(s,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,r,(function(e,t){return new Promise((function(s,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(l,[e,t],(function(){s()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){s(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return s(c,o),c}function a(e,t,n,r){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return s(c,r),c}function c(e,t,n,s){var i=this,c=i.driver();return c===i.INDEXEDDB?r.call(i,e,t,n,s):c===i.WEBSQL?o.call(i,e,t,n,s):a.call(i,e,t,n,s)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return r.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(6639))},1253:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=l(n(8584)),i=l(n(1060)),r=l(n(1161)),o=l(n(8681)),a=l(n(3415));t.default=function(e,t){var n=(0,c.getStorage)(),l=!(!n||!n[t]),d=l?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},u=d.clear.bind(d),h=d.get.bind(d),m=d.remove.bind(d),f=d.set.bind(d);return{_driver:e,_support:l,_initStorage:function(){return a.default.resolve()},clear:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(),e&&e();case 2:case"end":return t.stop()}}),n,t)})))()},iterate:function(e,t){var n=this;return(0,o.default)(r.default.mark((function s(){var o;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(h,null);case 2:o=n.sent,(0,i.default)(o).forEach((function(t,n){return e(o[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),s,n)})))()},getItem:function(e,t){var n=this;return(0,o.default)(r.default.mark((function s(){var i;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,c.usePromise)(h,e);case 3:return i=n.sent,i=void 0===(i="string"==typeof e?i[e]:i)?null:i,t&&t(null,i),n.abrupt("return",i);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),s,n,[[0,10]])})))()},key:function(e,t){var n=this;return(0,o.default)(r.default.mark((function s(){var o,a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(h,null);case 2:return o=n.sent,a=(0,i.default)(o)[e],t&&t(a),n.abrupt("return",a);case 6:case"end":return n.stop()}}),s,n)})))()},keys:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){var s,o;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.usePromise)(h,null);case 2:return s=t.sent,o=(0,i.default)(s),e&&e(o),t.abrupt("return",o);case 6:case"end":return t.stop()}}),n,t)})))()},length:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){var s,o;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.usePromise)(h,null);case 2:return s=t.sent,o=(0,i.default)(s).length,e&&e(o),t.abrupt("return",o);case 6:case"end":return t.stop()}}),n,t)})))()},removeItem:function(e,t){var n=this;return(0,o.default)(r.default.mark((function s(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,c.usePromise)(m,e);case 2:t&&t();case 3:case"end":return n.stop()}}),s,n)})))()},setItem:function(e,t,n){var i=this;return(0,o.default)(r.default.mark((function o(){return r.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,c.usePromise)(f,(0,s.default)({},e,t));case 2:n&&n();case 3:case"end":return i.stop()}}),o,i)})))()}}};var c=n(4136);function l(e){return e&&e.__esModule?e:{default:e}}},721:(e,t,n)=>{"use strict";var s,i=(s=n(1253))&&s.__esModule?s:{default:s};t.Z=(0,i.default)("webExtensionLocalStorage","local")},3634:(e,t,n)=>{"use strict";var s,i=(s=n(1253))&&s.__esModule?s:{default:s};t.Z=(0,i.default)("webExtensionSyncStorage","sync")},4136:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=(s=n(3415))&&s.__esModule?s:{default:s};function r(){return window.browser&&browser.storage||window.chrome&&chrome.storage}t.getStorage=r,t.usePromise=function(e,t){return function(){var e=r();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}()?e(t):new i.default((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},6639:(e,t,n)=>{e.exports=function e(t,n,s){function i(o,a){if(!n[o]){if(!t[o]){if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){return i(t[o][1][e]||e)}),l,l.exports,e,t,n,s)}return n[o].exports}for(var r=void 0,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e,t,s){(function(e){"use strict";var n,s,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;s=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}s=!1}t.exports=function(e){1!==l.push(e)||s||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var s=e(1);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){s((function(){var s;try{s=t(n)}catch(t){return r.reject(e,t)}s===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,s)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var n=!1;function s(t){n||(n=!0,r.reject(e,t))}function i(t){n||(n=!0,r.resolve(e,t))}var o=f((function(){t(i,s)}));"error"===o.status&&s(o.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?u(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=f(h,t);if("error"===n.status)return r.reject(e,n.value);var s=n.value;if(s)m(e,s);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:r.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return r.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,l=new this(i);++c<n;)d(e[c],c);return l;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||s||(s=!0,r.resolve(l,o))}),(function(e){s||(s=!0,r.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,s=e.length,o=!1;if(!s)return this.resolve([]);for(var a=-1,c=new this(i);++a<s;)n=e[a],t.resolve(n).then((function(e){o||(o=!0,r.resolve(c,e))}),(function(e){o||(o=!0,r.reject(c,e))}));return c}},{1:1}],3:[function(e,t,s){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u="local-forage-detect-blob-support",h=void 0,m={},f=Object.prototype.toString,g="readonly",p="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),i=0;i<t;i++)s[i]=e.charCodeAt(i);return n}function b(e){return"boolean"==typeof h?o.resolve(h):function(e){return new o((function(t){var n=e.transaction(u,p),s=r([""]);n.objectStore(u).put(s,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return h=e}))}function y(e){var t=m[e.name],n={};n.promise=new o((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function _(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function w(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function S(e,t){return new o((function(n,s){if(m[e.name]=m[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);y(e),e.db.close()}var r=[e.name];t&&r.push(e.version);var o=i.open.apply(i,r);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(u)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),s(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),_(e)}}))}function x(e){return S(e,!1)}function E(e){return S(e,!0)}function A(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,i=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function C(e){return r([v(atob(e.data))],{type:e.type})}function T(e){return e&&e.__local_forage_encoded_blob}function k(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function j(e,t,n,s){void 0===s&&(s=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(s>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)})).then((function(){return function(e){y(e);for(var t=m[e.name],n=t.forages,s=0;s<n.length;s++){var i=n[s];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,x(e).then((function(t){return e.db=t,A(e)?E(e):t})).then((function(s){e.db=t.db=s;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=s})).catch((function(t){throw w(e,t),t}))}(e).then((function(){j(e,t,n,s-1)}))})).catch(n);n(i)}}var N={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]=e[s];var i=m[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},m[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=k);var r=[];function a(){return o.resolve()}for(var c=0;c<i.forages.length;c++){var l=i.forages[c];l!==t&&r.push(l._initReady().catch(a))}var d=i.forages.slice(0);return o.all(r).then((function(){return n.db=i.db,x(n)})).then((function(e){return n.db=e,A(n,t._defaultConfig.version)?E(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var s=0;s<d.length;s++){var r=d[s];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=new o((function(t,s){n.ready().then((function(){j(n._dbInfo,g,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var s=n.value;T(s)&&(s=C(s));var i=e(s,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return a(s,t),s},getItem:function(e,t){var n=this;e=l(e);var s=new o((function(t,s){n.ready().then((function(){j(n._dbInfo,g,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),T(e)&&(e=C(e)),t(e)},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return a(s,t),s},setItem:function(e,t,n){var s=this;e=l(e);var i=new o((function(n,i){var r;s.ready().then((function(){return r=s._dbInfo,"[object Blob]"===f.call(t)?b(r.db).then((function(e){return e?t:(n=t,new o((function(e,t){var s=new FileReader;s.onerror=t,s.onloadend=function(t){var s=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:s,type:n.type})},s.readAsBinaryString(n)})));var n})):t})).then((function(t){j(s._dbInfo,p,(function(r,o){if(r)return i(r);try{var a=o.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,n),i},removeItem:function(e,t){var n=this;e=l(e);var s=new o((function(t,s){n.ready().then((function(){j(n._dbInfo,p,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){s(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return a(s,t),s},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){j(t._dbInfo,p,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){j(t._dbInfo,g,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,s=new o((function(t,s){e<0?t(null):n.ready().then((function(){j(n._dbInfo,g,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){s(c.error)}}catch(e){s(e)}}))})).catch(s)}));return a(s,t),s},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){j(t._dbInfo,g,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,r=this;if(e.name){var c=e.name===n.name&&r._dbInfo.db?o.resolve(r._dbInfo.db):x(e).then((function(t){var n=m[e.name],s=n.forages;n.db=t;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=t;return t}));s=e.storeName?c.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;y(e);var s=m[e.name],r=s.forages;t.close();for(var a=0;a<r.length;a++){var c=r[a];c._dbInfo.db=null,c._dbInfo.version=n}return new o((function(t,s){var r=i.open(e.name,n);r.onerror=function(e){r.result.close(),s(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(e.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}})).then((function(e){s.db=e;for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=e,_(n._dbInfo)}})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}})):c.then((function(t){y(e);var n=m[e.name],s=n.forages;t.close();for(var r=0;r<s.length;r++)s[r]._dbInfo.db=null;return new o((function(t,n){var s=i.deleteDatabase(e.name);s.onerror=function(){var e=s.result;e&&e.close(),n(s.error)},s.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},s.onsuccess=function(){var e=s.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<s.length;t++)_(s[t]._dbInfo)})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}))}else s=o.reject("Invalid arguments");return a(s,t),s}};var O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$=/^~~local_forage_type~([^~]+)~/,I="__lfsc__:",M=I.length,R="arbf",D="blob",L="si08",z="ui08",P="uic8",F="si16",U="si32",B="ur16",q="ui32",H="fl32",G="fl64",W=M+R.length,V=Object.prototype.toString;function J(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=O.indexOf(e[t]),s=O.indexOf(e[t+1]),i=O.indexOf(e[t+2]),r=O.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function K(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=O[n[t]>>2],s+=O[(3&n[t])<<4|n[t+1]>>4],s+=O[(15&n[t+1])<<2|n[t+2]>>6],s+=O[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}var Y={serialize:function(e,t){var n="";if(e&&(n=V.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===V.call(e.buffer))){var s,i=I;e instanceof ArrayBuffer?(s=e,i+=R):(s=e.buffer,"[object Int8Array]"===n?i+=L:"[object Uint8Array]"===n?i+=z:"[object Uint8ClampedArray]"===n?i+=P:"[object Int16Array]"===n?i+=F:"[object Uint16Array]"===n?i+=B:"[object Int32Array]"===n?i+=U:"[object Uint32Array]"===n?i+=q:"[object Float32Array]"===n?i+=H:"[object Float64Array]"===n?i+=G:t(new Error("Failed to get type for BinaryArray"))),t(i+K(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+K(this.result);t("__lfsc__:blob"+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,M)!==I)return JSON.parse(e);var t,n=e.substring(W),s=e.substring(M,W);if(s===D&&$.test(n)){var i=n.match($);t=i[1],n=n.substring(i[0].length)}var o=J(n);switch(s){case R:return o;case D:return r([o],{type:t});case L:return new Int8Array(o);case z:return new Uint8Array(o);case P:return new Uint8ClampedArray(o);case F:return new Int16Array(o);case B:return new Uint16Array(o);case U:return new Int32Array(o);case q:return new Uint32Array(o);case H:return new Float32Array(o);case G:return new Float64Array(o);default:throw new Error("Unkown type: "+s)}},stringToBuffer:J,bufferToString:K};function Q(e,t,n,s){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,s)}function X(e,t,n,s,i,r){e.executeSql(n,s,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):Q(e,t,(function(){e.executeSql(n,s,i,r)}),r)}),r):r(e,o)}),r)}function Z(e,t,n,s){var i=this;e=l(e);var r=new o((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){X(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(s>0)return void r(Z.apply(i,[e,a,n,s-1]));o(t)}}))}))})).catch(o)}));return a(r,n),r}function ee(e){return new o((function(t,n){e.transaction((function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,s){for(var i=[],r=0;r<s.rows.length;r++)i.push(s.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var te={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]="string"!=typeof e[s]?e[s].toString():e[s];var i=new o((function(e,s){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return s(e)}n.db.transaction((function(i){Q(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){s(t)}))}),s)}));return n.serializer=Y,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,s=new o((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT * FROM "+i.storeName,[],(function(n,s){for(var r=s.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){s(t)}))}))})).catch(s)}));return a(s,t),s},getItem:function(e,t){var n=this;e=l(e);var s=new o((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var s=n.rows.length?n.rows.item(0).value:null;s&&(s=i.serializer.deserialize(s)),t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return a(s,t),s},setItem:function(e,t,n){return Z.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var s=new o((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){s(t)}))}))})).catch(s)}));return a(s,t),s},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){X(t,s,"DELETE FROM "+s.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){X(t,s,"SELECT COUNT(key) as c FROM "+s.storeName,[],(function(t,n){var s=n.rows.item(0).c;e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,s=new o((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var s=n.rows.length?n.rows.item(0).key:null;t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return a(s,t),s},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){X(t,s,"SELECT key FROM "+s.storeName,[],(function(t,n){for(var s=[],i=0;i<n.rows.length;i++)s.push(n.rows.item(i).key);e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;return a(s=e.name?new o((function(t){var s;s=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(ee(s))})).then((function(e){return new o((function(t,n){e.db.transaction((function(s){function i(e){return new o((function(t,n){s.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var r=[],a=0,c=e.storeNames.length;a<c;a++)r.push(i(e.storeNames[a]));o.all(r).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments"),t),s}};function ne(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function se(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var ie={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ne(e,this._defaultConfig),se()?(this._dbInfo=t,t.serializer=Y,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=n.ready().then((function(){for(var t=n._dbInfo,s=t.keyPrefix,i=s.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(s)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return a(s,t),s},getItem:function(e,t){var n=this;e=l(e);var s=n.ready().then((function(){var t=n._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s}));return a(s,t),s},setItem:function(e,t,n){var s=this;e=l(e);var i=s.ready().then((function(){void 0===t&&(t=null);var n=t;return new o((function(i,r){var o=s._dbInfo;o.serializer.serialize(t,(function(t,s){if(s)r(s);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return a(i,n),i},removeItem:function(e,t){var n=this;e=l(e);var s=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(s,t),s},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var s=localStorage.key(n);0===s.indexOf(e)&&localStorage.removeItem(s)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,s=n.ready().then((function(){var t,s=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t}));return a(s,t),s},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,s=[],i=0;i<n;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&s.push(r.substring(e.keyPrefix.length))}return s}));return a(n,e),n},dropInstance:function(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var s,i=this;return a(s=e.name?new o((function(t){e.storeName?t(ne(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments"),t),s}},re=function(e,t){for(var n=e.length,s=0;s<n;){if((i=e[s])===(r=t)||"number"==typeof i&&"number"==typeof r&&isNaN(i)&&isNaN(r))return!0;s++}var i,r;return!1},oe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ae={},ce={},le={INDEXEDDB:N,WEBSQL:te,LOCALSTORAGE:ie},de=[le.INDEXEDDB._driver,le.WEBSQL._driver,le.LOCALSTORAGE._driver],ue=["dropInstance"],he=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ue),me={description:"",driver:de.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function fe(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ge(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(oe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var pe=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),le)if(le.hasOwnProperty(n)){var s=le[n],i=s._driver;this[n]=i,ae[i]||this.defineDriver(s)}this._defaultConfig=ge({},me),this._config=ge({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":s(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var s=new o((function(t,n){try{var s=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var r=he.concat("_initStorage"),c=0,l=r.length;c<l;c++){var d=r[c];if((!re(ue,d)||e[d])&&"function"!=typeof e[d])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=o.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,s=ue.length;n<s;n++){var i=ue[n];e[i]||(e[i]=t(i))}}();var u=function(n){ae[s]&&console.info("Redefining LocalForage driver: "+s),ae[s]=e,ce[s]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,n):u(!!e._support):u(!0)}catch(e){n(e)}}));return c(s,t,n),s},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var s=ae[e]?o.resolve(ae[e]):o.reject(new Error("Driver not found."));return c(s,t,n),s},e.prototype.getSerializer=function(e){var t=o.resolve(Y);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var s=this;oe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function r(){s._config.driver=s.driver()}function a(e){return s._extend(e),r(),s._ready=s._initStorage(s._config),s._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve();return this._driverSet=l.then((function(){var e=i[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((function(e){s._driver=e._driver,r(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(i).then(a).catch(n)}r();var c=new Error("No available storage method found.");return s._driverSet=o.reject(c),s._driverSet}()}}(i)}))})).catch((function(){r();var e=new Error("No available storage method found.");return s._driverSet=o.reject(e),s._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!ce[e]},e.prototype._extend=function(e){ge(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,s=e.length;n<s;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=he.length;e<t;e++)fe(this,he[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=pe},{3:3}]},{},[4])(4)},6360:(e,t,n)=>{var s=n(8642).Symbol;e.exports=s},7291:(e,t,n)=>{var s=n(6360),i=n(4),r=n(73),o=s?s.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):r(e)}},3028:(e,t,n)=>{var s=n(4019),i=/^\s+/;e.exports=function(e){return e?e.slice(0,s(e)+1).replace(i,""):e}},6936:(e,t,n)=>{var s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=s},4:(e,t,n)=>{var s=n(6360),i=Object.prototype,r=i.hasOwnProperty,o=i.toString,a=s?s.toStringTag:void 0;e.exports=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var s=!0}catch(e){}var i=o.call(e);return s&&(t?e[a]=n:delete e[a]),i}},73:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},8642:(e,t,n)=>{var s=n(6936),i="object"==typeof self&&self&&self.Object===Object&&self,r=s||i||Function("return this")();e.exports=r},4019:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},4971:(e,t,n)=>{var s=n(4727),i=n(2301),r=n(1636),o=Math.max,a=Math.min;e.exports=function(e,t,n){var c,l,d,u,h,m,f=0,g=!1,p=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=c,s=l;return c=l=void 0,f=t,u=e.apply(s,n)}function y(e){return f=e,h=setTimeout(w,t),g?b(e):u}function _(e){var n=e-m;return void 0===m||n>=t||n<0||p&&e-f>=d}function w(){var e=i();if(_(e))return S(e);h=setTimeout(w,function(e){var n=t-(e-m);return p?a(n,d-(e-f)):n}(e))}function S(e){return h=void 0,v&&c?b(e):(c=l=void 0,u)}function x(){var e=i(),n=_(e);if(c=arguments,l=this,m=e,n){if(void 0===h)return y(m);if(p)return clearTimeout(h),h=setTimeout(w,t),b(m)}return void 0===h&&(h=setTimeout(w,t)),u}return t=r(t)||0,s(n)&&(g=!!n.leading,d=(p="maxWait"in n)?o(r(n.maxWait)||0,t):d,v="trailing"in n?!!n.trailing:v),x.cancel=function(){void 0!==h&&clearTimeout(h),f=0,c=m=l=h=void 0},x.flush=function(){return void 0===h?u:S(i())},x}},4727:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7837:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},7946:(e,t,n)=>{var s=n(7291),i=n(7837);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==s(e)}},2301:(e,t,n)=>{var s=n(8642);e.exports=function(){return s.Date.now()}},1636:(e,t,n)=>{var s=n(3028),i=n(4727),r=n(7946),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=s(e);var n=a.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):o.test(e)?NaN:+e}},1751:(e,t,n)=>{var s;!function(i){var r,o,a,c,l,d,u,h,m,f,g,p,v,b,y,_,w,S,x,E="sizzle"+1*new Date,A=i.document,C=0,T=0,k=he(),j=he(),N=he(),O=he(),$=function(e,t){return e===t&&(g=!0),0},I={}.hasOwnProperty,M=[],R=M.pop,D=M.push,L=M.push,z=M.slice,P=function(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\[[\\x20\\t\\r\\n\\f]*("+B+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+U+"*\\]",H=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",G=new RegExp(U+"+","g"),W=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),V=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),J=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),K=new RegExp(U+"|>"),Y=new RegExp(H),Q=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,se=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,re=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){p()},de=Ee((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{L.apply(M=z.call(A.childNodes),A.childNodes),M[A.childNodes.length].nodeType}catch(e){L={apply:M.length?function(e,t){D.apply(e,z.call(t))}:function(e,t){for(var n=e.length,s=0;e[n++]=t[s++];);e.length=n-1}}}function ue(e,t,n,s){var i,r,a,c,l,u,m,f=t&&t.ownerDocument,g=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return n;if(!s&&(p(t),t=t||v,y)){if(11!==g&&(l=se.exec(e)))if(i=l[1]){if(9===g){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&x(t,a)&&a.id===i)return n.push(a),n}else{if(l[2])return L.apply(n,t.getElementsByTagName(e)),n;if((i=l[3])&&o.getElementsByClassName&&t.getElementsByClassName)return L.apply(n,t.getElementsByClassName(i)),n}if(o.qsa&&!O[e+" "]&&(!_||!_.test(e))&&(1!==g||"object"!==t.nodeName.toLowerCase())){if(m=e,f=t,1===g&&(K.test(e)||J.test(e))){for((f=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=E)),r=(u=d(e)).length;r--;)u[r]=(c?"#"+c:":scope")+" "+xe(u[r]);m=u.join(",")}try{return L.apply(n,f.querySelectorAll(m)),n}catch(t){O(e,!0)}finally{c===E&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,n,s)}function he(){var e=[];return function t(n,s){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=s}}function me(e){return e[E]=!0,e}function fe(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ge(e,t){for(var n=e.split("|"),s=n.length;s--;)a.attrHandle[n[s]]=t}function pe(e,t){var n=t&&e,s=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(s)return s;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function be(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function _e(e){return me((function(t){return t=+t,me((function(n,s){for(var i,r=e([],n.length,t),o=r.length;o--;)n[i=r[o]]&&(n[i]=!(s[i]=n[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(r in o=ue.support={},l=ue.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},p=ue.setDocument=function(e){var t,n,s=e?e.ownerDocument||e:A;return s!=v&&9===s.nodeType&&s.documentElement?(b=(v=s).documentElement,y=!l(v),A!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",le,!1):n.attachEvent&&n.attachEvent("onunload",le)),o.scope=fe((function(e){return b.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.attributes=fe((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=fe((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=fe((function(e){return b.appendChild(e).id=E,!v.getElementsByName||!v.getElementsByName(E).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,s,i,r=t.getElementById(e);if(r){if((n=r.getAttributeNode("id"))&&n.value===e)return[r];for(i=t.getElementsByName(e),s=0;r=i[s++];)if((n=r.getAttributeNode("id"))&&n.value===e)return[r]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,s=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[i++];)1===n.nodeType&&s.push(n);return s}return r},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},w=[],_=[],(o.qsa=ne.test(v.querySelectorAll))&&(fe((function(e){var t;b.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&_.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||_.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+F+")"),e.querySelectorAll("[id~="+E+"-]").length||_.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||_.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||_.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||_.push(".#.+[+~]"),e.querySelectorAll("\\\f"),_.push("[\\r\\n\\f]")})),fe((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&_.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&_.push(":enabled",":disabled"),b.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&_.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),_.push(",.*:")}))),(o.matchesSelector=ne.test(S=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.oMatchesSelector||b.msMatchesSelector))&&fe((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",H)})),_=_.length&&new RegExp(_.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(b.compareDocumentPosition),x=t||ne.test(b.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,s=t&&t.parentNode;return e===s||!(!s||1!==s.nodeType||!(n.contains?n.contains(s):e.compareDocumentPosition&&16&e.compareDocumentPosition(s)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},$=t?function(e,t){if(e===t)return g=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==A&&x(A,e)?-1:t==v||t.ownerDocument==A&&x(A,t)?1:f?P(f,e)-P(f,t):0:4&n?-1:1)}:function(e,t){if(e===t)return g=!0,0;var n,s=0,i=e.parentNode,r=t.parentNode,o=[e],a=[t];if(!i||!r)return e==v?-1:t==v?1:i?-1:r?1:f?P(f,e)-P(f,t):0;if(i===r)return pe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[s]===a[s];)s++;return s?pe(o[s],a[s]):o[s]==A?-1:a[s]==A?1:0},v):v},ue.matches=function(e,t){return ue(e,null,null,t)},ue.matchesSelector=function(e,t){if(p(e),o.matchesSelector&&y&&!O[t+" "]&&(!w||!w.test(t))&&(!_||!_.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){O(t,!0)}return ue(t,v,null,[e]).length>0},ue.contains=function(e,t){return(e.ownerDocument||e)!=v&&p(e),x(e,t)},ue.attr=function(e,t){(e.ownerDocument||e)!=v&&p(e);var n=a.attrHandle[t.toLowerCase()],s=n&&I.call(a.attrHandle,t.toLowerCase())?n(e,t,!y):void 0;return void 0!==s?s:o.attributes||!y?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ue.escape=function(e){return(e+"").replace(ae,ce)},ue.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ue.uniqueSort=function(e){var t,n=[],s=0,i=0;if(g=!o.detectDuplicates,f=!o.sortStable&&e.slice(0),e.sort($),g){for(;t=e[i++];)t===e[i]&&(s=n.push(i));for(;s--;)e.splice(n[s],1)}return f=null,e},c=ue.getText=function(e){var t,n="",s=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[s++];)n+=c(t);return n},(a=ue.selectors={cacheLength:50,createPseudo:me,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(re,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(re,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ue.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ue.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(re,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+U+"|$)"))&&k(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(s){var i=ue.attr(s,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(G," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,s,i){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===s&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var l,d,u,h,m,f,g=r!==o?"nextSibling":"previousSibling",p=t.parentNode,v=a&&t.nodeName.toLowerCase(),b=!c&&!a,y=!1;if(p){if(r){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?p.firstChild:p.lastChild],o&&b){for(y=(m=(l=(d=(u=(h=p)[E]||(h[E]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===C&&l[1])&&l[2],h=m&&p.childNodes[m];h=++m&&h&&h[g]||(y=m=0)||f.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[C,m,y];break}}else if(b&&(y=m=(l=(d=(u=(h=t)[E]||(h[E]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===C&&l[1]),!1===y)for(;(h=++m&&h&&h[g]||(y=m=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(b&&((d=(u=h[E]||(h[E]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[C,y]),h!==t)););return(y-=i)===s||y%s==0&&y/s>=0}}},PSEUDO:function(e,t){var n,s=a.pseudos[e]||a.setFilters[e.toLowerCase()]||ue.error("unsupported pseudo: "+e);return s[E]?s(t):s.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?me((function(e,n){for(var i,r=s(e,t),o=r.length;o--;)e[i=P(e,r[o])]=!(n[i]=r[o])})):function(e){return s(e,0,n)}):s}},pseudos:{not:me((function(e){var t=[],n=[],s=u(e.replace(W,"$1"));return s[E]?me((function(e,t,n,i){for(var r,o=s(e,null,i,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))})):function(e,i,r){return t[0]=e,s(t,null,r,n),t[0]=null,!n.pop()}})),has:me((function(e){return function(t){return ue(e,t).length>0}})),contains:me((function(e){return e=e.replace(re,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:me((function(e){return Q.test(e||"")||ue.error("unsupported lang: "+e),e=e.replace(re,oe).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===b},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:_e((function(){return[0]})),last:_e((function(e,t){return[t-1]})),eq:_e((function(e,t,n){return[n<0?n+t:n]})),even:_e((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:_e((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:_e((function(e,t,n){for(var s=n<0?n+t:n>t?t:n;--s>=0;)e.push(s);return e})),gt:_e((function(e,t,n){for(var s=n<0?n+t:n;++s<t;)e.push(s);return e}))}}).pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[r]=ve(r);for(r in{submit:!0,reset:!0})a.pseudos[r]=be(r);function Se(){}function xe(e){for(var t=0,n=e.length,s="";t<n;t++)s+=e[t].value;return s}function Ee(e,t,n){var s=t.dir,i=t.next,r=i||s,o=n&&"parentNode"===r,a=T++;return t.first?function(t,n,i){for(;t=t[s];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var l,d,u,h=[C,a];if(c){for(;t=t[s];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[s];)if(1===t.nodeType||o)if(d=(u=t[E]||(t[E]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[s]||t;else{if((l=d[r])&&l[0]===C&&l[1]===a)return h[2]=l[2];if(d[r]=h,h[2]=e(t,n,c))return!0}return!1}}function Ae(e){return e.length>1?function(t,n,s){for(var i=e.length;i--;)if(!e[i](t,n,s))return!1;return!0}:e[0]}function Ce(e,t,n,s,i){for(var r,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(r=e[a])&&(n&&!n(r,s,i)||(o.push(r),l&&t.push(a)));return o}function Te(e,t,n,s,i,r){return s&&!s[E]&&(s=Te(s)),i&&!i[E]&&(i=Te(i,r)),me((function(r,o,a,c){var l,d,u,h=[],m=[],f=o.length,g=r||function(e,t,n){for(var s=0,i=t.length;s<i;s++)ue(e,t[s],n);return n}(t||"*",a.nodeType?[a]:a,[]),p=!e||!r&&t?g:Ce(g,h,e,a,c),v=n?i||(r?e:f||s)?[]:o:p;if(n&&n(p,v,a,c),s)for(l=Ce(v,m),s(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[m[d]]=!(p[m[d]]=u));if(r){if(i||e){if(i){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(p[d]=u);i(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=i?P(r,u):h[d])>-1&&(r[l]=!(o[l]=u))}}else v=Ce(v===o?v.splice(f,v.length):v),i?i(null,o,v,c):L.apply(o,v)}))}function ke(e){for(var t,n,s,i=e.length,r=a.relative[e[0].type],o=r||a.relative[" "],c=r?1:0,l=Ee((function(e){return e===t}),o,!0),d=Ee((function(e){return P(t,e)>-1}),o,!0),u=[function(e,n,s){var i=!r&&(s||n!==m)||((t=n).nodeType?l(e,n,s):d(e,n,s));return t=null,i}];c<i;c++)if(n=a.relative[e[c].type])u=[Ee(Ae(u),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[E]){for(s=++c;s<i&&!a.relative[e[s].type];s++);return Te(c>1&&Ae(u),c>1&&xe(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),n,c<s&&ke(e.slice(c,s)),s<i&&ke(e=e.slice(s)),s<i&&xe(e))}u.push(n)}return Ae(u)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=ue.tokenize=function(e,t){var n,s,i,r,o,c,l,d=j[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],l=a.preFilter;o;){for(r in n&&!(s=V.exec(o))||(s&&(o=o.slice(s[0].length)||o),c.push(i=[])),n=!1,(s=J.exec(o))&&(n=s.shift(),i.push({value:n,type:s[0].replace(W," ")}),o=o.slice(n.length)),a.filter)!(s=X[r].exec(o))||l[r]&&!(s=l[r](s))||(n=s.shift(),i.push({value:n,type:r,matches:s}),o=o.slice(n.length));if(!n)break}return t?o.length:o?ue.error(e):j(e,c).slice(0)},u=ue.compile=function(e,t){var n,s=[],i=[],r=N[e+" "];if(!r){for(t||(t=d(e)),n=t.length;n--;)(r=ke(t[n]))[E]?s.push(r):i.push(r);(r=N(e,function(e,t){var n=t.length>0,s=e.length>0,i=function(i,r,o,c,l){var d,u,h,f=0,g="0",b=i&&[],_=[],w=m,S=i||s&&a.find.TAG("*",l),x=C+=null==w?1:Math.random()||.1,E=S.length;for(l&&(m=r==v||r||l);g!==E&&null!=(d=S[g]);g++){if(s&&d){for(u=0,r||d.ownerDocument==v||(p(d),o=!y);h=e[u++];)if(h(d,r||v,o)){c.push(d);break}l&&(C=x)}n&&((d=!h&&d)&&f--,i&&b.push(d))}if(f+=g,n&&g!==f){for(u=0;h=t[u++];)h(b,_,r,o);if(i){if(f>0)for(;g--;)b[g]||_[g]||(_[g]=R.call(c));_=Ce(_)}L.apply(c,_),l&&!i&&_.length>0&&f+t.length>1&&ue.uniqueSort(c)}return l&&(C=x,m=w),b};return n?me(i):i}(i,s))).selector=e}return r},h=ue.select=function(e,t,n,s){var i,r,o,c,l,h="function"==typeof e&&e,m=!s&&d(e=h.selector||e);if(n=n||[],1===m.length){if((r=m[0]=m[0].slice(0)).length>2&&"ID"===(o=r[0]).type&&9===t.nodeType&&y&&a.relative[r[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(re,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(i=X.needsContext.test(e)?0:r.length;i--&&(o=r[i],!a.relative[c=o.type]);)if((l=a.find[c])&&(s=l(o.matches[0].replace(re,oe),ie.test(r[0].type)&&we(t.parentNode)||t))){if(r.splice(i,1),!(e=s.length&&xe(r)))return L.apply(n,s),n;break}}return(h||u(e,m))(s,t,!y,n,!t||ie.test(e)&&we(t.parentNode)||t),n},o.sortStable=E.split("").sort($).join("")===E,o.detectDuplicates=!!g,p(),o.sortDetached=fe((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),fe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ge("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&fe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ge("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),fe((function(e){return null==e.getAttribute("disabled")}))||ge(F,(function(e,t,n){var s;if(!n)return!0===e[t]?t.toLowerCase():(s=e.getAttributeNode(t))&&s.specified?s.value:null}));var je=i.Sizzle;ue.noConflict=function(){return i.Sizzle===ue&&(i.Sizzle=je),ue},void 0===(s=function(){return ue}.call(t,n,t,e))||(e.exports=s)}(window)},4457:(e,t,n)=>{var s;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(e){return a(l(e),arguments)}function o(e,t){return r.apply(null,[e].concat(t||[]))}function a(e,t){var n,s,o,a,c,l,d,u,h,m=1,f=e.length,g="";for(s=0;s<f;s++)if("string"==typeof e[s])g+=e[s];else if("object"==typeof e[s]){if((a=e[s]).keys)for(n=t[m],o=0;o<a.keys.length;o++){if(null==n)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[m++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(r("[sprintf] expecting number but found %T",n));switch(i.number.test(a.type)&&(u=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?g+=n:(!i.number.test(a.type)||u&&!a.sign?h="":(h=u?"+":"-",n=n.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+n).length,c=a.width&&d>0?l.repeat(d):"",g+=a.align?h+n+c:"0"===l?h+c+n:c+h+n)}return g}var c=Object.create(null);function l(e){if(c[e])return c[e];for(var t,n=e,s=[],r=0;n;){if(null!==(t=i.text.exec(n)))s.push(t[0]);else if(null!==(t=i.modulo.exec(n)))s.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){r|=1;var o=[],a=t[2],l=[];if(null===(l=i.key.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(a=a.substring(l[0].length));)if(null!==(l=i.key_access.exec(a)))o.push(l[1]);else{if(null===(l=i.index_access.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}t[2]=o}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");s.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return c[e]=s}t.sprintf=r,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=o,void 0===(s=function(){return{sprintf:r,vsprintf:o}}.call(t,n,t,e))||(e.exports=s))}()},1059:function(e,t,n){var s,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(s=o)?s.call(t,n,t,e):s)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,s=e.toLowerCase().split(":"),i=s.length,r=8;for(""===s[0]&&""===s[1]&&""===s[2]?(s.shift(),s.shift()):""===s[0]&&""===s[1]?s.shift():""===s[i-1]&&""===s[i-2]&&s.pop(),-1!==s[(i=s.length)-1].indexOf(".")&&(r=7),t=0;t<i&&""!==s[t];t++);if(t<r)for(s.splice(t,1,"0000");s.length<r;)s.splice(t,0,"0000");for(var o=0;o<r;o++){n=s[o].split("");for(var a=0;a<3&&"0"===n[0]&&n.length>1;a++)n.splice(0,1);s[o]=n.join("")}var c=-1,l=0,d=0,u=-1,h=!1;for(o=0;o<r;o++)h?"0"===s[o]?d+=1:(h=!1,d>l&&(c=u,l=d)):"0"===s[o]&&(h=!0,u=o,d=1);d>l&&(c=u,l=d),l>1&&s.splice(c,l,""),i=s.length;var m="";for(""===s[0]&&(m=":"),o=0;o<i&&(m+=s[o],o!==i-1);o++)m+=":";return""===s[i-1]&&(m+=":"),m},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},4463:function(e,t,n){var s,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(s=o)?s.call(t,n,t,e):s)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var s=e.lastIndexOf(".",t-1);if(s<=0||s>=t-1)return!1;var i=n.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(s+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var s=n.list[e.slice(t+1)];return!!s&&s.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var s=e.lastIndexOf(".",t-1);if(s<=0||s>=t-1)return null;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(s+1,t)+" ")<0?null:e.slice(s+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},2369:function(e,t,n){var s,i,r;!function(o,a){"use strict";e.exports?e.exports=a(n(6635),n(1059),n(4463)):(i=[n(6635),n(1059),n(4463)],void 0===(r="function"==typeof(s=a)?s.apply(t,i):s)||(e.exports=r))}(0,(function(e,t,n,s){"use strict";var i=s&&s.URI;function r(e,t){var n=arguments.length>=1,s=arguments.length>=2;if(!(this instanceof r))return n?s?new r(e,t):new r(e):new r;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}r.version="1.19.7";var o=r.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===l(e)}function u(e,t){var n,s,i={};if("RegExp"===l(t))i=null;else if(d(t))for(n=0,s=t.length;n<s;n++)i[t[n]]=!0;else i[t]=!0;for(n=0,s=e.length;n<s;n++)(i&&void 0!==i[e[n]]||!i&&t.test(e[n]))&&(e.splice(n,1),s--,n--);return e}function h(e,t){var n,s;if(d(t)){for(n=0,s=t.length;n<s;n++)if(!h(e,t[n]))return!1;return!0}var i=l(t);for(n=0,s=e.length;n<s;n++)if("RegExp"===i){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function m(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,s=e.length;n<s;n++)if(e[n]!==t[n])return!1;return!0}function f(e){return e.replace(/^\/+|\/+$/g,"")}function g(e){return escape(e)}function p(e){return encodeURIComponent(e).replace(/[!'()*]/g,g).replace(/\*/g,"%2A")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return r.domAttributes[t]}},r.encode=p,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=p,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(e,t){var n=r.encode(e+"");return void 0===t&&(t=r.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},r.decodeQuery=function(e,t){e+="",void 0===t&&(t=r.escapeQuerySpace);try{return r.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,b={encode:"encode",decode:"decode"},y=function(e,t){return function(n){try{return r[t](n+"").replace(r.characters[e][t].expression,(function(n){return r.characters[e][t].map[n]}))}catch(e){return n}}};for(v in b)r[v+"PathSegment"]=y("pathname",b[v]),r[v+"UrnPathSegment"]=y("urnpath",b[v]);var _=function(e,t,n){return function(s){var i;i=n?function(e){return r[t](r[n](e))}:r[t];for(var o=(s+"").split(e),a=0,c=o.length;a<c;a++)o[a]=i(o[a]);return o.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,s){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!s),this)}}r.decodePath=_("/","decodePathSegment"),r.decodeUrnPath=_(":","decodeUrnPathSegment"),r.recodePath=_("/","encodePathSegment","decode"),r.recodeUrnPath=_(":","encodeUrnPathSegment","decode"),r.encodeReserved=y("reserved","encode"),r.parse=function(e,t){var n;return t||(t={preventInvalidHostname:r.preventInvalidHostname}),(n=e.indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===(e=e.replace(/^(https?|ftp|wss?)?:[/\\]*/,"$1://")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=r.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(r.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3).replace(/\\/g,"/")?(e=e.substring(n+3),e=r.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},r.parseHost=function(e,t){e||(e="");var n,s,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(s=e.substring(0,i).split(":"),t.hostname=s[0]||null,t.port=s[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&r.ensureValidHostname(t.hostname,t.protocol),t.port&&r.ensureValidPort(t.port),e.substring(i)||"/"},r.parseAuthority=function(e,t){return e=r.parseUserinfo(e,t),r.parseHost(e,t)},r.parseUserinfo=function(e,t){var n=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var s,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(s=e.substring(0,o).split(":"),t.username=s[0]?r.decode(s[0]):null,s.shift(),t.password=s[0]?r.decode(s.join(":")):null,e=n.substring(o+1)):(t.username=null,t.password=null),e},r.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,s,i,o={},c=e.split("&"),l=c.length,d=0;d<l;d++)n=c[d].split("="),s=r.decodeQuery(n.shift(),t),i=n.length?r.decodeQuery(n.join("="),t):null,"__proto__"!==s&&(a.call(o,s)?("string"!=typeof o[s]&&null!==o[s]||(o[s]=[o[s]]),o[s].push(i)):o[s]=i);return o},r.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=r.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},r.buildHost=function(e){var t="";return e.hostname?(r.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},r.buildAuthority=function(e){return r.buildUserinfo(e)+r.buildHost(e)},r.buildUserinfo=function(e){var t="";return e.username&&(t+=r.encode(e.username)),e.password&&(t+=":"+r.encode(e.password)),t&&(t+="@"),t},r.buildQuery=function(e,t,n){var s,i,o,c,l="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(d(e[i]))for(s={},o=0,c=e[i].length;o<c;o++)void 0!==e[i][o]&&void 0===s[e[i][o]+""]&&(l+="&"+r.buildQueryParameter(i,e[i][o],n),!0!==t&&(s[e[i][o]+""]=!0));else void 0!==e[i]&&(l+="&"+r.buildQueryParameter(i,e[i],n));return l.substring(1)},r.buildQueryParameter=function(e,t,n){return r.encodeQuery(e,n)+(null!==t?"="+r.encodeQuery(t,n):"")},r.addQuery=function(e,t,n){if("object"==typeof t)for(var s in t)a.call(t,s)&&r.addQuery(e,s,t[s]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),d(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},r.setQuery=function(e,t,n){if("object"==typeof t)for(var s in t)a.call(t,s)&&r.setQuery(e,s,t[s]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},r.removeQuery=function(e,t,n){var s,i,o;if(d(t))for(s=0,i=t.length;s<i;s++)e[t[s]]=void 0;else if("RegExp"===l(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&r.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===l(n)?!d(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=u(e[t],n):e[t]!==String(n)||d(n)&&1!==n.length?d(e[t])&&(e[t]=u(e[t],n)):e[t]=void 0:e[t]=void 0}},r.hasQuery=function(e,t,n,s){switch(l(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===n||r.hasQuery(e,i,n)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!r.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(l(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!d(e[t])&&(s?h:m)(e[t],n);case"RegExp":return d(e[t])?!!s&&h(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return d(e[t])?!!s&&h(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var e=[],t=[],n=0,s=0;s<arguments.length;s++){var i=new r(arguments[s]);e.push(i);for(var o=i.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&n++}if(!t.length||!n)return new r("");var c=new r("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},r.commonPath=function(e,t){var n,s=Math.min(e.length,t.length);for(n=0;n<s;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},r.withinString=function(e,t,n){n||(n={});var s=n.start||r.findUri.start,i=n.end||r.findUri.end,o=n.trim||r.findUri.trim,a=n.parens||r.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(s.lastIndex=0;;){var l=s.exec(e);if(!l)break;var d=l.index;if(n.ignoreHtml){var u=e.slice(Math.max(d-3,0),d);if(u&&c.test(u))continue}for(var h=d+e.slice(d).search(i),m=e.slice(d,h),f=-1;;){var g=a.exec(m);if(!g)break;var p=g.index+g[0].length;f=Math.max(f,p)}if(!((m=f>-1?m.slice(0,f)+m.slice(f).replace(o,""):m.replace(o,"")).length<=l[0].length||n.ignore&&n.ignore.test(m))){var v=t(m,d,h=d+m.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),s.lastIndex=d+v.length):s.lastIndex=h}}return s.lastIndex=0,e},r.ensureValidHostname=function(t,n){var s=!!t,i=!1;if(!!n&&(i=h(r.hostProtocols,n)),i&&!s)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},r.noConflict=function(e){if(e){var t={URI:this.noConflict()};return s.URITemplate&&"function"==typeof s.URITemplate.noConflict&&(t.URITemplate=s.URITemplate.noConflict()),s.IPv6&&"function"==typeof s.IPv6.noConflict&&(t.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&"function"==typeof s.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=s.SecondLevelDomains.noConflict()),t}return s.URI===this&&(s.URI=i),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new r(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},o.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},o.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?r.decodeUrnPath:r.decodePath)(n):n}return this._parts.urn?this._parts.path=e?r.recodeUrnPath(e):"":this._parts.path=e?r.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=r._parts();var s=e instanceof r,i="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName&&(e=e[r.getDomAttribute(e)]||"",i=!1),!s&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=r.parse(String(e),this._parts);else{if(!s&&!i)throw new TypeError("invalid input");var o=s?e._parts:e;for(n in o)"query"!==n&&a.call(this._parts,n)&&(this._parts[n]=o[n]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,s=!1,i=!1,o=!1,a=!1,c=!1,l=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,s=r.ip4_expression.test(this._parts.hostname),i=r.ip6_expression.test(this._parts.hostname),a=(o=!(t=s||i))&&n&&n.has(this._parts.hostname),c=o&&r.idn_expression.test(this._parts.hostname),l=o&&r.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return s;case"ip6":case"ipv6":case"inet6":return i;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return l}return null};var x=o.protocol,E=o.port,A=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(r.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return x.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),r.ensureValidPort(e))),E.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==r.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(e,this._parts.protocol)}return A.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var s=r(e);return this.protocol(s.protocol()).authority(s.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildHost(this._parts):"";if("/"!==r.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildAuthority(this._parts):"";if("/"!==r.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=r.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),r.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=r.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var s=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,s),o=new RegExp("^"+c(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&r.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var s=this._parts.hostname.length-this.tld(t).length-1;return s=this._parts.hostname.lastIndexOf(".",s-1)+1,this._parts.hostname.substring(s)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(s+1);return!0!==t&&n&&n.list[i.toLowerCase()]&&n.get(this._parts.hostname)||i}var r;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,s=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?r.decodePath(s):s}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),s=this._parts.path.substring(n+1);return e?r.decodePathSegment(s):s}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(c(this.filename())+"$");return e=r.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,s,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(n=i.substring(o+1),s=/^[a-z0-9%]+$/i.test(n)?n:"",e?r.decodePathSegment(s):s)}"."===e.charAt(0)&&(e=e.substring(1));var a,l=this.suffix();if(l)a=e?new RegExp(c(l)+"$"):new RegExp(c("."+l)+"$");else{if(!e)return this;this._parts.path+="."+r.recodePath(e)}return a&&(e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,n){var s=this._parts.urn?":":"/",i=this.path(),r="/"===i.substring(0,1),o=i.split(s);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(r&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(f(t[a])))}else(t||"string"==typeof t)&&(t=f(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=f(t):o.splice(e,1);return r&&o.unshift(""),this.path(o.join(s),n)},o.segmentCoded=function(e,t,n){var s,i,o;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(d(s=this.segment(e,t,n)))for(i=0,o=s.length;i<o;i++)s[i]=r.decode(s[i]);else s=void 0!==s?r.decode(s):void 0;return s}if(d(t))for(i=0,o=t.length;i<o;i++)t[i]=r.encode(t[i]);else t="string"==typeof t||t instanceof String?r.encode(t):t;return this.segment(e,t,n)};var C=o.query;return o.query=function(e,t){if(!0===e)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),s=e.call(this,n);return this._parts.query=r.buildQuery(s||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=r.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):C.call(this,e,t)},o.setQuery=function(e,t,n){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)s[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(s[i]=e[i])}return this._parts.query=r.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(s,e,void 0===t?null:t),this._parts.query=r.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(s,e,t),this._parts.query=r.buildQuery(s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(s,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var s,i,o="";for("/"!==(n=r.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=n.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(s=n.search(/\/\.\.(\/|$)/));)0!==s?(-1===(i=n.substring(0,s).lastIndexOf("/"))&&(i=s),n=n.substring(0,i)+n.substring(s+3)):n=n.substring(3);return t&&this.is("relative")&&(n=o+n.substring(1)),this._parts.path=n,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=r.encode,t=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.unicode=function(){var e=r.encode,t=r.decode;r.encode=p,r.decode=unescape;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var s="",i=0,o=t._parts.query.split("&"),a=o.length;i<a;i++){var c=(o[i]||"").split("=");s+="&"+r.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(s+="="+r.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+s.substring(1)}return n+r.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,n,s,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof r||(e=new r(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(n=0;s=o[n];n++)i._parts[s]=e._parts[s];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},o.relativeTo=function(e){var t,n,s,i,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new r(e).normalize(),t=a._parts,n=e._parts,i=a.path(),o=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,i===o)return t.path="",a.build();if(!(s=r.commonPath(i,o)))return a.build();var c=n.path.substring(s.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(s.length)||"./",a.build()},o.equals=function(e){var t,n,s,i,o,c=this.clone(),l=new r(e),u={};if(c.normalize(),l.normalize(),c.toString()===l.toString())return!0;if(s=c.query(),i=l.query(),c.query(""),l.query(""),c.toString()!==l.toString())return!1;if(s.length!==i.length)return!1;for(o in t=r.parseQuery(s,this._parts.escapeQuerySpace),n=r.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!m(t[o],n[o]))return!1}else if(t[o]!==n[o])return!1;u[o]=!0}for(o in n)if(a.call(n,o)&&!u[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},r}))},6635:function(e,t,n){var s;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof n.g&&n.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,c=36,l=/^xn--/,d=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,f=String.fromCharCode;function g(e){throw new RangeError(h[e])}function p(e,t){for(var n=e.length,s=[];n--;)s[n]=t(e[n]);return s}function v(e,t){var n=e.split("@"),s="";return n.length>1&&(s=n[0]+"@",e=n[1]),s+p((e=e.replace(u,".")).split("."),t).join(".")}function b(e){for(var t,n,s=[],i=0,r=e.length;i<r;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<r?56320==(64512&(n=e.charCodeAt(i++)))?s.push(((1023&t)<<10)+(1023&n)+65536):(s.push(t),i--):s.push(t);return s}function y(e){return p(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+f(e)})).join("")}function _(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var s=0;for(e=n?m(e/700):e>>1,e+=m(e/t);e>455;s+=c)e=m(e/35);return m(s+36*e/(e+38))}function S(e){var t,n,s,i,r,o,l,d,u,h,f,p=[],v=e.length,b=0,_=128,S=72;for((n=e.lastIndexOf("-"))<0&&(n=0),s=0;s<n;++s)e.charCodeAt(s)>=128&&g("not-basic"),p.push(e.charCodeAt(s));for(i=n>0?n+1:0;i<v;){for(r=b,o=1,l=c;i>=v&&g("invalid-input"),((d=(f=e.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c)>=c||d>m((a-b)/o))&&g("overflow"),b+=d*o,!(d<(u=l<=S?1:l>=S+26?26:l-S));l+=c)o>m(a/(h=c-u))&&g("overflow"),o*=h;S=w(b-r,t=p.length+1,0==r),m(b/t)>a-_&&g("overflow"),_+=m(b/t),b%=t,p.splice(b++,0,_)}return y(p)}function x(e){var t,n,s,i,r,o,l,d,u,h,p,v,y,S,x,E=[];for(v=(e=b(e)).length,t=128,n=0,r=72,o=0;o<v;++o)(p=e[o])<128&&E.push(f(p));for(s=i=E.length,i&&E.push("-");s<v;){for(l=a,o=0;o<v;++o)(p=e[o])>=t&&p<l&&(l=p);for(l-t>m((a-n)/(y=s+1))&&g("overflow"),n+=(l-t)*y,t=l,o=0;o<v;++o)if((p=e[o])<t&&++n>a&&g("overflow"),p==t){for(d=n,u=c;!(d<(h=u<=r?1:u>=r+26?26:u-r));u+=c)x=d-h,S=c-h,E.push(f(_(h+x%S,0))),d=m(x/S);E.push(f(_(d,0))),r=w(n,y,s==i),n=0,++s}++n,++t}return E.join("")}o={version:"1.3.2",ucs2:{decode:b,encode:y},decode:S,encode:x,toASCII:function(e){return v(e,(function(e){return d.test(e)?"xn--"+x(e):e}))},toUnicode:function(e){return v(e,(function(e){return l.test(e)?S(e.slice(4).toLowerCase()):e}))}},void 0===(s=function(){return o}.call(t,n,t,e))||(e.exports=s)}()},8884:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},6853:(e,t,n)=>{function s(e){this.options=e||{locator:{}}}function i(){this.cdata=!1}function r(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function o(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}s.prototype.parseFromString=function(e,t){var n=this.options,s=new u,r=n.domBuilder||new i,a=n.errorHandler,c=n.locator,d=n.xmlns||{},h=/\/x?html?$/.test(t),m=h?l.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&r.setDocumentLocator(c),s.errorHandler=function(e,t,n){if(!e){if(t instanceof i)return t;e=t}var s={},r=e instanceof Function;function a(t){var i=e[t];!i&&r&&(i=2==e.length?function(n){e(t,n)}:e),s[t]=i&&function(e){i("[xmldom "+t+"]\t"+e+o(n))}||function(){}}return n=n||{},a("warning"),a("error"),a("fatalError"),s}(a,r,c),s.domBuilder=n.domBuilder||r,h&&(d[""]="http://www.w3.org/1999/xhtml"),d.xml=d.xml||"http://www.w3.org/XML/1998/namespace",e&&"string"==typeof e?s.parse(e,d,m):s.errorHandler.error("invalid doc source"),r.doc},i.prototype={startDocument:function(){this.doc=(new m).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,s){var i=this.doc,o=i.createElementNS(e,n||t),a=s.length;c(this,o),this.currentElement=o,this.locator&&r(this.locator,o);for(var l=0;l<a;l++){e=s.getURI(l);var d=s.getValue(l),u=(n=s.getQName(l),i.createAttributeNS(e,n));this.locator&&r(s.getLocator(l),u),u.value=u.nodeValue=d,o.setAttributeNode(u)}},endElement:function(e,t,n){var s=this.currentElement;s.tagName,this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&r(this.locator,n),c(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=a.apply(this,arguments)){if(this.cdata)var s=this.doc.createCDATASection(e);else s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&r(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=a.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&r(this.locator,s),c(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var s=this.doc.implementation;if(s&&s.createDocumentType){var i=s.createDocumentType(e,t,n);this.locator&&r(this.locator,i),c(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,o(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,o(this.locator))},fatalError:function(e){throw new h(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){i.prototype[e]=function(){return null}}));var l=n(1814),d=n(63),u=d.XMLReader,h=d.ParseError,m=t.DOMImplementation=n(823).DOMImplementation;n(823),t.a=s},823:(e,t)=>{function n(e,t){for(var n in e)t[n]=e[n]}function s(e,t){var s=e.prototype;if(!(s instanceof t)){function i(){}i.prototype=t.prototype,n(s,i=new i),e.prototype=s=i}s.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),s.constructor=e)}var i={},r=i.ELEMENT_NODE=1,o=i.ATTRIBUTE_NODE=2,a=i.TEXT_NODE=3,c=i.CDATA_SECTION_NODE=4,l=i.ENTITY_REFERENCE_NODE=5,d=i.ENTITY_NODE=6,u=i.PROCESSING_INSTRUCTION_NODE=7,h=i.COMMENT_NODE=8,m=i.DOCUMENT_NODE=9,f=i.DOCUMENT_TYPE_NODE=10,g=i.DOCUMENT_FRAGMENT_NODE=11,p=i.NOTATION_NODE=12,v={},b={},y=(v.INDEX_SIZE_ERR=(b[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(b[2]="DOMString size error",2),v.HIERARCHY_REQUEST_ERR=(b[3]="Hierarchy request error",3)),_=(v.WRONG_DOCUMENT_ERR=(b[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(b[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(b[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(b[7]="No modification allowed",7),v.NOT_FOUND_ERR=(b[8]="Not found",8)),w=(v.NOT_SUPPORTED_ERR=(b[9]="Not supported",9),v.INUSE_ATTRIBUTE_ERR=(b[10]="Attribute in use",10));function S(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,b[e]),this.message=b[e],Error.captureStackTrace&&Error.captureStackTrace(this,S);return n.code=e,t&&(this.message=this.message+": "+t),n}function x(){}function E(e,t){this._node=e,this._refresh=t,A(this)}function A(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var s=e._refresh(e._node);ne(e,"length",s.length),n(s,e),e._inc=t}}function C(){}function T(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function k(e,t,n,s){if(s?t[T(t,s)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(s&&R(i,e,s),function(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(i,e,n))}}function j(e,t,n){var s=T(t,n);if(!(s>=0))throw S(_,new Error(e.tagName+"@"+n));for(var i=t.length-1;s<i;)t[s]=t[++s];if(t.length=i,e){var r=e.ownerDocument;r&&(R(r,e,n),n.ownerElement=null)}}function N(e){if(this._features={},e)for(var t in e)this._features=e[t]}function O(){}function $(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function I(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(I(e,t))return!0}while(e=e.nextSibling)}function M(){}function R(e,t,n,s){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function D(e,t,n){if(e&&e._inc){e._inc++;var s=t.childNodes;if(n)s[s.length++]=n;else{for(var i=t.firstChild,r=0;i;)s[r++]=i,i=i.nextSibling;s.length=r}}}function L(e,t){var n=t.previousSibling,s=t.nextSibling;return n?n.nextSibling=s:e.firstChild=s,s?s.previousSibling=n:e.lastChild=n,D(e.ownerDocument,e),t}function z(e,t,n){var s=t.parentNode;if(s&&s.removeChild(t),t.nodeType===g){var i=t.firstChild;if(null==i)return t;var r=t.lastChild}else i=r=t;var o=n?n.previousSibling:e.lastChild;i.previousSibling=o,r.nextSibling=n,o?o.nextSibling=i:e.firstChild=i,null==n?e.lastChild=r:n.previousSibling=r;do{i.parentNode=e}while(i!==r&&(i=i.nextSibling));return D(e.ownerDocument||e,e),t.nodeType==g&&(t.firstChild=t.lastChild=null),t}function P(){this._nsMap={}}function F(){}function U(){}function B(){}function q(){}function H(){}function G(){}function W(){}function V(){}function J(){}function K(){}function Y(){}function Q(e,t){var n=[],s=9==this.nodeType&&this.documentElement||this,i=s.prefix,r=s.namespaceURI;if(r&&null==i&&null==(i=s.lookupPrefix(r)))var o=[{namespace:r,prefix:null}];return Z(this,n,e,t,o),n.join("")}function X(e,t,n){var s=e.prefix||"",i=e.namespaceURI;if(!s&&!i)return!1;if("xml"===s&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var r=n.length;r--;){var o=n[r];if(o.prefix==s)return o.namespace!=i}return!0}function Z(e,t,n,s,i){if(s){if(!(e=s(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case r:i||(i=[]),i.length;var d=e.attributes,p=d.length,v=e.firstChild,b=e.tagName;n="http://www.w3.org/1999/xhtml"===e.namespaceURI||n,t.push("<",b);for(var y=0;y<p;y++)"xmlns"==(_=d.item(y)).prefix?i.push({prefix:_.localName,namespace:_.value}):"xmlns"==_.nodeName&&i.push({prefix:"",namespace:_.value});for(y=0;y<p;y++){var _;if(X(_=d.item(y),0,i)){var w=_.prefix||"",S=_.namespaceURI,x=w?" xmlns:"+w:" xmlns";t.push(x,'="',S,'"'),i.push({prefix:w,namespace:S})}Z(_,t,n,s,i)}if(X(e,0,i)&&(w=e.prefix||"",S=e.namespaceURI,x=w?" xmlns:"+w:" xmlns",t.push(x,'="',S,'"'),i.push({prefix:w,namespace:S})),v||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(b)){if(t.push(">"),n&&/^script$/i.test(b))for(;v;)v.data?t.push(v.data):Z(v,t,n,s,i),v=v.nextSibling;else for(;v;)Z(v,t,n,s,i),v=v.nextSibling;t.push("</",b,">")}else t.push("/>");return;case m:case g:for(v=e.firstChild;v;)Z(v,t,n,s,i),v=v.nextSibling;return;case o:return t.push(" ",e.name,'="',e.value.replace(/[&"]/g,$),'"');case a:return t.push(e.data.replace(/[<&]/g,$).replace(/]]>/g,"]]&gt;"));case c:return t.push("<![CDATA[",e.data,"]]>");case h:return t.push("\x3c!--",e.data,"--\x3e");case f:var E=e.publicId,A=e.systemId;if(t.push("<!DOCTYPE ",e.name),E)t.push(" PUBLIC ",E),A&&"."!=A&&t.push(" ",A),t.push(">");else if(A&&"."!=A)t.push(" SYSTEM ",A,">");else{var C=e.internalSubset;C&&t.push(" [",C,"]"),t.push(">")}return;case u:return t.push("<?",e.target," ",e.data,"?>");case l:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ee(e,t,n){var s;switch(t.nodeType){case r:(s=t.cloneNode(!1)).ownerDocument=e;case g:break;case o:n=!0}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,n)for(var i=t.firstChild;i;)s.appendChild(ee(e,i,n)),i=i.nextSibling;return s}function te(e,t,n){var s=new t.constructor;for(var i in t){var a=t[i];"object"!=typeof a&&a!=s[i]&&(s[i]=a)}switch(t.childNodes&&(s.childNodes=new x),s.ownerDocument=e,s.nodeType){case r:var c=t.attributes,l=s.attributes=new C,d=c.length;l._ownerElement=s;for(var u=0;u<d;u++)s.setAttributeNode(te(e,c.item(u),!0));break;case o:n=!0}if(n)for(var h=t.firstChild;h;)s.appendChild(te(e,h,n)),h=h.nextSibling;return s}function ne(e,t,n){e[t]=n}v.INVALID_STATE_ERR=(b[11]="Invalid state",11),v.SYNTAX_ERR=(b[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(b[13]="Invalid modification",13),v.NAMESPACE_ERR=(b[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(b[15]="Invalid access",15),S.prototype=Error.prototype,n(v,S),x.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],s=0;s<this.length;s++)Z(this[s],n,e,t);return n.join("")}},E.prototype.item=function(e){return A(this),this[e]},s(E,x),C.prototype={length:0,item:x.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new S(w);var n=this.getNamedItem(e.nodeName);return k(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new S(w);return t=this.getNamedItemNS(e.namespaceURI,e.localName),k(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return j(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return j(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var s=this[n];if(s.localName==t&&s.namespaceURI==e)return s}return null}},N.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var s=new M;if(s.implementation=this,s.childNodes=new x,s.doctype=n,n&&s.appendChild(n),t){var i=s.createElementNS(e,t);s.appendChild(i)}return s},createDocumentType:function(e,t,n){var s=new G;return s.name=e,s.nodeName=e,s.publicId=t,s.systemId=n,s}},O.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return z(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return L(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return te(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==a&&e.nodeType==a?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var s in n)if(n[s]==e)return s;t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==o?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},n(i,O),n(i,O.prototype),M.prototype={nodeName:"#document",nodeType:m,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==g){for(var n=e.firstChild;n;){var s=n.nextSibling;this.insertBefore(n,t),n=s}return e}return null==this.documentElement&&e.nodeType==r&&(this.documentElement=e),z(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),L(this,e)},importNode:function(e,t){return ee(this,e,t)},getElementById:function(e){var t=null;return I(this.documentElement,(function(n){if(n.nodeType==r&&n.getAttribute("id")==e)return t=n,!0})),t},getElementsByClassName:function(e){var t=new RegExp("(^|\\s)"+e+"(\\s|$)");return new E(this,(function(e){var n=[];return I(e.documentElement,(function(s){s!==e&&s.nodeType==r&&t.test(s.getAttribute("class"))&&n.push(s)})),n}))},createElement:function(e){var t=new P;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new x,(t.attributes=new C)._ownerElement=t,t},createDocumentFragment:function(){var e=new K;return e.ownerDocument=this,e.childNodes=new x,e},createTextNode:function(e){var t=new B;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new q;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new H;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new Y;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new F;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new J;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new P,s=t.split(":"),i=n.attributes=new C;return n.childNodes=new x,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new F,s=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==s.length?(n.prefix=s[0],n.localName=s[1]):n.localName=t,n}},s(M,O),P.prototype={nodeType:r,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===g?this.insertBefore(e,null):function(e,t){var n=t.parentNode;if(n){var s=e.lastChild;n.removeChild(t),s=e.lastChild}return s=e.lastChild,t.parentNode=e,t.previousSibling=s,t.nextSibling=null,s?s.nextSibling=t:e.firstChild=t,e.lastChild=t,D(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+n,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new E(this,(function(t){var n=[];return I(t,(function(s){s===t||s.nodeType!=r||"*"!==e&&s.tagName!=e||n.push(s)})),n}))},getElementsByTagNameNS:function(e,t){return new E(this,(function(n){var s=[];return I(n,(function(i){i===n||i.nodeType!==r||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||s.push(i)})),s}))}},M.prototype.getElementsByTagName=P.prototype.getElementsByTagName,M.prototype.getElementsByTagNameNS=P.prototype.getElementsByTagNameNS,s(P,O),F.prototype.nodeType=o,s(F,O),U.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(b[y])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},s(U,O),B.prototype={nodeName:"#text",nodeType:a,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},s(B,U),q.prototype={nodeName:"#comment",nodeType:h},s(q,U),H.prototype={nodeName:"#cdata-section",nodeType:c},s(H,U),G.prototype.nodeType=f,s(G,O),W.prototype.nodeType=p,s(W,O),V.prototype.nodeType=d,s(V,O),J.prototype.nodeType=l,s(J,O),K.prototype.nodeName="#document-fragment",K.prototype.nodeType=g,s(K,O),Y.prototype.nodeType=u,s(Y,O),O.prototype.toString=Q;try{if(Object.defineProperty){function se(e){switch(e.nodeType){case r:case g:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(se(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(E.prototype,"length",{get:function(){return A(this),this.$$length}}),Object.defineProperty(O.prototype,"textContent",{get:function(){return se(this)},set:function(e){switch(this.nodeType){case r:case g:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ne=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.DOMImplementation=N},1814:(e,t)=>{t.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},63:(e,t)=>{var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,s=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+n.source+s.source+"*(?::"+n.source+s.source+"*)?$");function r(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,r)}function o(){}function a(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function c(e,t,n,s,i,r){function o(e,t,s){e in n.attributeNames&&r.fatalError("Attribute "+e+" redefined"),n.addValue(e,t,s)}for(var a,c=++t,l=0;;){var d=e.charAt(c);switch(d){case"=":if(1===l)a=e.slice(t,c),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(r.warning('attribute value must after "="'),a=e.slice(t,c)),t=c+1,!((c=e.indexOf(d,t))>0))throw new Error("attribute value no end '"+d+"' match");o(a,u=e.slice(t,c).replace(/&#?\w+;/g,i),t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');o(a,u=e.slice(t,c).replace(/&#?\w+;/g,i),t),r.warning('attribute "'+a+'" missed start quot('+d+")!!"),t=c+1,l=5}break;case"/":switch(l){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:l=7,n.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return r.error("unexpected end of input"),0==l&&n.setTagName(e.slice(t,c)),c;case">":switch(l){case 0:n.setTagName(e.slice(t,c));case 5:case 6:case 7:break;case 4:case 1:"/"===(u=e.slice(t,c)).slice(-1)&&(n.closed=!0,u=u.slice(0,-1));case 2:2===l&&(u=a),4==l?(r.warning('attribute "'+u+'" missed quot(")!'),o(a,u.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===s[""]&&u.match(/^(?:disabled|checked|selected)$/i)||r.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),o(u,u,t));break;case 3:throw new Error("attribute value missed!!")}return c;case"":d=" ";default:if(d<=" ")switch(l){case 0:n.setTagName(e.slice(t,c)),l=6;break;case 1:a=e.slice(t,c),l=2;break;case 4:var u=e.slice(t,c).replace(/&#?\w+;/g,i);r.warning('attribute "'+u+'" missed quot(")!!'),o(a,u,t);case 5:l=6}else switch(l){case 2:n.tagName,"http://www.w3.org/1999/xhtml"===s[""]&&a.match(/^(?:disabled|checked|selected)$/i)||r.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),o(a,a,t),t=c,l=1;break;case 5:r.warning('attribute space is required"'+a+'"!!');case 6:l=1,t=c;break;case 3:l=4,t=c;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function l(e,t,n){for(var s=e.tagName,i=null,r=e.length;r--;){var o=e[r],a=o.qName,c=o.value;if((m=a.indexOf(":"))>0)var l=o.prefix=a.slice(0,m),d=a.slice(m+1),u="xmlns"===l&&d;else d=a,l=null,u="xmlns"===a&&"";o.localName=d,!1!==u&&(null==i&&(i={},h(n,n={})),n[u]=i[u]=c,o.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(u,c))}for(r=e.length;r--;)(l=(o=e[r]).prefix)&&("xml"===l&&(o.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(o.uri=n[l||""]));var m;(m=s.indexOf(":"))>0?(l=e.prefix=s.slice(0,m),d=e.localName=s.slice(m+1)):(l=null,d=e.localName=s);var f=e.uri=n[l||""];if(t.startElement(f,d,s,e),!e.closed)return e.currentNSMap=n,e.localNSMap=i,!0;if(t.endElement(f,d,s),i)for(l in i)t.endPrefixMapping(l)}function d(e,t,n,s,i){if(/^(?:script|textarea)$/i.test(n)){var r=e.indexOf("</"+n+">",t),o=e.substring(t+1,r);if(/[&<]/.test(o))return/^script$/i.test(n)?(i.characters(o,0,o.length),r):(o=o.replace(/&#?\w+;/g,s),i.characters(o,0,o.length),r)}return t+1}function u(e,t,n,s){var i=s[n];return null==i&&((i=e.lastIndexOf("</"+n+">"))<t&&(i=e.lastIndexOf("</"+n)),s[n]=i),i<t}function h(e,t){for(var n in e)t[n]=e[n]}function m(e,t,n,s){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,i-t-4),i+3):(s.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,i-t-9),n.endCDATA(),i+3}var r=function(e,t){var n,s=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);n=i.exec(e);)if(s.push(n),n[1])return s}(e,t),o=r.length;if(o>1&&/!doctype/i.test(r[0][0])){var a=r[1][0],c=!1,l=!1;o>3&&(/^public$/i.test(r[2][0])?(c=r[3][0],l=o>4&&r[4][0]):/^system$/i.test(r[2][0])&&(l=r[3][0]));var d=r[o-1];return n.startDTD(a,c,l),n.endDTD(),d.index+d[0].length}}return-1}function f(e,t,n){var s=e.indexOf("?>",t);if(s){var i=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return i?(i[0].length,n.processingInstruction(i[1],i[2]),s+2):-1}return-1}function g(){this.attributeNames={}}r.prototype=new Error,r.prototype.name=r.name,o.prototype={parse:function(e,t,n){var s=this.domBuilder;s.startDocument(),h(t,t={}),function(e,t,n,s,i){function o(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function h(t){if(t>x){var n=e.substring(x,t).replace(/&#?\w+;/g,o);_&&p(x),s.characters(n,0,t-x),x=t}}function p(t,n){for(;t>=b&&(n=y.exec(e));)v=n.index,b=v+n[0].length,_.lineNumber++;_.columnNumber=t-v+1}for(var v=0,b=0,y=/.*(?:\r\n?|\n)|.*$/g,_=s.locator,w=[{currentNSMap:t}],S={},x=0;;){try{var E=e.indexOf("<",x);if(E<0){if(!e.substr(x).match(/^\s*$/)){var A=s.doc,C=A.createTextNode(e.substr(x));A.appendChild(C),s.currentElement=C}return}switch(E>x&&h(E),e.charAt(E+1)){case"/":var T=e.indexOf(">",E+3),k=e.substring(E+2,T),j=w.pop();T<0?(k=e.substring(E+2).replace(/[\s<].*/,""),i.error("end tag name: "+k+" is not complete:"+j.tagName),T=E+1+k.length):k.match(/\s</)&&(k=k.replace(/[\s<].*/,""),i.error("end tag name: "+k+" maybe not complete"),T=E+1+k.length);var N=j.localNSMap,O=j.tagName==k;if(O||j.tagName&&j.tagName.toLowerCase()==k.toLowerCase()){if(s.endElement(j.uri,j.localName,k),N)for(var $ in N)s.endPrefixMapping($);O||i.fatalError("end tag name: "+k+" is not match the current start tagName:"+j.tagName)}else w.push(j);T++;break;case"?":_&&p(E),T=f(e,E,s);break;case"!":_&&p(E),T=m(e,E,s,i);break;default:_&&p(E);var I=new g,M=w[w.length-1].currentNSMap,R=(T=c(e,E,I,M,o,i),I.length);if(!I.closed&&u(e,T,I.tagName,S)&&(I.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),_&&R){for(var D=a(_,{}),L=0;L<R;L++){var z=I[L];p(z.offset),z.locator=a(_,{})}s.locator=D,l(I,s,M)&&w.push(I),s.locator=_}else l(I,s,M)&&w.push(I);"http://www.w3.org/1999/xhtml"!==I.uri||I.closed?T++:T=d(e,T,I.tagName,o,s)}}catch(e){if(e instanceof r)throw e;i.error("element parse error: "+e),T=-1}T>x?x=T:h(Math.max(E,x)+1)}}(e,t,n,s,this.errorHandler),s.endDocument()}},g.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!i.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=o,t.ParseError=r},6387:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>nx});var s=n(2369),i=n.n(s),r=n(4457);const o={initialize(){},__:(...e)=>(0,r.sprintf)(...e)},a=function(e){return null!=e&&"object"==typeof e},c="object"==typeof global&&global&&global.Object===Object&&global;var l="object"==typeof self&&self&&self.Object===Object&&self;const d=c||l||Function("return this")(),u=d.Symbol;var h=Object.prototype,m=h.hasOwnProperty,f=h.toString,g=u?u.toStringTag:void 0;var p=Object.prototype.toString;var v=u?u.toStringTag:void 0;const b=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":v&&v in Object(e)?function(e){var t=m.call(e,g),n=e[g];try{e[g]=void 0;var s=!0}catch(e){}var i=f.call(e);return s&&(t?e[g]=n:delete e[g]),i}(e):function(e){return p.call(e)}(e)},y=function(e,t){return function(n){return e(t(n))}},_=y(Object.getPrototypeOf,Object);var w=Function.prototype,S=Object.prototype,x=w.toString,E=S.hasOwnProperty,A=x.call(Object);const C=function(e){if(!a(e)||"[object Object]"!=b(e))return!1;var t=_(e);if(null===t)return!0;var n=E.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&x.call(n)==A},T=function(e){return a(e)&&1===e.nodeType&&!C(e)};var k,j,N,O;const $={debug:0,info:1,warn:2,error:3,fatal:4},I=Object.assign({debug:null!==(k=console)&&void 0!==k&&k.log?console.log.bind(console):function(){},error:null!==(j=console)&&void 0!==j&&j.log?console.log.bind(console):function(){},info:null!==(N=console)&&void 0!==N&&N.log?console.log.bind(console):function(){},warn:null!==(O=console)&&void 0!==O&&O.log?console.log.bind(console):function(){}},console),M={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,n=""){if($[t]<$[this.loglevel])return;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:T(e)&&(e=e.outerHTML);const s=n?"%c":"";"error"===t?I.error(`${s} ERROR: ${e}`,n):"warn"===t?I.warn(`${s} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?I.error(`${s} FATAL: ${e}`,n):"debug"===t?I.debug(`${s} ${(new Date).toISOString()} DEBUG: ${e}`,n):I.info(`${s} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}},R=function(){let e=n.g.WebSocket;if(void 0===e)try{e=n(8884)}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}(),D=function(){let e=n.g.DOMParser;if(void 0===e)try{e=n(6853).a}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}return e}();const L=function(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},z=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");const t=[];for(let n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},P=function(e,t,n,s,i,r){return L((o=L(L(t,e),L(s,r)))<<(a=i)|o>>>32-a,n);var o,a},F=function(e,t,n,s,i,r,o){return P(t&n|~t&s,e,t,i,r,o)},U=function(e,t,n,s,i,r,o){return P(t&s|n&~s,e,t,i,r,o)},B=function(e,t,n,s,i,r,o){return P(t^n^s,e,t,i,r,o)},q=function(e,t,n,s,i,r,o){return P(n^(t|~s),e,t,i,r,o)},H=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let n,s,i,r,o=1732584193,a=-271733879,c=-1732584194,l=271733878;for(let t=0;t<e.length;t+=16)n=o,s=a,i=c,r=l,o=F(o,a,c,l,e[t+0],7,-680876936),l=F(l,o,a,c,e[t+1],12,-389564586),c=F(c,l,o,a,e[t+2],17,606105819),a=F(a,c,l,o,e[t+3],22,-1044525330),o=F(o,a,c,l,e[t+4],7,-176418897),l=F(l,o,a,c,e[t+5],12,1200080426),c=F(c,l,o,a,e[t+6],17,-1473231341),a=F(a,c,l,o,e[t+7],22,-45705983),o=F(o,a,c,l,e[t+8],7,1770035416),l=F(l,o,a,c,e[t+9],12,-1958414417),c=F(c,l,o,a,e[t+10],17,-42063),a=F(a,c,l,o,e[t+11],22,-1990404162),o=F(o,a,c,l,e[t+12],7,1804603682),l=F(l,o,a,c,e[t+13],12,-40341101),c=F(c,l,o,a,e[t+14],17,-1502002290),a=F(a,c,l,o,e[t+15],22,1236535329),o=U(o,a,c,l,e[t+1],5,-165796510),l=U(l,o,a,c,e[t+6],9,-1069501632),c=U(c,l,o,a,e[t+11],14,643717713),a=U(a,c,l,o,e[t+0],20,-373897302),o=U(o,a,c,l,e[t+5],5,-701558691),l=U(l,o,a,c,e[t+10],9,38016083),c=U(c,l,o,a,e[t+15],14,-660478335),a=U(a,c,l,o,e[t+4],20,-405537848),o=U(o,a,c,l,e[t+9],5,568446438),l=U(l,o,a,c,e[t+14],9,-1019803690),c=U(c,l,o,a,e[t+3],14,-187363961),a=U(a,c,l,o,e[t+8],20,1163531501),o=U(o,a,c,l,e[t+13],5,-1444681467),l=U(l,o,a,c,e[t+2],9,-51403784),c=U(c,l,o,a,e[t+7],14,1735328473),a=U(a,c,l,o,e[t+12],20,-1926607734),o=B(o,a,c,l,e[t+5],4,-378558),l=B(l,o,a,c,e[t+8],11,-2022574463),c=B(c,l,o,a,e[t+11],16,1839030562),a=B(a,c,l,o,e[t+14],23,-35309556),o=B(o,a,c,l,e[t+1],4,-1530992060),l=B(l,o,a,c,e[t+4],11,1272893353),c=B(c,l,o,a,e[t+7],16,-155497632),a=B(a,c,l,o,e[t+10],23,-1094730640),o=B(o,a,c,l,e[t+13],4,681279174),l=B(l,o,a,c,e[t+0],11,-358537222),c=B(c,l,o,a,e[t+3],16,-722521979),a=B(a,c,l,o,e[t+6],23,76029189),o=B(o,a,c,l,e[t+9],4,-640364487),l=B(l,o,a,c,e[t+12],11,-421815835),c=B(c,l,o,a,e[t+15],16,530742520),a=B(a,c,l,o,e[t+2],23,-995338651),o=q(o,a,c,l,e[t+0],6,-198630844),l=q(l,o,a,c,e[t+7],10,1126891415),c=q(c,l,o,a,e[t+14],15,-1416354905),a=q(a,c,l,o,e[t+5],21,-57434055),o=q(o,a,c,l,e[t+12],6,1700485571),l=q(l,o,a,c,e[t+3],10,-1894986606),c=q(c,l,o,a,e[t+10],15,-1051523),a=q(a,c,l,o,e[t+1],21,-2054922799),o=q(o,a,c,l,e[t+8],6,1873313359),l=q(l,o,a,c,e[t+15],10,-30611744),c=q(c,l,o,a,e[t+6],15,-1560198380),a=q(a,c,l,o,e[t+13],21,1309151649),o=q(o,a,c,l,e[t+4],6,-145523070),l=q(l,o,a,c,e[t+11],10,-1120210379),c=q(c,l,o,a,e[t+2],15,718787259),a=q(a,c,l,o,e[t+9],21,-343485551),o=L(o,n),a=L(a,s),c=L(c,i),l=L(l,r);return[o,a,c,l]},G={hexdigest:function(e){return function(e){const t="0123456789abcdef";let n="";for(let s=0;s<4*e.length;s++)n+=t.charAt(e[s>>2]>>s%4*8+4&15)+t.charAt(e[s>>2]>>s%4*8&15);return n}(H(z(e),8*e.length))},hash:function(e){return function(e){let t="";for(let n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}(H(z(e),8*e.length))}};class W{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}}const V=function(e){var t,n,s="",i=e.length;for(t=0;t<i;t++)(n=e.charCodeAt(t))>=0&&n<=127?s+=e.charAt(t):n>2047?(s+=String.fromCharCode(224|n>>12&15),s+=String.fromCharCode(128|n>>6&63),s+=String.fromCharCode(128|n>>0&63)):(s+=String.fromCharCode(192|n>>6&31),s+=String.fromCharCode(128|n>>0&63));return s};function J(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,s,i,r,o,a,c,l,d=new Array(80),u=1732584193,h=-271733879,m=-1732584194,f=271733878,g=-1009589776;for(n=0;n<e.length;n+=16){for(r=u,o=h,a=m,c=f,l=g,s=0;s<80;s++)d[s]=s<16?e[n+s]:Z(d[s-3]^d[s-8]^d[s-14]^d[s-16],1),i=X(X(Z(u,5),K(s,h,m,f)),X(X(g,d[s]),Y(s))),g=f,f=m,m=Z(h,30),h=u,u=i;u=X(u,r),h=X(h,o),m=X(m,a),f=X(f,c),g=X(g,l)}return[u,h,m,f,g]}function K(e,t,n,s){return e<20?t&n|~t&s:e<40?t^n^s:e<60?t&n|t&s|n&s:t^n^s}function Y(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function Q(e,t){var n=ee(e);n.length>16&&(n=J(n,8*e.length));for(var s=new Array(16),i=new Array(16),r=0;r<16;r++)s[r]=909522486^n[r],i[r]=1549556828^n[r];var o=J(s.concat(ee(t)),512+8*t.length);return J(i.concat(o),672)}function X(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function Z(e,t){return e<<t|e>>>32-t}function ee(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function te(e){for(var t,n,s="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?s+="=":s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-n)&63);return s}function ne(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}const se={b64_hmac_sha1:function(e,t){return te(Q(e,t))},b64_sha1:function(e){return te(J(ee(e),8*e.length))},binb2str:ne,core_hmac_sha1:Q,str_hmac_sha1:function(e,t){return ne(Q(e,t))},str_sha1:function(e){return ne(J(ee(e),8*e.length))}};var ie=n(7706);function re(e,t){return new le.Builder(e,t)}function oe(e){return new le.Builder("message",e)}function ae(e){return new le.Builder("iq",e)}function ce(e){return new le.Builder("presence",e)}const le={VERSION:"1.4.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag(e){for(let t=0;t<le.XHTML.tags.length;t++)if(e===le.XHTML.tags[t])return!0;return!1},validAttribute(e,t){if(void 0!==le.XHTML.attributes[e]&&le.XHTML.attributes[e].length>0)for(let n=0;n<le.XHTML.attributes[e].length;n++)if(t===le.XHTML.attributes[e][n])return!0;return!1},validCSS(e){for(let t=0;t<le.XHTML.css.length;t++)if(e===le.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace(e,t){le.NS[e]=t},forEachChild(e,t,n){for(let s=0;s<e.childNodes.length;s++){const i=e.childNodes[s];i.nodeType!==le.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}},isTagEqual:(e,t)=>e.tagName===t,_xmlGenerator:null,xmlGenerator:()=>(le._xmlGenerator||(le._xmlGenerator=function(){if("undefined"==typeof document)try{return(new(0,n(6853).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){const e=function(){const e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];for(let t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}();return e.appendChild(e.createElement("strophe")),e}return document.implementation.createDocument("jabber:client","strophe",null)}()),le._xmlGenerator),xmlElement(e){if(!e)return null;const t=le.xmlGenerator().createElement(e);for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)if("string"==typeof n||"number"==typeof n)t.appendChild(le.xmlTextNode(n));else if("object"==typeof n&&"function"==typeof n.sort)for(let e=0;e<n.length;e++){const s=n[e];"object"==typeof s&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&t.setAttribute(s[0],s[1])}else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&void 0!==n[e]&&null!==n[e]&&t.setAttribute(e,n[e])}return t},xmlescape:e=>(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;"),xmlunescape:e=>(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"'),xmlTextNode:e=>le.xmlGenerator().createTextNode(e),xmlHtmlNode(e){let t;return D?t=(new D).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},getText(e){if(!e)return null;let t="";0===e.childNodes.length&&e.nodeType===le.ElementType.TEXT&&(t+=e.nodeValue);for(let n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===le.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return le.xmlescape(t)},copyElement(e){let t;if(e.nodeType===le.ElementType.NORMAL){t=le.xmlElement(e.tagName);for(let n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(let n=0;n<e.childNodes.length;n++)t.appendChild(le.copyElement(e.childNodes[n]))}else e.nodeType===le.ElementType.TEXT&&(t=le.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml(e){let t;if(e.nodeType===le.ElementType.NORMAL){const n=e.nodeName.toLowerCase();if(le.XHTML.validTag(n))try{t=le.xmlElement(n);for(let s=0;s<le.XHTML.attributes[n].length;s++){const i=le.XHTML.attributes[n][s];let r=e.getAttribute(i);if(null!=r&&""!==r&&!1!==r&&0!==r)if("style"===i&&"object"==typeof r&&void 0!==r.cssText&&(r=r.cssText),"style"===i){const e=[],n=r.split(";");for(let t=0;t<n.length;t++){const s=n[t].split(":"),i=s[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(le.XHTML.validCSS(i)){const t=s[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(r=e.join("; "),t.setAttribute(i,r))}else t.setAttribute(i,r)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(le.createHtml(e.childNodes[n]))}catch(e){t=le.xmlTextNode("")}else{t=le.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(le.createHtml(e.childNodes[n]))}}else if(e.nodeType===le.ElementType.FRAGMENT){t=le.xmlGenerator().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(le.createHtml(e.childNodes[n]))}else e.nodeType===le.ElementType.TEXT&&(t=le.xmlTextNode(e.nodeValue));return t},escapeNode:e=>"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40"),unescapeNode:e=>"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\"),getNodeFromJid:e=>e.indexOf("@")<0?null:e.split("@")[0],getDomainFromJid(e){const t=le.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}},getResourceFromJid(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:e=>e?e.split("/")[0]:null,_handleError(e){void 0!==e.stack&&le.fatal(e.stack),e.sourceURL?le.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?le.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):le.fatal("error: "+e.message)},log(e,t){var n;e===this.LogLevel.FATAL&&(null===(n=console)||void 0===n||n.error(t))},debug(e){this.log(this.LogLevel.DEBUG,e)},info(e){this.log(this.LogLevel.INFO,e)},warn(e){this.log(this.LogLevel.WARN,e)},error(e){this.log(this.LogLevel.ERROR,e)},fatal(e){this.log(this.LogLevel.FATAL,e)},serialize(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());const t=[...Array(e.attributes.length).keys()].map((t=>e.attributes[t].nodeName));t.sort();let n=t.reduce(((t,n)=>`${t} ${n}="${le.xmlescape(e.attributes.getNamedItem(n).value)}"`),`<${e.nodeName}`);if(e.childNodes.length>0){n+=">";for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];switch(s.nodeType){case le.ElementType.NORMAL:n+=le.serialize(s);break;case le.ElementType.TEXT:n+=le.xmlescape(s.nodeValue);break;case le.ElementType.CDATA:n+="<![CDATA["+s.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin(e,t){le._connectionPlugins[e]=t},Builder:class{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=le.NS.CLIENT:t||(t={xmlns:le.NS.CLIENT})),this.nodeTree=le.xmlElement(e,t),this.node=this.nodeTree}tree(){return this.nodeTree}toString(){return le.serialize(this.nodeTree)}up(){return this.node=this.node.parentNode,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}c(e,t,n){const s=le.xmlElement(e,t,n);return this.node.appendChild(s),"string"!=typeof n&&"number"!=typeof n&&(this.node=s),this}cnode(e){let t;const n=le.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}const s=t?n.importNode(e,!0):le.copyElement(e);return this.node.appendChild(s),this.node=s,this}t(e){const t=le.xmlTextNode(e);return this.node.appendChild(t),this}h(e){const t=le.xmlGenerator().createElement("body");t.innerHTML=e;const n=le.createHtml(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},Handler:function(e,t,n,s,i,r,o){this.handler=e,this.ns=t,this.name=n,this.type=s,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(le.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=r?le.getBareJidFromJid(r):null:this.from=r,this.user=!0}};le.Handler.prototype={getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch(e){let t=!1;return!this.ns||(le.forEachChild(e,null,(e=>{this.getNamespace(e)===this.ns&&(t=!0)})),t||this.getNamespace(e)===this.ns)},isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=le.getBareJidFromJid(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!le.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run(e){let t=null;try{t=this.handler(e)}catch(e){throw le._handleError(e),e}return t},toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},le.TimedHandler=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},le.Connection=class{constructor(e,t){this.service=e,this.options=t||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),function(e){e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",s="",i="";const r=e[t],o="object"==typeof r,a=escape(unescape(o?r.value:r));o&&(n=r.expires?";expires="+r.expires:"",s=r.domain?";domain="+r.domain:"",i=r.path?";path="+r.path:""),document.cookie=t+"="+a+n+s+i}}(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(const e in le._connectionPlugins)if(Object.prototype.hasOwnProperty.call(le._connectionPlugins,e)){const t=function(){};t.prototype=le._connectionPlugins[e],this[e]=new t,this[e].init(this)}}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new le.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new le.Websocket(this):this._proto=new le.Bosh(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,s,i,r,o){this.jid=e,this.authzid=le.getBareJidFromJid(this.jid),this.authcid=o||le.getNodeFromJid(this.jid),this.pass=t,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=le.getDomainFromJid(this.jid),this._changeConnectStatus(le.Status.CONNECTING,null),this._proto._connect(s,i,r)}attach(e,t,n,s,i,r,o){if(this._proto._attach)return this._proto._attach(e,t,n,s,i,r,o);{const e=new Error('The "attach" method is not available for your connection protocol');throw e.name="StropheSessionError",e}}restore(e,t,n,s,i){if(!this._sessionCachingSupported()){const e=new Error('The "restore" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._restore(e,t,n,s,i)}_sessionCachingSupported(){if(this._proto instanceof le.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if("function"==typeof e.sort)for(let t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,s){let i=null;"function"==typeof e.tree&&(e=e.tree());let r=e.getAttribute("id");if(r||(r=this.getUniqueId("sendPresence"),e.setAttribute("id",r)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,r);s&&(i=this.addTimedHandler(s,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),r}sendIQ(e,t,n,s){let i=null;"function"==typeof e.tree&&(e=e.tree());let r=e.getAttribute("id");if(r||(r=this.getUniqueId("sendIQ"),e.setAttribute("id",r)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const s=e.getAttribute("type");if("result"===s)t&&t(e);else{if("error"!==s){const e=new Error(`Got bad IQ type of ${s}`);throw e.name="StropheError",e}n&&n(e)}}),null,"iq",["error","result"],r);s&&(i=this.addTimedHandler(s,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),r}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new le.TimedHandler(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,s,i,r,o){const a=new le.Handler(e,t,n,s,i,r,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e=e||[le.SASLAnonymous,le.SASLExternal,le.SASLOAuthBearer,le.SASLXOAuth2,le.SASLPlain,le.SASLSHA1]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(le.Status.DISCONNECTING,e),e?le.warn("Disconnect was called because: "+e):le.info("Disconnect was called"),this.connected){let e=!1;this.disconnecting=!0,this.authenticated&&(e=ce({xmlns:le.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else le.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in le._connectionPlugins)if(Object.prototype.hasOwnProperty.call(le._connectionPlugins,n)){const s=this[n];if(s.statusChanged)try{s.statusChanged(e,t)}catch(e){le.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){le._handleError(e),le.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),le.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(le.Status.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n=this._proto._reqToData(e);if(null===n)return;for(this.xmlInput!==le.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==le.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(le.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const s=n.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(le.Status.CONNFAIL,e)):this._changeConnectStatus(le.Status.CONNFAIL,le.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(e)}le.forEachChild(n,null,(e=>{const t=this.handlers;this.handlers=[];for(let n=0;n<t.length;n++){const s=t[n];try{(!s.isMatch(e)||!this.authenticated&&s.user||s.run(e))&&this.handlers.push(s)}catch(e){le.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}}))}_connect_cb(e,t,n){let s,i;le.debug("_connect_cb was called"),this.connected=!0;try{s=this._proto._reqToData(e)}catch(e){if(e.name!==le.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(le.Status.CONNFAIL,le.ErrorCondition.BAD_FORMAT),this._doDisconnect(le.ErrorCondition.BAD_FORMAT)}if(!s)return;if(this.xmlInput!==le.Connection.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==le.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(le.serialize(s))),this._proto._connect_cb(s)===le.Status.CONNFAIL)return;if(i=s.getElementsByTagNameNS?s.getElementsByTagNameNS(le.NS.STREAM,"features").length>0:s.getElementsByTagName("stream:features").length>0||s.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const r=Array.from(s.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==r.length||0!==s.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let s=t+1;s<e.length;++s)e[s].priority>e[n].priority&&(n=s);if(n!==t){const s=e[t];e[t]=e[n],e[n]=s}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const s=re("auth",{xmlns:le.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);s.t((0,ie.btoa)(e))}this.send(s.tree()),t=!0;break}return t}_sasl_challenge_cb(e){const t=(0,ie.atob)(le.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),s=re("response",{xmlns:le.NS.SASL});return""!==n&&s.t((0,ie.btoa)(n)),this.send(s.tree()),!0}_attemptLegacyAuth(){null===le.getNodeFromJid(this.jid)?(this._changeConnectStatus(le.Status.CONNFAIL,le.ErrorCondition.MISSING_JID_NODE),this.disconnect(le.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(le.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(ae({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:le.NS.AUTH}).c("username",{}).t(le.getNodeFromJid(this.jid)).tree()))}_onLegacyAuthIQResult(e){const t=ae({type:"set",id:"_auth_2"}).c("query",{xmlns:le.NS.AUTH}).c("username",{}).t(le.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return le.getResourceFromJid(this.jid)||(this.jid=le.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(le.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,s=(0,ie.atob)(le.getText(e)).match(n);if("v"===s[1]&&(t=s[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}le.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),le.NS.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(le.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(le.Status.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void le.log(le.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=le.getResourceFromJid(this.jid);e?this.send(ae({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:le.NS.BIND}).c("resource",{}).t(e).tree()):this.send(ae({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:le.NS.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){let t;return le.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=le.ErrorCondition.CONFLICT),this._changeConnectStatus(le.Status.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return le.warn("Resource binding failed."),this._changeConnectStatus(le.Status.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=le.getText(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(le.Status.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${le.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(ae({type:"set",id:"_session_auth_2"}).c("session",{xmlns:le.NS.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(le.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,le.warn("Session creation failed."),this._changeConnectStatus(le.Status.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(le.Status.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(le.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(le.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new le.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,s,i){const r=new le.Handler(e,t,n,s,i);return r.user=!1,this.addHandlers.push(r),r}_onDisconnectTimeout(){return le.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(le.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const s=this.timedHandlers[n];!this.authenticated&&s.user||(s.lastCalled+s.period-e<=0?s.run()&&t.push(s):t.push(s))}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}},le.SASLMechanism=W,le.SASLAnonymous=class extends W{constructor(e="ANONYMOUS",t=!1,n=20){super(e,t,n)}test(e){return null===e.authcid}},le.SASLPlain=class extends W{constructor(e="PLAIN",t=!0,n=50){super(e,t,n)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:s,pass:i}=e;if(!s)throw new Error("SASLPlain onChallenge: domain is not defined!");let r=n!==`${t}@${s}`?n:"";return r+="\0",r+=t,r+="\0",r+=i,V(r)}},le.SASLSHA1=class extends W{constructor(e="SCRAM-SHA-1",t=!0,n=60){super(e,t,n)}test(e){return null!==e.authcid}onChallenge(e,t){let n,s,i,r,o,a,c,l,d="c=biws,",u=`${e._sasl_data["client-first-message-bare"]},${t},`;const h=e._sasl_data.cnonce,m=/([a-z]+)=([^,]+)(,|$)/;for(;t.match(m);){const e=t.match(m);switch(t=t.replace(e[0],""),e[1]){case"r":n=e[2];break;case"s":s=e[2];break;case"i":i=e[2]}}if(n.substr(0,h.length)!==h)return e._sasl_data={},e._sasl_failure_cb();d+="r="+n,u+=d,s=atob(s),s+="\0\0\0";const f=V(e.pass);for(r=a=se.core_hmac_sha1(f,s),c=1;c<i;c++){for(o=se.core_hmac_sha1(f,se.binb2str(a)),l=0;l<5;l++)r[l]^=o[l];a=o}r=se.binb2str(r);const g=se.core_hmac_sha1(r,"Client Key"),p=se.str_hmac_sha1(r,"Server Key"),v=se.core_hmac_sha1(se.str_sha1(se.binb2str(g)),u);for(e._sasl_data["server-signature"]=se.b64_hmac_sha1(p,u),l=0;l<5;l++)g[l]^=v[l];return d+=",p="+btoa(se.binb2str(g)),d}clientChallenge(e,t){const n=t||G.hexdigest(""+1234567890*Math.random());let s="n="+V(e.authcid);return s+=",r=",s+=n,e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=s,s="n,,"+s,s}},le.SASLOAuthBearer=class extends W{constructor(e="OAUTHBEARER",t=!0,n=40){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",V(t)}},le.SASLExternal=class extends W{constructor(e="EXTERNAL",t=!0,n=10){super(e,t,n)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}},le.SASLXOAuth2=class extends W{constructor(e="X-OAUTH2",t=!0,n=30){super(e,t,n)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,V(t)}};const de={Strophe:le,$build:re,$iq:ae,$msg:oe,$pres:ce,SHA1:se,MD5:G,b64_hmac_sha1:se.b64_hmac_sha1,b64_sha1:se.b64_sha1,str_hmac_sha1:se.str_hmac_sha1,str_sha1:se.str_sha1};le.Request=class{constructor(e,t,n,s){this.id=++le._requestId,this.xmlData=e,this.data=le.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()}getResponse(){let e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw le.error("invalid response received"),le.error("responseText: "+this.xhr.responseText),le.error("responseXML: "+le.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(le.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new D).parseFromString(this.xhr.responseText,"application/xml").documentElement,!e)throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){le.error("invalid response received: "+e.querySelector("parsererror").textContent),le.error("responseText: "+this.xhr.responseText);const t=new Error;throw t.name=le.ErrorCondition.BAD_FORMAT,t}}return e}_newXHR(){let e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},le.Bosh=class e{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}_buildBody(){const e=re("body",{rid:this.rid++,xmlns:le.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":le.NS.BOSH});n&&s.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new le.Request(s.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()}_attach(e,t,n,s,i,r,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=s,this._conn.domain=le.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=r||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(le.Status.ATTACHED,null)}_restore(e,t,n,s,i){const r=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=r&&r.rid&&r.sid&&r.jid&&(null==e||le.getBareJidFromJid(r.jid)===le.getBareJidFromJid(e)||null===le.getNodeFromJid(e)&&le.getDomainFromJid(r.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,t,n,s,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");le.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(le.Status.CONNFAIL,t)):this._conn._changeConnectStatus(le.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),le.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const r=e.getAttribute("inactivity");r&&(this.inactivity=parseInt(r,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(t){const n=e._getRequestStatus(t),s=this._conn.protocolErrorHandlers.HTTP[n];s&&s.call(this,n)}_hitError(e){this.errors++,le.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){le.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new le.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(le.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":le.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new le.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(le.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(le.TIMEOUT*this.wait)&&(le.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(le.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){le.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(t,n){if(le.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4!==n.xhr.readyState)return;const s=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&s>=400)return this._hitError(s),void this._callProtocolErrorHandlers(n);const i=s>0&&s<500,r=n.sends>this._conn.maxRetries;if((i||r)&&(this._removeRequest(n),le.debug("request id "+n.id+" should now be removed")),200===s){const e=this._requests[0]===n;(this._requests[1]===n||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(le.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),le.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===s||s>=400&&s<600||s>=12e3?(le.error("request id "+n.id+"."+n.sends+" error "+s+" happened"),this._hitError(s),this._callProtocolErrorHandlers(n),s>=400&&s<500&&(this._conn._changeConnectStatus(le.Status.DISCONNECTING,null),this._conn._doDisconnect())):le.error("request id "+n.id+"."+n.sends+" error "+s+" happened");i||r?r&&!this._conn.connected&&this._conn._changeConnectStatus(le.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(t){let n=this._requests[t];const s=e._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const i=n.age(),r=!isNaN(i)&&i>Math.floor(le.TIMEOUT*this.wait),o=null!==n.dead&&n.timeDead()>Math.floor(le.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(s<1||s>=500);if((r||o||a)&&(o&&le.error(`Request ${this._requests[t].id} timed out (secondary), restarting`),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new le.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){le.debug("request id "+n.id+"."+n.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return le.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(le.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(n.date=new Date,this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.xhr.setRequestHeader(t,e[t])}n.xhr.send(n.data)};if(n.sends>1){const t=1e3*Math.min(Math.floor(le.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){e()}),t)}else e();n.sends++,this._conn.xmlOutput!==le.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==le.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else le.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+n.xhr.readyState)}_removeRequest(e){le.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){le.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());const n=new le.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?le.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):le.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},le.Bosh.prototype.strip=null,le.Websocket=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}}_buildStream(){return re("open",{xmlns:le.NS.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(le.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const s=n[0];let i="",r="";for(let e=0;e<s.childNodes.length;e++){const t=s.childNodes[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?r=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",r&&(o+=" - "+r),le.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new R(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,le.Status.CONNFAIL))return le.Status.CONNFAIL}_handleStreamStart(e){let t=!1;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==le.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const s=e.getAttribute("version");return"string"!=typeof s?t="Missing version in <open />":"1.0"!==s&&(t="Wrong version in <open />: "+s),!t||(this._conn._changeConnectStatus(le.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new D).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new D).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(le.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(le.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new D).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==R.CLOSED){e&&this._conn.send(e);const t=re("close",{xmlns:le.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=le.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){le.warn("Couldn't send <close /> tag.")}}setTimeout((()=>this._conn._doDisconnect),0)}_doDisconnect(){le.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){le.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(le.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(le.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(le.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):le.debug("Websocket closed")}_no_auth_received(e){le.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(le.Status.CONNFAIL,le.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){le.error("Websocket error "+e),this._conn._changeConnectStatus(le.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){let n;n="restart"===e[t]?this._buildStream().tree():e[t];const s=le.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new D).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new D).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,le.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(le.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){le.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=le.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_reqToData(e){return e}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const ue={};ue.debug=le.LogLevel.DEBUG,ue.info=le.LogLevel.INFO,ue.warn=le.LogLevel.WARN,ue.error=le.LogLevel.ERROR,ue.fatal=le.LogLevel.FATAL,le.WorkerWebsocket=class extends le.Websocket{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{var t;null===(t=console)||void 0===t||t.error(e),le.log(le.LogLevel.ERROR,`Shared Worker Error: ${e}`)}}get socket(){return{send:e=>this.worker.port.postMessage(["send",e])}}_connect(){this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===le.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(le.Status.ATTACHED)):e===le.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(le.Status.ATTACHFAIL))}_disconnect(e,t){t&&this._conn.send(t);const n=re("close",{xmlns:le.NS.FRAMING});this._conn.xmlOutput(n.tree());const s=le.serialize(n);this._conn.rawOutput(s),this.worker.port.postMessage(["send",s]),this._conn._doDisconnect()}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(le.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(le.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(le.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):le.debug("Websocket closed")}_closeSocket(){this.worker.port.postMessage(["_closeSocket"])}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){le.log(le.LogLevel.ERROR,e)}else if("log"===n){const e=t[1],n=t[2];le.log(ue[e],n)}else le.log(le.LogLevel.ERROR,`Found unhandled service worker message: ${t}`)}},n.g.$build=de.$build,n.g.$iq=de.$iq,n.g.$msg=de.$msg,n.g.$pres=de.$pres,n.g.Strophe=de.Strophe;const{b64_sha1:he}=se,me={};me[le.Status.ATTACHED]="ATTACHED",me[le.Status.AUTHENTICATING]="AUTHENTICATING",me[le.Status.AUTHFAIL]="AUTHFAIL",me[le.Status.CONNECTED]="CONNECTED",me[le.Status.CONNECTING]="CONNECTING",me[le.Status.CONNFAIL]="CONNFAIL",me[le.Status.DISCONNECTED]="DISCONNECTED",me[le.Status.DISCONNECTING]="DISCONNECTING",me[le.Status.ERROR]="ERROR",me[le.Status.RECONNECTING]="RECONNECTING",me[le.Status.REDIRECT]="REDIRECT";const fe=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-carbons","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],ge={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi},pe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},ve=function(e){if(!pe(e))return!1;var t=b(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},be=d["__core-js_shared__"];var ye,_e=(ye=/[^.]+$/.exec(be&&be.keys&&be.keys.IE_PROTO||""))?"Symbol(src)_1."+ye:"";var we=Function.prototype.toString;const Se=function(e){if(null!=e){try{return we.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var xe=/^\[object .+?Constructor\]$/,Ee=Function.prototype,Ae=Object.prototype,Ce=Ee.toString,Te=Ae.hasOwnProperty,ke=RegExp("^"+Ce.call(Te).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const je=function(e){return!(!pe(e)||(t=e,_e&&_e in t))&&(ve(e)?ke:xe).test(Se(e));var t},Ne=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return je(n)?n:void 0},Oe=function(){try{var e=Ne(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),$e=function(e,t,n){"__proto__"==t&&Oe?Oe(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ie=function(e,t){return e===t||e!=e&&t!=t};var Me=Object.prototype.hasOwnProperty;const Re=function(e,t,n){var s=e[t];Me.call(e,t)&&Ie(s,n)&&(void 0!==n||t in e)||$e(e,t,n)},De=function(e,t,n,s){var i=!n;n||(n={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=s?s(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?$e(n,a,c):Re(n,a,c)}return n},Le=function(e){return e},ze=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Pe=Math.max;const Fe=function(e,t,n){return t=Pe(void 0===t?e.length-1:t,0),function(){for(var s=arguments,i=-1,r=Pe(s.length-t,0),o=Array(r);++i<r;)o[i]=s[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=s[i];return a[t]=n(o),ze(e,this,a)}},Ue=function(e){return function(){return e}},Be=Oe?function(e,t){return Oe(e,"toString",{configurable:!0,enumerable:!1,value:Ue(t),writable:!0})}:Le;var qe=Date.now;const He=(Ge=Be,We=0,Ve=0,function(){var e=qe(),t=16-(e-Ve);if(Ve=e,t>0){if(++We>=800)return arguments[0]}else We=0;return Ge.apply(void 0,arguments)});var Ge,We,Ve;const Je=function(e,t){return He(Fe(e,t,Le),e+"")},Ke=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Ye=function(e){return null!=e&&Ke(e.length)&&!ve(e)};var Qe=/^(?:0|[1-9]\d*)$/;const Xe=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Qe.test(e))&&e>-1&&e%1==0&&e<t},Ze=function(e,t,n){if(!pe(n))return!1;var s=typeof t;return!!("number"==s?Ye(n)&&Xe(t,n.length):"string"==s&&t in n)&&Ie(n[t],e)},et=function(e){return Je((function(t,n){var s=-1,i=n.length,r=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&Ze(n[0],n[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++s<i;){var a=n[s];a&&e(t,a,s,r)}return t}))},tt=function(e){return a(e)&&"[object Arguments]"==b(e)};var nt=Object.prototype,st=nt.hasOwnProperty,it=nt.propertyIsEnumerable;const rt=tt(function(){return arguments}())?tt:function(e){return a(e)&&st.call(e,"callee")&&!it.call(e,"callee")},ot=Array.isArray;var at="object"==typeof exports&&exports&&!exports.nodeType&&exports,ct=at&&"object"==typeof module&&module&&!module.nodeType&&module,lt=ct&&ct.exports===at?d.Buffer:void 0;const dt=(lt?lt.isBuffer:void 0)||function(){return!1};var ut={};ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Arguments]"]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object Boolean]"]=ut["[object DataView]"]=ut["[object Date]"]=ut["[object Error]"]=ut["[object Function]"]=ut["[object Map]"]=ut["[object Number]"]=ut["[object Object]"]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object WeakMap]"]=!1;const ht=function(e){return function(t){return e(t)}};var mt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ft=mt&&"object"==typeof module&&module&&!module.nodeType&&module,gt=ft&&ft.exports===mt&&c.process;const pt=function(){try{return ft&&ft.require&&ft.require("util").types||gt&&gt.binding&&gt.binding("util")}catch(e){}}();var vt=pt&&pt.isTypedArray;const bt=vt?ht(vt):function(e){return a(e)&&Ke(e.length)&&!!ut[b(e)]};var yt=Object.prototype.hasOwnProperty;const _t=function(e,t){var n=ot(e),s=!n&&rt(e),i=!n&&!s&&dt(e),r=!n&&!s&&!i&&bt(e),o=n||s||i||r,a=o?function(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}(e.length,String):[],c=a.length;for(var l in e)!t&&!yt.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Xe(l,c))||a.push(l);return a};var wt=Object.prototype;const St=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||wt)};var xt=Object.prototype.hasOwnProperty;const Et=function(e){if(!pe(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=St(e),n=[];for(var s in e)("constructor"!=s||!t&&xt.call(e,s))&&n.push(s);return n},At=function(e){return Ye(e)?_t(e,!0):Et(e)},Ct=et((function(e,t){De(t,At(t),e)})),Tt=function(e,t){for(var n=-1,s=null==e?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1},kt=function(e,t){for(var n=e.length;n--;)if(Ie(e[n][0],t))return n;return-1};var jt=Array.prototype.splice;function Nt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Nt.prototype.clear=function(){this.__data__=[],this.size=0},Nt.prototype.delete=function(e){var t=this.__data__,n=kt(t,e);return!(n<0||(n==t.length-1?t.pop():jt.call(t,n,1),--this.size,0))},Nt.prototype.get=function(e){var t=this.__data__,n=kt(t,e);return n<0?void 0:t[n][1]},Nt.prototype.has=function(e){return kt(this.__data__,e)>-1},Nt.prototype.set=function(e,t){var n=this.__data__,s=kt(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this};const Ot=Nt,$t=Ne(d,"Map"),It=Ne(Object,"create");var Mt=Object.prototype.hasOwnProperty;var Rt=Object.prototype.hasOwnProperty;function Dt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Dt.prototype.clear=function(){this.__data__=It?It(null):{},this.size=0},Dt.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Dt.prototype.get=function(e){var t=this.__data__;if(It){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Mt.call(t,e)?t[e]:void 0},Dt.prototype.has=function(e){var t=this.__data__;return It?void 0!==t[e]:Rt.call(t,e)},Dt.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=It&&void 0===t?"__lodash_hash_undefined__":t,this};const Lt=Dt,zt=function(e,t){var n,s,i=e.__data__;return("string"==(s=typeof(n=t))||"number"==s||"symbol"==s||"boolean"==s?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map};function Pt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Pt.prototype.clear=function(){this.size=0,this.__data__={hash:new Lt,map:new($t||Ot),string:new Lt}},Pt.prototype.delete=function(e){var t=zt(this,e).delete(e);return this.size-=t?1:0,t},Pt.prototype.get=function(e){return zt(this,e).get(e)},Pt.prototype.has=function(e){return zt(this,e).has(e)},Pt.prototype.set=function(e,t){var n=zt(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this};const Ft=Pt;function Ut(e){var t=this.__data__=new Ot(e);this.size=t.size}Ut.prototype.clear=function(){this.__data__=new Ot,this.size=0},Ut.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ut.prototype.get=function(e){return this.__data__.get(e)},Ut.prototype.has=function(e){return this.__data__.has(e)},Ut.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ot){var s=n.__data__;if(!$t||s.length<199)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ft(s)}return n.set(e,t),this.size=n.size,this};const Bt=Ut;function qt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Ft;++t<n;)this.add(e[t])}qt.prototype.add=qt.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},qt.prototype.has=function(e){return this.__data__.has(e)};const Ht=qt,Gt=function(e,t){return e.has(t)},Wt=function(e,t,n,s,i,r){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e),d=r.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,m=2&n?new Ht:void 0;for(r.set(e,t),r.set(t,e);++u<a;){var f=e[u],g=t[u];if(s)var p=o?s(g,f,u,t,e,r):s(f,g,u,e,t,r);if(void 0!==p){if(p)continue;h=!1;break}if(m){if(!Tt(t,(function(e,t){if(!Gt(m,t)&&(f===e||i(f,e,n,s,r)))return m.push(t)}))){h=!1;break}}else if(f!==g&&!i(f,g,n,s,r)){h=!1;break}}return r.delete(e),r.delete(t),h},Vt=d.Uint8Array,Jt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,s){n[++t]=[s,e]})),n},Kt=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var Yt=u?u.prototype:void 0,Qt=Yt?Yt.valueOf:void 0;const Xt=function(e,t){for(var n=-1,s=t.length,i=e.length;++n<s;)e[i+n]=t[n];return e},Zt=function(e,t,n){var s=t(e);return ot(e)?s:Xt(s,n(e))},en=function(){return[]};var tn=Object.prototype.propertyIsEnumerable,nn=Object.getOwnPropertySymbols;const sn=nn?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,s=null==e?0:e.length,i=0,r=[];++n<s;){var o=e[n];t(o,n,e)&&(r[i++]=o)}return r}(nn(e),(function(t){return tn.call(e,t)})))}:en,rn=y(Object.keys,Object);var on=Object.prototype.hasOwnProperty;const an=function(e){if(!St(e))return rn(e);var t=[];for(var n in Object(e))on.call(e,n)&&"constructor"!=n&&t.push(n);return t},cn=function(e){return Ye(e)?_t(e):an(e)},ln=function(e){return Zt(e,cn,sn)};var dn=Object.prototype.hasOwnProperty;const un=Ne(d,"DataView"),hn=Ne(d,"Promise"),mn=Ne(d,"Set"),fn=Ne(d,"WeakMap");var gn="[object Map]",pn="[object Promise]",vn="[object Set]",bn="[object WeakMap]",yn="[object DataView]",_n=Se(un),wn=Se($t),Sn=Se(hn),xn=Se(mn),En=Se(fn),An=b;(un&&An(new un(new ArrayBuffer(1)))!=yn||$t&&An(new $t)!=gn||hn&&An(hn.resolve())!=pn||mn&&An(new mn)!=vn||fn&&An(new fn)!=bn)&&(An=function(e){var t=b(e),n="[object Object]"==t?e.constructor:void 0,s=n?Se(n):"";if(s)switch(s){case _n:return yn;case wn:return gn;case Sn:return pn;case xn:return vn;case En:return bn}return t});const Cn=An;var Tn="[object Arguments]",kn="[object Array]",jn="[object Object]",Nn=Object.prototype.hasOwnProperty;const On=function(e,t,n,s,i,r){var o=ot(e),a=ot(t),c=o?kn:Cn(e),l=a?kn:Cn(t),d=(c=c==Tn?jn:c)==jn,u=(l=l==Tn?jn:l)==jn,h=c==l;if(h&&dt(e)){if(!dt(t))return!1;o=!0,d=!1}if(h&&!d)return r||(r=new Bt),o||bt(e)?Wt(e,t,n,s,i,r):function(e,t,n,s,i,r,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!r(new Vt(e),new Vt(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ie(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Jt;case"[object Set]":var c=1&s;if(a||(a=Kt),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;s|=2,o.set(e,t);var d=Wt(a(e),a(t),s,i,r,o);return o.delete(e),d;case"[object Symbol]":if(Qt)return Qt.call(e)==Qt.call(t)}return!1}(e,t,c,n,s,i,r);if(!(1&n)){var m=d&&Nn.call(e,"__wrapped__"),f=u&&Nn.call(t,"__wrapped__");if(m||f){var g=m?e.value():e,p=f?t.value():t;return r||(r=new Bt),i(g,p,n,s,r)}}return!!h&&(r||(r=new Bt),function(e,t,n,s,i,r){var o=1&n,a=ln(e),c=a.length;if(c!=ln(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:dn.call(t,d)))return!1}var u=r.get(e),h=r.get(t);if(u&&h)return u==t&&h==e;var m=!0;r.set(e,t),r.set(t,e);for(var f=o;++l<c;){var g=e[d=a[l]],p=t[d];if(s)var v=o?s(p,g,d,t,e,r):s(g,p,d,e,t,r);if(!(void 0===v?g===p||i(g,p,n,s,r):v)){m=!1;break}f||(f="constructor"==d)}if(m&&!f){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(m=!1)}return r.delete(e),r.delete(t),m}(e,t,n,s,i,r))},$n=function e(t,n,s,i,r){return t===n||(null==t||null==n||!a(t)&&!a(n)?t!=t&&n!=n:On(t,n,s,i,e,r))},In=function(e,t,n,s){var i=n.length,r=i,o=!s;if(null==e)return!r;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<r;){var c=(a=n[i])[0],l=e[c],d=a[1];if(o&&a[2]){if(void 0===l&&!(c in e))return!1}else{var u=new Bt;if(s)var h=s(l,d,c,e,t,u);if(!(void 0===h?$n(d,l,3,s,u):h))return!1}}return!0},Mn=function(e){return e==e&&!pe(e)},Rn=function(e){for(var t=cn(e),n=t.length;n--;){var s=t[n],i=e[s];t[n]=[s,i,Mn(i)]}return t},Dn=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Ln=function(e){return"symbol"==typeof e||a(e)&&"[object Symbol]"==b(e)};var zn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pn=/^\w*$/;const Fn=function(e,t){if(ot(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ln(e))||Pn.test(e)||!zn.test(e)||null!=t&&e in Object(t)};function Un(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var s=arguments,i=t?t.apply(this,s):s[0],r=n.cache;if(r.has(i))return r.get(i);var o=e.apply(this,s);return n.cache=r.set(i,o)||r,o};return n.cache=new(Un.Cache||Ft),n}Un.Cache=Ft;var Bn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qn=/\\(\\)?/g;const Hn=(Gn=Un((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Bn,(function(e,n,s,i){t.push(s?i.replace(qn,"$1"):n||e)})),t}),(function(e){return 500===Wn.size&&Wn.clear(),e})),Wn=Gn.cache,Gn);var Gn,Wn;const Vn=function(e,t){for(var n=-1,s=null==e?0:e.length,i=Array(s);++n<s;)i[n]=t(e[n],n,e);return i};var Jn=u?u.prototype:void 0,Kn=Jn?Jn.toString:void 0;const Yn=function e(t){if("string"==typeof t)return t;if(ot(t))return Vn(t,e)+"";if(Ln(t))return Kn?Kn.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},Qn=function(e){return null==e?"":Yn(e)},Xn=function(e,t){return ot(e)?e:Fn(e,t)?[e]:Hn(Qn(e))},Zn=function(e){if("string"==typeof e||Ln(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},es=function(e,t){for(var n=0,s=(t=Xn(t,e)).length;null!=e&&n<s;)e=e[Zn(t[n++])];return n&&n==s?e:void 0},ts=function(e,t){return null!=e&&t in Object(e)},ns=function(e,t,n){for(var s=-1,i=(t=Xn(t,e)).length,r=!1;++s<i;){var o=Zn(t[s]);if(!(r=null!=e&&n(e,o)))break;e=e[o]}return r||++s!=i?r:!!(i=null==e?0:e.length)&&Ke(i)&&Xe(o,i)&&(ot(e)||rt(e))},ss=function(e,t){return null!=e&&ns(e,t,ts)},is=function(e,t){return Fn(e)&&Mn(t)?Dn(Zn(e),t):function(n){var s=function(e,t,n){var s=null==e?void 0:es(e,t);return void 0===s?n:s}(n,e);return void 0===s&&s===t?ss(n,e):$n(t,s,3)}},rs=function(e){return Fn(e)?(t=Zn(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return es(t,e)}}(e);var t},os=function(e){return"function"==typeof e?e:null==e?Le:"object"==typeof e?ot(e)?is(e[0],e[1]):1==(n=Rn(t=e)).length&&n[0][2]?Dn(n[0][0],n[0][1]):function(e){return e===t||In(e,t,n)}:rs(e);var t,n},as=function(e,t,n){for(var s=-1,i=Object(e),r=n(e),o=r.length;o--;){var a=r[++s];if(!1===t(i[a],a,i))break}return e},cs=function(e,t){return e&&as(e,t,cn)},ls=(ds=cs,function(e,t){if(null==e)return e;if(!Ye(e))return ds(e,t);for(var n=e.length,s=-1,i=Object(e);++s<n&&!1!==t(i[s],s,i););return e});var ds;const us=function(e,t){var n;return ls(e,(function(e,s,i){return!(n=t(e,s,i))})),!!n},hs=function(e,t,n){var s=ot(e)?Tt:us;return n&&Ze(e,t,n)&&(t=void 0),s(e,os(t))};var ms=Object.prototype.hasOwnProperty;const fs=function(e){if(null==e)return!0;if(Ye(e)&&(ot(e)||"string"==typeof e||"function"==typeof e.splice||dt(e)||bt(e)||rt(e)))return!e.length;var t=Cn(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(St(e))return!an(e).length;for(var n in e)if(ms.call(e,n))return!1;return!0};var gs=/\s/;var ps=/^\s+/;const vs=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&gs.test(e.charAt(t)););return t}(e)+1).replace(ps,""):e};var bs=/^[-+]0x[0-9a-f]+$/i,ys=/^0b[01]+$/i,_s=/^0o[0-7]+$/i,ws=parseInt;const Ss=function(e){if("number"==typeof e)return e;if(Ln(e))return NaN;if(pe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=pe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=vs(e);var n=ys.test(e);return n||_s.test(e)?ws(e.slice(2),n?2:8):bs.test(e)?NaN:+e};const xs=function(e){return e?Infinity===(e=Ss(e))||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},Es=function(e){var t=xs(e),n=t%1;return t==t?n?t-n:t:0},As=function(e){return function(e,t){var n;if("function"!=typeof t)throw new TypeError("Expected a function");return e=Es(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}(2,e)};var Cs=0;const Ts=function(e){var t=++Cs;return Qn(e)+t},ks={},js=/\s+/;let Ns;const Os=function(e,t,n,s,i){let r,o=0;if(n&&"object"==typeof n){void 0!==s&&"context"in i&&void 0===i.context&&(i.context=s);for(r=cn(n);o<r.length;o++)t=Os(e,t,r[o],n[r[o]],i)}else if(n&&js.test(n))for(r=n.split(js);o<r.length;o++)t=e(t,r[o],s,i);else t=e(t,n,s,i);return t};ks.on=function(e,t,n){return this._events=Os($s,this._events||{},e,t,{context:n,ctx:this,listening:Ns}),Ns&&((this._listeners||(this._listeners={}))[Ns.id]=Ns,Ns.interop=!1),this},ks.listenTo=function(e,t,n){if(!e)return this;const s=e._listenId||(e._listenId=Ts("l")),i=this._listeningTo||(this._listeningTo={});let r=Ns=i[s];r||(this._listenId||(this._listenId=Ts("l")),r=Ns=i[s]=new zs(this,e));const o=Is(e,t,n,this);if(Ns=void 0,o)throw o;return r.interop&&r.on(t,n),this};const $s=function(e,t,n,s){if(n){const i=e[t]||(e[t]=[]),r=s.context,o=s.ctx,a=s.listening;a&&a.count++,i.push({callback:n,context:r,ctx:r||o,listening:a})}return e},Is=function(e,t,n,s){try{e.on(t,n,s)}catch(e){return e}};ks.off=function(e,t,n){return this._events?(this._events=Os(Ms,this._events,e,t,{context:n,listeners:this._listeners}),this):this},ks.stopListening=function(e,t,n){const s=this._listeningTo;if(!s)return this;const i=e?[e._listenId]:cn(s);for(let e=0;e<i.length;e++){const r=s[i[e]];if(!r)break;r.obj.off(t,n,this),r.interop&&r.off(t,n)}return fs(s)&&(this._listeningTo=void 0),this};const Ms=function(e,t,n,s){if(!e)return;const i=s.context,r=s.listeners;let o,a=0;if(t||i||n){for(o=t?[t]:cn(e);a<o.length;a++){const s=e[t=o[a]];if(!s)break;const r=[];for(let e=0;e<s.length;e++){const o=s[e];if(n&&n!==o.callback&&n!==o.callback._callback||i&&i!==o.context)r.push(o);else{const e=o.listening;e&&e.off(t,n)}}r.length?e[t]=r:delete e[t]}return e}for(o=cn(r);a<o.length;a++)r[o[a]].cleanup()};ks.once=function(e,t,n){const s=Os(Rs,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(s,t,n)},ks.listenToOnce=function(e,t,n){const s=Os(Rs,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,s)};const Rs=function(e,t,n,s){if(n){const i=e[t]=As((function(){s(t,i),n.apply(this,arguments)}));i._callback=n}return e};ks.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return Os(Ds,this._events,e,void 0,n),this};const Ds=function(e,t,n,s){if(e){const n=e[t];let i=e.all;n&&i&&(i=i.slice()),n&&Ls(n,s),i&&Ls(i,[t].concat(s))}return e},Ls=function(e,t){let n,s=-1;const i=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++s<i;)(n=e[s]).callback.call(n.ctx);return;case 1:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r);return;case 2:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r,o);return;case 3:for(;++s<i;)(n=e[s]).callback.call(n.ctx,r,o,a);return;default:for(;++s<i;)(n=e[s]).callback.apply(n.ctx,t);return}},zs=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};zs.prototype.on=ks.on,zs.prototype.off=function(e,t){let n;this.interop?(this._events=Os(Ms,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},zs.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},ks.bind=ks.on,ks.unbind=ks.off;const Ps=function(e,t){return e&&De(t,cn(t),e)};var Fs=Object.create;const Us=function(){function e(){}return function(t){if(!pe(t))return{};if(Fs)return Fs(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Bs=Object.prototype.hasOwnProperty;const qs=function(e,t){return null!=e&&Bs.call(e,t)},Hs=function(e,t){return null!=e&&ns(e,t,qs)},Gs=function(e,t,n){var s=-1,i=(t=Xn(t,e)).length;for(i||(i=1,e=void 0);++s<i;){var r=null==e?void 0:e[Zn(t[s])];void 0===r&&(s=i,r=n),e=ve(r)?r.call(e):r}return e};function Ws(e,t){const n=this;let s;return s=e&&Hs(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},Ct(s,n,t),s.prototype=function(e,t){var n=Us(e);return null==t?n:Ps(n,t)}(n.prototype,e),s.prototype.constructor=s,s.__super__=n.prototype,s}function Vs(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function Js(){throw new Error('A "url" property or function must be specified')}function Ks(e,t){const n=t.error;t.error=function(s){n&&n.call(t.context,e,s,t),e.trigger("error",e,s,t)}}Error;const Ys={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Qs(e){const t=Gs(e,"browserStorage")||Gs(e.collection,"browserStorage");return t?t.sync():Xs}function Xs(e,t,n={}){const s={type:Ys[e],dataType:"json"};n.url||(s.url=Gs(t,"url")||Js()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(n.attrs||t.toJSON(n))),"GET"!==s.type&&(s.processData=!1);const i=n.error;n.error=function(e,t,s){n.textStatus=t,n.errorThrown=s,i&&i.call(n.context,e,t,s)};const r=n.xhr=function(){return fetch.apply(this,arguments)}(Ct(s,n));return t.trigger("request",t,r,n),r}const Zs=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)};Zs.extend=Ws;const ei=/^[#\/]|\s+$/g,ti=/^\/+|\/+$/g,ni=/#.*$/;Zs.started=!1,Object.assign(Zs.prototype,ks,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){const e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){const t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){const e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(ei,"")},start:function(e){if(Zs.started)throw new Error("history has already been started");if(Zs.started=!0,this.options=Ct({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(ti,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){const e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;const e=document.body,t=e.insertBefore(this.iframe,e.firstChild).contentWindow;t.document.open(),t.document.close(),t.location.hash="#"+this.fragment}if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),Zs.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){let t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),hs(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!Zs.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");let n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");const s=n+e;e=e.replace(ni,"");const i=this.decodeFragment(e);if(this.fragment!==i){if(this.fragment=i,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,s);else{if(!this._wantsHashChange)return this.location.assign(s);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){const n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){const n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}});const si=Zs;var ii=pt&&pt.isRegExp;const ri=ii?ht(ii):function(e){return a(e)&&"[object RegExp]"==b(e)},oi=function(e={}){this.history=e.history||new si,this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};oi.extend=Ws;const ai=/\((.*?)\)/g,ci=/(\(\?)?:\w+/g,li=/\*\w+/g,di=/[\-{}\[\]+?.,\\\^$|#\s]/g;Object.assign(oi.prototype,ks,{preinitialize:function(){},initialize:function(){},route:function(e,t,n){return ri(e)||(e=this._routeToRegExp(e)),ve(t)&&(n=t,t=""),n||(n=this[t]),this.history.route(e,(s=>{const i=this._extractParameters(e,s);!1!==this.execute(n,i,t)&&(this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),this.history.trigger("route",this,t,i))})),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,t){return this.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;let e;this.routes=Gs(this,"routes");const t=cn(this.routes);for(;null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(di,"\\$&").replace(ai,"(?:$1)?").replace(ci,(function(e,t){return t?e:"([^/?]+)"})).replace(li,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){const n=e.exec(t).slice(1);return n.map((function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});class ui extends Error{}const hi=function(e,t,n){(void 0!==n&&!Ie(e[t],n)||void 0===n&&!(t in e))&&$e(e,t,n)};var mi="object"==typeof exports&&exports&&!exports.nodeType&&exports,fi=mi&&"object"==typeof module&&module&&!module.nodeType&&module,gi=fi&&fi.exports===mi?d.Buffer:void 0,pi=gi?gi.allocUnsafe:void 0;const vi=function(e,t){if(t)return e.slice();var n=e.length,s=pi?pi(n):new e.constructor(n);return e.copy(s),s},bi=function(e){var t=new e.constructor(e.byteLength);return new Vt(t).set(new Vt(e)),t},yi=function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},_i=function(e,t){var n=-1,s=e.length;for(t||(t=Array(s));++n<s;)t[n]=e[n];return t},wi=function(e){return"function"!=typeof e.constructor||St(e)?{}:Us(_(e))},Si=function(e){return a(e)&&Ye(e)},xi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},Ei=function(e,t,n,s,i,r,o){var a,c=xi(e,n),l=xi(t,n),d=o.get(l);if(d)hi(e,n,d);else{var u=r?r(c,l,n+"",e,t,o):void 0,h=void 0===u;if(h){var m=ot(l),f=!m&&dt(l),g=!m&&!f&&bt(l);u=l,m||f||g?ot(c)?u=c:Si(c)?u=_i(c):f?(h=!1,u=vi(l,!0)):g?(h=!1,u=yi(l,!0)):u=[]:C(l)||rt(l)?(u=c,rt(c)?u=De(a=c,At(a)):pe(c)&&!ve(c)||(u=wi(l))):h=!1}h&&(o.set(l,u),i(u,l,s,r,o),o.delete(l)),hi(e,n,u)}},Ai=function e(t,n,s,i,r){t!==n&&as(n,(function(o,a){if(r||(r=new Bt),pe(o))Ei(t,n,a,s,e,i,r);else{var c=i?i(xi(t,a),o,a+"",t,n,r):void 0;void 0===c&&(c=o),hi(t,a,c)}}),At)},Ci=et((function(e,t,n){Ai(e,t,n)})),Ti=et((function(e,t,n,s){Ai(e,t,n,s)})),ki=function(){return d.Date.now()};function ji(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const Ni=Math.max,Oi=Math.min,$i=function(e,t,n={}){let s,i,r,o,a,c,l=0,d=!1,u=n.promise?ji():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const r=s,a=i;return s=i=void 0,l=t,o=e.apply(a,r),n.promise&&(u.resolve(o),u=ji()),n.promise?u:o}function m(e){return l=e,a=setTimeout(g,t),n.promise?u:o}function f(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=r}function g(){const e=ki();if(f(e))return p(e);a=setTimeout(g,function(e){const n=t-(e-c);return d?Oi(n,r-(e-l)):n}(e))}function p(e){return a=void 0,s?h(e):(s=i=void 0,n.promise?u:o)}function v(e,t){if(Array.isArray(e)&&Array.isArray(t))return null!=n&&n.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function b(e){var t;return null!==(t=s)&&void 0!==t&&t.length?e.length?null!=n&&n.concatArrays||null!=n&&n.dedupeArrays?Ti(s,e,v):Ci(s,e):s:e||[]}function y(){const e=ki(),r=f(e);if(s=b(Array.from(arguments)),i=this,c=e,r){if(void 0===a)return m(c);if(d)return clearTimeout(a),a=setTimeout(g,t),h(c)}return void 0===a&&(a=setTimeout(g,t)),n.promise?u:o}return t=Ss(t)||0,pe(n)&&(d="maxWait"in n,r=d?Ni(Ss(n.maxWait)||0,t):r),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=c=i=a=void 0},y.flush=function(){return void 0===a?o:p(ki())},y},Ii=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}(),Mi=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),s=0;s<e.length;s+=1)n.append(e[s]);return n.getBlob(t.type)}};"undefined"==typeof Promise&&n(5004);const Ri=Promise,Di=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))},Li=function(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)};function zi(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function Pi(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const Fi="local-forage-detect-blob-support";let Ui;const Bi={},qi=Object.prototype.toString,Hi="readonly",Gi="readwrite";function Wi(e){var t=Bi[e.name],n={};n.promise=new Ri((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function Vi(e){var t=Bi[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function Ji(e,t){var n=Bi[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function Ki(e,t){return new Ri((function(n,s){if(Bi[e.name]=Bi[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);Wi(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=Ii.open.apply(Ii,i);t&&(r.onupgradeneeded=function(t){var n=r.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(Fi)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),s(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},n(t),Vi(e)}}))}function Yi(e){return Ki(e,!1)}function Qi(e){return Ki(e,!0)}function Xi(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),s=e.version<e.db.version,i=e.version>e.db.version;if(s&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function Zi(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),i=0;i<t;i++)s[i]=e.charCodeAt(i);return n}(atob(e.data));return Mi([t],{type:e.type})}function er(e){return e&&e.__local_forage_encoded_blob}function tr(e){var t=this,n=t._initReady().then((function(){var e=Bi[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return Li(n,e,e),n}function nr(e,t,n,s){void 0===s&&(s=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(s>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return Ri.resolve().then((()=>{if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Qi(e)})).then((()=>function(e){Wi(e);for(var t=Bi[e.name],n=t.forages,s=0;s<n.length;s++){const e=n[s];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Yi(e).then((t=>(e.db=t,Xi(e)?Qi(e):t))).then((s=>{e.db=t.db=s;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=s})).catch((t=>{throw Ji(e,t),t}))}(e).then((function(){nr(e,t,n,s-1)})))).catch(n);n(i)}}const sr={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]=e[s];var i=Bi[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},Bi[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=tr);var r=[];function o(){return Ri.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var l=i.forages.slice(0);return Ri.all(r).then((function(){return n.db=i.db,Yi(n)})).then((function(e){return n.db=e,Xi(n,t._defaultConfig.version)?Qi(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var s=0;s<l.length;s++){var r=l[s];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))},_support:function(){try{if(!Ii||!Ii.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=new Ri((function(t,s){n.ready().then((function(){nr(n._dbInfo,Hi,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var s=n.value;er(s)&&(s=Zi(s));var i=e(s,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return Di(s,t),s},getItem:function(e,t){var n=this;e=zi(e);var s=new Ri((function(t,s){n.ready().then((function(){nr(n._dbInfo,Hi,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),er(e)&&(e=Zi(e)),t(e)},o.onerror=function(){s(o.error)}}catch(e){s(e)}}))})).catch(s)}));return Di(s,t),s},setItem:function(e,t,n){var s=this;e=zi(e);var i=new Ri((function(n,i){var r;s.ready().then((function(){return r=s._dbInfo,"[object Blob]"===qi.call(t)?(e=r.db,"boolean"==typeof Ui?Ri.resolve(Ui):function(e){return new Ri((function(t){var n=e.transaction(Fi,Gi),s=Mi([""]);n.objectStore(Fi).put(s,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return Ui=e,Ui}))).then((function(e){return e?t:(n=t,new Ri((function(e,t){var s=new FileReader;s.onerror=t,s.onloadend=function(t){var s=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:s,type:n.type})},s.readAsBinaryString(n)})));var n})):t;var e})).then((function(t){nr(s._dbInfo,Gi,(function(r,o){if(r)return i(r);try{var a=o.objectStore(s._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return Di(i,n),i},removeItem:function(e,t){var n=this;e=zi(e);var s=new Ri((function(t,s){n.ready().then((function(){nr(n._dbInfo,Gi,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){s(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return Di(s,t),s},clear:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){nr(t._dbInfo,Gi,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return Di(n,e),n},length:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){nr(t._dbInfo,Hi,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return Di(n,e),n},key:function(e,t){var n=this,s=new Ri((function(t,s){e<0?t(null):n.ready().then((function(){nr(n._dbInfo,Hi,(function(i,r){if(i)return s(i);try{var o=r.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){s(c.error)}}catch(e){s(e)}}))})).catch(s)}));return Di(s,t),s},keys:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){nr(t._dbInfo,Hi,(function(s,i){if(s)return n(s);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return Di(n,e),n},dropInstance:function(e,t){t=Pi.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;if(e.name){const t=e.name===n.name&&i._dbInfo.db?Ri.resolve(i._dbInfo.db):Yi(e).then((t=>{const n=Bi[e.name],s=n.forages;n.db=t;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=t;return t}));s=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const n=t.version+1;Wi(e);const s=Bi[e.name],i=s.forages;t.close();for(let e=0;e<i.length;e++){const t=i[e];t._dbInfo.db=null,t._dbInfo.version=n}return new Ri(((t,s)=>{const i=Ii.open(e.name,n);i.onerror=e=>{i.result.close(),s(e)},i.onupgradeneeded=()=>{i.result.deleteObjectStore(e.storeName)},i.onsuccess=()=>{const e=i.result;e.close(),t(e)}})).then((e=>{s.db=e;for(let t=0;t<i.length;t++){const n=i[t];n._dbInfo.db=e,Vi(n._dbInfo)}})).catch((t=>{throw(Ji(e,t)||Ri.resolve()).catch((()=>{})),t}))})):t.then((t=>{Wi(e);const n=Bi[e.name],s=n.forages;t.close();for(var i=0;i<s.length;i++)s[i]._dbInfo.db=null;return new Ri(((t,n)=>{var s=Ii.deleteDatabase(e.name);s.onerror=()=>{const e=s.result;e&&e.close(),n(s.error)},s.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},s.onsuccess=()=>{const e=s.result;e&&e.close(),t(e)}})).then((e=>{n.db=e;for(var t=0;t<s.length;t++)Vi(s[t]._dbInfo)})).catch((t=>{throw(Ji(e,t)||Ri.resolve()).catch((()=>{})),t}))}))}else s=Ri.reject("Invalid arguments");return Di(s,t),s}};var ir="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rr=/^~~local_forage_type~([^~]+)~/,or="__lfsc__:",ar=or.length,cr="arbf",lr="blob",dr="si08",ur="ui08",hr="uic8",mr="si16",fr="si32",gr="ur16",pr="ui32",vr="fl32",br="fl64",yr=ar+cr.length,_r=Object.prototype.toString;function wr(e){var t,n,s,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)n=ir.indexOf(e[t]),s=ir.indexOf(e[t+1]),i=ir.indexOf(e[t+2]),r=ir.indexOf(e[t+3]),d[c++]=n<<2|s>>4,d[c++]=(15&s)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function Sr(e){var t,n=new Uint8Array(e),s="";for(t=0;t<n.length;t+=3)s+=ir[n[t]>>2],s+=ir[(3&n[t])<<4|n[t+1]>>4],s+=ir[(15&n[t+1])<<2|n[t+2]>>6],s+=ir[63&n[t+2]];return n.length%3==2?s=s.substring(0,s.length-1)+"=":n.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}const xr={serialize:function(e,t){var n="";if(e&&(n=_r.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===_r.call(e.buffer))){var s,i=or;e instanceof ArrayBuffer?(s=e,i+=cr):(s=e.buffer,"[object Int8Array]"===n?i+=dr:"[object Uint8Array]"===n?i+=ur:"[object Uint8ClampedArray]"===n?i+=hr:"[object Int16Array]"===n?i+=mr:"[object Uint16Array]"===n?i+=gr:"[object Int32Array]"===n?i+=fr:"[object Uint32Array]"===n?i+=pr:"[object Float32Array]"===n?i+=vr:"[object Float64Array]"===n?i+=br:t(new Error("Failed to get type for BinaryArray"))),t(i+Sr(s))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+Sr(this.result);t("__lfsc__:blob"+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,ar)!==or)return JSON.parse(e);var t,n=e.substring(yr),s=e.substring(ar,yr);if(s===lr&&rr.test(n)){var i=n.match(rr);t=i[1],n=n.substring(i[0].length)}var r=wr(n);switch(s){case cr:return r;case lr:return Mi([r],{type:t});case dr:return new Int8Array(r);case ur:return new Uint8Array(r);case hr:return new Uint8ClampedArray(r);case mr:return new Int16Array(r);case gr:return new Uint16Array(r);case fr:return new Int32Array(r);case pr:return new Uint32Array(r);case vr:return new Float32Array(r);case br:return new Float64Array(r);default:throw new Error("Unkown type: "+s)}},stringToBuffer:wr,bufferToString:Sr};function Er(e,t,n,s){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],n,s)}function Ar(e,t,n,s,i,r){e.executeSql(n,s,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):Er(e,t,(function(){e.executeSql(n,s,i,r)}),r)}),r):r(e,o)}),r)}function Cr(e,t,n,s){var i=this;e=zi(e);var r=new Ri((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(n){Ar(n,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(s>0)return void r(Cr.apply(i,[e,a,n,s-1]));o(t)}}))}))})).catch(o)}));return Di(r,n),r}function Tr(e){return new Ri((function(t,n){e.transaction((function(s){s.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,s){for(var i=[],r=0;r<s.rows.length;r++)i.push(s.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}const kr={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var s in e)n[s]="string"!=typeof e[s]?e[s].toString():e[s];var i=new Ri((function(e,s){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return s(e)}n.db.transaction((function(i){Er(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){s(t)}))}),s)}));return n.serializer=xr,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,s=new Ri((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ar(n,i,`SELECT * FROM ${i.storeName}`,[],(function(n,s){for(var r=s.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){s(t)}))}))})).catch(s)}));return Di(s,t),s},getItem:function(e,t){var n=this;e=zi(e);var s=new Ri((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ar(n,i,`SELECT * FROM ${i.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,n){var s=n.rows.length?n.rows.item(0).value:null;s&&(s=i.serializer.deserialize(s)),t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return Di(s,t),s},setItem:function(e,t,n){return Cr.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=zi(e);var s=new Ri((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ar(n,i,`DELETE FROM ${i.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){s(t)}))}))})).catch(s)}));return Di(s,t),s},clear:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){Ar(t,s,`DELETE FROM ${s.storeName}`,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return Di(n,e),n},length:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){Ar(t,s,`SELECT COUNT(key) as c FROM ${s.storeName}`,[],(function(t,n){var s=n.rows.item(0).c;e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return Di(n,e),n},key:function(e,t){var n=this,s=new Ri((function(t,s){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Ar(n,i,`SELECT key FROM ${i.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,n){var s=n.rows.length?n.rows.item(0).key:null;t(s)}),(function(e,t){s(t)}))}))})).catch(s)}));return Di(s,t),s},keys:function(e){var t=this,n=new Ri((function(e,n){t.ready().then((function(){var s=t._dbInfo;s.db.transaction((function(t){Ar(t,s,`SELECT key FROM ${s.storeName}`,[],(function(t,n){for(var s=[],i=0;i<n.rows.length;i++)s.push(n.rows.item(i).key);e(s)}),(function(e,t){n(t)}))}))})).catch(n)}));return Di(n,e),n},dropInstance:function(e,t){t=Pi.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var s,i=this;return s=e.name?new Ri((function(t){var s;s=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:s,storeNames:[e.storeName]}):t(Tr(s))})).then((function(e){return new Ri((function(t,n){e.db.transaction((function(s){function i(e){return new Ri((function(t,n){s.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));Ri.all(r).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):Ri.reject("Invalid arguments"),Di(s,t),s}};function jr(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const Nr={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=jr(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=xr,Ri.resolve()):Ri.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,s=n.ready().then((function(){for(var t=n._dbInfo,s=t.keyPrefix,i=s.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(s)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return Di(s,t),s},getItem:function(e,t){var n=this;e=zi(e);var s=n.ready().then((function(){var t=n._dbInfo,s=localStorage.getItem(t.keyPrefix+e);return s&&(s=t.serializer.deserialize(s)),s}));return Di(s,t),s},setItem:function(e,t,n){var s=this;e=zi(e);var i=s.ready().then((function(){void 0===t&&(t=null);var n=t;return new Ri((function(i,r){var o=s._dbInfo;o.serializer.serialize(t,(function(t,s){if(s)r(s);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return Di(i,n),i},removeItem:function(e,t){var n=this;e=zi(e);var s=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return Di(s,t),s},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var s=localStorage.key(n);0===s.indexOf(e)&&localStorage.removeItem(s)}}));return Di(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return Di(t,e),t},key:function(e,t){var n=this,s=n.ready().then((function(){var t,s=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(s.keyPrefix.length)),t}));return Di(s,t),s},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,s=[],i=0;i<n;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&s.push(r.substring(e.keyPrefix.length))}return s}));return Di(n,e),n},dropInstance:function(e,t){if(t=Pi.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var s,i=this;return s=e.name?new Ri((function(t){e.storeName?t(jr(e,i._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):Ri.reject("Invalid arguments"),Di(s,t),s}},Or=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),$r=(e,t)=>{const n=e.length;let s=0;for(;s<n;){if(Or(e[s],t))return!0;s++}return!1},Ir=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Mr={},Rr={},Dr={INDEXEDDB:sr,WEBSQL:kr,LOCALSTORAGE:Nr},Lr=[Dr.INDEXEDDB._driver,Dr.WEBSQL._driver,Dr.LOCALSTORAGE._driver],zr=["dropInstance"],Pr=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(zr),Fr={description:"",driver:Lr.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ur(e,t){e[t]=function(){const n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Br(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(Ir(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class qr{constructor(e){for(let e in Dr)if(Dr.hasOwnProperty(e)){const t=Dr[e],n=t._driver;this[e]=n,Mr[n]||this.defineDriver(t)}this._defaultConfig=Br({},Fr),this._config=Br({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,n){const s=new Ri((function(t,n){try{const s=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);const r=Pr.concat("_initStorage");for(let t=0,s=r.length;t<s;t++){const s=r[t];if((!$r(zr,s)||e[s])&&"function"!=typeof e[s])return void n(i)}!function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),n=Ri.reject(t);return Di(n,arguments[arguments.length-1]),n}};for(let n=0,s=zr.length;n<s;n++){const s=zr[n];e[s]||(e[s]=t(s))}}();const o=function(n){Mr[s]&&console.info(`Redefining LocalForage driver: ${s}`),Mr[s]=e,Rr[s]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(o,n):o(!!e._support):o(!0)}catch(e){n(e)}}));return Li(s,t,n),s}driver(){return this._driver||null}getDriver(e,t,n){const s=Mr[e]?Ri.resolve(Mr[e]):Ri.reject(new Error("Driver not found."));return Li(s,t,n),s}getSerializer(e){const t=Ri.resolve(xr);return Li(t,e),t}ready(e){const t=this,n=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return Li(n,e,e),n}setDriver(e,t,n){const s=this;Ir(e)||(e=[e]);const i=this._getSupportedDrivers(e);function r(){s._config.driver=s.driver()}function o(e){return s._extend(e),r(),s._ready=s._initStorage(s._config),s._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>Ri.resolve())):Ri.resolve();return this._driverSet=a.then((()=>{const e=i[0];return s._dbInfo=null,s._ready=null,s.getDriver(e).then((e=>{s._driver=e._driver,r(),s._wrapLibraryMethodsWithReady(),s._initDriver=function(e){return function(){let t=0;return function n(){for(;t<e.length;){let i=e[t];return t++,s._dbInfo=null,s._ready=null,s.getDriver(i).then(o).catch(n)}r();const i=new Error("No available storage method found.");return s._driverSet=Ri.reject(i),s._driverSet}()}}(i)}))})).catch((()=>{r();const e=new Error("No available storage method found.");return s._driverSet=Ri.reject(e),s._driverSet})),Li(this._driverSet,t,n),this._driverSet}supports(e){return!!Rr[e]}_extend(e){Br(this,e)}_getSupportedDrivers(e){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];this.supports(s)&&t.push(s)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=Pr.length;e<t;e++)Ur(this,Pr[e])}createInstance(e){return new qr(e)}}const Hr=new qr;var Gr=n(2272);const Wr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Xt(t,sn(e)),e=_(e);return t}:en,Vr=function(e){return Zt(e,At,Wr)};var Jr=Object.prototype.hasOwnProperty;var Kr=/\w*$/;var Yr=u?u.prototype:void 0,Qr=Yr?Yr.valueOf:void 0;const Xr=function(e,t,n){var s,i=e.constructor;switch(t){case"[object ArrayBuffer]":return bi(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return yi(e,n);case"[object Map]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,Kr.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Set]":return new i;case"[object Symbol]":return s=e,Qr?Object(Qr.call(s)):{}}};var Zr=pt&&pt.isMap;const eo=Zr?ht(Zr):function(e){return a(e)&&"[object Map]"==Cn(e)};var to=pt&&pt.isSet;const no=to?ht(to):function(e){return a(e)&&"[object Set]"==Cn(e)};var so="[object Arguments]",io="[object Function]",ro={};ro[so]=ro["[object Array]"]=ro["[object ArrayBuffer]"]=ro["[object DataView]"]=ro["[object Boolean]"]=ro["[object Date]"]=ro["[object Float32Array]"]=ro["[object Float64Array]"]=ro["[object Int8Array]"]=ro["[object Int16Array]"]=ro["[object Int32Array]"]=ro["[object Map]"]=ro["[object Number]"]=ro["[object Object]"]=ro["[object RegExp]"]=ro["[object Set]"]=ro["[object String]"]=ro["[object Symbol]"]=ro["[object Uint8Array]"]=ro["[object Uint8ClampedArray]"]=ro["[object Uint16Array]"]=ro["[object Uint32Array]"]=!0,ro["[object Error]"]=ro[io]=ro["[object WeakMap]"]=!1;const oo=function e(t,n,s,i,r,o){var a,c=1&n,l=2&n,d=4&n;if(s&&(a=r?s(t,i,r,o):s(t)),void 0!==a)return a;if(!pe(t))return t;var u=ot(t);if(u){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Jr.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!c)return _i(t,a)}else{var h=Cn(t),m=h==io||"[object GeneratorFunction]"==h;if(dt(t))return vi(t,c);if("[object Object]"==h||h==so||m&&!r){if(a=l||m?{}:wi(t),!c)return l?function(e,t){return De(e,Wr(e),t)}(t,function(e,t){return e&&De(t,At(t),e)}(a,t)):function(e,t){return De(e,sn(e),t)}(t,Ps(a,t))}else{if(!ro[h])return r?t:{};a=Xr(t,h,c)}}o||(o=new Bt);var f=o.get(t);if(f)return f;o.set(t,a),no(t)?t.forEach((function(i){a.add(e(i,n,s,i,t,o))})):eo(t)&&t.forEach((function(i,r){a.set(r,e(i,n,s,r,t,o))}));var g=u?void 0:(d?l?Vr:ln:l?At:cn)(t);return function(e,t){for(var n=-1,s=null==e?0:e.length;++n<s&&!1!==t(e[n],n,e););}(g||t,(function(i,r){g&&(i=t[r=i]),Re(a,r,e(i,n,s,r,t,o))})),a},ao=function(e){return"string"==typeof e||!ot(e)&&a(e)&&"[object String]"==b(e)};function co(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const lo={serializer:{serialize:xr.serialize,deserialize:xr.deserialize}},uo={_driver:"sessionStorageWrapper",_initStorage:function(e){if(lo.keyPrefix=co(e,this._defaultConfig),e)for(const t in e)lo[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=lo.keyPrefix,n=t.length,s=sessionStorage.length;let i=1;for(let r=0;r<s;r++){const s=sessionStorage.key(r);if(0!==s.indexOf(t))continue;let o=sessionStorage.getItem(s);if(o&&(o=lo.serializer.deserialize(o)),o=e(o,s.substring(n),i++),void 0!==o)return o}}));return Di(n,t),n},getItem:function(e,t){e=zi(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(lo.keyPrefix+e);return t&&(t=lo.serializer.deserialize(t)),t}));return Di(n,t),n},setItem:function(e,t,n){e=zi(e);const s=this.ready().then((function(){void 0===t&&(t=null);const n=t;return new Promise((function(s,i){lo.serializer.serialize(t,(function(t,r){if(r)i(r);else try{sessionStorage.setItem(lo.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return Di(s,n),s},removeItem:function(e,t){e=zi(e);const n=this.ready().then((function(){sessionStorage.removeItem(lo.keyPrefix+e)}));return Di(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=lo.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return Di(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return Di(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(lo.keyPrefix.length)),t}));return Di(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(lo.keyPrefix)&&t.push(e.substring(lo.keyPrefix.length))}return t}));return Di(t,e),t},dropInstance:function(e,t){if(t=Pi.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let s;return s=e.name?new Promise((function(t){e.storeName?t(co(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),Di(s,t),s}};var ho=n(7667);const mo=Gr._driver;function fo(){return(65536*(1+Math.random())|0).toString(16).substring(1)}Hr.defineDriver(Gr),(0,ho.extendPrototype)(Hr);class go{constructor(e,t,n=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");ao(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=$i((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)Hr.setDriver(uo._driver);else if("local"===e)await Hr.config({driver:Hr.LOCALSTORAGE});else if("in_memory"===e)Hr.config({driver:mo});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=Hr,t&&(this.store.debouncedSetItems=$i((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){var e;return null===(e=this.store.debouncedSetItems)||void 0===e?void 0:e.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(e){const t=this;async function n(e,n,s){let i,r,o,a;const c=n.collection;var l;["patch","update"].includes(e)&&(l=n.attributes,a=oo(l,5)),await t.storeInitialized;try{const r=n.attributes;switch(e){case"read":i=void 0!==n.id?await t.find(n):await t.findAll();break;case"create":i=await t.create(n,s);break;case"patch":case"update":s.wait&&(n.attributes=a),o=t.update(n,s),s.wait&&(n.attributes=r),i=await o;break;case"delete":i=await t.destroy(n,c)}}catch(e){r=22===e.code&&0===t.getStorageSize()?"Private browsing is unsupported":e.message}if(i){if(s&&s.success){const t="read"===e?i:null;s.success(t,s)}}else r=r||"Record Not Found",s&&s.error&&s.error(r)}return n.__name__="localSync",n}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),s=this.getItemName(e.id);return n.includes(s)||n.push(s),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const s={};return s[this.name]=t,s}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=fo()+fo()+"-"+fo()+"-"+fo()+"-"+fo()+"-"+fo()+fo()+fo(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);return e&&e.length?Promise.all(e.map((e=>this.store.getItem(e)))):[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}go.sessionStorageInitialized=Hr.defineDriver(uo),go.localForage=Hr;const po=go;function vo(){return va.config.get("trusted")?"sessionStorage"===Cl.settings.get("persistent_store")?"session":"persistent":"session"}function bo(e){return"persistent"===e&&"IndexedDB"===Cl.settings.get("persistent_store")}function yo(e,t){const n=t||vo(),s=va.storage[n];if(void 0===s)throw new TypeError(`createStore: Could not find store for ${e}`);return new po(e,s,bo(t))}function _o(e,t,n){const s=n||vo();if(e.browserStorage=va.createStore(t,s),bo(s)){const t=()=>e.browserStorage.flush();window.addEventListener(va.unloadevent,t),e.on("destroy",(()=>window.removeEventListener(va.unloadevent,t))),e.listenTo(va,"beforeLogout",t)}}const wo=function(e,t,n,s){if(!pe(e))return e;for(var i=-1,r=(t=Xn(t,e)).length,o=r-1,a=e;null!=a&&++i<r;){var c=Zn(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(l=s?s(d,c,a):void 0)&&(l=pe(d)?d:Xe(t[i+1])?[]:{})}Re(a,c,l),a=a[c]}return e},So=function(e,t){return function(e,t,n){for(var s=-1,i=t.length,r={};++s<i;){var o=t[s],a=es(e,o);n(a,o)&&wo(r,Xn(o,e),a)}return r}(e,t,(function(t,n){return ss(e,n)}))};var xo=u?u.isConcatSpreadable:void 0;const Eo=function(e){return ot(e)||rt(e)||!!(xo&&e&&e[xo])},Ao=function e(t,n,s,i,r){var o=-1,a=t.length;for(s||(s=Eo),r||(r=[]);++o<a;){var c=t[o];n>0&&s(c)?n>1?e(c,n-1,s,i,r):Xt(r,c):i||(r[r.length]=c)}return r},Co=function(e){return null!=e&&e.length?Ao(e,1):[]},To=function(e){return He(Fe(e,void 0,Co),e+"")},ko=To((function(e,t){return null==e?{}:So(e,t)}));var jo=n(1041),No=n.n(jo);const Oo=function(e){for(var t=-1,n=null==e?0:e.length,s=0,i=[];++t<n;){var r=e[t];r&&(i[s++]=r)}return i},$o=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var Io=n(1751),Mo=n.n(Io);const Ro=function(e){return oo(e,4)};var Do=Object.prototype,Lo=Do.hasOwnProperty;const zo=Je((function(e,t){e=Object(e);var n=-1,s=t.length,i=s>2?t[2]:void 0;for(i&&Ze(t[0],t[1],i)&&(s=1);++n<s;)for(var r=t[n],o=At(r),a=-1,c=o.length;++a<c;){var l=o[a],d=e[l];(void 0===d||Ie(d,Do[l])&&!Lo.call(e,l))&&(e[l]=r[l])}return e})),Po=Je((function(e,t){return function(e,t,n){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,n)}),t)}(e,1,t)})),Fo=(Uo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(e){return null==Uo?void 0:Uo[e]});var Uo,Bo=/[&<>"']/g,qo=RegExp(Bo.source);var Ho=Object.prototype.toString;const Go=(Wo=function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ho.call(t)),e[t]=n},Vo=Ue(Le),function(e,t){return function(e,t,n,s){return cs(e,(function(e,i,r){t(s,n(e),i,r)})),s}(e,Wo,Vo(t),{})});var Wo,Vo;const Jo=function(e,t){return $n(e,t)},Ko=function(e,t){return t.length<2?e:es(e,function(e,t,n){var s=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var r=Array(i);++s<i;)r[s]=e[s+t];return r}(t,0,-1))},Yo=function(e,t){return t=Xn(t,e),null==(e=Ko(e,t))||delete e[Zn($o(t))]},Qo=function(e){return C(e)?void 0:e},Xo=To((function(e,t){var n={};if(null==e)return n;var s=!1;t=Vn(t,(function(t){return t=Xn(t,e),s||(s=t.length>1),t})),De(e,Vr(e),n),s&&(n=oo(n,7,Qo));for(var i=t.length;i--;)Yo(n,t[i]);return n})),Zo=function(e,t){let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=Ts(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const s=Gs(this,"defaults");n=zo(Ct({},s,n),s),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};function ea(e){return e instanceof Zo&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message)}Zo.extend=Ws,Object.assign(Zo.prototype,ks,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return Ro(this.attributes)},sync:function(e,t,n){return Qs(this)(e,t,n)},get:function(e){return this.attributes[e]},keys:function(){return Object.keys(this.attributes)},values:function(){return Object.values(this.attributes)},pairs:function(){return this.entries()},entries:function(){return Object.entries(this.attributes)},invert:function(){return Go(this.attributes)},pick:function(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),ko(this.attributes,e)},omit:function(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),Xo(this.attributes,e)},isEmpty:function(){return fs(this.attributes)},escape:function(e){return t=this.get(e),(t=Qn(t))&&qo.test(t)?t.replace(Bo,Fo):t;var t},has:function(e){return null!=this.get(e)},matches:function(e){return!!function(e){return os("function"==typeof e?e:oo(e,1))}(e)(this.attributes)},set:function(e,t,n){if(null==e)return this;let s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;const i=n.unset,r=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=Ro(this.attributes),this.changed={});const c=this.attributes,l=this.changed,d=this._previousAttributes;for(const e in s)t=s[e],Jo(c[e],t)||o.push(e),Jo(d[e],t)?delete l[e]:l[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!r){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!r)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,Ct({},t,{unset:!0}))},clear:function(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Ct({},e,{unset:!0}))},hasChanged:function(e){return null==e?!fs(this.changed):Hs(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&Ro(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let s;for(const i in e){const r=e[i];Jo(t[i],r)||(n[i]=r,s=!0)}return!!s&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return Ro(this._previousAttributes)},fetch:function(e){e=Ct({parse:!0},e);const t=this,n=e.success;return e.success=function(s){const i=e.parse?t.parse(s,e):s;if(!t.set(i,e))return!1;n&&n.call(e.context,t,s,e),t.trigger("sync",t,s,e)},Ks(this,e),this.sync("read",this,e)},save:function(e,t,n){let s;null==e||"object"==typeof e?(s=e,n=t):(s={})[e]=t;const i=(n=Ct({validate:!0,parse:!0},n)).wait,r=n.promise,o=r&&Vs();if(s&&!i){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;const a=this,c=n.success,l=n.error,d=this.attributes;n.success=function(e){a.attributes=d;let t=n.parse?a.parse(e,n):e;if(i&&(t=Ct({},s,t)),t&&!a.set(t,n))return!1;c&&c.call(n.context,a,e,n),a.trigger("sync",a,e,n),r&&o.resolve()},n.error=function(e,t,n){l&&l.call(n.context,e,t,n),r&&o.reject(t)},Ks(this,n),s&&i&&(this.attributes=Ct({},d,s));const u=this.isNew()?"create":n.patch?"patch":"update";"patch"!==u||n.attrs||(n.attrs=s);const h=this.sync(u,this,n);return this.attributes=d,r?o:h},destroy:function(e){e=e?Ro(e):{};const t=this,n=e.success,s=e.wait,i=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(r){s&&i(),n&&n.call(e.context,t,r,e),t.isNew()||t.trigger("sync",t,r,e)};let r=!1;return this.isNew()?Po(e.success):(Ks(this,e),r=this.sync("delete",this,e)),s||i(),r},url:function(){const e=Gs(this,"urlRoot")||Gs(this.collection,"url")||Js();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},Ct({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=Ct({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Ct(t,{validationError:n})),!1)}});const ta={isTagEqual:function(e,t){if(e.nodeTree)return ta.isTagEqual(e.nodeTree,t);if(e instanceof Element)return le.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}},na=new DOMParser,sa=na.parseFromString("invalid","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;function ia(e,t,n){ta.isPersistableModel(e)?e.save(t,n):e.set(t,n)}function ra(e,t){clearTimeout(e),clearInterval(t)}function oa(e){const t=va.promises[e];if(!t)throw new Error(`Tried to replace non-existing promise: ${e}`);if(t.replace){const n=ji();n.replace=t.replace,va.promises[e]=n}else M.debug(`Not replacing promise "${e}"`)}ta.getJIDFromURI=function(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e},ta.toStanza=function(e){const t=na.parseFromString(e,"text/xml");if(t.getElementsByTagNameNS(sa,"parsererror").length)throw new Error(`Parser Error: ${e}`);return t.firstElementChild},ta.getLongestSubstring=function(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")},ta.prefixMentions=function(e){let t=e.get("message");return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},ta.isValidJID=function(e){return"string"==typeof e&&2===Oo(e.split("@")).length&&!e.startsWith("@")&&!e.endsWith("@")},ta.isValidMUCJID=function(e){return!e.startsWith("@")&&!e.endsWith("@")},ta.isSameBareJID=function(e,t){return"string"==typeof e&&"string"==typeof t&&le.getBareJidFromJid(e).toLowerCase()===le.getBareJidFromJid(t).toLowerCase()},ta.isSameDomain=function(e,t){return"string"==typeof e&&"string"==typeof t&&le.getDomainFromJid(e).toLowerCase()===le.getDomainFromJid(t).toLowerCase()},ta.isNewMessage=function(e){return e instanceof Element?!(Mo()(`result[xmlns="${le.NS.MAM}"]`,e).length&&Mo()(`delay[xmlns="${le.NS.DELAY}"]`,e).length):(e instanceof Zo&&(e=e.attributes),!(e.is_delayed&&e.is_archived))},ta.shouldCreateMessage=function(e){return e.retracted||!ea(e)},ta.shouldCreateGroupchatMessage=function(e){return e.nick&&(ta.shouldCreateMessage(e)||e.is_tombstone)},ta.isChatRoom=function(e){return e&&"chatroom"===e.get("type")},ta.isErrorObject=function(e){return e instanceof Error},ta.isErrorStanza=function(e){return!!T(e)&&"error"===e.getAttribute("type")},ta.isForbiddenError=function(e){return!!T(e)&&Mo()(`error[type="auth"] forbidden[xmlns="${le.NS.STANZAS}"]`,e).length>0},ta.isServiceUnavailableError=function(e){return!!T(e)&&Mo()(`error[type="cancel"] service-unavailable[xmlns="${le.NS.STANZAS}"]`,e).length>0},ta.merge=function e(t,n){for(const s in n)pe(t[s])?e(t[s],n[s]):t[s]=n[s]},ta.getOuterWidth=function(e,t=!1){let n=e.offsetWidth;if(!t)return n;const s=window.getComputedStyle(e);return n+=parseInt(s.marginLeft?s.marginLeft:0,10)+parseInt(s.marginRight?s.marginRight:0,10),n},ta.stringToElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},ta.matchesSelector=function(e,t){const n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return!!n&&n.call(e,t)},ta.queryChildren=function(e,t){return Array.from(e.childNodes).filter((e=>ta.matchesSelector(e,t)))},ta.contains=function(e,t){const n=(e,n)=>e.get(n).toLowerCase().includes(t.toLowerCase());return function(t){if("object"==typeof e)return Object.keys(e).reduce(((e,s)=>e||n(t,s)),!1);if("string"==typeof e)return n(t,e);throw new TypeError("contains: wrong attribute type. Must be string or array.")}},ta.isOfType=function(e,t){return t.get("type")==e},ta.isInstance=function(e,t){return t instanceof e},ta.getAttribute=function(e,t){return t.get(e)},ta.contains.not=function(e,t){return function(n){return!ta.contains(e,t)(n)}},ta.rootContains=function(e,t){return e!==document||e.contains?e.contains?e.contains(t):window.HTMLElement.prototype.contains.call(e,t):document.head.contains(t)||document.body.contains(t)},ta.createFragmentFromText=function(e){var t,n=document.createDocumentFragment(),s=document.createElement("body");for(s.innerHTML=e;t=s.firstChild;)n.appendChild(t);return n},ta.isPersistableModel=function(e){return e.collection&&e.collection.browserStorage},ta.getResolveablePromise=ji,ta.getOpenPromise=ji,ta.interpolate=function(e,t){return e.replace(/{{{([^{}]*)}}}/g,((e,n)=>{var s=t[n];return"string"==typeof s||"number"==typeof s?s:e}))},ta.onMultipleEvents=function(e=[],t){let n=[];function s(s){n.push(s),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,s)))},ta.safeSave=ia,ta.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},ta.getCurrentWord=function(e,t,n){t||(t=e.selectionEnd||void 0);let[s]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([s]=s.split(n).slice(-1)),s},ta.isMentionBoundary=e=>"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e),ta.replaceCurrentWord=function(e,t){const n=e.selectionEnd||void 0,s=$o(e.value.slice(0,n).split(/\s/)),i=e.value,r=ta.isMentionBoundary(s[0])?s[0]:"";e.value=i.slice(0,n-s.length)+r+`${t} `+i.slice(n);const o=n-s.length+t.length+1;e.selectionEnd=r?o+1:o},ta.triggerEvent=function(e,t,n="Event",s=!0,i=!0){const r=document.createEvent(n);r.initEvent(t,s,i),e.dispatchEvent(r)},ta.getSelectValues=function(e){const t=[],n=e&&e.options;for(var s=0,i=n.length;s<i;s++){const e=n[s];e.selected&&t.push(e.value||e.text)}return t},ta.formatFingerprint=function(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const n=8*t+t-1;e=e.slice(0,n)+" "+e.slice(n)}return e},ta.getRandomInt=function(e){return Math.floor(Math.random()*Math.floor(e))},ta.placeCaretAtEnd=function(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),this.scrollTop=999999},ta.getUniqueId=function(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t},ta.httpToGeoUri=function(e,t){return e.replace(t.api.settings.get("geouri_regex"),"geo:$1,$2")},ta.waitUntil=function(e,t=300,n=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const s=ji(),i=new Error,r=setInterval((function(){try{const t=e();t&&(ra(o,r),s.resolve(t))}catch(e){ra(o,r),s.reject(e)}}),n),o=setTimeout((function(){ra(o,r);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),M.error(e),s.reject(new Error(e))}),t);return s};const aa=document.createElement("div");function ca(e){return e&&"string"==typeof e&&(aa.innerHTML=No().sanitize(e),e=aa.textContent,aa.textContent=""),e}const la=Object.assign({isEmptyMessage:ea},ta);let da,ua={},ha={};const ma={allow_non_roster_messaging:!1,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,idle_presence_timeout:300,jid:void 0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","eo","es","eu","en","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","nb","nl","mr","oc","pl","pt","pt_BR","ro","ru","sv","th","tr","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]};function fa(){var e;if(!va.bare_jid){const e="No JID to fetch user settings for";throw M.error(e),Error(e)}if(null===(e=da)||void 0===e||!e.fetched){const e=`converse.user-settings.${va.bare_jid}`;da=new Zo({id:e}),_o(da,e),da.fetched=da.fetch({promise:!0})}return da.fetched}async function ga(){return await fa(),da}async function pa(e,t){return await fa(),da.save(e,t)}const va={log:M,CONNECTION_STATUS:me,templates:{},promises:{initialized:ji()},STATUS_WEIGHTS:{offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},ANONYMOUS:"anonymous",CLOSED:"closed",EXTERNAL:"external",LOGIN:"login",LOGOUT:"logout",OPENED:"opened",PREBIND:"prebind",STANZA_TIMEOUT:1e4,SUCCESS:"success",FAILURE:"failure",DEFAULT_IMAGE_TYPE:"image/svg+xml",DEFAULT_IMAGE:"PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+CiA8cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzU1NSIvPgogPGNpcmNsZSBjeD0iNjQiIGN5PSI0MSIgcj0iMjQiIGZpbGw9IiNmZmYiLz4KIDxwYXRoIGQ9Im0yOC41IDExMiB2LTEyIGMwLTEyIDEwLTI0IDI0LTI0IGgyMyBjMTQgMCAyNCAxMiAyNCAyNCB2MTIiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cg==",TIMEOUTS:{PAUSED:1e4,INACTIVE:9e4},INACTIVE:"inactive",ACTIVE:"active",COMPOSING:"composing",PAUSED:"paused",GONE:"gone",PRIVATE_CHAT_TYPE:"chatbox",CHATROOMS_TYPE:"chatroom",HEADLINES_TYPE:"headline",CONTROLBOX_TYPE:"controlbox",default_connection_options:{explicitResourceBinding:!0},router:new oi,TimeoutError:ui,isTestEnv:()=>"montague.lit/http-bind"===ua.bosh_service_url,getDefaultStore:vo,createStore:yo,__:(...e)=>o.__(...e),___:e=>e};var ba=n(8674),ya=n.n(ba),_a=n(8169),wa=n.n(_a);const Sa=function(e,t,n){t=Xn(t,e);var s=null==(e=Ko(e,t))?e:e[Zn($o(t))];return null==s?void 0:ze(s,e,n)},xa=Je(Sa);function Ea(e,t,n,s,...i){return"function"==typeof n&&(void 0===this.__super__&&(this.__super__=s),this.__super__[e]=n.bind(this)),t.apply(this,i)}class Aa{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const s=this.plugged[e];this.plugged[e]=function(...i){return Ea.apply(this,[e,n,s,t,...i])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,s]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(s,e.prototype[n]);else if("function"==typeof s){const t={};t[this.name]=this.plugged;const i=e.prototype[n];e.prototype[n]=function(...e){return Ea.apply(this,[n,s,i,t,...e])}}else e.prototype[n]=s}loadPluginDependencies(e){var t;null===(t=e.dependencies)||void 0===t||t.forEach((t=>{const n=this.plugins[t];if(n){var s;if(null!==(s=n.dependencies)&&void 0!==s&&s.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){var t;Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||null!==(t=e.enabled)&&void 0!==t&&t.call(e,this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],n=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,s]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=s);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const Ca=function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new Aa(e,t),e},Ta={extend:e=>function(e){la.merge(ma,e);const t=Object.keys(ko(e,Object.keys(ma))),n=ko(ua,t),s=Ct(ko(e,t),n);la.merge(ha,s),la.merge(va,s)}(e),update(e){return M.warn("The api.settings.update method has been deprecated and will be removed. Please use api.settings.extend instead."),this.extend(e)},get:e=>function(e){if(Object.keys(ma).includes(e))return ha[e]}(e),set(e,t){!function(e,t){const n={};pe(e)?(Ct(va,ko(e,Object.keys(ma))),Ct(ha,ko(e,Object.keys(ma)))):"string"==typeof e&&(n[e]=t,Ct(va,ko(n,Object.keys(ma))),Ct(ha,ko(n,Object.keys(ma))))}(e,t)}},ka=function(e,t,n,s){for(var i=-1,r=null==e?0:e.length;++i<r;){var o=e[i];t(s,o,n(o),e)}return s},ja=function(e,t,n,s){return ls(e,(function(e,i,r){t(s,e,n(e),r)})),s},Na=function(e,t){return function(n,s){var i=ot(n)?ka:ja,r=t?t():{};return i(n,e,os(s),r)}};var Oa=Object.prototype.hasOwnProperty;const $a=Na((function(e,t,n){Oa.call(e,n)?++e[n]:$e(e,n,1)})),Ia=function(e,t,n,s){for(var i=e.length,r=n+(s?1:-1);s?r--:++r<i;)if(t(e[r],r,e))return r;return-1},Ma=function(e){return e!=e},Ra=function(e,t,n){return t==t?function(e,t,n){for(var s=n-1,i=e.length;++s<i;)if(e[s]===t)return s;return-1}(e,t,n):Ia(e,Ma,n)},Da=function(e,t){return!(null==e||!e.length)&&Ra(e,t,0)>-1},La=function(e,t,n){for(var s=-1,i=null==e?0:e.length;++s<i;)if(n(t,e[s]))return!0;return!1},za=Je((function(e,t){return Si(e)?function(e,t,n,s){var i=-1,r=Da,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;n&&(t=Vn(t,ht(n))),s?(r=La,o=!1):t.length>=200&&(r=Gt,o=!1,t=new Ht(t));e:for(;++i<a;){var d=e[i],u=null==n?d:n(d);if(d=s||0!==d?d:0,o&&u==u){for(var h=l;h--;)if(t[h]===u)continue e;c.push(d)}else r(t,u,s)||c.push(d)}return c}(e,Ao(t,1,Si,!0)):[]})),Pa=function(e,t){for(var n=-1,s=null==e?0:e.length;++n<s;)if(!t(e[n],n,e))return!1;return!0},Fa=function(e,t){var n=!0;return ls(e,(function(e,s,i){return n=!!t(e,s,i)})),n};var Ua=Math.max;var Ba=Math.max,qa=Math.min;var Ha=Object.prototype.hasOwnProperty;const Ga=Na((function(e,t,n){Ha.call(e,n)?e[n].push(t):$e(e,n,[t])}));var Wa=Math.max;const Va=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var i=null==n?0:Es(n);return i<0&&(i=Wa(s+i,0)),Ra(e,t,i)},Ja=Na((function(e,t,n){$e(e,n,t)}));var Ka=Math.max,Ya=Math.min;const Qa=function(e,t){if(e!==t){var n=void 0!==e,s=null===e,i=e==e,r=Ln(e),o=void 0!==t,a=null===t,c=t==t,l=Ln(t);if(!a&&!l&&!r&&e>t||r&&o&&c&&!a&&!l||s&&o&&c||!n&&c||!i)return 1;if(!s&&!r&&!l&&e<t||l&&n&&i&&!s&&!r||a&&n&&i||!o&&i||!c)return-1}return 0},Xa=function(e,t,n){t=t.length?Vn(t,(function(e){return ot(e)?function(t){return es(t,1===e.length?e[0]:e)}:e})):[Le];var s=-1;return t=Vn(t,ht(os)),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(function(e,t){var n=-1,s=Ye(e)?Array(e.length):[];return ls(e,(function(e,i,r){s[++n]=t(e,i,r)})),s}(e,(function(e,n,i){return{criteria:Vn(t,(function(t){return t(e)})),index:++s,value:e}})),(function(e,t){return function(e,t,n){for(var s=-1,i=e.criteria,r=t.criteria,o=i.length,a=n.length;++s<o;){var c=Qa(i[s],r[s]);if(c)return s>=a?c:c*("desc"==n[s]?-1:1)}return e.index-t.index}(e,t,n)}))},Za=Je((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Ze(e,t[0],t[1])?t=[]:n>2&&Ze(t[0],t[1],t[2])&&(t=[t[0]]),Xa(e,Ao(t,1),[])})),ec=Array.prototype.slice,tc=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Ct({silent:!0},t))};tc.extend=Ws;const nc={add:!0,remove:!0,merge:!0},sc={add:!0,remove:!1},ic=function(e,t,n){n=Math.min(Math.max(n,0),e.length);const s=Array(e.length-n),i=t.length;let r;for(r=0;r<s.length;r++)s[r]=e[r+n];for(r=0;r<i;r++)e[r+n]=t[r];for(r=0;r<s.length;r++)e[r+i+n]=s[r]};Object.assign(tc.prototype,ks,{model:Zo,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(e,t,n){return Qs(this)(e,t,n)},add:function(e,t){return this.set(e,Ct({merge:!1},t,sc))},remove:function(e,t){t=Ct({},t);const n=!Array.isArray(e);e=n?[e]:e.slice();const s=this._removeModels(e,t);return!t.silent&&s.length&&(t.changes={added:[],merged:[],removed:s},this.trigger("update",this,t)),n?s[0]:s},set:function(e,t){if(null==e)return;(t=Ct({},nc,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let s=t.at;null!=s&&(s=+s),s>this.length&&(s=this.length),s<0&&(s+=this.length+1);const i=[],r=[],o=[],a=[],c={},l=t.add,d=t.merge,u=t.remove;let h=!1;const m=this.comparator&&null==s&&!1!==t.sort,f=ao(this.comparator)?this.comparator:null;let g,p;for(p=0;p<e.length;p++){g=e[p];const n=this.get(g);if(n){if(d&&g!==n){let e=this._isModel(g)?g.attributes:g;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),m&&!h&&(h=n.hasChanged(f))}c[n.cid]||(c[n.cid]=!0,i.push(n)),e[p]=n}else l&&(g=e[p]=this._prepareModel(g,t),g&&(r.push(g),this._addReference(g,t),c[g.cid]=!0,i.push(g)))}if(u){for(p=0;p<this.length;p++)g=this.models[p],c[g.cid]||a.push(g);a.length&&this._removeModels(a,t)}let v=!1;const b=!m&&l&&u;if(i.length&&b?(v=this.length!==i.length||hs(this.models,((e,t)=>e!==i[t])),this.models.length=0,ic(this.models,i,0),this.length=this.models.length):r.length&&(m&&(h=!0),ic(this.models,r,null==s?this.length:s),this.length=this.models.length),h&&this.sort({silent:!0}),!t.silent){for(p=0;p<r.length;p++)null!=s&&(t.index=s+p),g=r[p],g.trigger("add",g,this,t);(h||v)&&this.trigger("sort",this,t),(r.length||a.length||o.length)&&(t.changes={added:r,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e},clearStore:async function(e={},t=(e=>e)){await Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),await this.browserStorage.clear(),this.reset()},reset:function(e,t){t=t?Ro(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Ct({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,Ct({at:this.length},t))},pop:function(e){const t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,Ct({at:0},t))},shift:function(e){const t=this.at(0);return this.remove(t,e)},slice:function(){return ec.apply(this.models,arguments)},filter:function(e,t){return this.models.filter(ve(e)?e:t=>t.matches(e),t)},every:function(e){return function(e,t,n){var s=ot(e)?Pa:Fa;return n&&Ze(e,t,n)&&(t=void 0),s(e,os(t))}(this.models.map((e=>e.attributes)),e)},difference:function(e){return za(this.models,e)},max:function(){return Math.max.apply(Math,this.models)},min:function(){return Math.min.apply(Math,this.models)},drop:function(e=1){return this.models.slice(e)},some:function(e){return hs(this.models.map((e=>e.attributes)),e)},sortBy:function(e){return Za(this.models,ve(e)?e:t=>ao(e)?t.get(e):t.matches(e))},isEmpty:function(){return fs(this.models)},keyBy:function(e){return Ja(this.models,e)},each:function(e,t){return this.forEach(e,t)},forEach:function(e,t){return this.models.forEach(e,t)},includes:function(e){return this.models.includes(e)},size:function(){return this.models.length},countBy:function(e){return $a(this.models,ve(e)?e:t=>ao(e)?t.get(e):t.matches(e))},groupBy:function(e){return Ga(this.models,ve(e)?e:t=>ao(e)?t.get(e):t.matches(e))},indexOf:function(e){return Va(this.models,e)},findLastIndex:function(e,t){return function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var i=s-1;return void 0!==n&&(i=Es(n),i=n<0?Ba(s+i,0):qa(i,s-1)),Ia(e,os(t),i,!0)}(this.models,ve(e)?e:t=>ao(e)?t.get(e):t.matches(e),t)},lastIndexOf:function(e){return function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var i=s;return void 0!==n&&(i=(i=Es(n))<0?Ka(s+i,0):Ya(i,s-1)),t==t?function(e,t,n){for(var s=n+1;s--;)if(e[s]===t)return s;return s}(e,t,i):Ia(e,Ma,i,!0)}(this.models,e)},findIndex:function(e){return function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var i=null==n?0:Es(n);return i<0&&(i=Ua(s+i,0)),Ia(e,os(t),i)}(this.models,ve(e)?e:t=>ao(e)?t.get(e):t.matches(e))},last:function(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0},head:function(){return this.models[0]},first:function(){return this.head()},map:function(e,t){return this.models.map(ve(e)?e:t=>ao(e)?t.get(e):t.matches(e),t)},reduce:function(e,t){return this.models.reduce(e,t||this.models[0])},reduceRight:function(e,t){return this.models.reduceRight(e,t||this.models[0])},toArray:function(){return Array.from(this.models)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},find:function(e,t){const n=ve(e)?e:t=>t.matches(e);return this.models.find(n,t)},sort:function(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return ve(t)&&(t=t.bind(this)),1===n||ao(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){const t=(e=Ct({parse:!0},e)).success,n=this,s=e.promise&&Vs();return e.success=function(i){const r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),s&&s.resolve(),n.trigger("sync",n,i,e)},Ks(this,e),s||this.sync("read",this,e)},create:function(e,t){const n=(t=t?Ro(t):{}).wait,s=t.promise,i=s&&Vs();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const r=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&r.add(e,a),o&&o.call(a.context,e,t,a),s&&i.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),s&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),s?i:e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){var t;return e[(null===(t=this.model.prototype)||void 0===t?void 0:t.idAttribute)||"id"]},values:function(){return new oc(this,ac)},keys:function(){return new oc(this,cc)},entries:function(){return new oc(this,lc)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?Ro(t):{}).collection=this;const n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){const n=[];for(let s=0;s<e.length;s++){const i=this.get(e[s]);if(!i)continue;const r=this.indexOf(i);this.models.splice(r,1),this.length--,delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=r,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n},_isModel:function(e){return e instanceof Zo},_addReference:function(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,s){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,s),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}});const rc="function"==typeof Symbol&&Symbol.iterator;rc&&(tc.prototype[rc]=tc.prototype.values);const oc=function(e,t){this._collection=e,this._kind=t,this._index=0},ac=1,cc=2,lc=3;rc&&(oc.prototype[rc]=function(){return this}),oc.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===ac)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===cc?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var dc=Math.max,uc=Math.min;const hc=function(e,t,n){var s,i,r,o,a,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=s,r=i;return s=i=void 0,l=t,o=e.apply(r,n)}function f(e){return l=e,a=setTimeout(p,t),d?m(e):o}function g(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-l>=r}function p(){var e=ki();if(g(e))return v(e);a=setTimeout(p,function(e){var n=t-(e-c);return u?uc(n,r-(e-l)):n}(e))}function v(e){return a=void 0,h&&s?m(e):(s=i=void 0,o)}function b(){var e=ki(),n=g(e);if(s=arguments,i=this,c=e,n){if(void 0===a)return f(c);if(u)return clearTimeout(a),a=setTimeout(p,t),m(c)}return void 0===a&&(a=setTimeout(p,t)),o}return t=Ss(t)||0,pe(n)&&(d=!!n.leading,r=(u="maxWait"in n)?dc(Ss(n.maxWait)||0,t):r,h="trailing"in n?!!n.trailing:h),b.cancel=function(){void 0!==a&&clearTimeout(a),l=0,s=c=i=a=void 0},b.flush=function(){return void 0===a?o:v(ki())},b};class mc extends le.Connection{constructor(e,t){super(e,t),this.debouncedReconnect=hc(this.reconnect,2e3)}static generateResource(){return`/converse.js-${Math.floor(139749528*Math.random()).toString()}`}async bind(){await Cl.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const t=await e.text(),n=(new window.DOMParser).parseFromString(t,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return M.warn("Could not discover XEP-0156 connection methods");const s=Mo()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),i=Mo()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),r=s.map((e=>e.getAttribute("href"))),o=i.map((e=>e.getAttribute("href")));0===r.length&&0===o.length?M.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(Cl.settings.set("websocket_url",o.pop()),Cl.settings.set("bosh_service_url",r.pop()),this.service=Cl.settings.get("websocket_url")||Cl.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let s;try{s=await fetch(n,t)}catch(e){return M.error(`Failed to discover alternative connection methods at ${n}`),void M.error(e)}s.status>=200&&s.status<400?await this.onDomainDiscovered(s):M.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,n){if(Cl.settings.get("discover_connection_methods")){const t=le.getDomainFromJid(e);await this.discoverConnectionMethods(t)}super.connect(e,t,n||this.onConnectStatusChanged,59)}async reconnect(){const{__:e}=va;return M.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.setConnectionStatus(le.Status.RECONNECTING,e("The connection has dropped, attempting to reconnect.")),Cl.trigger("will-reconnect"),this.reconnecting=!0,await Tl(),Cl.user.login()}async onConnected(e){delete this.reconnecting,this.flush(),await va.setUserJID(this.jid),await Cl.trigger("afterResourceBinding",e,{synchronous:!0}),e?Cl.trigger("reconnected"):Cl.trigger("connected")}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,va.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){M.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),Tl(),await kl(),delete va.connection,Cl.trigger("disconnected")}onDisconnected(){if(!Cl.settings.get("auto_reconnect"))return this.finishDisconnection();{const e=this.disconnection_reason;if(this.disconnection_cause===le.Status.AUTHFAIL)return Cl.settings.get("credentials_url")||Cl.settings.get("authentication")===va.ANONYMOUS?Cl.connection.reconnect():this.finishDisconnection();if(this.disconnection_cause===va.LOGOUT||e===le.ErrorCondition.NO_AUTH_MECH||"host-unknown"===e||"remote-connection-failed"===e)return this.finishDisconnection();Cl.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=va;var s;if(M.debug(`Status changed to: ${va.CONNECTION_STATUS[e]}`),e===le.Status.ATTACHFAIL)this.setConnectionStatus(e),null===(s=this.worker_attach_promise)||void 0===s||s.resolve(!1);else if(e===le.Status.CONNECTED||e===le.Status.ATTACHED){var i,r;if(null!==(i=this.worker_attach_promise)&&void 0!==i&&i.isResolved&&this.status===le.Status.ATTACHED)return;this.setConnectionStatus(e),null===(r=this.worker_attach_promise)||void 0===r||r.resolve(!0),va.send_initial_presence=!0,this.setDisconnectionCause(),this.reconnecting?(M.debug(e===le.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(M.debug(e===le.Status.CONNECTED?"Connected":"Attached"),this.restored&&(va.send_initial_presence=!1),this.onConnected())}else if(e===le.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===le.Status.BINDREQUIRED)this.bind();else if(e===le.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===le.Status.CONNECTING)this.setConnectionStatus(e);else if(e===le.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===le.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===le.Status.CONNFAIL){var o;let s=t;"host-unknown"===t||"remote-connection-failed"==t?s=n("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${le.getDomainFromJid(this.jid)}"`):void 0!==t&&t===(null==le||null===(o=le.ErrorCondition)||void 0===o?void 0:o.NO_AUTH_MECH)&&(s=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,s),this.setDisconnectionCause(e,t)}else e===le.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof le.Websocket:"bosh"===e.toLowerCase()?le.Bosh&&this._proto instanceof le.Bosh:void 0}hasResumed(){var e;return null!==(e=Cl.settings.get("connection_options"))&&void 0!==e&&e.worker||this.isType("bosh")?va.connfeedback.get("connection_status")===le.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=ji(),this.worker_attach_promise}}class fc extends mc{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=le.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(le.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,n){T(e)||(e=e.nodeTree),this.IQ_stanzas.push(e);const s=super.sendIQ(e,t,n);return this.IQ_ids.push(s),s}send(e){return T(e)?this.sent_stanzas.push(e):this.sent_stanzas.push(e.nodeTree),super.send(e)}async bind(){await Cl.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,va.no_connection_on_bind||this._changeConnectStatus(le.Status.CONNECTED)}}const gc=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,pc=Symbol();class vc{constructor(e,t){if(t!==pc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return gc&&void 0===this.t&&(this.t=new CSSStyleSheet,this.t.replaceSync(this.cssText)),this.t}toString(){return this.cssText}}const bc=new Map,yc=e=>{let t=bc.get(e);return void 0===t&&bc.set(e,t=new vc(e,pc)),t},_c=gc?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>yc("string"==typeof e?e:e+""))(t)})(e):e;var wc,Sc,xc,Ec;const Ac={toAttribute(e,t){switch(t){case Boolean:e=e?"":null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},Cc=(e,t)=>t!==e&&(t==t||e==e),Tc={attribute:!0,type:String,converter:Ac,reflect:!1,hasChanged:Cc};class kc extends HTMLElement{constructor(){super(),this.Πi=new Map,this.Πo=void 0,this.Πl=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this.Πh=null,this.u()}static addInitializer(e){var t;null!==(t=this.v)&&void 0!==t||(this.v=[]),this.v.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const s=this.Πp(n,t);void 0!==s&&(this.Πm.set(s,n),e.push(s))})),e}static createProperty(e,t=Tc){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,s=this.getPropertyDescriptor(e,n,t);void 0!==s&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(s){const i=this[e];this[t]=s,this.requestUpdate(e,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Tc}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this.Πm=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(_c(e))}else void 0!==e&&t.push(_c(e));return t}static Πp(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this.Πg=new Promise((e=>this.enableUpdating=e)),this.L=new Map,this.Π_(),this.requestUpdate(),null===(e=this.constructor.v)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this.ΠU)&&void 0!==t?t:this.ΠU=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this.ΠU)||void 0===t||t.splice(this.ΠU.indexOf(e)>>>0,1)}Π_(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this.Πi.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{gc?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const n=document.createElement("style");n.textContent=t.cssText,e.appendChild(n)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)})),this.Πl&&(this.Πl(),this.Πo=this.Πl=void 0)}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)})),this.Πo=new Promise((e=>this.Πl=e))}attributeChangedCallback(e,t,n){this.K(e,n)}Πj(e,t,n=Tc){var s,i;const r=this.constructor.Πp(e,n);if(void 0!==r&&!0===n.reflect){const o=(null!==(i=null===(s=n.converter)||void 0===s?void 0:s.toAttribute)&&void 0!==i?i:Ac.toAttribute)(t,n.type);this.Πh=e,null==o?this.removeAttribute(r):this.setAttribute(r,o),this.Πh=null}}K(e,t){var n,s,i;const r=this.constructor,o=r.Πm.get(e);if(void 0!==o&&this.Πh!==o){const e=r.getPropertyOptions(o),a=e.converter,c=null!==(i=null!==(s=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==s?s:"function"==typeof a?a:null)&&void 0!==i?i:Ac.fromAttribute;this.Πh=o,this[o]=c(t,e.type),this.Πh=null}}requestUpdate(e,t,n){let s=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||Cc)(this[e],t)?(this.L.has(e)||this.L.set(e,t),!0===n.reflect&&this.Πh!==e&&(void 0===this.Πk&&(this.Πk=new Map),this.Πk.set(e,n))):s=!1),!this.isUpdatePending&&s&&(this.Πg=this.Πq())}async Πq(){this.isUpdatePending=!0;try{for(await this.Πg;this.Πo;)await this.Πo}catch(e){Promise.reject(e)}const e=this.performUpdate();return null!=e&&await e,!this.isUpdatePending}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this.Πi&&(this.Πi.forEach(((e,t)=>this[t]=e)),this.Πi=void 0);let t=!1;const n=this.L;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this.ΠU)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this.Π$()}catch(e){throw t=!1,this.Π$(),e}t&&this.E(n)}willUpdate(e){}E(e){var t;null===(t=this.ΠU)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}Π$(){this.L=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this.Πg}shouldUpdate(e){return!0}update(e){void 0!==this.Πk&&(this.Πk.forEach(((e,t)=>this.Πj(t,this[t],e))),this.Πk=void 0),this.Π$()}updated(e){}firstUpdated(e){}}var jc,Nc,Oc,$c;kc.finalized=!0,kc.elementProperties=new Map,kc.elementStyles=[],kc.shadowRootOptions={mode:"open"},null===(Sc=(wc=globalThis).reactiveElementPlatformSupport)||void 0===Sc||Sc.call(wc,{ReactiveElement:kc}),(null!==(xc=(Ec=globalThis).reactiveElementVersions)&&void 0!==xc?xc:Ec.reactiveElementVersions=[]).push("1.0.0-rc.2");const Ic=globalThis.trustedTypes,Mc=Ic?Ic.createPolicy("lit-html",{createHTML:e=>e}):void 0,Rc=`lit$${(Math.random()+"").slice(9)}$`,Dc="?"+Rc,Lc=`<${Dc}>`,zc=document,Pc=(e="")=>zc.createComment(e),Fc=e=>null===e||"object"!=typeof e&&"function"!=typeof e,Uc=Array.isArray,Bc=e=>{var t;return Uc(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])},qc=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Hc=/-->/g,Gc=/>/g,Wc=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,Vc=/'/g,Jc=/"/g,Kc=/^(?:script|style|textarea)$/i,Yc=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),Qc=Yc(1),Xc=(Yc(2),Symbol.for("lit-noChange")),Zc=Symbol.for("lit-nothing"),el=new WeakMap,tl=(e,t,n)=>{var s,i;const r=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:t;let o=r._$litPart$;if(void 0===o){const e=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;r._$litPart$=o=new al(t.insertBefore(Pc(),e),e,void 0,n)}return o.I(e),o},nl=zc.createTreeWalker(zc,129,null,!1),sl=(e,t)=>{const n=e.length-1,s=[];let i,r=2===t?"<svg>":"",o=qc;for(let t=0;t<n;t++){const n=e[t];let a,c,l=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===qc?"!--"===c[1]?o=Hc:void 0!==c[1]?o=Gc:void 0!==c[2]?(Kc.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=Wc):void 0!==c[3]&&(o=Wc):o===Wc?">"===c[0]?(o=null!=i?i:qc,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?Wc:'"'===c[3]?Jc:Vc):o===Jc||o===Vc?o=Wc:o===Hc||o===Gc?o=qc:(o=Wc,i=void 0);const u=o===Wc&&e[t+1].startsWith("/>")?" ":"";r+=o===qc?n+Lc:l>=0?(s.push(a),n.slice(0,l)+"$lit$"+n.slice(l)+Rc+u):n+Rc+(-2===l?(s.push(void 0),t):u)}const a=r+(e[n]||"<?>")+(2===t?"</svg>":"");return[void 0!==Mc?Mc.createHTML(a):a,s]};class il{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=sl(e,t);if(this.el=il.createElement(c,n),nl.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(s=nl.nextNode())&&a.length<o;){if(1===s.nodeType){if(s.hasAttributes()){const e=[];for(const t of s.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(Rc)){const n=l[r++];if(e.push(t),void 0!==n){const e=s.getAttribute(n.toLowerCase()+"$lit$").split(Rc),t=/([.?@])?(.*)/.exec(n);a.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?ll:"?"===t[1]?dl:"@"===t[1]?ul:cl})}else a.push({type:6,index:i})}for(const t of e)s.removeAttribute(t)}if(Kc.test(s.tagName)){const e=s.textContent.split(Rc),t=e.length-1;if(t>0){s.textContent=Ic?Ic.emptyScript:"";for(let n=0;n<t;n++)s.append(e[n],Pc()),nl.nextNode(),a.push({type:2,index:++i});s.append(e[t],Pc())}}}else if(8===s.nodeType)if(s.data===Dc)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=s.data.indexOf(Rc,e+1));)a.push({type:7,index:i}),e+=Rc.length-1}i++}}static createElement(e,t){const n=zc.createElement("template");return n.innerHTML=e,n}}function rl(e,t,n=e,s){var i,r,o,a;if(t===Xc)return t;let c=void 0!==s?null===(i=n.Σi)||void 0===i?void 0:i[s]:n.Σo;const l=Fc(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(r=null==c?void 0:c.O)||void 0===r||r.call(c,!1),void 0===l?c=void 0:(c=new l(e),c.T(e,n,s)),void 0!==s?(null!==(o=(a=n).Σi)&&void 0!==o?o:a.Σi=[])[s]=c:n.Σo=c),void 0!==c&&(t=rl(e,c.S(e,t.values),c,s)),t}class ol{constructor(e,t){this.l=[],this.N=void 0,this.D=e,this.M=t}u(e){var t;const{el:{content:n},parts:s}=this.D,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:zc).importNode(n,!0);nl.currentNode=i;let r=nl.nextNode(),o=0,a=0,c=s[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new al(r,r.nextSibling,this,e):1===c.type?t=new c.ctor(r,c.name,c.strings,this,e):6===c.type&&(t=new hl(r,this,e)),this.l.push(t),c=s[++a]}o!==(null==c?void 0:c.index)&&(r=nl.nextNode(),o++)}return i}v(e){let t=0;for(const n of this.l)void 0!==n&&(void 0!==n.strings?(n.I(e,n,t),t+=n.strings.length-2):n.I(e[t])),t++}}class al{constructor(e,t,n,s){this.type=2,this.N=void 0,this.A=e,this.B=t,this.M=n,this.options=s}setConnected(e){var t;null===(t=this.P)||void 0===t||t.call(this,e)}get parentNode(){return this.A.parentNode}get startNode(){return this.A}get endNode(){return this.B}I(e,t=this){e=rl(this,e,t),Fc(e)?e===Zc||null==e||""===e?(this.H!==Zc&&this.R(),this.H=Zc):e!==this.H&&e!==Xc&&this.m(e):void 0!==e._$litType$?this._(e):void 0!==e.nodeType?this.$(e):Bc(e)?this.g(e):this.m(e)}k(e,t=this.B){return this.A.parentNode.insertBefore(e,t)}$(e){this.H!==e&&(this.R(),this.H=this.k(e))}m(e){const t=this.A.nextSibling;null!==t&&3===t.nodeType&&(null===this.B?null===t.nextSibling:t===this.B.previousSibling)?t.data=e:this.$(zc.createTextNode(e)),this.H=e}_(e){var t;const{values:n,_$litType$:s}=e,i="number"==typeof s?this.C(e):(void 0===s.el&&(s.el=il.createElement(s.h,this.options)),s);if((null===(t=this.H)||void 0===t?void 0:t.D)===i)this.H.v(n);else{const e=new ol(i,this),t=e.u(this.options);e.v(n),this.$(t),this.H=e}}C(e){let t=el.get(e.strings);return void 0===t&&el.set(e.strings,t=new il(e)),t}g(e){Uc(this.H)||(this.H=[],this.R());const t=this.H;let n,s=0;for(const i of e)s===t.length?t.push(n=new al(this.k(Pc()),this.k(Pc()),this,this.options)):n=t[s],n.I(i),s++;s<t.length&&(this.R(n&&n.B.nextSibling,s),t.length=s)}R(e=this.A.nextSibling,t){var n;for(null===(n=this.P)||void 0===n||n.call(this,!1,!0,t);e&&e!==this.B;){const t=e.nextSibling;e.remove(),e=t}}}class cl{constructor(e,t,n,s,i){this.type=1,this.H=Zc,this.N=void 0,this.V=void 0,this.element=e,this.name=t,this.M=s,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this.H=Array(n.length-1).fill(Zc),this.strings=n):this.H=Zc}get tagName(){return this.element.tagName}I(e,t=this,n,s){const i=this.strings;let r=!1;if(void 0===i)e=rl(this,e,t,0),r=!Fc(e)||e!==this.H&&e!==Xc,r&&(this.H=e);else{const s=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=rl(this,s[n+o],t,o),a===Xc&&(a=this.H[o]),r||(r=!Fc(a)||a!==this.H[o]),a===Zc?e=Zc:e!==Zc&&(e+=(null!=a?a:"")+i[o+1]),this.H[o]=a}r&&!s&&this.W(e)}W(e){e===Zc?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class ll extends cl{constructor(){super(...arguments),this.type=3}W(e){this.element[this.name]=e===Zc?void 0:e}}class dl extends cl{constructor(){super(...arguments),this.type=4}W(e){e&&e!==Zc?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class ul extends cl{constructor(){super(...arguments),this.type=5}I(e,t=this){var n;if((e=null!==(n=rl(this,e,t,0))&&void 0!==n?n:Zc)===Xc)return;const s=this.H,i=e===Zc&&s!==Zc||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,r=e!==Zc&&(s===Zc||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,e),this.H=e}handleEvent(e){var t,n;"function"==typeof this.H?this.H.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this.H.handleEvent(e)}}class hl{constructor(e,t,n){this.element=e,this.type=6,this.N=void 0,this.V=void 0,this.M=t,this.options=n}I(e){rl(this,e)}}const ml={Z:"$lit$",U:Rc,Y:Dc,q:1,X:sl,tt:ol,it:Bc,st:rl,et:al,ot:cl,nt:dl,rt:ul,lt:ll,ht:hl};var fl,gl,pl,vl,bl,yl;null===(Nc=(jc=globalThis).litHtmlPlatformSupport)||void 0===Nc||Nc.call(jc,il,al),(null!==(Oc=($c=globalThis).litHtmlVersions)&&void 0!==Oc?Oc:$c.litHtmlVersions=[]).push("2.0.0-rc.3"),(null!==(fl=(yl=globalThis).litElementVersions)&&void 0!==fl?fl:yl.litElementVersions=[]).push("3.0.0-rc.2");class _l extends kc{constructor(){super(...arguments),this.renderOptions={host:this},this.Φt=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();super.update(e),this.Φt=tl(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this.Φt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.Φt)||void 0===e||e.setConnected(!1)}render(){return Xc}}_l.finalized=!0,_l._$litElement$=!0,null===(pl=(gl=globalThis).litElementHydrateSupport)||void 0===pl||pl.call(gl,{LitElement:_l}),null===(bl=(vl=globalThis).litElementPlatformSupport)||void 0===bl||bl.call(vl,{LitElement:_l});var wl=n(721),Sl=n(3634);function xl(e,t){t=e.session.get("jid")||t,e.api.settings.get("authentication")===e.ANONYMOUS||le.getResourceFromJid(t)||(t=t.toLowerCase()+mc.generateResource()),e.jid=t,e.bare_jid=le.getBareJidFromJid(t),e.resource=le.getResourceFromJid(t),e.domain=le.getDomainFromJid(t),e.session.save({jid:t,bare_jid:e.bare_jid,resource:e.resource,domain:e.domain,active:!0}),e.connection.jid=t}function El(e=0){return new Promise(hc(((e,t)=>{const n=new XMLHttpRequest;n.open("GET",va.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);va.setUserJID(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n.send()}),e))}function Al(e){if([va.ANONYMOUS,va.EXTERNAL].includes(va.api.settings.get("authentication"))){if(!va.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");va.connection.reconnecting||va.connection.reset(),va.connection.connect(va.jid.toLowerCase())}else if(va.api.settings.get("authentication")===va.LOGIN){var t;const n=e?e.password:(null===(t=va.connection)||void 0===t?void 0:t.pass)||va.api.settings.get("password");if(!n){if(va.api.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return va.connection.setDisconnectionCause(le.Status.AUTHFAIL,void 0,!0),void va.api.connection.disconnect()}va.connection.reconnecting||va.connection.reset(),va.connection.connect(va.jid,n)}}wa().extend(ya()),le.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),le.addNamespace("CARBONS","urn:xmpp:carbons:2"),le.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),le.addNamespace("CSI","urn:xmpp:csi:0"),le.addNamespace("DELAY","urn:xmpp:delay"),le.addNamespace("EME","urn:xmpp:eme:0"),le.addNamespace("FASTEN","urn:xmpp:fasten:0"),le.addNamespace("FORWARD","urn:xmpp:forward:0"),le.addNamespace("HINTS","urn:xmpp:hints"),le.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),le.addNamespace("IDLE","urn:xmpp:idle:1"),le.addNamespace("MAM","urn:xmpp:mam:2"),le.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),le.addNamespace("MENTIONS","urn:xmpp:mmn:0"),le.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),le.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),le.addNamespace("NICK","http://jabber.org/protocol/nick"),le.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),le.addNamespace("OUTOFBAND","jabber:x:oob"),le.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),le.addNamespace("RAI","urn:xmpp:rai:0"),le.addNamespace("RECEIPTS","urn:xmpp:receipts"),le.addNamespace("REFERENCE","urn:xmpp:reference:0"),le.addNamespace("REGISTER","jabber:iq:register"),le.addNamespace("RETRACT","urn:xmpp:message-retract:0"),le.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),le.addNamespace("RSM","http://jabber.org/protocol/rsm"),le.addNamespace("SID","urn:xmpp:sid:0"),le.addNamespace("SPOILER","urn:xmpp:spoiler:0"),le.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),le.addNamespace("STYLING","urn:xmpp:styling:0"),le.addNamespace("VCARD","vcard-temp"),le.addNamespace("VCARDUPDATE","vcard-temp:x:update"),le.addNamespace("XFORM","jabber:x:data"),le.addNamespace("XHTML","http://www.w3.org/1999/xhtml"),va.VERSION_NAME="v8.0.1",Object.assign(va,ks),Ca(va,"_converse","pluggable");const Cl=va.api={connection:{connected(){var e;return(null==va||null===(e=va.connection)||void 0===e?void 0:e.connected)&&!0},disconnect(){va.connection&&va.connection.disconnect()},async reconnect(){var e;const t=va.connfeedback.get("connection_status");if(Cl.settings.get("authentication")===va.ANONYMOUS&&(await Tl(),await kl()),t===le.Status.CONNFAIL?Cl.connection.isType("websocket")&&Cl.settings.get("bosh_service_url")?(await va.setUserJID(va.bare_jid),va.connection._proto._doDisconnect(),va.connection._proto=new le.Bosh(va.connection),va.connection.service=Cl.settings.get("bosh_service_url")):Cl.connection.isType("bosh")&&Cl.settings.get("websocket_url")&&(Cl.settings.get("authentication")===va.ANONYMOUS?await va.setUserJID(Cl.settings.get("jid")):await va.setUserJID(va.bare_jid),va.connection._proto._doDisconnect(),va.connection._proto=new le.Websocket(va.connection),va.connection.service=Cl.settings.get("websocket_url")):t===le.Status.AUTHFAIL&&Cl.settings.get("authentication")===va.ANONYMOUS&&await va.setUserJID(Cl.settings.get("jid")),null===(e=va.connection)||void 0===e||!e.reconnecting)return va.connection.reconnect();va.connection.debouncedReconnect()},isType:e=>va.connection.isType(e)},async trigger(e){if(!va._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=va._events[e]||[],s=t.splice(1);await Promise.all(n.map((e=>e.callback.apply(e.ctx,s))))}else va.trigger.apply(va,arguments);const s=va.promises[e];void 0!==s&&s.resolve()},hook(e,t,n){const s=va._events[e]||[];if(s.length){const e=s.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n));return e.catch((e=>{throw M.error(e),e})),e}return n},user:{jid:()=>va.connection.jid,async login(e,t,n=!1){var s,i;if(e=e||va.jid,(null===(s=va.connection)||void 0===s||!s.jid||e&&!la.isSameDomain(va.connection.jid,e))&&await va.initConnection(),null!==(i=Cl.settings.get("connection_options"))&&void 0!==i&&i.worker&&await va.connection.restoreWorkerSession())return;e&&(e=await va.setUserJID(e));const r=va.pluggable.plugins["converse-bosh"];if(r&&r.enabled()){if(await va.restoreBOSHSession())return;if(Cl.settings.get("authentication")===va.PREBIND&&(!n||Cl.settings.get("auto_login")))return va.startNewPreboundBOSHSession()}t=t||Cl.settings.get("password"),async function(e,t){const{api:n}=va;n.settings.get("authentication")===va.LOGIN?e?Al(e):va.api.settings.get("credentials_url")?Al(await async function(){let e,t=0;for(;!e;){try{e=await El(t)}catch(e){M.error("Could not fetch login credentials"),M.error(e)}t=2e3}return e}()):va.jid&&(va.api.settings.get("password")||va.connection.pass)?Al():!va.isTestEnv()&&"credentials"in navigator?Al(await async function(){try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&ta.isValidJID(e.id))return await va.setUserJID(e.id),{jid:e.id,password:e.password}}catch(e){M.error(e)}}()):!va.isTestEnv()&&M.warn("attemptNonPreboundSession: Couldn't find credentials to log in with"):![va.ANONYMOUS,va.EXTERNAL].includes(va.api.settings.get("authentication"))||t&&!va.api.settings.get("auto_login")||Al()}(e&&t?{jid:e,password:t}:null,n)},async logout(){await Cl.trigger("beforeLogout",{synchronous:!0});const e=ji(),t=()=>{Object.keys(va.promises).forEach(oa),delete va.jid,Cl.trigger("logout"),e.resolve()};return va.connection.setDisconnectionCause(va.LOGOUT,void 0,!0),void 0!==va.connection?(Cl.listen.once("disconnected",(()=>t())),va.connection.disconnect()):t(),e},settings:{getModel:()=>ga(),async get(e,t){const n=await ga();return void 0===n.get(e)?t:n.get(e)},set(e,t){if(pe(e))return pa(e,{promise:!0});{const n={};return n[e]=t,pa(n,{promise:!0})}},clear:()=>async function(){return await fa(),da.clear()}()}},settings:Ta,promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=ji();n.replace=t,va.promises[e]=n}))}},listen:{once:va.once.bind(va),on:va.on.bind(va),not:va.off.bind(va),stanza(e,t,n){ve(t)?(n=t,t={}):t=t||{},va.connection.addHandler(n,t.ns,e,t.type,t.id,t.from,t)}},waitUntil(e){if(ve(e))return la.waitUntil(e);{const t=va.promises[e];return void 0===t?null:t}},send(e){var t;return Cl.connection.connected()?("string"==typeof e?e=la.toStanza(e):null!==(t=e)&&void 0!==t&&t.nodeTree&&(e=e.nodeTree),"iq"===e.tagName?Cl.sendIQ(e):(va.connection.send(e),void Cl.trigger("send",e))):(M.warn("Not sending stanza because we're not connected!"),void M.warn(le.serialize(e)))},sendIQ(e,t=va.STANZA_TIMEOUT,n=!0){var s;let i;return e=(null===(s=e)||void 0===s?void 0:s.nodeTree)??e,["get","set"].includes(e.getAttribute("type"))?(t=t||va.STANZA_TIMEOUT,n?(i=new Promise(((n,s)=>va.connection.sendIQ(e,n,s,t))),i.catch((n=>{if(null===n)throw new ui(`Timeout error after ${t}ms for the following IQ stanza: ${le.serialize(e)}`)}))):i=new Promise((n=>va.connection.sendIQ(e,n,n,t)))):(va.connection.sendIQ(e),i=Promise.resolve()),Cl.trigger("send",e),i}};async function Tl(){return await va.api.trigger("beforeTearDown",{synchronous:!0}),window.removeEventListener("click",va.onUserActivity),window.removeEventListener("focus",va.onUserActivity),window.removeEventListener("keypress",va.onUserActivity),window.removeEventListener("mousemove",va.onUserActivity),window.removeEventListener(va.unloadevent,va.onUserActivity),window.clearInterval(va.everySecondTrigger),va.api.trigger("afterTearDown"),va}function kl(){var e;return null===(e=va.session)||void 0===e||e.destroy(),delete va.session,va.shouldClearCache()&&va.api.user.settings.clear(),va.api.trigger("clearSession",{synchronous:!0})}va.isUniView=function(){return["mobile","fullscreen","embedded"].includes(Cl.settings.get("view_mode"))},va.shouldClearCache=()=>!va.config.get("trusted")||Cl.settings.get("clear_cache_on_logout")||va.isTestEnv(),va.initConnection=function(){const e=va.api;if(!e.settings.get("bosh_service_url")){if(e.settings.get("authentication")===va.PREBIND)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");if(!e.settings.get("websocket_url"))throw new Error("initConnection: you must supply a value for either the bosh_service_url or websocket_url or both.")}const t=va.isTestEnv()?fc:mc;if(("WebSocket"in window||"MozWebSocket"in window)&&e.settings.get("websocket_url"))va.connection=new t(e.settings.get("websocket_url"),Object.assign(va.default_connection_options,e.settings.get("connection_options")));else{if(!e.settings.get("bosh_service_url"))throw new Error("initConnection: this browser does not support websockets and bosh_service_url wasn't specified.");va.connection=new t(e.settings.get("bosh_service_url"),Object.assign(va.default_connection_options,e.settings.get("connection_options"),{keepalive:e.settings.get("keepalive")}))}!function(){const e={};e[le.LogLevel.DEBUG]="debug",e[le.LogLevel.INFO]="info",e[le.LogLevel.WARN]="warn",e[le.LogLevel.ERROR]="error",e[le.LogLevel.FATAL]="fatal",le.log=(t,n)=>M.log(n,e[t]),le.error=e=>M.error(e),va.connection.xmlInput=e=>M.debug(e.outerHTML,"color: darkgoldenrod"),va.connection.xmlOutput=e=>M.debug(e.outerHTML,"color: darkcyan")}(),e.trigger("connectionInitialized")},va.setUserJID=async function(e){return await async function(e,t){var n;const s=e.api.settings.get("connection_options").worker,i=le.getBareJidFromJid(t).toLowerCase(),r=`converse.session-${i}`;(null===(n=e.session)||void 0===n?void 0:n.get("id"))!==r?(function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return po.localForage.defineDriver(wl.Z).then((()=>po.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=po.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return po.localForage.defineDriver(Sl.Z).then((()=>po.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=po.localForage);const n={name:e.isTestEnv()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(n.description="localStorage instance",n.driver=[po.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(n.description="indexedDB instance",n.driver=[po.localForage.INDEXEDDB]),e.storage.persistent=po.localForage.createInstance(n)}(e,i),e.session=new Zo({id:r}),_o(e.session,r,s?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!s&&e.session.get("active")&&(e.session.clear(),e.session.save({id:r})),xl(e,t),e.api.trigger("userSessionInitialized")):xl(e,t)}(va,e),va.api.trigger("setUserJID"),e},va.saveWindowState=function(e){let t;const n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};t=(e=e||document.createEvent("Events")).type in n?n[e.type]:document.hidden?"hidden":"visible",va.windowState=t,Cl.trigger("windowStateChanged",{state:t})},va.ConnectionFeedback=Zo.extend({defaults:{connection_status:le.Status.DISCONNECTED,message:""},initialize(){this.on("change",(()=>Cl.trigger("connfeedback",va.connfeedback)))}});const jl=window.converse||{};Object.assign(jl,{CHAT_STATES:["active","composing","gone","inactive","paused"],keycodes:{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},async initialize(e){if(await async function(e){var t;const{api:n}=e;await n.trigger("cleanup",{synchronous:!0}),e.router.history.stop(),function(e){const{api:t}=e;document.removeEventListener("visibilitychange",e.saveWindowState),t.trigger("unregisteredGlobalEventHandlers")}(e),null===(t=e.connection)||void 0===t||t.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&n.promises.add("initialized")}(va),"onpagehide"in window?va.unloadevent="pagehide":"onbeforeunload"in window?va.unloadevent="beforeunload":"onunload"in window&&(va.unloadevent="unload"),function(e){ua=e,ha={};const t=ko(e,Object.keys(ma));Ct(va,ma,t),Ct(ha,ma,t)}(e),va.strict_plugin_dependencies=e.strict_plugin_dependencies,M.setLogLevel(Cl.settings.get("loglevel")),Cl.settings.get("authentication")===va.ANONYMOUS&&Cl.settings.get("auto_login")&&!Cl.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");var t;va.router.route(/^converse\?loglevel=(debug|info|warn|error|fatal)$/,"loglevel",(e=>M.setLogLevel(e))),va.connfeedback=new va.ConnectionFeedback,va.send_initial_presence=!0,await async function(e){await po.sessionStorageInitialized,e.storage={session:po.localForage.createInstance({name:e.isTestEnv()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}}(va),await async function(e){const t="converse.client-config";e.config=new Zo({id:t,trusted:!0}),e.config.browserStorage=yo(t,"session"),await new Promise((t=>e.config.fetch({success:t,error:t}))),e.api.trigger("clientConfigInitialized")}(va),await o.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=fe.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(va),t=va,document.addEventListener("visibilitychange",t.saveWindowState),t.saveWindowState({type:document.hidden?"blur":"focus"}),t.api.trigger("registeredGlobalEventHandlers");try{!History.started&&va.router.history.start()}catch(e){M.error(e)}Cl.settings.get("idle_presence_timeout")>0&&Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(le.NS.IDLE)));const n=va.pluggable.plugins;if((Cl.settings.get("auto_login")||Cl.settings.get("keepalive")&&xa(n["converse-bosh"],"enabled"))&&await Cl.user.login(null,null,!0),Cl.trigger("initialized"),va.isTestEnv())return va},plugins:{add(e,t){if(t.__name__=e,void 0!==va.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);va.pluggable.plugins[e]=t}},env:{$build:re,$iq:ae,$msg:oe,$pres:ce,utils:la,Collection:tc,Model:Zo,Promise,Strophe:le,URI:i(),dayjs:wa(),html:Qc,log:M,sizzle:Mo(),sprintf:r.sprintf,u:la}});const Nl=jl.env.utils;function Ol(e,t){Cl.send(oe({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),M.warn(`Rejecting message stanza with the following reason: ${t}`),M.warn(e)}function $l(e,t,n,s){const i=oe({from:va.connection.jid,id:Nl.getUniqueId(),to:e,type:s||"chat"}).c(n,{xmlns:le.NS.MARKERS,id:t});Cl.send(i)}function Il(e){try{return e instanceof i()?e:new(i())(e)}catch(e){return M.debug(e),null}}function Ml(e,t){const n=Il(t);if(null===n||!function(e){const t=e.protocol().toLowerCase();return"http:"===window.location.protocol||"https:"===window.location.protocol&&["https","aesgcm"].includes(t)}(n))return!1;const s=n.filename().toLowerCase();return!!e.filter((e=>s.endsWith(e))).length}function Rl(e,t){const n=Il(t),s=n.subdomain(),i=n.domain(),r=`${s?`${s}.`:""}${i}`;return e.includes(i)||e.includes(r)}function Dl(e){const t=Cl.settings.get("embed_audio");if(!Array.isArray(t))return t;try{return Rl(t,e)}catch(e){return M.debug(e),!1}}function Ll(e){const t=Cl.settings.get("embed_videos");if(!Array.isArray(t))return t;try{return Rl(t,e)}catch(e){return M.debug(e),!1}}function zl(e){const t=Cl.settings.get("show_images_inline");if(!Array.isArray(t))return t;try{return Rl(t,e)}catch(e){return M.debug(e),!1}}function Pl(e){return Ml([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function Fl(e){return Ml([".gif"],e)}function Ul(e){return Ml([".ogg",".mp3",".m4a"],e)}function Bl(e){return Ml([".mp4",".webm"],e)}function ql(e){const t=Cl.settings.get("image_urls_regex");return(null==t?void 0:t.test(e))||Pl(e)}const{NS:Hl}=le;class Gl extends Error{constructor(e,t){super(e,t),this.name="StanzaParseError",this.stanza=t}}function Wl(e,t){const n={},s=Mo()(`stanza-id[xmlns="${le.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(n,s);const i=Mo()(`message > result[xmlns="${le.NS.MAM}"]`,t).pop();i&&(n[`stanza_id ${t.getAttribute("from")||va.bare_jid}`]=i.getAttribute("id"));const r=Mo()(`origin-id[xmlns="${le.NS.SID}"]`,e).pop();return r&&(n.origin_id=r.getAttribute("id")),n}function Vl(e,t){var n;const s=Mo()(`encryption[xmlns="${le.NS.EME}"]`,e).pop(),i=null==s?void 0:s.getAttribute("namespace"),r={};if(i&&(r.is_encrypted=!0,r.encryption_namespace=i,i!==le.NS.OMEMO))return r;const o=Mo()(`encrypted[xmlns="${le.NS.OMEMO}"]`,e).pop();if(s||(r.is_encrypted=!!o),!o||Cl.settings.get("clear_cache_on_logout"))return r;const a=o.querySelector("header");r.encrypted={device_id:a.getAttribute("sid")};const c=null===(n=t.omemo_store)||void 0===n?void 0:n.get("device_id"),l=c&&Mo()(`key[rid="${c}"]`,o).pop();var d;return l&&Object.assign(r.encrypted,{iv:a.querySelector("iv").textContent,key:l.textContent,payload:(null===(d=o.querySelector("payload"))||void 0===d?void 0:d.textContent)||null,prekey:["true","1"].includes(l.getAttribute("prekey"))}),r}function Jl(e,t){const n=Mo()(`> apply-to[xmlns="${le.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(Mo()(`> retract[xmlns="${le.NS.RETRACT}"]`,n).pop()){const n=Mo()(`delay[xmlns="${le.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?wa()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=Mo()(`> retracted[xmlns="${le.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function Kl(e,t){const n=Mo()(`replace[xmlns="${le.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id"),s=e;if(e){const n=Mo()(`delay[xmlns="${le.NS.DELAY}"]`,t).pop();return{msgid:s,replace_id:e,edited:n?wa()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Yl(e){const t=[];if(!e)return{};try{i().withinString(e,((e,n,s)=>(t.push({url:e,start:n,end:s}),e)),ge)}catch(e){M.debug(e)}const n=t.filter((e=>ql(e.url)&&zl(e.url)||Bl(e.url)&&Ll(e.url)||Ul(e.url)&&Dl(e.url))).map((e=>({start:e.start,end:e.end})));return n.length?{media_urls:n}:{}}function Ql(e){const t=Mo()(`spoiler[xmlns="${le.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:null==t?void 0:t.textContent}}function Xl(e){const t=Mo()(`x[xmlns="${le.NS.OUTOFBAND}"]`,e).pop();var n,s;return t?{oob_url:null===(n=t.querySelector("url"))||void 0===n?void 0:n.textContent,oob_desc:null===(s=t.querySelector("desc"))||void 0===s?void 0:s.textContent}:{}}function Zl(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=Mo()(`text[xmlns="${le.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:null==n?void 0:n.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName}}return{}}function ed(e){return Mo()(`reference[xmlns="${le.NS.REFERENCE}"]`,e).map((t=>{var n;const s=t.getAttribute("anchor"),i=null===(n=e.querySelector(s?`#${s}`:"body"))||void 0===n?void 0:n.textContent;if(!i)return M.warn(`Could not find referenced text for ${t}`),null;const r=t.getAttribute("begin"),o=t.getAttribute("end");return{begin:r,end:o,type:t.getAttribute("type"),value:i.slice(r,o),uri:t.getAttribute("uri")}})).filter((e=>e))}function td(e){const t=Mo()(`received[xmlns="${le.NS.RECEIPTS}"]`,e).pop();return null==t?void 0:t.getAttribute("id")}function nd(e){const t=le.NS.CARBONS;return Mo()(`message > received[xmlns="${t}"]`,e).length>0||Mo()(`message > sent[xmlns="${t}"]`,e).length>0}function sd(e){var t;return null===(t=Mo()(`\n        composing[xmlns="${Hl.CHATSTATES}"],\n        paused[xmlns="${Hl.CHATSTATES}"],\n        inactive[xmlns="${Hl.CHATSTATES}"],\n        active[xmlns="${Hl.CHATSTATES}"],\n        gone[xmlns="${Hl.CHATSTATES}"]`,e).pop())||void 0===t?void 0:t.nodeName}function id(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&Mo()(`request[xmlns="${le.NS.RECEIPTS}"]`,e).length}function rd(e){if(Mo()(`message > forwarded[xmlns="${le.NS.FORWARD}"]`,e).length){Ol(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Gl(`Ignoring unencapsulated forwarded message from ${t}`,e)}}function od(e){return Mo()(`\n        acknowledged[xmlns="${le.NS.MARKERS}"],\n        displayed[xmlns="${le.NS.MARKERS}"],\n        received[xmlns="${le.NS.MARKERS}"]`,e).pop()}function ad(e){return"headline"===e.getAttribute("type")}function cd(e){if(Mo()(`mentions[xmlns="${le.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function ld(e){return!!Mo()(`message > result[xmlns="${le.NS.MAM}"]`,e).pop()}function dd(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=le.xmlunescape(e.getAttribute(n)),t)),{})}const{Strophe:ud}=jl.env;let hd,md;ud.addNamespace("ADHOC","http://jabber.org/protocol/commands");const fd={adhoc:{async getCommands(e){let t=[];try{n=await md.disco.items(e,ud.NS.ADHOC),t=Mo()(`query[xmlns="${ud.NS.DISCO_ITEMS}"][node="${ud.NS.ADHOC}"] item`,n).map(dd)}catch(t){null===t?M.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(M.error(`Error while fetching ad-hoc commands for ${e}`),M.error(t))}var n;return t}}};jl.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){hd=this._converse,md=hd.api,Object.assign(md,fd)}});const gd=Zo.extend({initialize(){this.rosterContactAdded=ji()},async setRosterContact(e){const t=await Cl.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")),this.rosterContactAdded.resolve())}});var pd=n(3964),vd=n.n(pd);const{u:bd}=jl.env;function yd(e){const t=Cl.settings.get("prune_messages_above");if(t&&"number"==typeof t&&e.messages.length>t){const n=e.messages.filter((e=>!bd.isEmptyMessage(e)));if(n.length>t){for(;n.length>t;)n.shift().destroy();Cl.trigger("historyPruned",e)}}}const _d=hc(yd,250),{Strophe:wd,sizzle:Sd}=jl.env;async function xd(e,t){var n,s,i,r,o,a;rd(e);let c=e.getAttribute("to");const l=wd.getResourceFromJid(c);if(Cl.settings.get("filter_by_resource")&&l&&l!==t.resource)return new Gl(`Ignoring incoming message intended for a different resource: ${c}`,e);const d=e;let u=e.getAttribute("from")||t.bare_jid;if(nd(e)){if(u!==t.bare_jid)return Ol(e,"Rejecting carbon from invalid JID"),new Gl(`Rejecting carbon from invalid JID ${c}`,e);{const t=`[xmlns="${wd.NS.CARBONS}"] > forwarded[xmlns="${wd.NS.FORWARD}"] > message`;c=(e=Sd(t,e).pop()).getAttribute("to"),u=e.getAttribute("from")}}const h=ld(e);if(h){if(u!==t.bare_jid)return new Gl(`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`,e);{const t=`[xmlns="${wd.NS.MAM}"] > forwarded[xmlns="${wd.NS.FORWARD}"] > message`;c=(e=Sd(t,e).pop()).getAttribute("to"),u=e.getAttribute("from")}}const m=wd.getBareJidFromJid(u),f=m===t.bare_jid;if(f&&null===c)return new Gl(`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`,e);const g=ad(e),p=cd(e);let v,b;if(!g&&!p&&(b=f?wd.getBareJidFromJid(c):m,v=await Cl.contacts.get(b),void 0===v&&!Cl.settings.get("allow_non_roster_messaging")))return M.error(e),new Gl("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const y=Sd(`delay[xmlns="${wd.NS.DELAY}"]`,d).pop(),_=od(e),w=(new Date).toISOString();let S=Object.assign({contact_jid:b,is_archived:h,is_headline:g,is_server_message:p,body:null===(n=e.querySelector("body"))||void 0===n||null===(s=n.textContent)||void 0===s?void 0:s.trim(),chat_state:sd(e),from:wd.getBareJidFromJid(e.getAttribute("from")),is_carbon:nd(d),is_delayed:!!y,is_markable:!!Sd(`markable[xmlns="${wd.NS.MARKERS}"]`,e).length,is_marker:!!_,is_unstyled:!!Sd(`unstyled[xmlns="${wd.NS.STYLING}"]`,e).length,marker_id:_&&_.getAttribute("id"),msgid:e.getAttribute("id")||d.getAttribute("id"),nick:null===(i=v)||void 0===i||null===(r=i.attributes)||void 0===r?void 0:r.nickname,receipt_id:td(e),received:(new Date).toISOString(),references:ed(e),sender:f?"me":"them",subject:null===(o=e.querySelector("subject"))||void 0===o?void 0:o.textContent,thread:null===(a=e.querySelector("thread"))||void 0===a?void 0:a.textContent,time:y?wa()(y.getAttribute("stamp")).toISOString():w,to:e.getAttribute("to"),type:e.getAttribute("type")},Zl(e),Xl(e),Ql(e),Kl(e,d),Wl(e,d),Jl(e,d),Vl(e,t));if(S.is_archived){const n=d.getAttribute("from");if(n&&n!==t.bare_jid)return new Gl(`Invalid Stanza: Forged MAM message from ${n}`,e)}return await Cl.emojis.initialize(),S=Object.assign({message:S.body||S.error,is_only_emojis:!!S.body&&la.isOnlyEmojis(S.body),is_valid_receipt_request:id(e,S)},S),S.id=S.origin_id||S[`stanza_id ${S.from}`]||la.getUniqueId(),S=await Cl.hook("parseMessage",e,S),Object.assign(S,Yl(S.is_encrypted?S.plaintext:S.body))}const{Strophe:Ed,$msg:Ad}=jl.env,Cd=jl.env.utils,Td=gd.extend({defaults(){return{bookmarked:!1,chat_state:void 0,hidden:va.isUniView()&&!Cl.settings.get("singleton"),message_type:"chat",nickname:void 0,num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:va.PRIVATE_CHAT_TYPE,url:""}},async initialize(){this.initialized=ji(),gd.prototype.initialize.apply(this,arguments);const e=this.get("jid");e&&(this.set({box_id:`box-${e}`}),this.initNotifications(),this.initUI(),this.initMessages(),this.get("type")===va.PRIVATE_CHAT_TYPE&&(this.presence=va.presences.findWhere({jid:e})||va.presences.create({jid:e}),await this.setRosterContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))),this.on("change:chat_state",this.sendChatState,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.fetchMessages(),await Cl.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve())},getMessagesCollection:()=>new va.Messages,getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${va.bare_jid}`},initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=ji(),this.messages.fetched.then((()=>{this.pruneHistoryWhenScrolledDown(),Cl.trigger("afterMessagesFetched",this)})),this.messages.chatbox=this,_o(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",this.onMessageUploadChanged,this),this.listenTo(this.messages,"add",this.onMessageAdded,this)},initUI(){this.ui=new Zo},initNotifications(){this.notifications=new Zo},getNotificationsText(){var e,t,n;const{__:s}=va;return(null===(e=this.notifications)||void 0===e?void 0:e.get("chat_state"))===va.COMPOSING?s("%1$s is typing",this.getDisplayName()):(null===(t=this.notifications)||void 0===t?void 0:t.get("chat_state"))===va.PAUSED?s("%1$s has stopped typing",this.getDisplayName()):(null===(n=this.notifications)||void 0===n?void 0:n.get("chat_state"))===va.GONE?s("%1$s has gone away",this.getDisplayName()):""},afterMessagesFetched(e){this.most_recent_cached_message=e?this.getMostRecentMessage(e):null,Cl.trigger("afterMessagesFetched",this)},fetchMessages(){if(this.messages.fetched_flag)return void M.info(`Not re-fetching messages for ${this.get("jid")}`);this.most_recent_cached_message=null,this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:t=>{this.afterMessagesFetched(t),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched},async handleErrorMessageStanza(e){const{__:t}=va,n=await xd(e,va);if(!await this.shouldShowErrorMessage(n))return;const s=this.getMessageReferencedByError(n);if(s){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===s.get("retraction_id")?(e.retraction_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to send a message."):e.error=t("Sorry, an error occurred while trying to send your message.")),s.save(e)}else this.createMessage(n)},queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>M.error(e))),this.msg_chain},async onMessage(e){if(e=await e,Cd.isErrorObject(e))return e.stanza&&M.error(e.stanza),M.error(e.message);const t=this.getDuplicateMessage(e);if(t)this.updateMessage(t,e);else if(!this.handleReceipt(e)&&!this.handleChatMarker(e)&&!await this.handleRetraction(e)&&(this.setEditable(e,e.time),e.chat_state&&"them"===e.sender&&this.notifications.set("chat_state",e.chat_state),Cd.shouldCreateMessage(e))){const t=this.handleCorrection(e)||await this.createMessage(e);this.notifications.set({chat_state:null}),this.handleUnreadMessage(t)}},async onMessageUploadChanged(e){if(e.get("upload")===va.SUCCESS){const t={body:e.get("message"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}},onMessageAdded(e){!Cl.settings.get("prune_messages_above")||"scrolled"!==Cl.settings.get("pruning_behavior")&&this.ui.get("scrolled")||Cd.isEmptyMessage(e)||_d(this)},async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),M.error(e)}finally{delete this.msg_chain,delete this.messages.fetched_flag,this.messages.fetched=ji()}},async close(){Cl.connection.connected()&&(this.setChatState(va.INACTIVE),this.sendChatState());try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){M.error(e)}finally{Cl.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}Cl.trigger("chatBoxClosed",this)},announceReconnection(){Cl.trigger("chatReconnected",this)},async onReconnection(){Cl.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()},onPresenceChanged(e){const{__:t}=va,n=e.get("show"),s=this.getDisplayName();let i;"offline"===n?i=t("%1$s has gone offline",s):"away"===n?i=t("%1$s has gone away",s):"dnd"===n?i=t("%1$s is busy",s):"online"===n&&(i=t("%1$s is online",s)),i&&this.createMessage({message:i,type:"info"})},onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())},pruneHistoryWhenScrolledDown(){Cl.settings.get("prune_messages_above")&&"unscrolled"===Cl.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&yd(this)},validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=Cl.settings.get("auto_join_rooms").map((e=>pe(e)?e.jid:e)),n=Cl.settings.get("auto_join_private_chats").concat(t);if(Cl.settings.get("singleton")&&!n.includes(e.jid)&&!Cl.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return M.warn(t),t}},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")},async createMessageFromError(e){e instanceof va.TimeoutError&&((await this.createMessage({type:"error",message:e.message,retry_event_id:e.retry_event_id})).error=e)},editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)},editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e},getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getMostRecentMessage(e){for(let t=(e=e||this.messages).length-1;t>=0;t--){const n=e.at(t);if(n.get("type")===this.get("message_type"))return n}},getUpdatedMessageAttributes:(e,t)=>(({is_archived:e})=>({is_archived:e}))(t),updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)},setChatState(e,t){return void 0!==this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===va.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),va.TIMEOUTS.PAUSED,va.PAUSED):e===va.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),va.TIMEOUTS.INACTIVE,va.INACTIVE)),this.set("chat_state",e,t),this},getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))},shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||e.body)return!0},isSameUser:(e,t)=>Cd.isSameBareJID(e,t),findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}},async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const n=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return n?(n.save(ko(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const n=this.findDanglingRetraction(e);if(n){const s=ko(n.attributes,t),i=Object.assign({dangling_retraction:!1},e,s);return delete i.id,n.save(i),!0}}return!1},handleCorrection(e){if(!e.replace_id||!e.from)return;const t=this.messages.findWhere({msgid:e.replace_id,from:e.from});if(!t)return;const n=t.get("older_versions")||{};return e.time<t.get("time")&&t.get("edited")?(n[e.time]=e.message,t.save({older_versions:n})):(Object.keys(n).length?n[t.get("edited")]=t.get("message"):n[t.get("time")]=t.get("message"),delete(e=Object.assign(e,{older_versions:n})).id,e.time=t.get("time"),t.save(e)),t},getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,n)=>t||function(e,t){return e===t||In(e,t,Rn(t))}(e.attributes,n)),!1)))},getOriginIdQueryAttrs:e=>e.origin_id&&{origin_id:e.origin_id,from:e.from},getStanzaIdQueryAttrs:e=>Object.keys(e).filter((e=>e.startsWith("stanza_id "))).map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n})),getMessageBodyQueryAttrs(e){if(e.message&&e.msgid){const t={from:e.from,msgid:e.msgid};return e.is_encrypted||(t.message=e.message),t}},retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})},sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=Ad({id:Cd.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:Ed.NS.HINTS}).up().c("apply-to",{id:t,xmlns:Ed.NS.FASTEN}).c("retract",{xmlns:Ed.NS.RETRACT});return va.connection.send(n)},sendMarkerForLastMessage(e="displayed",t=!1){const n=Array.from(this.messages.models);n.reverse();const s=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));s&&this.sendMarkerForMessage(s,e,t)},sendMarkerForMessage(e,t="displayed",n=!1){e&&Cl.settings.get("send_chat_markers").includes(t)&&(null!=e&&e.get("is_markable")||n)&&$l(Ed.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))},handleChatMarker(e){if(Ed.getBareJidFromJid(e.to)!==va.bare_jid)return!1;if(e.is_markable)return!this.contact||e.is_archived||e.is_carbon||$l(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}},sendReceiptStanza(e,t){const n=Ad({from:va.connection.jid,id:Cd.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:Ed.NS.RECEIPTS,id:t}).up().c("store",{xmlns:Ed.NS.HINTS}).up();Cl.send(n)},handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1},createMessageStanza(e){const t=Ad({from:va.connection.jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&Cd.getUniqueId()||e.get("msgid")}).c("body").t(e.get("message")).up().c(va.ACTIVE,{xmlns:Ed.NS.CHATSTATES}).root();return"chat"===e.get("type")&&t.c("request",{xmlns:Ed.NS.RECEIPTS}).root(),e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:Ed.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:Ed.NS.SPOILER}).root()),(e.get("references")||[]).forEach((e=>{const n={xmlns:Ed.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(n.uri=e.uri),t.c("reference",n).root()})),e.get("oob_url")&&t.c("x",{xmlns:Ed.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root(),e.get("edited")&&t.c("replace",{xmlns:Ed.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:Ed.NS.SID,id:e.get("origin_id")}).root(),t},getOutgoingMessageAttributes(e){const t=!!this.get("composing_spoiler"),n=Cd.getUniqueId(),s=null==e?void 0:e.body,i=s?Cd.httpToGeoUri(Cd.shortnamesToUnicode(s),va):void 0;return Object.assign({},e,{from:va.bare_jid,fullname:va.xmppstatus.get("fullname"),id:n,is_only_emojis:!!s&&Cd.isOnlyEmojis(s),jid:this.get("jid"),message:i,msgid:n,nickname:this.get("nickname"),sender:"me",time:(new Date).toISOString(),type:this.get("message_type"),body:i,is_spoiler:t,origin_id:n},Yl(s))},setEditable(e,t){if(!e.is_headline&&!Cd.isEmptyMessage(e)&&"me"===e.sender)if("all"===Cl.settings.get("allow_message_corrections"))e.editable=!(e.file||e.retracted||"oob_url"in e);else if("last"===Cl.settings.get("allow_message_corrections")&&t>this.get("time_sent")){this.set({time_sent:t});const n=this.messages.findWhere({editable:!0});n&&n.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)}},async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)},async sendMessage(e){e=this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const n=t.get("older_versions")||{};n[t.get("time")]=t.get("message"),t.save({correcting:!1,edited:(new Date).toISOString(),message:e.message,older_versions:n,references:e.references,is_only_emojis:e.is_only_emojis,origin_id:Cd.getUniqueId(),received:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);return Cl.send(this.createMessageStanza(t)),Cl.trigger("sendMessage",{chatbox:this,message:t}),t},sendChatState(){if(Cl.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=Cl.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;Cl.send(Ad({id:Cd.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:Ed.NS.CHATSTATES}).up().c("no-store",{xmlns:Ed.NS.HINTS}).up().c("no-permanent-store",{xmlns:Ed.NS.HINTS}))}},async sendFiles(e){var t;const{__:n}=va,s=(await Cl.disco.features.get(Ed.NS.HTTPUPLOAD,va.domain)).pop();if(!s)return void this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const i=s.dataforms.where({FORM_TYPE:{value:Ed.NS.HTTPUPLOAD,type:"hidden"}}).pop(),r=window.parseInt(null===(t=((null==i?void 0:i.attributes)||{})["max-file-size"])||void 0===t?void 0:t.value),o=null==s?void 0:s.id;o?Array.from(e).forEach((async e=>{if(e=await Cl.hook("beforeFileUpload",this,e),!window.isNaN(r)&&window.parseInt(e.size)>r)return this.createMessage({message:n("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,vd()(r)),type:"error",is_ephemeral:!0});{const t=Object.assign(this.getOutgoingMessageAttributes(),{file:!0,progress:0,slot_request_url:o});this.setEditable(t,(new Date).toISOString());const n=await this.createMessage(t,{silent:!0});n.file=e,this.messages.trigger("add",n),n.getRequestSlotURL()}})):this.createMessage({message:n("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})},maybeShow(e){if(!va.isUniView())return Cd.safeSave(this,{hidden:!1}),this.trigger("show"),this;{const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=va.chatboxes.filter(t);(e||0===n.length)&&(n.forEach((e=>Cd.safeSave(e,{hidden:!0}))),Cd.safeSave(this,{hidden:!1}))}},isHidden(){return this.get("hidden")||this.isScrolledUp()||"hidden"===va.windowState},handleUnreadMessage(e){null!=e&&e.get("body")&&Cd.isNewMessage(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))},incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)},clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),Cd.safeSave(this,{num_unread:0})},isScrolledUp(){return this.ui.get("scrolled")}}),kd=jl.env.utils,{Strophe:jd}=jl.env,Nd={defaults:()=>({msgid:kd.getUniqueId(),time:(new Date).toISOString(),is_ephemeral:!1}),async initialize(){this.checkValidity()&&(this.initialized=ji(),"chat"===this.get("type")&&(gd.prototype.initialize.apply(this,arguments),this.setRosterContact(jd.getBareJidFromJid(this.get("from")))),this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage(),await Cl.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())},setTimerForEphemeralMessage(){const e=()=>{this.ephemeral_timer=window.setTimeout(this.safeDestroy.bind(this),1e4)};return this.isEphemeral()?(e(),!0):(this.on("change:is_ephemeral",(()=>this.isEphemeral()?e():clearTimeout(this.ephemeral_timer))),!1)},checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)},mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(Cl.settings.get("allow_message_retraction"))},safeDestroy(){try{this.destroy()}catch(e){M.error(e)}},isEphemeral(){return this.get("is_ephemeral")},isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")},isFollowup(){const e=this.collection.models,t=e.indexOf(this),n=t?e[t-1]:null;if(null===n)return!1;const s=wa()(this.get("time"));return this.get("from")===n.get("from")&&!this.isMeCommand()&&!n.isMeCommand()&&"info"!==this.get("type")&&"info"!==n.get("type")&&s.isBefore(wa()(n.get("time")).add(10,"minutes"))&&!!this.get("is_encrypted")==!!n.get("is_encrypted")},getDisplayName(){return"groupchat"===this.get("type")?this.get("nick"):this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")},getMessageText(){const{__:e}=va;return this.get("is_encrypted")?this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message"):this.get("message")},sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=jl.env.$iq({from:va.jid,to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:jd.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return Cl.sendIQ(e)},async getRequestSlotURL(){const{__:e}=va;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return M.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const n=t.querySelector("slot");if(!n)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})},uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async()=>{if(e.readyState===XMLHttpRequest.DONE)if(M.info("Status: "+e.status),200===e.status||201===e.status){let e={upload:va.SUCCESS,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await Cl.hook("afterFileUploaded",this,e),this.save(e)}else e.onerror()},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=va;let n;n=e.responseText?t('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:va.FAILURE,message:n,is_ephemeral:!0})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),e.send(this.file)}},Od={chats:{async create(e,t){if("string"==typeof e){if(t&&(null==t||!t.fullname)){var n;const s=await Cl.contacts.get(e);t.fullname=null==s||null===(n=s.attributes)||void 0===n?void 0:n.fullname}return Cl.chats.get(e,t,!0)||void M.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.forEach((async n=>{var s;const i=await Cl.contacts.get(e);return t.fullname=null==i||null===(s=i.attributes)||void 0===s?void 0:s.fullname,Cl.chats.get(n,t,!0).maybeShow()}))):(M.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if("string"==typeof e){const s=await Cl.chats.get(e,t,!0);return s?s.maybeShow(n):s}if(Array.isArray(e))return Promise.all(e.map((e=>Cl.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const s="chats.open: You need to provide at least one JID";throw M.error(s),new Error(s)},async get(e,t={},n=!1){async function s(e){let s=await Cl.chatboxes.get(e);return!s&&n?s=await Cl.chatboxes.create(e,t,va.ChatBox):(s=s&&s.get("type")===va.PRIVATE_CHAT_TYPE?s:null,s&&Object.keys(t).length&&s.save(t)),s}return await Cl.waitUntil("chatBoxesFetched"),void 0===e?(await Cl.chatboxes.get()).filter((e=>e.get("type")===va.PRIVATE_CHAT_TYPE)):"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}}},{Strophe:$d,sizzle:Id,u:Md}=jl.env;function Rd(e){if(!Md.isValidJID(e))return M.warn(`Invalid JID "${e}" provided in URL fragment`);Cl.chats.open(e)}async function Dd(){if(va.shouldClearCache()){await Promise.all(va.chatboxes.map((e=>e.messages&&e.messages.clearStore({silent:!0}))));const e=e=>e.get("type")!==va.CONTROLBOX_TYPE;va.chatboxes.clearStore({silent:!0},e)}}function Ld(){Cl.settings.get("auto_join_private_chats").forEach((e=>{va.chatboxes.where({jid:e}).length||("string"==typeof e?Cl.chats.open(e):M.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),Cl.trigger("privateChatsAutoJoined")}function zd(){va.connection.addHandler((e=>Id(`message > result[xmlns="${$d.NS.MAM}"]`,e).pop()?(M.warn('Received a MAM message with type "chat".'),!0):(va.handleMessageStanza(e),!0)),null,"message","chat"),va.connection.addHandler((e=>(null!==e.getAttribute("type")||va.handleMessageStanza(e),!0)),$d.NS.RECEIPTS,"message"),va.connection.addHandler((e=>(async function(e){const t=$d.getBareJidFromJid(e.getAttribute("from"));if(Md.isSameBareJID(t,va.bare_jid))return;const n=await Cl.chatboxes.get(t);n.get("type")===va.PRIVATE_CHAT_TYPE&&(null==n||n.handleErrorMessageStanza(e))}(e),!0)),null,"message","error")}async function Pd(e){if(cd(e)){const t=e.getAttribute("from");return M.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}const t=await xd(e,va);if(Md.isErrorObject(t))return t.stanza&&M.error(t.stanza),M.error(t.message);const n=!!Id(`body, encrypted[xmlns="${$d.NS.OMEMO}"]`,e).length,s=await Cl.chats.get(t.contact_jid,{nickname:t.nick},n);await(null==s?void 0:s.queueMessage(t));const i={stanza:e,attrs:t,chatbox:s};Cl.trigger("message",i)}jl.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){Cl.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0}),va.Message=gd.extend(Nd),va.Messages=tc.extend({model:va.Message,comparator:"time"}),Object.assign(va,{ChatBox:Td,handleMessageStanza:Pd}),Object.assign(Cl,Od),va.router.route("converse/chat?jid=:jid",Rd),Cl.listen.on("chatBoxesFetched",Ld),Cl.listen.on("presencesInitialized",zd),Cl.listen.on("clearSession",Dd)}});const{Strophe:Fd}=jl.env,Ud=Zo.extend({idAttribute:"jid",initialize(e,t){this.waitUntilFeaturesDiscovered=ji(),this.dataforms=new tc;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=va.createStore(n,"session"),this.features=new tc,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=va.createStore(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new tc,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=va.createStore(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new tc,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=va.createStore(n,"session"),this.fetchFeatures(t),this.items=new va.DiscoEntities,n=`converse.disco-items-${this.get("jid")}`,this.items.browserStorage=va.createStore(n,"session"),this.items.fetch()},async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})},async hasFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this},onFeatureAdded(e){e.entity=this,Cl.trigger("serviceDiscovered",e)},onFieldAdded(e){e.entity=this,Cl.trigger("discoExtensionFieldDiscovered",e)},async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}},async queryInfo(){let e;try{e=await Cl.disco.info(this.get("jid"),null)}catch(e){return null===e?M.error(`Timeout for disco#info query for ${this.get("jid")}`):M.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)},onDiscoItems(e){Mo()(`query[xmlns="${Fd.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid");if(void 0===this.items.get(t)){const e=va.disco_entities.get(t);e?this.items.add(e):this.items.create({jid:t})}}))},async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await Cl.disco.items(this.get("jid"));this.onDiscoItems(e)},onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),Mo()(`x[type="result"][xmlns="${Fd.NS.XFORM}"]`,e).forEach((e=>{const t={};Mo()("field",e).forEach((e=>{var n;t[e.getAttribute("var")]={value:null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${Fd.NS.DISCO_ITEMS}"]`)&&this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),Mo()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{var n;this.fields.create({var:t.getAttribute("var"),value:null===(n=t.querySelector("value"))||void 0===n?void 0:n.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),Bd=tc.extend({model:Ud,fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){M.error(n),t(new Error("Could not fetch disco entities"))}})}))}}),{Strophe:qd,$iq:Hd}=jl.env;async function Gd(){Cl.disco.own.identities.add("client","web","Converse"),Cl.disco.own.features.add(qd.NS.CHATSTATES),Cl.disco.own.features.add(qd.NS.DISCO_INFO),Cl.disco.own.features.add(qd.NS.ROSTERX),Cl.settings.get("message_carbons")&&Cl.disco.own.features.add(qd.NS.CARBONS),Cl.trigger("addClientFeatures"),va.connection.addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:qd.NS.DISCO_INFO};t&&(n.node=t);const s=Hd({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&s.attrs({to:i}),s.c("query",n),va.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),s.c("identity",t).up()})),va.disco._features.forEach((e=>s.c("feature",{var:e}).up())),Cl.send(s.tree()),!0}(e)),qd.NS.DISCO_INFO,"iq","get",null,null),va.disco_entities=new va.DiscoEntities;const e=`converse.disco-entities-${va.bare_jid}`;va.disco_entities.browserStorage=va.createStore(e,"session");const t=await va.disco_entities.fetchEntities();0!==t.length&&t.get(va.domain)||va.disco_entities.create({jid:va.domain}),Cl.trigger("discoInitialized")}function Wd(){if(!va.stream_features){const e=`converse.stream-features-${qd.getBareJidFromJid(va.jid)}`;Cl.promises.add("streamFeaturesAdded"),va.stream_features=new tc,va.stream_features.browserStorage=va.createStore(e,"session")}}function Vd(){Cl.trigger("streamFeaturesAdded")}function Jd(){Wd(),Array.from(va.connection.features.childNodes).forEach((e=>{va.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),Vd()}function Kd(){var e,t,n,s,i;null===(e=va.disco_entities)||void 0===e||e.forEach((e=>e.features.clearStore())),null===(t=va.disco_entities)||void 0===t||t.forEach((e=>e.identities.clearStore())),null===(n=va.disco_entities)||void 0===n||n.forEach((e=>e.dataforms.clearStore())),null===(s=va.disco_entities)||void 0===s||s.forEach((e=>e.fields.clearStore())),null===(i=va.disco_entities)||void 0===i||i.clearStore(),delete va.disco_entities}const{Strophe:Yd,$iq:Qd}=jl.env,Xd={disco:{stream:{async getFeature(e,t){if(await Cl.waitUntil("streamFeaturesAdded"),!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==va.stream_features||Cl.connection.connected())return va.stream_features.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but _converse.stream_features has been torn down`;M.warn(n)}}},own:{identities:{add(e,t,n,s){for(var i=0;i<va.disco._identities.length;i++)if(va.disco._identities[i].category==e&&va.disco._identities[i].type==t&&va.disco._identities[i].name==n&&va.disco._identities[i].lang==s)return!1;va.disco._identities.push({category:e,type:t,name:n,lang:s})},clear(){va.disco._identities=[]},get:()=>va.disco._identities},features:{add(e){for(var t=0;t<va.disco._features.length;t++)if(va.disco._features[t]==e)return!1;va.disco._features.push(e)},clear(){va.disco._features=[]},get:()=>va.disco._features}},info(e,t){const n={xmlns:Yd.NS.DISCO_INFO};t&&(n.node=t);const s=Qd({from:va.connection.jid,to:e,type:"get"}).c("query",n);return Cl.sendIQ(s)},items(e,t){const n={xmlns:Yd.NS.DISCO_ITEMS};return t&&(n.node=t),Cl.sendIQ(Qd({from:va.connection.jid,to:e,type:"get"}).c("query",n))},entities:{async get(e,t=!1){if(await Cl.waitUntil("discoInitialized"),!e)return va.disco_entities;if(void 0===va.disco_entities&&!Cl.connection.connected()){const t=`Tried to look up entity ${e} but _converse.disco_entities has been torn down`;return void M.warn(t)}const n=va.disco_entities.get(e);return n||!t?n:Cl.disco.entities.create(e)},create:(e,t)=>va.disco_entities.create({jid:e},t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");await Cl.waitUntil("discoInitialized");let n=await Cl.disco.entities.get(t,!0);if(void 0===va.disco_entities&&!Cl.connection.connected()){const n=`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`;return void M.warn(n)}n=await n.waitUntilFeaturesDiscovered;const s=[...n.items.map((t=>t.hasFeature(e))),n.hasFeature(e)];return(await Promise.all(s)).filter(pe)}},supports:async(e,t)=>(await Cl.disco.features.get(e,t)||[]).length>0,async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await Cl.waitUntil("discoInitialized");let t=await Cl.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=ji()),t.queryInfo()):t=await Cl.disco.entities.create(e,{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>Cl.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await Cl.waitUntil("discoInitialized");let t=await Cl.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await Cl.waitUntil("discoInitialized");let t=await Cl.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const s=await Cl.disco.entities.get(n,!0);if(void 0!==s||Cl.connection.connected())return s.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;M.warn(t)}}}},{Strophe:Zd}=jl.env;jl.plugins.add("converse-disco",{initialize(){Object.assign(Cl,Xd),Cl.promises.add("discoInitialized"),Cl.promises.add("streamFeaturesAdded"),va.DiscoEntity=Ud,va.DiscoEntities=Bd,va.disco={_identities:[],_features:[]},Cl.listen.on("userSessionInitialized",(async()=>{Wd(),va.connfeedback.get("connection_status")===Zd.Status.ATTACHED&&(await new Promise(((e,t)=>va.stream_features.fetch({success:e,error:t}))),Vd())})),Cl.listen.on("beforeResourceBinding",Jd),Cl.listen.on("reconnected",Gd),Cl.listen.on("connected",Gd),Cl.listen.on("beforeTearDown",(async()=>{Cl.promises.add("streamFeaturesAdded"),va.stream_features&&(await va.stream_features.clearStore(),delete va.stream_features)})),Cl.listen.on("will-reconnect",Kd),Cl.listen.on("clearSession",Kd)}});const eu=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),tu=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,nu=jl.env.utils;jl.emojis={initialized:!1,initialized_promise:ji()};const su={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function iu(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){let s=parseInt(n[e],16);if(s>=65536&&s<=1114111){const e=Math.floor((s-65536)/1024)+55296,t=(s-65536)%1024+56320;s=String.fromCharCode(e)+String.fromCharCode(t)}else s=String.fromCharCode(s);t.push(s)}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function ru(e){return e.replace(eu,((e,t,n,s)=>void 0!==s&&""!==s&&nu.unescapeHTML(s)in su?(s=nu.unescapeHTML(s),n+iu(su[s].toUpperCase())):e))}function ou(e,t={unicode_only:!1,add_title_wrapper:!1}){const n=e.emoji,s=e.shortname;if(n){if(t.unicode_only)return n;if(Cl.settings.get("use_system_emojis"))return t.add_title_wrapper&&s?Qc`<span title="${s}">${n}</span>`:n;{const t=Cl.settings.get("emoji_image_path");return Qc`<img class="emoji"
                draggable="false"
                title="${s}"
                alt="${n}"
                src="${t}/72x72/${e.cp}.png"/>`}}return t.unicode_only?s:Qc`<img class="emoji"
            draggable="false"
            title="${s}"
            alt="${s}"
            src="${jl.emojis.by_sn[s].url}">`}function au(e){if(!jl.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initilaized_promise.");return[...e.matchAll(jl.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=jl.emojis.by_sn[e[0]].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?iu(t):null}}))}function cu(e){const t=[];return function(e,n){const s=/\uFE0F/g,i=String.fromCharCode(8205);String(e).replace(tu,((e,n,r)=>{const o=function(e){const t=[];let n=0,s=0;for(;s<e.length;){const i=e.charCodeAt(s++);n?(t.push((65536+(n-55296<<10)+(i-56320)).toString(16)),n=0):55296<=i&&i<=56319?n=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(i)<0?e.replace(s,""):e);o&&((e,n,s)=>{var i;t.push({begin:s,cp:e,emoji:n,end:s+n.length,shortname:(null===(i=nu.getEmojisByAtrribute("cp")[e])||void 0===i?void 0:i.sn)||""})})(o,e,r)}))}(e),t}jl.plugins.add("converse-emoji",{initialize(){const{___:e}=va;Cl.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}}),va.EmojiPicker=Zo.extend({defaults:{current_category:"smileys",current_skintone:"",scroll_position:0}});const t={};Object.assign(nu,{shortnamesToEmojis:(e,t={unicode_only:!1,add_title_wrapper:!1})=>function(e,t){let n=[e];return[...au(e),...cu(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const s=n.shift(),i=ou(e,t);n="string"==typeof i?[s.slice(0,e.begin)+i+s.slice(e.end),...n]:[s.slice(0,e.begin),i,s.slice(e.end),...n]})),n}(e=ru(e),t),shortnamesToUnicode:e=>nu.shortnamesToEmojis(e,{unicode_only:!0})[0],isOnlyEmojis(e){const t=e.trim().split(/\s+/);return!(0===t.length||t.length>3)&&t.filter((e=>{const t=cu(nu.shortnamesToUnicode(e));return 1===t.length&&(e===t[0].shortname||e===t[0].emoji)})).length===t.length},getEmojisByAtrribute(e){if(t[e])return t[e];if("category"===e)return jl.emojis.json;const n=jl.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return t[e]={},n.forEach((n=>t[e][n]=jl.emojis.list.find((t=>t[e]===n)))),t[e]}}),Object.assign(Cl,{emojis:{async initialize(){if(!jl.emojis.initialized){jl.emojis.initialized=!0;const{default:t}=await n.e(4610).then(n.t.bind(n,7530,19));jl.emojis.json=t,jl.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),jl.emojis.list=Object.values(jl.emojis.by_sn),jl.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),jl.emojis.shortnames=jl.emojis.list.map((e=>e.sn));const s=()=>jl.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");jl.emojis.shortnames_regex=new RegExp(s(),"gi"),jl.emojis.toned=(jl.emojis.toned||(jl.emojis.toned=(e=Object.values(jl.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))),[...new Set(e)])),jl.emojis.toned),jl.emojis.initialized_promise.resolve()}var e;return jl.emojis.initialized_promise}}})}});const lu={initialize(){this.checkValidity()&&(this.get("file")&&this.on("change:put",this.uploadFile,this),this.setTimerForEphemeralMessage()||this.setOccupant(),Cl.trigger("chatRoomMessageInitialized",this))},mayBeModerated(){return["all","moderator"].includes(Cl.settings.get("allow_message_retraction"))&&this.collection.chatbox.canModerateMessages()},checkValidity(){const e=va.Message.prototype.checkValidity.call(this);return!e&&this.collection.chatbox.debouncedRejoin(),e},onOccupantRemoved(){var e;this.stopListening(this.occupant),delete this.occupant;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return M.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);this.listenTo(t.occupants,"add",this.onOccupantAdded)},onOccupantAdded(e){if(e.get("nick")===le.getResourceFromJid(this.get("from"))){var t;this.occupant=e,this.trigger("occupantAdded"),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved);const n=null==this||null===(t=this.collection)||void 0===t?void 0:t.chatbox;if(!n)return M.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);this.stopListening(n.occupants,"add",this.onOccupantAdded)}},setOccupant(){var e;if("groupchat"!==this.get("type"))return;const t=null==this||null===(e=this.collection)||void 0===e?void 0:e.chatbox;if(!t)return M.error(`Could not get collection.chatbox for message: ${JSON.stringify(this.toJSON())}`);const n=le.getResourceFromJid(this.get("from"));if(this.occupant=t.occupants.findWhere({nick:n}),!this.occupant&&Cl.settings.get("muc_send_probes")){this.occupant=t.occupants.create({nick:n,type:"unavailable"});const e=`${t.get("jid")}/${n}`;Cl.user.presence.send("probe",e)}this.occupant?this.listenTo(this.occupant,"destroy",this.onOccupantRemoved):this.listenTo(t.occupants,"add",this.onOccupantAdded)}},du={},uu=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);du.escapeCharacters=e=>t=>e.split("").reduce(uu,t),du.escapeRegexString=du.escapeCharacters("[\\^$.?*+(){}|"),du.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const hu=([e,t],n,s)=>{let i=e,{begin:r,end:o}=n;const{value:a}=n;return r-=s,o=o-s-1,i=`${i.slice(0,r)}${a}${i.slice(o+1)}`,[i,[...t,{...n,begin:r,end:o}]]};du.reduceTextFromReferences=(e,t)=>t.reduce(hu,[e,[]]);const mu=du;la.webForm2xForm=function(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?la.getSelectValues(e):e.value,la.toStanza(`\n        <field var="${t}">\n            ${n.constructor===Array?n.map((e=>`<value>${e}</value>`)):`<value>${n}</value>`}\n        </field>`)};const fu=la,gu=function(e,t){return function(e,t,n){for(var s=-1,i=e.length,r=t.length,o={};++s<i;){var a=s<r?t[s]:void 0;n(o,e[s],a)}return o}(e||[],t||[],Re)},{Strophe:pu,sizzle:vu,u:bu}=jl.env,{NS:yu}=pu;function _u(e){const t=vu(`items[node="${pu.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),s=e.getAttribute("id"),i=`item conference-info[xmlns="${pu.NS.CONFINFO}"] activity[xmlns="${pu.NS.ACTIVITY}"]`;return vu(i,t).map((t=>{var i;const r=null===(i=t.querySelector("text"))||void 0===i?void 0:i.textContent;if(r){var o;const i=ed(e),a=null===(o=t.querySelector("reason"))||void 0===o?void 0:o.textContent;return{from:n,msgid:s,message:r,reason:a,references:i,type:"info"}}return{}}))}async function wu(e,t,n){var s,i,r,o,a,c;rd(e);const l=`[xmlns="${yu.MAM}"] > forwarded[xmlns="${yu.FORWARD}"] > message`,d=e;if(e=vu(l,e).pop()||e,vu(`message > forwarded[xmlns="${pu.NS.FORWARD}"]`,e).length)return new Gl(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e);const u=vu(`delay[xmlns="${pu.NS.DELAY}"]`,d).pop(),h=e.getAttribute("from"),m=pu.unescapeNode(pu.getResourceFromJid(h)),f=od(e),g=(new Date).toISOString();let p=Object.assign({from:h,nick:m,is_forwarded:!(null===(s=e)||void 0===s||!s.querySelector("forwarded")),activities:_u(e),body:null===(i=e.querySelector("body"))||void 0===i||null===(r=i.textContent)||void 0===r?void 0:r.trim(),chat_state:sd(e),from_muc:pu.getBareJidFromJid(h),from_real_jid:null===(o=t.occupants.findOccupant({nick:m}))||void 0===o?void 0:o.get("jid"),is_archived:ld(d),is_carbon:nd(d),is_delayed:!!u,is_headline:ad(e),is_markable:!!vu(`markable[xmlns="${pu.NS.MARKERS}"]`,e).length,is_marker:!!f,is_unstyled:!!vu(`unstyled[xmlns="${pu.NS.STYLING}"]`,e).length,marker_id:f&&f.getAttribute("id"),msgid:e.getAttribute("id")||d.getAttribute("id"),receipt_id:td(e),received:(new Date).toISOString(),references:ed(e),subject:null===(a=e.querySelector("subject"))||void 0===a?void 0:a.textContent,thread:null===(c=e.querySelector("thread"))||void 0===c?void 0:c.textContent,time:u?wa()(u.getAttribute("stamp")).toISOString():g,to:e.getAttribute("to"),type:e.getAttribute("type")},Zl(e),Xl(e),Ql(e),Kl(e,d),Wl(e,d),function(e){const t=Mo()(`> apply-to[xmlns="${le.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=Mo()(`> meta[xmlns="${le.NS.XHTML}"]`,t);if(n.length){const t=Cl.settings.get("message_limit"),s=n.reduce(((e,n)=>{const s=n.getAttribute("property");if(s){let i=ca(n.getAttribute("content")||"");t&&"og:description"===s&&i.length>=t&&(i=`${i.slice(0,t)}${ca("&#8230;")}`),e[s]=i}return e}),{ogp_for_id:e});if("og:description"in s||"og:title"in s||"og:image"in s)return s}}return{}}(e),Jl(e,d),function(e){const t=vu(`apply-to[xmlns="${pu.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),s=vu(`moderated[xmlns="${pu.NS.MODERATE}"]`,t).pop();var n;if(s&&vu(`retract[xmlns="${pu.NS.RETRACT}"]`,s).pop())return{editable:!1,moderated:"retracted",moderated_by:s.getAttribute("by"),moderated_id:e,moderation_reason:null===(n=s.querySelector("reason"))||void 0===n?void 0:n.textContent}}else{const t=vu(`> moderated[xmlns="${pu.NS.MODERATE}"]`,e).pop();var s;if(t&&vu(`retracted[xmlns="${pu.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:null===(s=t.querySelector("reason"))||void 0===s?void 0:s.textContent}}return{}}(e),Vl(e,n));return await Cl.emojis.initialize(),p=Object.assign({is_only_emojis:!!p.body&&bu.isOnlyEmojis(p.body),is_valid_receipt_request:id(e,p),message:p.body||p.error,sender:p.nick===t.get("nick")?"me":"them"},p),p.is_archived&&d.getAttribute("from")!==p.from_muc?new Gl(`Invalid Stanza: Forged MAM message from ${d.getAttribute("from")}`,e):p.is_archived&&d.getAttribute("from")!==t.get("jid")?new Gl(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e):p.is_carbon?new Gl("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(p.id=p.origin_id||p[`stanza_id ${p.from_muc||p.from}`]||bu.getUniqueId(),p=await Cl.hook("parseMUCMessage",e,p),Object.assign(p,Yl(p.is_encrypted?p.plaintext:p.body)))}const{Strophe:Su,$iq:xu,u:Eu}=jl.env;async function Au(e,t){const{__:n}=va,s=xu({to:t,type:"get"}).c("query",{xmlns:Su.NS.MUC_ADMIN}).c("item",{affiliation:e}),i=await Cl.sendIQ(s,null,!1);if(null===i){const s=n("Error: timeout while fetching %1s list for MUC %2s",e,t),r=new Error(s);return M.warn(s),M.warn(i),r}if(Eu.isErrorStanza(i)){const s=n("Error: not allowed to fetch %1s list for MUC %2s",e,t),r=new Error(s);return M.warn(s),M.warn(i),r}return function(e){return vu(`query[xmlns="${pu.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");bu.isValidJID(n)?t.jid=n:t.nick=n;const s=e.getAttribute("nick");return s&&(t.nick=s),e.getAttribute("role")&&(t.role=s),t}))}(i).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function Cu(e){let t=Cl.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?oh:[]),"owner"===e.get("affiliation")?oh.filter((e=>!t.includes(e))):"admin"===e.get("affiliation")?oh.filter((e=>!["owner","admin",...t].includes(e))):[]}function Tu(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>ku(n,e,t))))}function ku(e,t,n){return Array.isArray(t)||(t=[t]),n=n.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,s)=>[...t,...n.map((t=>function(e,t,n){const s=xu({to:t,type:"set"}).c("query",{xmlns:Su.NS.MUC_ADMIN}).c("item",{affiliation:n.affiliation||e,nick:n.nick,jid:n.jid});return void 0!==n.reason&&s.c("reason",n.reason),Cl.sendIQ(s)}(e,s,t)))]),[]))}function ju(e,t,n,s){const i=n.map((e=>e.jid)),r=s.map((e=>e.jid));let o=za(i,r).map((e=>n[Va(i,e)]));return e||(o=o.concat(n.filter((e=>{const t=Va(r,e.jid);return t>=0&&e.affiliation!==s[t].affiliation})))),t&&(o=o.concat(za(r,i).map((e=>({jid:e,affiliation:"none"}))))),o}va.getAssignableAffiliations=Cu;const Nu=["owner"],Ou=["admin","ban","deop","destroy","member","op","revoke"],$u=["kick","mute","voice","modtools"],Iu=["nick"],Mu=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],Ru=["301","303","333","307","321","322"],Du=Zo.extend({defaults:()=>({connection_status:jl.ROOMSTATUS.DISCONNECTED})}),Lu={defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:va.isUniView()&&!Cl.settings.get("singleton"),hidden_occupants:!!Cl.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:va.CHATROOMS_TYPE}},async initialize(){this.initialized=ji(),this.debouncedRejoin=hc(this.rejoin,250),this.set("box_id",`box-${this.get("jid")}`),this.initNotifications(),this.initMessages(),this.initUI(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage),await this.restoreFromCache()||this.join(),await Cl.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()},async restoreFromCache(){return this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED&&await this.isJoined()?(await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchOccupants().catch((e=>M.error(e))),await this.fetchMessages().catch((e=>M.error(e))),!0):(this.session.save("connection_status",jl.ROOMSTATUS.DISCONNECTED),this.clearOccupantsCache(),!1)},async join(e,t){return this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED?this:(this.session.save("connection_status",jl.ROOMSTATUS.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?(Cl.send(await this.constructPresence(t)),this):(fu.safeSave(this.session,{connection_status:jl.ROOMSTATUS.NICKNAME_REQUIRED}),Cl.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))},rejoin(){return this.session.save("connection_status",jl.ROOMSTATUS.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()},async constructPresence(e){let t=ce({from:va.connection.jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:le.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:Cl.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(le.xmlElement("password",[],e)),t=await Cl.hook("constructedMUCPresence",null,t),t},clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()},sendMarkerForMessage(e,t="displayed",n=!1){if(e&&Cl.settings.get("send_chat_markers").includes(t)&&(null!=e&&e.get("is_markable")||n)){const n=`stanza_id ${this.get("jid")}`,s=e.get(n);if(!s)return void M.error(`Can't send marker for message without stanza ID: ${n}`);$l(le.getBareJidFromJid(e.get("from")),s,t,e.get("type"))}},enableRAI(){if(Cl.settings.get("muc_subscribe_to_rai")){const e=le.getDomainFromJid(this.get("jid"));Cl.user.presence.send(null,e,null,re("rai",{xmlns:le.NS.RAI}))}},async onHiddenChange(){const e=this.session.get("connection_status");this.get("hidden")?e===jl.ROOMSTATUS.ENTERED&&Cl.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()&&(e!==jl.ROOMSTATUS.DISCONNECTED&&(this.sendMarkerForLastMessage("received",!0),await this.leave()),this.enableRAI()):(e===jl.ROOMSTATUS.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())},onOccupantAdded(e){va.isInfoVisible(jl.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),jl.MUC_TRAFFIC_STATES.ENTERED)},onOccupantRemoved(e){va.isInfoVisible(jl.MUC_TRAFFIC_STATES.EXITED)&&this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),jl.MUC_TRAFFIC_STATES.EXITED)},onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&va.isInfoVisible(jl.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),jl.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&va.isInfoVisible(jl.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),jl.MUC_TRAFFIC_STATES.ENTERED))},async onRoomEntered(){await this.occupants.fetchMembers(),Cl.settings.get("clear_messages_on_reconnection")?(await this.messages.clearStore(),this.messages.fetched.resolve()):await this.fetchMessages(),Cl.trigger("enteredNewRoom",this),Cl.settings.get("auto_register_muc_nickname")&&await Cl.disco.supports(le.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()},async onConnectionStatusChanged(){this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED&&(this.get("hidden")&&Cl.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()?(await this.leave(),this.enableRAI()):await this.onRoomEntered())},async onReconnection(){await this.rejoin(),this.announceReconnection()},getMessagesCollection:()=>new va.ChatRoomMessages,restoreSession(){const e=`muc.session-${va.bare_jid}-${this.get("jid")}`;return this.session=new Du({id:e}),_o(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))},initDiscoModels(){let e=`converse.muc-features-${va.bare_jid}-${this.get("jid")}`;this.features=new Zo(Object.assign({id:e},gu(jl.ROOM_FEATURES,jl.ROOM_FEATURES.map((()=>!1))))),this.features.browserStorage=va.createStore(e,"session"),this.features.listenTo(va,"beforeLogout",(()=>this.features.browserStorage.flush())),e=`converse.muc-config-{_converse.bare_jid}-${this.get("jid")}`,this.config=new Zo,this.config.browserStorage=va.createStore(e,"session"),this.config.listenTo(va,"beforeLogout",(()=>this.config.browserStorage.flush()))},initOccupants(){this.occupants=new va.ChatRoomOccupants;const e=`converse.occupants-${va.bare_jid}${this.get("jid")}`;this.occupants.browserStorage=va.createStore(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(va,"beforeLogout",(()=>this.occupants.browserStorage.flush()))},fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched},handleAffiliationChangedMessage(e){const t=Mo()(`x[xmlns="${le.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),s=e.getAttribute("type"),i=t.getAttribute("affiliation"),r=t.getAttribute("jid"),o={from:n,type:s,affiliation:i,states:[],show:"unavailable"==s?"offline":"online",role:t.getAttribute("role"),jid:le.getBareJidFromJid(r),resource:le.getResourceFromJid(r)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}},async handleErrorMessageStanza(e){const{__:t}=va,n=await wu(e,this,va);if(!await this.shouldShowErrorMessage(n))return;const s=this.getMessageReferencedByError(n);if(s){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===s.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===n.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===n.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),s.save(e)}else this.createMessage(n)},handleMessageFromMUCHost(e){if(this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED)return;const t=Mo()(`rai[xmlns="${le.NS.RAI}"]`,e).pop();Array.from((null==t?void 0:t.querySelectorAll("activity"))||[]).map((e=>e.textContent)).includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})},handleForwardedMentions(e){if(this.session.get("connection_status")===jl.ROOMSTATUS.ENTERED)return;const t=Mo()(`mentions[xmlns="${le.NS.MENTIONS}"] forwarded[xmlns="${le.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),s=t.filter((e=>le.getBareJidFromJid(e.getAttribute("from"))===n));s.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+s.length}),s.forEach((async e=>{const t={stanza:e,attrs:await wu(e,this,va),chatbox:this};Cl.trigger("message",t)})))},async handleMessageStanza(e){const t=e.getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(ld(e))return M.warn('Received a MAM message with type "groupchat"');this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e)}else if(!t)return this.handleForwardedMentions(e);let n;try{n=await wu(e,this,va)}catch(e){return M.error(e.message)}const s={stanza:e,attrs:n,chatbox:this};return Cl.trigger("message",s),n&&this.queueMessage(n)},registerHandlers(){const e=this.get("jid"),t=le.getDomainFromJid(e);this.removeHandlers(),this.presence_handler=va.connection.addHandler((e=>this.onPresence(e)||!0),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=va.connection.addHandler((e=>this.onPresenceFromMUCHost(e)||!0),null,"presence",null,null,t),this.message_handler=va.connection.addHandler((e=>!!this.handleMessageStanza(e)||!0),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=va.connection.addHandler((e=>this.handleMessageFromMUCHost(e)||!0),null,"message",null,null,t),this.affiliation_message_handler=va.connection.addHandler((e=>this.handleAffiliationChangedMessage(e)||!0),le.NS.MUC_USER,"message",null,null,e)},removeHandlers(){return this.message_handler&&(va.connection&&va.connection.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(va.connection&&va.connection.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(va.connection&&va.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(va.connection&&va.connection.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(va.connection&&va.connection.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this},invitesAllowed(){return Cl.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())},getDisplayName(){return this.get("name")||("hidden"===Cl.settings.get("locked_muc_domain")?le.getNodeFromJid(this.get("jid")):this.get("jid"))},sendTimedMessage(e){"function"==typeof e.tree&&(e=e.tree());let t=e.getAttribute("id");t||(t=this.getUniqueId("sendIQ"),e.setAttribute("id",t));const n=ji(),s=va.connection.addTimedHandler(va.STANZA_TIMEOUT,(()=>{va.connection.deleteHandler(i);const e=new va.TimeoutError("Timeout Error: No response from server");return n.resolve(e),!1})),i=va.connection.addHandler((e=>{s&&va.connection.deleteTimedHandler(s),n.resolve(e)}),null,"message",["error","groupchat"],t);return Cl.send(e),n},async retractOwnMessage(e){const t=va.__,n=e.get("origin_id");if(!n)throw new Error("Can't retract message without a XEP-0359 Origin ID");const s=e.get("editable"),i=oe({id:fu.getUniqueId(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:le.NS.HINTS}).up().c("apply-to",{id:n,xmlns:le.NS.FASTEN}).c("retract",{xmlns:le.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:n,retraction_id:i.nodeTree.getAttribute("id"),editable:!1});const r=await this.sendTimedMessage(i);fu.isErrorStanza(r)?M.error(r):r instanceof va.TimeoutError&&(M.error(r),e.save({editable:s,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))},async retractOtherMessage(e,t){const n=e.get("editable");e.save({moderated:"retracted",moderated_by:va.bare_jid,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const s=await this.sendRetractionIQ(e,t);return(null===s||fu.isErrorStanza(s))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),s},sendRetractionIQ(e,t){const n=ae({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:le.NS.FASTEN}).c("moderate",{xmlns:le.NS.MODERATE}).c("retract",{xmlns:le.NS.RETRACT}).up().c("reason").t(t||"");return Cl.sendIQ(n,null,!1)},sendDestroyIQ(e,t){const n=re("destroy");t&&n.attrs({jid:t});const s=ae({to:this.get("jid"),type:"set"}).c("query",{xmlns:le.NS.MUC_OWNER}).cnode(n.node);return e&&e.length>0&&s.c("reason",e),Cl.sendIQ(s)},async leave(e){var t;this.features.destroy();const n=null===(t=va.disco_entities)||void 0===t?void 0:t.get(this.get("jid"));n&&await new Promise(((e,t)=>n.destroy({success:e,error:t}))),Cl.connection.connected()&&Cl.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),fu.safeSave(this.session,{connection_status:jl.ROOMSTATUS.DISCONNECTED})},async close(e){return await this.leave(),"unregister"===Cl.settings.get("auto_register_muc_nickname")&&await Cl.disco.supports(le.NS.MUC_REGISTER,this.get("jid"))&&this.unregisterNickname(),this.occupants.clearStore(),"closeAllChatBoxes"!==(null==e?void 0:e.name)&&Cl.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{M.error(n),e()}}))),await new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{M.error(n),e()}}))),va.ChatBox.prototype.close.call(this)},canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&Cl.disco.supports(le.NS.MODERATE,this.get("jid"))},getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))},getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>mu.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")},getOccupantByJID(e){return this.occupants.findOccupant({jid:e})},getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})},parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=mu.findFirstMatchInArray(this.getAllKnownNicknames()),n=e=>{const t=this.get("jid"),n=this.getOccupant(e)||this.getOccupant(t),s=this.features.get("nonanonymous")&&(null==n?void 0:n.get("jid"))||`${t}/${e}`;return encodeURI(`xmpp:${s}`)},s=this.getAllKnownNicknamesRegex(),i=[...e.matchAll(s)].filter((e=>!e[0].startsWith("/"))).map((e=>{let s=e[0].indexOf("@");"@"===e[0][s+1]&&(s+=1);const i=e.index+s,r=i+e[0].length-s,o=t(e[1]);return{begin:i,end:r,value:o,type:"mention",uri:n(o)}})),[r,o]=mu.reduceTextFromReferences(e,i);return[r,o]},getOutgoingMessageAttributes(e){const t=this.get("composing_spoiler");let n,s="";null!=e&&e.body&&([s,n]=this.parseTextForReferences(e.body));const i=fu.getUniqueId(),r=s?fu.httpToGeoUri(fu.shortnamesToUnicode(s),va):void 0;return Object.assign({},e,{body:r,is_spoiler:t,origin_id:i,references:n,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),is_only_emojis:!!s&&fu.isOnlyEmojis(s),message:r,nick:this.get("nick"),sender:"me",type:"groupchat"},Yl(s))},getRoomJIDAndNick(){const e=this.get("nick");return le.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")},sendChatState(){if(!Cl.settings.get("send_chat_state_notifications")||!this.get("chat_state")||this.session.get("connection_status")!==jl.ROOMSTATUS.ENTERED||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=Cl.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==va.GONE&&Cl.send(oe({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:le.NS.CHATSTATES}).up().c("no-store",{xmlns:le.NS.HINTS}).up().c("no-permanent-store",{xmlns:le.NS.HINTS}))},directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(n.reason=t),this.get("password")&&(n.password=this.get("password"));const s=oe({from:va.connection.jid,to:e,id:fu.getUniqueId()}).c("x",n);Cl.send(s),Cl.trigger("roomInviteSent",{room:this,recipient:e,reason:t})},refreshDiscoInfo(){return Cl.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>M.error(e)))},getDiscoInfo(){return Cl.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:null==e?void 0:e.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>M.error(e)))},async getDiscoInfoFields(){const e=(await Cl.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return n&&n.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)},async getDiscoInfoFeatures(){const e=await Cl.disco.getFeatures(this.get("jid")),t=Object.assign(gu(jl.ROOM_FEATURES,jl.ROOM_FEATURES.map((()=>!1))),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===le.NS.MAM&&(t.mam_enabled=!0)})),this.features.save(t)},addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),s=this.get("roomconfig");if(n in s){let i;switch(t){case"boolean":i=[s[n]?1:0];break;case"list-multi":i=s[n];break;default:i=[s[n]]}e.innerHTML=i.map((e=>re("value").t(e))).join("")}return e},async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=Mo()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)},fetchRoomConfiguration(){return Cl.sendIQ(ae({to:this.get("jid"),type:"get"}).c("query",{xmlns:le.NS.MUC_OWNER}))},sendConfiguration(e=[]){const t=ae({to:this.get("jid"),type:"set"}).c("query",{xmlns:le.NS.MUC_OWNER}).c("x",{xmlns:le.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),Cl.sendIQ(t)},onCommandError(e){const{__:t}=va;M.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})},getNickOrJIDFromCommandArgs(e){const{__:t}=va;if(fu.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const[n,s]=this.parseTextForReferences(e);if(!s.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(s.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const i=s.pop().value,r=e.split(i,2)[1];if(!r||r.startsWith(" "))return i;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}},validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=va;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0},getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=this.occupants.findWhere({jid:va.bare_jid});return this.verifyAffiliations(["owner"],t,!1)?e=e.concat(Nu).concat(Ou):this.verifyAffiliations(["admin"],t,!1)&&(e=e.concat(Ou)),this.verifyRoles(["moderator"],t,!1)?e=e.concat($u).concat(Iu):this.verifyRoles(["visitor","participant","moderator"],t,!1)||(e=e.concat(Iu)),e.sort(),Array.isArray(Cl.settings.get("muc_disable_slash_commands"))?e.filter((e=>!Cl.settings.get("muc_disable_slash_commands").includes(e))):e},verifyAffiliations(e,t,n=!0){const{__:s}=va;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:va.bare_jid})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=s("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1},verifyRoles(e,t,n=!0){const{__:s}=va;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:va.bare_jid})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=s("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error"})}return!1},getOwnRole(){var e,t;return null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.role},getOwnAffiliation(){var e,t;return(null===(e=this.getOwnOccupant())||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.affiliation)||"none"},getOwnOccupant(){return this.occupants.findWhere({jid:va.bare_jid})},setRole(e,t,n,s,i){const r=re("item",{nick:e.get("nick"),role:t}),o=ae({to:this.get("jid"),type:"set"}).c("query",{xmlns:le.NS.MUC_ADMIN}).cnode(r.node);return null!==n&&o.c("reason",n),Cl.sendIQ(o).then(s).catch(i)},getOccupant(e){return fu.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)},getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))},getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))},getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))},async updateMemberLists(e){const t=this.get("jid"),n=(await Promise.all(["member","admin","owner"].map((e=>Au(e,t))))).reduce(((e,t)=>fu.isErrorObject(t)?e:[...t,...e]),[]);await Tu(t,ju(!0,!1,e,n)),await this.occupants.fetchMembers()},async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||va.getDefaultMUCNickname())&&this.save({nick:e},{silent:!0}),e},async getReservedNick(){const e=ae({to:this.get("jid"),from:va.connection.jid,type:"get"}).c("query",{xmlns:le.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await Cl.sendIQ(e,null,!1);if(fu.isErrorObject(t))throw t;const n=null==t?void 0:t.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null},async registerNickname(){const{__:e}=va,t=this.get("nick"),n=this.get("jid");let s,i;try{s=await Cl.sendIQ(ae({to:n,type:"get"}).c("query",{xmlns:le.NS.MUC_REGISTER}))}catch(t){return Mo()(`not-allowed[xmlns="${le.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):Mo()(`registration-required[xmlns="${le.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),M.error(t),i}const r=Mo()("field required",s).map((e=>e.parentElement));if(r.length>1&&"muc#register_roomnick"!==r[0].getAttribute("var"))return M.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{await Cl.sendIQ(ae({to:n,type:"set"}).c("query",{xmlns:le.NS.MUC_REGISTER}).c("x",{xmlns:le.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return Mo()(`service-unavailable[xmlns="${le.NS.STANZAS}"]`,t).length?i=e("Can't register your nickname in this groupchat, it doesn't support registration."):Mo()(`bad-request[xmlns="${le.NS.STANZAS}"]`,t).length&&(i=e("Can't register your nickname in this groupchat, invalid data form supplied.")),M.error(i),M.error(t),i}},unregisterNickname(){const e=ae({to:this.get("jid"),type:"set"}).c("query",{xmlns:le.NS.MUC_REGISTER}).c("remove");return Cl.sendIQ(e).catch((e=>M.error(e)))},updateOccupantsOnPresence(e){var t,n;const s=function(e){const t=e.getAttribute("from"),n=e.getAttribute("type"),s={from:t,nick:pu.getResourceFromJid(t),type:n,states:[],hats:[],show:"unavailable"!==n?"online":"offline"};return Array.from(e.children).forEach((e=>{if(e.matches("status"))s.status=e.textContent||null;else if(e.matches("show"))s.show=e.textContent||"online";else if(e.matches("x")&&e.getAttribute("xmlns")===pu.NS.MUC_USER)Array.from(e.children).forEach((e=>{"item"===e.nodeName?(s.affiliation=e.getAttribute("affiliation"),s.role=e.getAttribute("role"),s.jid=e.getAttribute("jid"),s.nick=e.getAttribute("nick")||s.nick):"status"==e.nodeName&&e.getAttribute("code")&&s.states.push(e.getAttribute("code"))}));else if(e.matches("x")&&e.getAttribute("xmlns")===pu.NS.VCARDUPDATE){var t;s.image_hash=null===(t=e.querySelector("photo"))||void 0===t?void 0:t.textContent}else e.matches("hats")&&e.getAttribute("xmlns")===pu.NS.MUC_HATS&&(s.hats=Array.from(e.children).map((e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")})))})),s}(e);if("error"===s.type||!s.jid&&!s.nick)return!0;const i=this.occupants.findOccupant(s);if("unavailable"===s.type&&i&&!s.states.includes(jl.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(s.affiliation))return i.set(s),void i.destroy();const r=s.jid||"",o=Object.assign(s,{jid:le.getBareJidFromJid(r)||(null==i||null===(t=i.attributes)||void 0===t?void 0:t.jid),resource:le.getResourceFromJid(r)||(null==i||null===(n=i.attributes)||void 0===n?void 0:n.resource)});i?i.save(o):this.occupants.create(o)},fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];Mo()("status",e).filter((e=>t.includes(e.getAttribute("status")))).length&&this.refreshDiscoInfo()},isSameUser(e,t){const n=le.getBareJidFromJid(e),s=le.getBareJidFromJid(t),i=le.getResourceFromJid(e),r=le.getResourceFromJid(t);return fu.isSameBareJID(e,t)?n!==this.get("jid")||i===r:(n===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:n}))===(s===this.get("jid")?this.occupants.findOccupant({nick:r}):this.occupants.findOccupant({jid:s}))},async isSubjectHidden(){return(await Cl.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))},async toggleSubjectHiddenState(){const e=this.get("jid"),t=await Cl.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?Cl.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):Cl.user.settings.set("mucs_with_hidden_subject",[...t,e])},async handleSubjectChange(e){const t=va.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,s=e.nick;if(fu.safeSave(this,{subject:{author:s,text:e.subject||""}}),!e.is_delayed&&s){const i=t(n?"Topic set by %1$s":"Topic cleared by %1$s",s),r=this.messages.last();(null==r?void 0:r.get("nick"))===e.nick&&"info"===(null==r?void 0:r.get("type"))&&(null==r?void 0:r.get("message"))===i||this.createMessage({message:i,nick:e.nick,type:"info"}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1},setSubject(e=""){Cl.send(oe({to:this.get("jid"),from:va.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())},ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))},isOwnMessage(e){let t;return t=T(e)?e.getAttribute("from"):e instanceof va.Message?e.get("from"):e.from,le.getResourceFromJid(t)==this.get("nick")},getUpdatedMessageAttributes(e,t){const n=va.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t);if(this.isOwnMessage(t)){const s=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,ko(t,s)),e.get("received")||(n.received=(new Date).toISOString())}return n},async isJoined(){const e=this.get("jid"),t=ae({to:`${e}/${this.get("nick")}`,type:"get"}).c("ping",{xmlns:le.NS.PING});try{await Cl.sendIQ(t)}catch(t){return null===t?M.warn(`isJoined: Timeout error while checking whether we're joined to MUC: ${e}`):M.warn(`isJoined: Apparently we're no longer connected to MUC: ${e}`),!1}return!0},async rejoinIfNecessary(){if(!await this.isJoined())return this.rejoin(),!0},async shouldShowErrorMessage(e){return("not-acceptable"!==e.error_condition||!await this.rejoinIfNecessary())&&va.ChatBox.prototype.shouldShowErrorMessage.call(this,e)},findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===n&&e.moderated_by))):null}},async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const s=this.messages.findWhere(n);return s?(s.save(ko(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const s=ko(n.attributes,t),i=Object.assign({dangling_moderation:!1},e,s);return delete i.id,n.save(i),!0}}return!1},getNotificationsText(){const{__:e}=va,t=this.notifications.toJSON(),n=Cl.settings.get("muc_show_info_messages").filter((e=>jl.MUC_ROLE_CHANGES_LIST.includes(e))),s=Cl.settings.get("muc_show_info_messages").filter((e=>jl.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...jl.CHAT_STATES,...s,...n].reduce(((n,s)=>{const i=t[s];if(null==i||!i.length)return n;const r=i.map((e=>{var t;return(null===(t=this.getOccupant(e))||void 0===t?void 0:t.getDisplayName())||e}));if(1===r.length){if("composing"===s)return`${n}${e("%1$s is typing",r[0])}\n`;if("paused"===s)return`${n}${e("%1$s has stopped typing",r[0])}\n`;if(s===va.GONE)return`${n}${e("%1$s has gone away",r[0])}\n`;if("entered"===s)return`${n}${e("%1$s has entered the groupchat",r[0])}\n`;if("exited"===s)return`${n}${e("%1$s has left the groupchat",r[0])}\n`;if("op"===s)return`${n}${e("%1$s is now a moderator",r[0])}\n`;if("deop"===s)return`${n}${e("%1$s is no longer a moderator",r[0])}\n`;if("voice"===s)return`${n}${e("%1$s has been given a voice",r[0])}\n`;if("mute"===s)return`${n}${e("%1$s has been muted",r[0])}\n`}else if(r.length>1){let t;if(r.length>3)t=`${Array.from(r).slice(0,2).join(", ")} and others`;else{const n=r.pop();t=e("%1$s and %2$s",r.join(", "),n)}if("composing"===s)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===s)return`${n}${e("%1$s have stopped typing",t)}\n`;if(s===va.GONE)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===s)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===s)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===s)return`${n}${e("%1$s are now moderators",r[0])}\n`;if("deop"===s)return`${n}${e("%1$s are no longer moderators",r[0])}\n`;if("voice"===s)return`${n}${e("%1$s have been given voices",r[0])}\n`;if("mute"===s)return`${n}${e("%1$s have been muted",r[0])}\n`}return n}),"")},removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const s=Array.from(n[t]||[]);if(s.includes(e)){const n=s.indexOf(e);s.splice(n,1),this.notifications.set(t,Array.from(s))}}))},updateNotifications(e,t){const n=this.notifications.toJSON(),s=n[t]||[];if(s.includes(e))return;const i=(i,r)=>(i[r]=r===t?[...s,e]:(n[r]||[]).filter((t=>t!==e)),i),r=jl.CHAT_STATES.reduce(i,{}),o=jl.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=jl.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(r,o,a)),window.setTimeout((()=>this.removeNotification(e,t)),1e4)},handleMetadataFastening(e){if(!Cl.settings.get("muc_show_ogp_unfurls"))return!1;if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const s=[...n,ko(e,Mu)];return t.save("ogp_metadata",s),!0}}return!1},handleMEPNotification(e){var t;return!(e.from!==this.get("jid")||!e.activities||(null===(t=e.activities)||void 0===t||t.forEach((t=>{const n=Object.assign({msgid:e.msgid,from_muc:e.from},t);this.createMessage(n),Cl.trigger("message",{attrs:n,chatbox:this})})),!e.activities.length))},getDuplicateMessage(e){var t;return null!==(t=e.activities)&&void 0!==t&&t.length?this.messages.findWhere({type:"info",msgid:e.msgid}):va.ChatBox.prototype.getDuplicateMessage.call(this,e)},async onMessage(e){if(e=await e,fu.isErrorObject(e))return e.stanza&&M.error(e.stanza),M.error(e.message);const t=this.getDuplicateMessage(e);if(t)"groupchat"===t.get("type")&&this.updateMessage(t,e);else if(!(e.is_valid_receipt_request||e.is_marker||this.ignorableCSN(e)))if(this.handleMetadataFastening(e)||this.handleMEPNotification(e)||await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))e.nick&&this.removeNotification(e.nick,["composing","paused"]);else if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),fu.shouldCreateGroupchatMessage(e)){const t=this.handleCorrection(e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.handleUnreadMessage(t)}},handleModifyError(e){var t;const n=null===(t=e.querySelector("error text"))||void 0===t?void 0:t.textContent;if(n)if(this.session.get("connection_status")===jl.ROOMSTATUS.CONNECTING)this.setDisconnectionState(n);else{const e={type:"error",message:n,is_ephemeral:!0};this.createMessage(e)}},handleDisconnection(e){var t;const n=null!==e.querySelector("status[code='110']"),s=Mo()(`x[xmlns="${le.NS.MUC_USER}"]`,e).pop();if(!s)return;const i=Object.keys(va.muc.disconnect_messages),r=Mo()("status",s).map((e=>e.getAttribute("code"))).filter((e=>i.includes(e)));if(!(n&&r.length>0))return;const o=s.querySelector("item"),a=o?null===(t=o.querySelector("reason"))||void 0===t?void 0:t.textContent:void 0,c=o?xa(o.querySelector("actor"),"getAttribute","nick"):void 0,l=va.muc.disconnect_messages[r[0]],d=r.includes("301")?jl.ROOMSTATUS.BANNED:jl.ROOMSTATUS.DISCONNECTED;this.setDisconnectionState(l,a,c,d)},getActionInfoMessage(e,t,n){const s=va.__;return"301"===e?n?s("%1$s has been banned by %2$s",t,n):s("%1$s has been banned",t):"303"===e?s("%1$s's nickname has changed",t):"307"===e?n?s("%1$s has been kicked out by %2$s",t,n):s("%1$s has been kicked out",t):"321"===e?s("%1$s has been removed because of an affiliation change",t):"322"===e?s("%1$s has been removed for not being a member",t):void 0},createAffiliationChangeMessage(e){const t=va.__,n=e._previousAttributes.affiliation;if(!n)return;const s=e.get("affiliation");"admin"===n&&va.isInfoVisible(jl.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&va.isInfoVisible(jl.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&va.isInfoVisible(jl.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===s&&"member"===n&&va.isInfoVisible(jl.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===s&&va.isInfoVisible(jl.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===s&&va.isInfoVisible(jl.AFFILIATION_CHANGES.ADMIN)||"owner"==s&&va.isInfoVisible(jl.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),s)})},createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&va.isInfoVisible(jl.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),jl.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&va.isInfoVisible(jl.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),jl.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&va.isInfoVisible(jl.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),jl.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&va.isInfoVisible(jl.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),jl.MUC_ROLE_CHANGES.OP)},createInfoMessage(e,t,n){const s=va.__,i={type:"info"};if(va.isInfoVisible(e)&&"110"!==e&&("100"!==e||n)){if(e in va.muc.info_messages)i.message=va.muc.info_messages[e];else if(!n&&Ru.includes(e)){var r,o;const n=le.getResourceFromJid(t.getAttribute("from")),s=Mo()(`x[xmlns="${le.NS.MUC_USER}"] item`,t).pop();i.actor=s?null===(r=s.querySelector("actor"))||void 0===r?void 0:r.getAttribute("nick"):void 0,i.reason=s?null===(o=s.querySelector("reason"))||void 0===o?void 0:o.textContent:void 0,i.message=this.getActionInfoMessage(e,n,i.actor)}else if(n&&e in va.muc.new_nickname_messages){let r;n&&"210"===e?r=le.getResourceFromJid(t.getAttribute("from")):n&&"303"===e&&(r=Mo()(`x[xmlns="${le.NS.MUC_USER}"] item`,t).pop().getAttribute("nick")),this.save("nick",r),i.message=s(va.muc.new_nickname_messages[e],r)}if(i.message){if("201"===e&&this.messages.findWhere(i))return;if(e in va.muc.info_messages&&this.messages.length&&this.messages.pop().get("message")===i.message)return;this.createMessage(i)}}},createInfoMessages(e){const t=Mo()(`x[xmlns="${le.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code")));t.includes("333")&&t.includes("307")&&t.splice(t.indexOf("307"),1);const n=t.includes("110");t.forEach((t=>this.createInfoMessage(t,e,n)))},setDisconnectionState(e,t,n,s=jl.ROOMSTATUS.DISCONNECTED){this.session.save({connection_status:s,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})},onNicknameClash(e){const t=va.__;if(Cl.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===va.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:jl.ROOMSTATUS.NICKNAME_REQUIRED})},onErrorPresence(e){var t;const n=va.__,s=e.querySelector("error"),i=s.getAttribute("type"),r=null===(t=Mo()(`text[xmlns="${le.NS.STANZAS}"]`,s).pop())||void 0===t?void 0:t.textContent;if("modify"===i)this.handleModifyError(e);else if("auth"===i)if(Mo()(`not-authorized[xmlns="${le.NS.STANZAS}"]`,s).length&&(this.save({password_validation_message:r||n("Password incorrect")}),this.session.save({connection_status:jl.ROOMSTATUS.PASSWORD_REQUIRED})),s.querySelector("registration-required")){const e=n("You are not on the member list of this groupchat.");this.setDisconnectionState(e,r)}else s.querySelector("forbidden")&&this.setDisconnectionState(va.muc.disconnect_messages[301],r,null,jl.ROOMSTATUS.BANNED);else if("cancel"===i)if(s.querySelector("not-allowed")){const e=n("You are not allowed to create new groupchats.");this.setDisconnectionState(e,r)}else if(s.querySelector("not-acceptable")){const e=n("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,r)}else if(Mo()(`gone[xmlns="${le.NS.STANZAS}"]`,s).length){var o;const e=null===(o=Mo()(`gone[xmlns="${le.NS.STANZAS}"]`,s).pop())||void 0===o?void 0:o.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:r}),this.session.save({connection_status:jl.ROOMSTATUS.DESTROYED})}else if(s.querySelector("conflict"))this.onNicknameClash(e);else if(s.querySelector("item-not-found")){const e=n("This groupchat does not (yet) exist.");this.setDisconnectionState(e,r)}else if(s.querySelector("service-unavailable")){const e=n("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,r)}else if(s.querySelector("remote-server-not-found")){const e=n("Remote server not found"),t=r?n('The explanation given is: "%1$s".',r):void 0;this.setDisconnectionState(e,t)}},onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===(null==t?void 0:t.getAttribute("type"))&&null!=t&&t.querySelector("resource-constraint")&&this.session.get("connection_status")===jl.ROOMSTATUS.DISCONNECTED&&this.rejoin()}},onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===jl.ROOMSTATUS.CONNECTING&&this.session.save("connection_status",jl.ROOMSTATUS.CONNECTED)):this.updateOccupantsOnPresence(e)},async onOwnPresence(e){await this.occupants.fetched;const t=this.session.get("connection_status");if("unavailable"!==e.getAttribute("type")&&t!==jl.ROOMSTATUS.ENTERED?(this.session.save("connection_status",jl.ROOMSTATUS.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e),"unavailable"!==e.getAttribute("type")){if(e.querySelector("status[code='201']"))if(this.get("auto_configure"))this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo()));else{if(!Cl.settings.get("muc_instant_rooms"))return void this.session.save({view:jl.MUC.VIEWS.CONFIG});this.sendConfiguration().then((()=>this.refreshDiscoInfo()))}else this.features.get("fetched")||("owner"===this.getOwnAffiliation()&&this.get("auto_configure")?this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):this.getDiscoInfo());this.session.save({connection_status:jl.ROOMSTATUS.ENTERED})}else this.handleDisconnection(e)},isUserMentioned(e){const t=this.get("nick");return e.get("references").length?e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t):new RegExp(`\\b${t}\\b`).test(e.get("message"))},incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)},clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&this.sendMarkerForMessage(this.messages.last()),fu.safeSave(this,{has_activity:!1,num_unread:0,num_unread_general:0})}},zu=Zo.extend({defaults:{hats:[],show:"offline",states:[]},initialize(e){this.set(Object.assign({id:fu.getUniqueId()},e)),this.on("change:image_hash",this.onAvatarChanged,this)},onAvatarChanged(){const e=this.get("image_hash"),t=[];this.get("jid")&&t.push(va.vcards.findWhere({jid:this.get("jid")})),t.push(va.vcards.findWhere({jid:this.get("from")})),t.filter((e=>e)).forEach((t=>{e&&t.get("image_hash")!==e&&Cl.vcard.update(t,!0)}))},getDisplayName(){return this.get("nick")||this.get("jid")},isMember(){return["admin","owner","member"].includes(this.get("affiliation"))},isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")},isSelf(){return this.get("states").includes("110")}}),Pu={moderator:1,participant:2,visitor:3,none:2},Fu=tc.extend({model:zu,comparator(e,t){const n=e.get("role")||"none",s=t.get("role")||"none";if(Pu[n]===Pu[s]){const n=e.getDisplayName().toLowerCase(),s=t.getDisplayName().toLowerCase();return n<s?-1:n>s?1:0}return Pu[n]<Pu[s]?-1:1},getAutoFetchedAffiliationLists(){const e=Cl.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]},async fetchMembers(){const e=this.getAutoFetchedAffiliationLists();if(0===e.length)return;const t=this.chatroom.get("jid"),n=await Promise.all(e.map((e=>Au(e,t)))),s=n.reduce(((e,t)=>fu.isErrorObject(t)?e:[...t,...e]),[]),i=e.filter((t=>!fu.isErrorObject(n[e.indexOf(t)]))),r=s.map((e=>e.jid)).filter((e=>void 0!==e)),o=s.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e));this.filter((e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!r.includes(e.get("jid")))).forEach((e=>{e.get("jid")!==va.bare_jid&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),s.forEach((e=>{const t=e.jid?this.findOccupant({jid:e.jid}):this.findOccupant({nick:e.nick});t?t.save(e):this.create(e)})),Cl.trigger("membersFetched")},findOccupant(e){const t=le.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||this.findWhere({nick:e.nick})}}),Uu={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],Tu(e=Array.isArray(e)?e:[e],t))}},Bu={rooms:{create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&Cl.settings.get("muc_nickname_from_jid")&&(t.nick=le.getNodeFromJid(va.bare_jid)),void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?Cl.rooms.get(fu.getJIDFromURI(e),t,!0):e.map((e=>Cl.rooms.get(fu.getJIDFromURI(e),t,!0)))},async open(e,t={},n=!1){if(await Cl.waitUntil("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw M.error(e),new TypeError(e)}if("string"==typeof e){const s=await Cl.rooms.get(e,t,!0);return!t.hidden&&(null==s||s.maybeShow(n)),s}{const s=await Promise.all(e.map((e=>Cl.rooms.get(e,t,!0))));return s.forEach((e=>!t.hidden&&e.maybeShow(n))),s}},async get(e,t={},n=!1){async function s(e){e=fu.getJIDFromURI(e);let s=await Cl.chatboxes.get(e);return!s&&n?s=await Cl.chatboxes.create(e,t,va.ChatRoom):(s=s&&s.get("type")===va.CHATROOMS_TYPE?s:null,s&&Object.keys(t).length&&s.save(t)),s}return await Cl.waitUntil("chatBoxesFetched"),void 0===e?(await Cl.chatboxes.get()).filter((e=>e.get("type")===va.CHATROOMS_TYPE)):"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}}},{Strophe:qu,sizzle:Hu,u:Gu}=jl.env;function Wu(e){let t=Cl.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?rh:[]),"moderator"===e.get("role")?rh.filter((e=>!t.includes(e))):[]}function Vu(){va.connection.addHandler((e=>(va.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function Ju(){return va.chatboxes.filter((e=>e.get("type")===va.CHATROOMS_TYPE)).forEach((e=>e.session.save({connection_status:jl.ROOMSTATUS.DISCONNECTED})))}async function Ku(e){"visible"===e.state&&Cl.connection.connected()&&(await Cl.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}async function Yu(e){if(!Gu.isValidMUCJID(e))return M.warn(`invalid jid "${e}" provided in url fragment`);await Cl.waitUntil("roomsAutoJoined"),Cl.settings.get("allow_bookmarks")&&await Cl.waitUntil("bookmarksInitialized"),Cl.rooms.open(e)}async function Qu(e){const{__:t}=va,n=Hu('x[xmlns="jabber:x:conference"]',e).pop(),s=qu.getBareJidFromJid(e.getAttribute("from")),i=n.getAttribute("jid"),r=n.getAttribute("reason");let o;if(Cl.settings.get("auto_join_on_invite"))o=!0;else{let e=va.roster.get(s);e=e?e.getDisplayName():s,o=r?confirm(t('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',e,i,r)):confirm(t("%1$s has invited you to join a groupchat: %2$s",e,i))}!0===o&&(await async function(e,t){t.type=va.CHATROOMS_TYPE,t.id=e;const n=await Cl.rooms.get(e,t,!0);return n.maybeShow(!0),n}(i,{password:n.getAttribute("password")})).session.get("connection_status")===jl.ROOMSTATUS.DISCONNECTED&&va.chatboxes.get(i).rejoin()}function Xu(){if(!va.xmppstatus)throw new Error("Can't call _converse.getDefaultMUCNickname before the statusInitialized has been fired.");return va.xmppstatus.getNickname()||(Cl.settings.get("muc_nickname_from_jid")?qu.unescapeNode(qu.getNodeFromJid(va.bare_jid)):void 0)}function Zu(e){return!!Cl.settings.get("muc_show_info_messages").includes(e)}async function eh(){await Promise.all(Cl.settings.get("auto_join_rooms").map((e=>"string"==typeof e?va.chatboxes.where({jid:e}).length?Promise.resolve():Cl.rooms.open(e):pe(e)?Cl.rooms.open(e.jid,{...e}):(M.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),Cl.trigger("roomsAutoJoined")}function th(){Cl.settings.get("allow_muc")&&Cl.disco.own.features.add(qu.NS.MUC),Cl.settings.get("allow_muc_invitations")&&Cl.disco.own.features.add("jabber:x:conference")}function nh(){va.chatboxes.where({type:va.CHATROOMS_TYPE}).forEach((e=>ia(e.session,{connection_status:jl.ROOMSTATUS.DISCONNECTED})))}function sh(){window.addEventListener(va.unloadevent,(()=>{!Cl.connection.isType("websocket")||Cl.settings.get("enable_smacks")&&va.session.get("smacks_stream_id")||Ju()}))}function ih(){va.connection.addHandler((e=>{const t=qu.getBareJidFromJid(e.getAttribute("from"));return va.chatboxes.get(t)||Cl.waitUntil("chatBoxesFetched").then((async()=>{const n=va.chatboxes.get(t);n&&(await n.initialized,n.message_handler.run(e))})),!0}),null,"message","groupchat")}Object.assign(va,{getAssignableRoles:Wu});const rh=["moderator","participant","visitor"],oh=["owner","admin","member","outcast","none"];jl.AFFILIATION_CHANGES={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},jl.AFFILIATION_CHANGES_LIST=Object.values(jl.AFFILIATION_CHANGES),jl.MUC_TRAFFIC_STATES={ENTERED:"entered",EXITED:"exited"},jl.MUC_TRAFFIC_STATES_LIST=Object.values(jl.MUC_TRAFFIC_STATES),jl.MUC_ROLE_CHANGES={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},jl.MUC_ROLE_CHANGES_LIST=Object.values(jl.MUC_ROLE_CHANGES),jl.MUC={},jl.MUC.INFO_CODES={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...jl.AFFILIATION_CHANGES_LIST],join_leave_events:[...jl.MUC_TRAFFIC_STATES_LIST],role_changes:[...jl.MUC_ROLE_CHANGES_LIST]};const{Strophe:ah}=jl.env;ah.addNamespace("MUC_ADMIN",ah.NS.MUC+"#admin"),ah.addNamespace("MUC_OWNER",ah.NS.MUC+"#owner"),ah.addNamespace("MUC_REGISTER","jabber:iq:register"),ah.addNamespace("MUC_ROOMCONF",ah.NS.MUC+"#roomconfig"),ah.addNamespace("MUC_USER",ah.NS.MUC+"#user"),ah.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),ah.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),jl.MUC_NICK_CHANGED_CODE="303",jl.ROOM_FEATURES=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled"],jl.ROOMSTATUS={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7},jl.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco","converse-controlbox"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e&&e.type==n.CHATROOMS_TYPE?new n.ChatRoom(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){const{__:e,___:t}=va;if(Cl.settings.extend({allow_muc:!0,allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...jl.MUC.INFO_CODES.visibility_changes,...jl.MUC.INFO_CODES.self,...jl.MUC.INFO_CODES.non_privacy_changes,...jl.MUC.INFO_CODES.muc_logging_changes,...jl.MUC.INFO_CODES.nickname_changes,...jl.MUC.INFO_CODES.disconnected,...jl.MUC.INFO_CODES.affiliation_changes,...jl.MUC.INFO_CODES.join_leave_events,...jl.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_show_ogp_unfurls:!0,muc_subscribe_to_rai:!1}),Cl.promises.add(["roomsAutoJoined"]),Cl.settings.get("locked_muc_domain")&&"string"!=typeof Cl.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");jl.env.muc_utils={computeAffiliationsDelta:ju},Object.assign(Cl,Bu),Object.assign(Cl.rooms,Uu),va.muc={info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),333:e("You have exited this groupchat due to a technical problem"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")}},va.router.route("converse/room?jid=:jid",Yu),va.ChatRoom=va.ChatBox.extend(Lu),va.ChatRoomMessage=va.Message.extend(lu),va.ChatRoomOccupants=Fu,va.ChatRoomOccupant=zu,va.ChatRoomMessages=tc.extend({model:va.ChatRoomMessage,comparator:"time"}),Object.assign(va,{getDefaultMUCNickname:Xu,isInfoVisible:Zu,onDirectMUCInvitation:Qu}),Cl.settings.get("allow_muc_invitations")&&(Cl.listen.on("connected",Vu),Cl.listen.on("reconnected",Vu)),Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(`${ah.NS.CONFINFO}+notify`))),Cl.listen.on("addClientFeatures",th),Cl.listen.on("beforeResourceBinding",ih),Cl.listen.on("beforeTearDown",nh),Cl.listen.on("chatBoxesFetched",eh),Cl.listen.on("disconnected",Ju),Cl.listen.on("statusInitialized",sh),Cl.listen.on("windowStateChanged",Ku)}});const{Strophe:ch}=jl.env,lh=Zo.extend({idAttribute:"jid",getDisplayName(){return ch.xmlunescape(this.get("name"))}});var dh=n(6336),uh=n.n(dh);const{dayjs:hh}=jl.env;function mh(e,t){return"string"==typeof e&&t.includes(e)}function fh(e,t){return"string"!=typeof e||"en"!==e&&!t(e)?function(e){let t;if(window.navigator.userLanguage&&(t=gh(window.navigator.userLanguage,e)),window.navigator.languages&&!t)for(let n=0;n<window.navigator.languages.length&&!t;n++)t=gh(window.navigator.languages[n],e);return window.navigator.browserLanguage&&!t&&(t=gh(window.navigator.browserLanguage,e)),window.navigator.language&&!t&&(t=gh(window.navigator.language,e)),window.navigator.systemLanguage&&!t&&(t=gh(window.navigator.systemLanguage,e)),t||"en"}(t)||"en":e}function gh(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}let ph;Object.assign(o,{getLocale:(e,t)=>fh(e,(e=>mh(e,t))),translate(e){if(!ph)return uh().sprintf.apply(uh(),arguments);const t=ph.translate(e);return arguments.length>1?t.fetch.apply(t,[].slice.call(arguments,1)):t.fetch()},async initialize(){if(va.isTestEnv())va.locale="en";else try{const e=Cl.settings.get("i18n");va.locale=o.getLocale(e,Cl.settings.get("locales")),await async function(e){const{api:t,locale:s}=e,i=s.toLowerCase().replace("_","-");if(!mh(s,t.settings.get("locales"))||"en"===s)return;const{default:r}=await n(7521)(`./${s}/LC_MESSAGES/converse.po`);await n(9434)(`./${i}.js`),hh.locale(fh(i,(e=>hh.locale(e)))),ph=new(uh())(r)}(va)}catch(e){M.fatal(e.message),va.locale="en"}},__:(...e)=>o.translate(...e)});const vh=o.__,{Strophe:bh,$iq:yh,sizzle:_h}=jl.env,wh={model:lh,comparator:e=>e.get("name").toLowerCase(),initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>M.fatal(e))))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const e=`converse.room-bookmarks${va.bare_jid}`;this.fetched_flag=e+"fetched",_o(this,e)},openBookmarkedRoom:async e=>(Cl.settings.get("muc_respect_autojoin")&&e.get("autojoin")&&(await Cl.rooms.create(e.get("jid"),{nick:e.get("nick")})).maybeShow(),e),fetchBookmarks(){const e=ji();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e},createBookmark(e){this.create(e),this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))},sendBookmarkStanza(){const e=yh({type:"set",from:va.connection.jid}).c("pubsub",{xmlns:bh.NS.PUBSUB}).c("publish",{node:bh.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:bh.NS.BOOKMARKS});return this.forEach((t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()})),e.up().up().up(),e.c("publish-options").c("x",{xmlns:bh.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),Cl.sendIQ(e)},onBookmarkError(e,t){M.error("Error while trying to add bookmark"),M.error(e),Cl.alert("error",vh("Error"),[vh("Sorry, something went wrong while trying to save your bookmark.")]),this.findWhere({jid:t.jid}).destroy()},fetchBookmarksFromServer(e){const t=yh({from:va.connection.jid,type:"get"}).c("pubsub",{xmlns:bh.NS.PUBSUB}).c("items",{node:bh.NS.BOOKMARKS});Cl.sendIQ(t).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))},markRoomAsBookmarked(e){const t=va.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!0)},markRoomAsUnbookmarked(e){const t=va.chatboxes.get(e.get("jid"));void 0!==t&&t.save("bookmarked",!1)},createBookmarksFromStanza(e){const t=bh.NS.BOOKMARKS;_h(`items[node="${t}"] item storage[xmlns="${t}"] conference`,e).forEach((e=>{var t;const n=e.getAttribute("jid"),s=this.get(n),i={jid:n,name:e.getAttribute("name")||n,autojoin:"true"===e.getAttribute("autojoin"),nick:(null===(t=e.querySelector("nick"))||void 0===t?void 0:t.textContent)||""};s?s.save(i):this.create(i)}))},onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,!0),void 0!==e)return e.resolve()},onBookmarksReceivedError(e,t){if(null===t)M.error("Error: timeout while fetching bookmarks"),Cl.alert("error",vh("Timeout Error"),[vh("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,!0),e.resolve()):(M.error("Error while fetching bookmarks"),M.error(t),e.reject(new Error("Could not fetch bookmarks")));M.error("Error while fetching bookmarks"),M.error(t)}},getUnopenedBookmarks(){return this.filter((e=>!va.chatboxes.get(e.get("jid"))))}},{Strophe:Sh}=jl.env;async function xh(){const e=await Cl.disco.getIdentity("pubsub","pep",va.bare_jid);return va.allow_public_bookmarks?!!e:Cl.disco.supports(Sh.NS.PUBSUB+"#publish-options",va.bare_jid)}const{Strophe:Eh,sizzle:Ah}=jl.env;function Ch(e){return Ah(`event[xmlns="${Eh.NS.PUBSUB}#event"] items[node="${Eh.NS.BOOKMARKS}"]`,e).length&&Cl.waitUntil("bookmarksInitialized").then((()=>va.bookmarks.createBookmarksFromStanza(e))).catch((e=>M.fatal(e))),!0}Eh.addNamespace("BOOKMARKS","storage:bookmarks"),jl.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e}=this.__super__;if(this.get("bookmarked")&&e.bookmarks){const t=e.bookmarks.findWhere({jid:this.get("jid")});if(t)return t.get("name")}return this.__super__.getDisplayName.apply(this,arguments)},getAndPersistNickname(e){return e=e||function(e){if(!va.bookmarks||!Cl.settings.get("allow_bookmarks"))return null;const t=va.bookmarks.findWhere({jid:e});return t?t.get("nick"):void 0}(this.get("jid")),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){Cl.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),Cl.promises.add("bookmarksInitialized"),va.Bookmark=lh,va.Bookmarks=tc.extend(wh),va.BookmarksList=Zo.extend({defaults:{"toggle-state":va.OPENED}}),Cl.listen.on("addClientFeatures",(()=>{Cl.settings.get("allow_bookmarks")&&Cl.disco.own.features.add(Eh.NS.BOOKMARKS+"+notify")})),Cl.listen.on("clearSession",(()=>{void 0!==va.bookmarks&&(va.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(va.bookmarks.fetched_flag),delete va.bookmarks)})),Cl.listen.on("connected",(async()=>{const{connection:e}=va;e.addHandler(Ch,null,"message","headline",null,va.bare_jid),await Promise.all([Cl.waitUntil("chatBoxesFetched")]),async function(){Cl.settings.get("allow_bookmarks")&&await xh()&&(va.bookmarks=new va.Bookmarks,await va.bookmarks.fetchBookmarks(),Cl.trigger("bookmarksInitialized"))}()}))}});const{Strophe:Th}=jl.env,kh="converse.bosh-session";jl.plugins.add("converse-bosh",{enabled:()=>!va.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){Cl.settings.extend({bosh_service_url:void 0,prebind_url:null}),va.startNewPreboundBOSHSession=function(){if(!Cl.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=new XMLHttpRequest;e.open("GET",Cl.settings.get("prebind_url"),!0),e.setRequestHeader("Accept","application/json, text/javascript"),e.onload=async function(){if(e.status>=200&&e.status<400){const t=JSON.parse(e.responseText),n=await va.setUserJID(t.jid);va.connection.attach(n,t.sid,t.rid,va.connection.onConnectStatusChanged)}else e.onerror()},e.onerror=function(){delete va.connection,Cl.trigger("noResumeableBOSHSession",va)},e.send()},va.restoreBOSHSession=async function(){const e=(await async function(){const e=kh;if(va.bosh_session||(va.bosh_session=new Zo({id:e}),va.bosh_session.browserStorage=va.createStore(e,"session"),await new Promise((e=>va.bosh_session.fetch({success:e,error:e})))),va.jid){if(va.bosh_session.get("jid")!==va.jid){const e=await va.setUserJID(va.jid);va.bosh_session.clear({silent:!0}),va.bosh_session.save({jid:e})}}else{const e=va.bosh_session.get("jid");e&&await va.setUserJID(e)}return va.bosh_session}()).get("jid");if(e&&va.connection._proto instanceof Th.Bosh)try{return va.connection.restore(e,va.connection.onConnectStatusChanged),!0}catch(t){return!va.isTestEnv()&&M.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1},Cl.listen.on("clearSession",(()=>{if(void 0===va.bosh_session){const e=kh;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else va.bosh_session.destroy(),delete va.bosh_session})),Cl.listen.on("setUserJID",(()=>{void 0!==va.bosh_session&&va.bosh_session.save({jid:va.jid})})),Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(Th.NS.BOSH))),Object.assign(Cl,{tokens:{get:e=>void 0===va.connection?null:"rid"===e.toLowerCase()?va.connection.rid||va.connection._proto.rid:"sid"===e.toLowerCase()?va.connection.sid||va.connection._proto.sid:void 0}})}});const{Strophe:jh,$build:Nh}=jl.env;function Oh(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}function $h(){const e=va.api.disco.own.identities.get(),t=va.api.disco.own.features.get();e.length>1&&(Oh(e,"category"),Oh(e,"type"),Oh(e,"lang"));let n=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${(null==t?void 0:t.lang)??""}/${t.name}<`),"");return t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n),se.b64_sha1(n)}function Ih(){return Nh("c",{xmlns:jh.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:$h()}).nodeTree}const{Strophe:Mh}=jl.env;function Rh(e){var t,n;if(e&&(null===(n=va.session)||void 0===n||n.set({carbons_enabled:!1})),!Cl.settings.get("message_carbons")||null!==(t=va.session)&&void 0!==t&&t.get("carbons_enabled"))return;const s=new le.Builder("iq",{from:va.connection.jid,id:"enablecarbons",type:"set"}).c("enable",{xmlns:le.NS.CARBONS});va.connection.addHandler((e=>{e.querySelectorAll("error").length>0?M.warn("An error occurred while trying to enable message carbons."):(va.session.set({carbons_enabled:!0}),M.debug("Message carbons have been enabled.")),va.session.save()}),null,"iq",null,"enablecarbons"),va.connection.send(s)}Mh.addNamespace("CAPS","http://jabber.org/protocol/caps"),jl.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){Cl.listen.on("constructedPresence",((e,t)=>t.root().cnode(Ih()).up()&&t)),Cl.listen.on("constructedMUCPresence",((e,t)=>t.root().cnode(Ih()).up()&&t))}}),jl.plugins.add("converse-carbons",{initialize(){Cl.settings.extend({message_carbons:!0}),Cl.listen.on("afterResourceBinding",Rh)}});const Dh=tc.extend({comparator:"time_opened",model:(e,t)=>new va.ChatBox(e,t),onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),Cl.trigger("chatBoxesFetched")},onConnected(e){e||(_o(this,`converse.chatboxes-${va.bare_jid}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)}))}}),{Strophe:Lh}=jl.env;async function zh(e,t,n){let s;e=Lh.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{s=new n(t,{collection:va.chatboxes})}catch(e){return M.error(e),null}return await s.initialized,s.isValid()?(va.chatboxes.add(s),s):(s.destroy(),null)}const Ph={create:async(e=[],t={},n)=>(await Cl.waitUntil("chatBoxesFetched"),"string"==typeof e?zh(e,t,n):Promise.all(e.map((e=>zh(e,t,n))))),get:async e=>(await Cl.waitUntil("chatBoxesFetched"),void 0===e?va.chatboxes.models:"string"==typeof e?va.chatboxes.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),va.chatboxes.models.filter((t=>e.includes(t.get("jid"))))))},{Strophe:Fh}=jl.env;jl.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){Cl.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(Cl,{chatboxes:Ph}),va.ChatBoxes=Dh,Cl.listen.on("addClientFeatures",(()=>{Cl.disco.own.features.add(Fh.NS.MESSAGE_CORRECT),Cl.disco.own.features.add(Fh.NS.HTTPUPLOAD),Cl.disco.own.features.add(Fh.NS.OUTOFBAND)})),Cl.listen.on("pluginsInitialized",(()=>{va.chatboxes=new va.ChatBoxes,Cl.trigger("chatBoxesInitialized")})),Cl.listen.on("presencesInitialized",(e=>va.chatboxes.onConnected(e))),Cl.listen.on("reconnected",(()=>va.chatboxes.forEach((e=>e.onReconnection()))))}}),jl.plugins.add("converse-headlines",{dependencies:["converse-chat"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e.type==n.HEADLINES_TYPE?new n.HeadlinesBox(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){function e(){va.connection.addHandler((e=>async function(e){if(ad(e)||cd(e)){const t=e.getAttribute("from");if(await Cl.waitUntil("rosterInitialized"),t.includes("@")&&!va.roster.get(t)&&!Cl.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=va.chatboxes.create({id:t,jid:t,type:va.HEADLINES_TYPE,from:t}),s=await xd(e,va);await n.createMessage(s),Cl.trigger("message",{chatbox:n,stanza:e,attrs:s})}}(e)||!0),null,"message")}va.HeadlinesBox=va.ChatBox.extend({defaults(){return{bookmarked:!1,hidden:["mobile","fullscreen"].includes(Cl.settings.get("view_mode")),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:va.HEADLINES_TYPE}},async initialize(){this.set({box_id:`box-${this.get("jid")}`}),this.initUI(),this.initMessages(),await this.fetchMessages(),Cl.trigger("headlinesBoxInitialized",this)}}),Cl.listen.on("connected",e),Cl.listen.on("reconnected",e),Object.assign(Cl,{headlines:{async get(e,t={},n=!1){async function s(e){let s=await Cl.chatboxes.get(e);return!s&&n?s=await Cl.chatboxes.create(e,t,va.HeadlinesBox):(s=s&&s.get("type")===va.HEADLINES_TYPE?s:null,s&&Object.keys(t).length&&s.save(t)),s}return void 0===e?(await Cl.chatboxes.get()).filter((e=>e.get("type")===va.HEADLINES_TYPE)):"string"==typeof e?s(e):Promise.all(e.map((e=>s(e))))}}})}});const Uh=jl.env.utils;class Bh extends Zo{defaults(){return{msgid:Uh.getUniqueId(),is_ephemeral:!1}}}const{Strophe:qh,$build:Hh}=jl.env;qh.addNamespace("RSM","http://jabber.org/protocol/rsm");const Gh=["after","before","index","max"],Wh=e=>Number(e),Vh=e=>e.toString(),Jh={after:Vh,before:Vh,count:Wh,first:Vh,index:Wh,last:Vh,max:Wh},Kh=e=>void 0===e,Yh=Object.keys(Jh);class Qh{static getQueryParameters(e={}){return ko(e,Gh)}static parseXMLResult(e){const t={};for(var n=0;n<Yh.length;n++){const s=Yh[n],i=e.getElementsByTagName(s)[0];Kh(i)||null===i||(t[s]=Jh[s](qh.getText(i)),"first"==s&&(t.index=Jh.index(i.getAttribute("index"))))}return t}constructor(e={}){this.query=Qh.getQueryParameters(e),this.result=e.xml?Qh.parseXMLResult(e.xml):{}}toXML(){const e=Hh("set",{xmlns:qh.NS.RSM});return Gh.reduce(((e,t)=>Kh(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Qh(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Qh(n)}}va.RSM_ATTRIBUTES=Yh,va.RSM=Qh;const{Strophe:Xh,$iq:Zh,dayjs:em}=jl.env,{NS:tm}=Xh,nm=jl.env.utils,sm={archive:{async query(e){if(!Cl.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const n=t.to||va.bare_jid;if(!await Cl.disco.supports(tm.MAM,n))return M.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${tm.MAM}`),{messages:[]};const s=nm.getUniqueId(),i=Zh(t).c("query",{xmlns:tm.MAM,queryid:s});if(e){i.c("x",{xmlns:tm.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(tm.MAM).up().up(),e.with&&!e.groupchat&&i.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const n=em(e[t]);if(!n.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);i.c("field",{var:t}).c("value").t(n.toISOString()).up().up()}})),i.up();const t=new Qh(e);Object.keys(t.query).length&&i.cnode(t.toXML())}const r=[],o=va.connection.addHandler((t=>{const n=Mo()(`message > result[xmlns="${tm.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==s)return!0;const i=t.getAttribute("from")||va.bare_jid;if(e.groupchat){if(i!==e.with)return M.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(i!==va.bare_jid)return M.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return r.push(t),!0}),tm.MAM);let a;const c=await Cl.sendIQ(i,Cl.settings.get("message_archiving_timeout"),!1);if(null===c){const{__:e}=va,t=e("Timeout while trying to fetch archived messages.");return M.error(t),a=new va.TimeoutError(t),{messages:r,error:a}}if(nm.isErrorStanza(c)){const{__:e}=va,t=e("An error occurred while querying for archived messages.");return M.error(t),M.error(c),a=new Error(t),{messages:r,error:a}}let l;va.connection.deleteHandler(o);const d=c&&Mo()(`fin[xmlns="${tm.MAM}"]`,c).pop(),u="true"===(null==d?void 0:d.getAttribute("complete")),h=Mo()(`set[xmlns="${tm.RSM}"]`,d).pop();return h&&(l=new Qh({...e,xml:h})),{messages:r,rsm:l,complete:u}}}},{Strophe:im,$iq:rm}=jl.env,{NS:om}=im,am=jl.env.utils;function cm(e){null!=e&&e.querySelectorAll("feature-not-implemented").length?M.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(M.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),M.error(e))}function lm(e,t){const n=Mo()(`prefs[xmlns="${om.MAM}"]`,e).pop();if(n.getAttribute("default")!==Cl.settings.get("message_archiving")){const e=rm({type:"set"}).c("prefs",{xmlns:om.MAM,default:Cl.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),Cl.sendIQ(e).then((()=>t.save({preferences:{default:Cl.settings.get("message_archiving")}}))).catch(va.onMAMError)}else t.save({preferences:{default:Cl.settings.get("message_archiving")}})}function dm(e){const t=e.get("preferences")||{};e.get("var")===om.MAM&&void 0!==Cl.settings.get("message_archiving")&&t.default!==Cl.settings.get("message_archiving")&&Cl.sendIQ(rm({type:"get"}).c("prefs",{xmlns:om.MAM})).then((t=>va.onMAMPreferences(t,e))).catch(va.onMAMError)}function um(e){Cl.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(fm(e),e.save({prejoin_mam_fetched:!0}))}async function hm(e,t,n,s,i){await Cl.emojis.initialize();const r=e.get("type")===va.CHATROOMS_TYPE;t.messages=t.messages.map((t=>r?wu(t,e,va):xd(t,va)));const o={query:n,chatbox:e,messages:t.messages};if(await Cl.trigger("MAMResult",o,{synchronous:!0}),t.messages.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=am.getUniqueId();Cl.listen.once(n,(()=>mm(e,s,i))),e.createMessageFromError(t.error)}}async function mm(e,t={},n=null){if(e.disable_mam)return;const s=e.get("type")===va.CHATROOMS_TYPE,i=s?e.get("jid"):va.bare_jid;if(!await Cl.disco.supports(om.MAM,i))return;const r=Cl.settings.get("archived_messages_page_size"),o=Object.assign({groupchat:s,max:r,with:e.get("jid")},t),a=await Cl.archive.query(o);if(await hm(e,a,o,t,n),a.rsm&&!a.complete){if(n)return"forwards"===n?t=a.rsm.next(r,t.before).query:"backwards"===n&&(t=a.rsm.previous(r,t.after).query),mm(e,t,n);!async function(e,t,n){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const s=await Promise.all(n.messages),{rsm:i}=n,r=`stanza_id ${e.get("jid")}`,o=s.find((e=>e[r]===i.result.first)),a={template_hook:"getMessageTemplate",time:new Date(new Date(o.time)-1).toISOString(),before:i.result.first,start:t.start};e.messages.add(new Bh(a))}(e,t,a)}}function fm(e){if(e.disable_mam)return;const t=e.most_recent_cached_message;if(t&&!Cl.settings.get("clear_messages_on_reconnection"))if(Cl.settings.get("mam_request_all_pages")){const n=t.get(`stanza_id ${e.get("jid")}`);mm(e,n?{after:n}:{start:t.get("time")},"forwards")}else mm(e,{before:"",start:t.get("time")});else mm(e,{before:""})}const{Strophe:gm}=jl.env,{NS:pm}=gm;jl.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){Cl.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:2e4}),Object.assign(Cl,sm),Object.assign(va,{onMAMError:cm,onMAMPreferences:lm,handleMAMResult:hm,MAMPlaceholderMessage:Bh}),Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(pm.MAM))),Cl.listen.on("serviceDiscovered",dm),Cl.listen.on("chatRoomViewInitialized",(e=>{Cl.settings.get("muc_show_logs_before_join")&&(um(e.model),e.model.features.on("change:mam_enabled",(()=>um(e.model))))})),Cl.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&fm(e))),Cl.listen.on("chatReconnected",(e=>{e.get("type")===va.PRIVATE_CHAT_TYPE&&fm(e)})),Cl.listen.on("afterMessagesFetched",(e=>{e.get("type")!==va.PRIVATE_CHAT_TYPE||va.connection.restored||fm(e)}))}});const{Strophe:vm,$iq:bm}=jl.env;let ym;function _m(e){"visible"===e.state&&Cl.connection.connected()&&Cl.ping(null,5e3)}function wm(e){ym=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),s=bm({type:"result",to:t,id:n});return va.connection.sendIQ(s),!0}function Sm(){void 0!==va.connection.disco&&Cl.disco.own.features.add(vm.NS.PING),va.connection.addHandler(wm,vm.NS.PING,"iq","get"),va.connection.addHandler((()=>{if(Cl.settings.get("ping_interval")>0)return ym=new Date,!0}))}function xm(){if(va.isTestEnv()||!Cl.connection.connected())return;const e=Cl.settings.get("ping_interval");if(e>0){const t=new Date;ym||(ym=t),(t-ym)/1e3>e&&Cl.ping()}}const{Strophe:Em,$iq:Am,u:Cm}=jl.env,Tm={async ping(e,t){var n;if(n=new Date,ym=n,e=e||Em.getDomainFromJid(va.bare_jid),va.connection){const n=Am({type:"get",to:e,id:Cm.getUniqueId("ping")}).c("ping",{xmlns:Em.NS.PING}),s=await Cl.sendIQ(n,t||1e4,!1);return null===s?(M.warn(`Timeout while pinging ${e}`),e===Em.getDomainFromJid(va.bare_jid)&&Cl.connection.reconnect()):Cm.isErrorStanza(s)&&(M.error(`Error while pinging ${e}`),M.error(s)),!0}return!1}},{Strophe:km}=jl.env;km.addNamespace("PING","urn:xmpp:ping"),jl.plugins.add("converse-ping",{initialize(){Cl.settings.extend({ping_interval:60}),Object.assign(Cl,Tm),setInterval(xm,1e3),Cl.listen.on("connected",Sm),Cl.listen.on("reconnected",Sm),Cl.listen.on("windowStateChanged",_m)}});const{Strophe:jm,$iq:Nm}=jl.env;jm.addNamespace("PUBSUB_ERROR",jm.NS.PUBSUB+"#errors"),jl.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(va.api,{pubsub:{async publish(e,t,n,s,i=!0){const r=Nm({from:va.bare_jid,type:"set",to:e}).c("pubsub",{xmlns:jm.NS.PUBSUB}).c("publish",{node:t}).cnode(n.tree()).up().up();s&&(e=e||va.bare_jid,await Cl.disco.supports(jm.NS.PUBSUB+"#publish-options",e)?(r.c("publish-options").c("x",{xmlns:jm.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(`${jm.NS.PUBSUB}#publish-options`).up().up(),Object.keys(s).forEach((e=>r.c("field",{var:e}).c("value").t(s[e]).up().up()))):M.warn(`_converse.api.publish: ${e} does not support #publish-options, so we didn't set them even though they were provided.`));try{await Cl.sendIQ(r)}catch(e){if(!(e instanceof Element&&i&&e.querySelector(`precondition-not-met[xmlns="${jm.NS.PUBSUB_ERROR}"]`)))throw e;{const e=r.nodeTree;e.querySelector("publish-options").outerHTML="",M.warn(`PubSub: Republishing without publish options. ${e.outerHTML}`),await Cl.sendIQ(e)}}}}})}});const Om=function(e){return function(e){return"number"==typeof e||a(e)&&"[object Number]"==b(e)}(e)&&e!=+e},{Strophe:$m,$pres:Im}=jl.env,Mm=Zo.extend({defaults:()=>({status:Cl.settings.get("default_state")}),initialize(){this.on("change",(e=>{pe(e.changed)&&("status"in e.changed||"status_message"in e.changed)&&Cl.user.presence.send(this.get("status"),null,this.get("status_message"))}))},getNickname:()=>va.nickname,getFullname:()=>"",async constructPresence(e,t=null,n){let s;e="string"==typeof e?e:this.get("status")||Cl.settings.get("default_state"),n="string"==typeof n?n:this.get("status_message");const i={to:t};"unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribe"===e||"subscribed"===e?(i.type=e,s=Im(i)):"offline"===e?(i.type="unavailable",s=Im(i)):s="online"===e?Im(i):Im(i).c("show").t(e).up(),n&&s.c("status").t(n).up();const r=Cl.settings.get("priority");if(s.c("priority").t(Om(Number(r))?0:r).up(),va.idle){const e=new Date;e.setSeconds(e.getSeconds()-va.idle_seconds),s.c("idle",{xmlns:$m.NS.IDLE,since:e.toISOString()})}return s=await Cl.hook("constructedPresence",null,s),s}}),Rm={presence:{async send(e,t,n,s){await Cl.waitUntil("statusInitialized");const i=await va.xmppstatus.constructPresence(e,t,n);s&&(Array.isArray(s)||(s=[s]),s.map((e=>(null==e?void 0:e.tree())??e)).forEach((e=>i.cnode(e).up()))),Cl.send(i)}},status:{get:async()=>(await Cl.waitUntil("statusInitialized"),va.xmppstatus.get("status")),async set(e,t){const n={status:e};if(!Object.keys(va.STATUS_WEIGHTS).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(n.status_message=t),await Cl.waitUntil("statusInitialized"),va.xmppstatus.save(n)},message:{get:async()=>(await Cl.waitUntil("statusInitialized"),va.xmppstatus.get("status_message")),async set(e){await Cl.waitUntil("statusInitialized"),va.xmppstatus.save({status_message:e})}}}},{Strophe:Dm,$build:Lm}=jl.env;function zm(e){Cl.trigger("statusInitialized",e)}function Pm(e){if(e=void 0!==va.xmppstatus&&e)zm(e);else{const t=`converse.xmppstatus-${va.bare_jid}`;va.xmppstatus=new va.XMPPStatus({id:t}),_o(va.xmppstatus,t,"session"),va.xmppstatus.fetch({success:()=>zm(e),error:()=>zm(e),silent:!0})}}function Fm(){var e;va.idle_seconds>0&&(va.idle_seconds=0),null!==(e=va.connection)&&void 0!==e&&e.authenticated&&(va.inactive&&va.sendCSI(va.ACTIVE),va.idle&&(va.idle=!1,Cl.user.presence.send()),!0===va.auto_changed_status&&(va.auto_changed_status=!1,va.xmppstatus.set("status",Cl.settings.get("default_state"))))}function Um(){var e;if(null===(e=va.connection)||void 0===e||!e.authenticated)return;const t=va.xmppstatus.get("status");va.idle_seconds++,Cl.settings.get("csi_waiting_time")>0&&va.idle_seconds>Cl.settings.get("csi_waiting_time")&&!va.inactive&&va.sendCSI(va.INACTIVE),Cl.settings.get("idle_presence_timeout")>0&&va.idle_seconds>Cl.settings.get("idle_presence_timeout")&&!va.idle&&(va.idle=!0,Cl.user.presence.send()),Cl.settings.get("auto_away")>0&&va.idle_seconds>Cl.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(va.auto_changed_status=!0,va.xmppstatus.set("status","away")):Cl.settings.get("auto_xa")>0&&va.idle_seconds>Cl.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(va.auto_changed_status=!0,va.xmppstatus.set("status","xa"))}function Bm(e){Cl.send(Lm(e,{xmlns:Dm.NS.CSI})),va.inactive=e===va.INACTIVE}function qm(){if(Cl.settings.get("auto_away")<1&&Cl.settings.get("auto_xa")<1&&Cl.settings.get("csi_waiting_time")<1&&Cl.settings.get("idle_presence_timeout")<1)return;va.idle_seconds=0,va.auto_changed_status=!1;const{unloadevent:e}=va;window.addEventListener("click",va.onUserActivity),window.addEventListener("focus",va.onUserActivity),window.addEventListener("keypress",va.onUserActivity),window.addEventListener("mousemove",va.onUserActivity),window.addEventListener(e,va.onUserActivity,{once:!0,passive:!0}),window.addEventListener(e,(()=>{var e;return null===(e=va.session)||void 0===e?void 0:e.save("active",!1)})),va.everySecondTrigger=window.setInterval(va.onEverySecond,1e3)}jl.plugins.add("converse-status",{initialize(){Cl.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",priority:0}),Cl.promises.add(["statusInitialized"]),va.XMPPStatus=Mm,va.onUserActivity=Fm,va.onEverySecond=Um,va.sendCSI=Bm,va.registerIntervalHandler=qm,Object.assign(va.api.user,Rm),Cl.listen.on("presencesInitialized",(e=>{e||va.registerIntervalHandler()})),Cl.listen.on("clearSession",(()=>{va.shouldClearCache()&&va.xmppstatus&&(va.xmppstatus.destroy(),delete va.xmppstatus,Cl.promises.add(["statusInitialized"]))})),Cl.listen.on("connected",(()=>Pm(!1))),Cl.listen.on("reconnected",(()=>Pm(!0)))}});const{$pres:Hm}=jl.env;function Gm(e){var t;const n=null===(t=va.roster)||void 0===t?void 0:t.findWhere({jid:e.get("jid")});null==n||n.save({num_unread:e.get("num_unread")})}function Wm(){void 0!==va.presence_ref&&(va.connection.deleteHandler(va.presence_ref),delete va.presence_ref)}async function Vm(){var e;await(null===(e=va.presences)||void 0===e?void 0:e.clearStore())}async function Jm(){var e;await Vm(),va.shouldClearCache()&&(va.rostergroups&&(await va.rostergroups.clearStore(),delete va.rostergroups),va.roster&&(null===(e=va.roster.data)||void 0===e||e.destroy(),await va.roster.clearStore(),delete va.roster))}async function Km(e){e?Cl.trigger("rosterReadyAfterReconnection"):await async function(){await Cl.waitUntil("VCardsInitialized"),va.roster=new va.RosterContacts;let e=`converse.contacts-${va.bare_jid}`;_o(va.roster,e),va.roster.data=new Zo,e=`converse-roster-model-${va.bare_jid}`,va.roster.data.id=e,_o(va.roster.data,e),va.roster.data.fetch(),Cl.trigger("rosterInitialized")}(),va.roster.onConnected(),Wm(),va.presence_ref=va.connection.addHandler((e=>(va.roster.presenceHandler(e),!0)),null,"presence",null),async function(e=!1){e&&(va.send_initial_presence=!0);try{await va.roster.fetchRosterContacts(),Cl.trigger("rosterContactsFetched")}catch(e){M.error(e)}finally{va.send_initial_presence&&Cl.user.presence.send()}}(!va.connection.restored)}async function Ym(e){if(e)!va.connection.hasResumed()&&await Vm();else{va.presences=new va.Presences;const e=`converse.presences-${va.bare_jid}`;_o(va.presences,e,"session"),va.presences.fetch()}Cl.trigger("presencesInitialized",e)}function Qm(){va.chatboxes.on("change:num_unread",Gm),va.chatboxes.on("add",(e=>{e.get("type")===va.PRIVATE_CHAT_TYPE&&e.setRosterContact(e.get("jid"))}))}function Xm(){va.roster.on("add",(e=>{const t=va.chatboxes.findWhere({jid:e.get("jid")});null==t||t.setRosterContact(e.get("jid"))}))}function Zm(e,t){const n=Hm({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),Cl.send(n)}function ef(e,t){const n=e.presence.get("show")||"offline",s=t.presence.get("show")||"offline";if(va.STATUS_WEIGHTS[n]===va.STATUS_WEIGHTS[s]){const n=e.getDisplayName().toLowerCase(),s=t.getDisplayName().toLowerCase();return n<s?-1:n>s?1:0}return va.STATUS_WEIGHTS[n]<va.STATUS_WEIGHTS[s]?-1:1}function tf(e,t){const n={};n[va.HEADER_UNREAD]=0,n[va.HEADER_REQUESTING_CONTACTS]=1,n[va.HEADER_CURRENT_CONTACTS]=2,n[va.HEADER_UNGROUPED]=3,n[va.HEADER_PENDING_CONTACTS]=4;const s=n,i=Object.keys(n),r=i.includes(e),o=i.includes(t);if(!r&&!o)return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0;if(r&&o)return s[e]<s[t]?-1:s[e]>s[t]?1:0;if(!r&&o){const e=va.HEADER_CURRENT_CONTACTS;return s[e]<s[t]?-1:s[e]>s[t]?1:0}if(r&&!o){const t=va.HEADER_CURRENT_CONTACTS;return s[e]<s[t]?-1:s[e]>s[t]?1:0}}const{Strophe:nf,$iq:sf,$pres:rf}=jl.env,of=Zo.extend({defaults:{chat_state:void 0,groups:[],image:va.DEFAULT_IMAGE,image_type:va.DEFAULT_IMAGE_TYPE,num_unread:0,status:void 0},async initialize(e){this.initialized=ji(),this.setPresence();const{jid:t}=e,n=nf.getBareJidFromJid(t).toLowerCase();e.jid=n,this.set(Object.assign({id:n,jid:n,user_id:nf.getNodeFromJid(t)},e)),this.listenTo(this.presence,"change:show",(()=>Cl.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await Cl.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()},setPresence(){const e=this.get("jid");this.presence=va.presences.findWhere({jid:e})||va.presences.create({jid:e})},openChat(){const e=this.attributes;Cl.chats.open(e.jid,e,!0)},getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let n=this.getDisplayName();return n=n.includes(t)?n:n.concat(`   ${t}`),n=n.includes(e)?n:n.concat(`   ${e}`),n.toLowerCase()},getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")},getFullname(){return this.get("jid")},subscribe(e){const t=rf({to:this.get("jid"),type:"subscribe"});e&&""!==e&&t.c("status").t(e).up();const n=va.xmppstatus.getNickname()||va.xmppstatus.getFullname();return n&&t.c("nick",{xmlns:nf.NS.NICK}).t(n).up(),Cl.send(t),this.save("ask","subscribe"),this},ackSubscribe(){Cl.send(rf({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe(){Cl.send(rf({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()},unauthorize(e){return Zm(this.get("jid"),e),this},authorize(e){const t=rf({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),Cl.send(t),this},removeFromRoster(){const e=sf({type:"set"}).c("query",{xmlns:nf.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return Cl.sendIQ(e)}}),{Strophe:af,$iq:cf,sizzle:lf,u:df}=jl.env,uf=tc.extend({model:of,initialize(){const e=`roster.state-${va.bare_jid}-${this.get("jid")}`;this.state=new Zo({id:e,collapsed_groups:[]}),_o(this.state,e),this.state.fetch()},onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()},registerRosterHandler(){va.connection.addHandler((e=>(va.roster.onRosterPush(e),!0)),af.NS.ROSTER,"iq","set")},registerRosterXHandler(){let e=0;va.connection.addHandler((function(t){return window.setTimeout((function(){va.connection.flush(),va.roster.subscribeToSuggestedItems.bind(va.roster)(t)}),e),e+=250*t.querySelectorAll("item").length,!0}),af.NS.ROSTERX,"message",null)},async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(df.isErrorObject(e)&&(M.error(e),va.session.save("roster_cached",!1),this.data.save("version",void 0)),!va.session.get("roster_cached"))return va.send_initial_presence=!0,va.roster.fetchFromServer();Cl.trigger("cachedRoster",e)},subscribeToSuggestedItems:e=>(Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&va.roster.addAndSubscribe(e.getAttribute("jid"),va.xmppstatus.getNickname()||va.xmppstatus.getFullname())})),!0),isSelf:e=>df.isSameBareJID(e,va.connection.jid),async addAndSubscribe(e,t,n,s,i){const r=await this.addContactToRoster(e,t,n,i);r instanceof va.RosterContact&&r.subscribe(s)},sendContactAddIQ(e,t,n){t=t||null;const s=cf({type:"set"}).c("query",{xmlns:af.NS.ROSTER}).c("item",{jid:e,name:t});return n.forEach((e=>s.c("group").t(e).up())),Cl.sendIQ(s)},async addContactToRoster(e,t,n,s){await Cl.waitUntil("rosterContactsFetched"),n=n||[];try{await this.sendContactAddIQ(e,t,n)}catch(n){return M.error(n),alert(vh("Sorry, there was an error while trying to add %1$s as a contact.",t||e)),n}return this.create(Object.assign({ask:void 0,nickname:t,groups:n,jid:e,requesting:!1,subscription:"none"},s),{sort:!1})},async subscribeBack(e,t){const n=this.get(e);if(n instanceof va.RosterContact)n.authorize().subscribe();else{var s;const n=(null===(s=lf(`nick[xmlns="${af.NS.NICK}"]`,t).pop())||void 0===s?void 0:s.textContent)||null,i=await this.addContactToRoster(e,n,[],{subscription:"from"});i instanceof va.RosterContact&&i.authorize().subscribe()}},getNumOnlineContacts(){const e=["offline","unavailable"];return(t=this.models.filter((t=>!e.includes(t.presence.get("show")))))&&t.length?function(e,t){for(var n,s=-1,i=e.length;++s<i;){var r=t(e[s]);void 0!==r&&(n=void 0===n?r:n+r)}return n}(t,Le):0;var t},onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from");if(n&&n!==va.bare_jid)return void M.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);Cl.send(cf({type:"result",id:t,from:va.connection.jid}));const s=lf(`query[xmlns="${af.NS.ROSTER}"]`,e).pop();this.data.save("version",s.getAttribute("ver"));const i=lf("item",s);if(i.length>1)throw M.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===i.length)return M.warn(e),void M.warn('Received a roster push stanza without an "item" element.');this.updateContact(i.pop()),Cl.trigger("rosterPush",e)},rosterVersioningSupported(){return Cl.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")},async fetchFromServer(){const e=cf({type:"get",id:df.getUniqueId("roster")}).c("query",{xmlns:af.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await Cl.sendIQ(e,null,!1);if("error"!==t.getAttribute("type")){const e=lf(`query[xmlns="${af.NS.ROSTER}"]`,t).pop();e&&(lf("item",e).forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver")))}else if(!df.isServiceUnavailableError(t))return M.error(t),void M.error("Error while trying to fetch roster from the server");va.session.save("roster_cached",!0),Cl.trigger("roster",t)},updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),s=e.getAttribute("subscription"),i=e.getAttribute("ask"),r=[...new Set(lf("group",e).map((e=>e.textContent)))];if(n){if("remove"===s)return n.destroy();n.save({subscription:s,ask:i,nickname:e.getAttribute("name"),requesting:null,groups:r})}else{if("none"===s&&null===i||"remove"===s)return;this.create({ask:i,nickname:e.getAttribute("name"),groups:r,jid:t,subscription:s},{sort:!1})}},createRequestingContact(e){var t;const n={jid:af.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:(null===(t=lf(`nick[xmlns="${af.NS.NICK}"]`,e).pop())||void 0===t?void 0:t.textContent)||null};Cl.trigger("contactRequest",this.create(n))},handleIncomingSubscription(e){const t=e.getAttribute("from"),n=af.getBareJidFromJid(t),s=this.get(n);Cl.settings.get("allow_contact_requests")||Zm(t,vh("This client does not allow presence subscriptions")),Cl.settings.get("auto_subscribe")?s&&"to"===s.get("subscription")?s.authorize():this.subscribeBack(n,e):s?("none"!==s.get("subscription")||"subscribe"===s.get("ask"))&&s.authorize():this.createRequestingContact(e)},handleOwnPresence(e){const t=e.getAttribute("from"),n=af.getResourceFromJid(t),s=e.getAttribute("type");if(va.connection.jid!==t&&"unavailable"!==s&&(!0===Cl.settings.get("synchronize_availability")||Cl.settings.get("synchronize_availability")===n)){var i,r;const t=(null===(i=e.querySelector("show"))||void 0===i?void 0:i.textContent)||"online";va.xmppstatus.save({status:t},{silent:!0});const n=null===(r=e.querySelector("status"))||void 0===r?void 0:r.textContent;n&&va.xmppstatus.save({status_message:n})}va.jid===t&&"unavailable"===s&&Cl.user.presence.send()},presenceHandler(e){var t;const n=e.getAttribute("type");if("error"===n)return!0;const s=e.getAttribute("from"),i=af.getBareJidFromJid(s);if(this.isSelf(i))return this.handleOwnPresence(e);if(lf(`query[xmlns="${af.NS.MUC}"]`,e).length)return;const r=null===(t=e.querySelector("status"))||void 0===t?void 0:t.textContent,o=this.get(i);if(o&&r!==o.get("status")&&o.save({status:r}),"subscribed"===n&&o)o.ackSubscribe();else if("unsubscribed"===n&&o)o.ackUnsubscribe();else{if("unsubscribe"===n)return;if("subscribe"===n)this.handleIncomingSubscription(e);else if("unavailable"===n&&o){const e=af.getResourceFromJid(s);o.presence.removeResource(e)}else o&&o.presence.addResource(e)}}}),{Strophe:hf}=jl.env,mf={contacts:{async get(e){await Cl.waitUntil("rosterContactsFetched");const t=e=>va.roster.get(hf.getBareJidFromJid(e));if(void 0===e)e=va.roster.pluck("jid");else if("string"==typeof e)return t(e);return e.map(t)},async add(e,t){if(await Cl.waitUntil("rosterContactsFetched"),"string"!=typeof e||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return va.roster.addAndSubscribe(e,t)}}},{Strophe:ff,dayjs:gf,sizzle:pf}=jl.env,vf=Zo.extend({idAttribute:"name"}),bf=tc.extend({model:vf}),yf=Zo.extend({defaults:{show:"offline"},initialize(){this.resources=new bf;const e=`converse.identities-${this.get("jid")}`;_o(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)},onResourcesChanged(){var e;const t=this.getHighestPriorityResource(),n=(null==t||null===(e=t.attributes)||void 0===e?void 0:e.show)||"offline";this.get("show")!==n&&this.save({show:n})},getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]},addResource(e){var t,n;const s=e.getAttribute("from"),i=ff.getResourceFromJid(s),r=pf(`delay[xmlns="${ff.NS.DELAY}"]`,e).pop(),o=(null===(t=e.querySelector("priority"))||void 0===t?void 0:t.textContent)??0,a=this.resources.get(i),c={name:i,priority:Om(parseInt(o,10))?0:parseInt(o,10),show:(null===(n=e.querySelector("show"))||void 0===n?void 0:n.textContent)??"online",timestamp:r?gf(r.getAttribute("stamp")).toISOString():(new Date).toISOString()};a?a.save(c):this.resources.create(c)},removeResource(e){const t=this.resources.get(e);t&&t.destroy()}}),_f=tc.extend({model:yf});jl.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){Cl.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),Cl.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(va.api,mf),va.HEADER_CURRENT_CONTACTS=vh("My contacts"),va.HEADER_PENDING_CONTACTS=vh("Pending contacts"),va.HEADER_REQUESTING_CONTACTS=vh("Contact requests"),va.HEADER_UNGROUPED=vh("Ungrouped"),va.HEADER_UNREAD=vh("New messages"),va.Presence=yf,va.Presences=_f,va.RosterContact=of,va.RosterContacts=uf,Cl.listen.on("beforeTearDown",(()=>Wm())),Cl.listen.on("chatBoxesInitialized",Qm),Cl.listen.on("clearSession",Jm),Cl.listen.on("presencesInitialized",Km),Cl.listen.on("statusInitialized",Ym),Cl.listen.on("streamResumptionFailed",(()=>va.session.set("roster_cached",!1))),Cl.waitUntil("rosterContactsFetched").then(Xm)}});const{Strophe:wf}=jl.env,Sf=jl.env.utils;function xf(){return!(Cl.connection.isType("bosh")&&!va.isTestEnv())&&Cl.disco.stream.getFeature("sm",wf.NS.SM)}function Ef(e){if(!va.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=va.session.get("num_stanzas_handled_by_server"),s=t-n;if(s<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;M.error(e)}const i=va.session.get("unacked_stanzas");if(s>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${s} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${n}`;M.error(e)}return va.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(s)}),!0}function Af(){if(va.session.get("smacks_enabled")){const e=va.session.get("num_stanzas_handled"),t=Sf.toStanza(`<a xmlns="${wf.NS.SM}" h="${e}"/>`);Cl.send(t)}return!0}function Cf(e){if(va.session.get("smacks_enabled")&&(Sf.isTagEqual(e,"iq")||Sf.isTagEqual(e,"presence")||Sf.isTagEqual(e,"message"))){const e=va.session.get("num_stanzas_handled");va.session.save("num_stanzas_handled",e+1)}return!0}function Tf(){va.session.save({smacks_enabled:va.session.get("smacks_enabled")||!1,num_stanzas_handled:va.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:va.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:va.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:va.session.get("unacked_stanzas")||[]})}function kf(){var e;null===(e=va.session)||void 0===e||e.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function jf(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),va.session.save(t),!0}function Nf(e){return e.querySelector("item-not-found")?M.warn("Could not resume previous SMACKS session, session id not found. A new session will be established."):(M.error("Failed to enable stream management"),M.error(e.outerHTML)),kf(),Cl.trigger("streamResumptionFailed"),!0}async function Of(){if(Cl.settings.get("enable_smacks")&&!va.session.get("smacks_enabled")&&await xf()){const e=ji();va.connection._addSysHandler((t=>e.resolve(jf(t))),wf.NS.SM,"enabled"),va.connection._addSysHandler((t=>e.resolve(Nf(t))),wf.NS.SM,"failed");const t=Cl.connection.isType("websocket")||va.isTestEnv(),n=Sf.toStanza(`<enable xmlns="${wf.NS.SM}" resume="${t}"/>`);Cl.send(n),va.connection.flush(),await e}}const $f=[];async function If(){var e;if(!Cl.settings.get("enable_smacks"))return;if(!await xf())return;const t=va.connection;for(;$f.length;)t.deleteHandler($f.pop());$f.push(t.addHandler(Cf)),$f.push(t.addHandler(Af,wf.NS.SM,"r")),$f.push(t.addHandler(Ef,wf.NS.SM,"a")),null!==(e=va.session)&&void 0!==e&&e.get("smacks_stream_id")?await async function(){const e=ji();va.connection._addSysHandler((t=>e.resolve(function(e){jf(e),Ef(e),function(){const e=va.session.get("unacked_stanzas");va.session.save("unacked_stanzas",[]),e.forEach((e=>Cl.send(e)))}(),va.connection.do_bind=!1,va.connection.authenticated=!0,va.connection.restored=!0,va.connection._changeConnectStatus(wf.Status.CONNECTED,null)}(t))),wf.NS.SM,"resumed"),va.connection._addSysHandler((t=>e.resolve(Nf(t))),wf.NS.SM,"failed");const t=va.session.get("smacks_stream_id"),n=va.session.get("num_stanzas_handled"),s=Sf.toStanza(`<resume xmlns="${wf.NS.SM}" h="${n}" previd="${t}"/>`);Cl.send(s),va.connection.flush(),await e}():kf()}function Mf(e){if(va.session){if(va.session.get("smacks_enabled")&&(Sf.isTagEqual(e,"iq")||Sf.isTagEqual(e,"presence")||Sf.isTagEqual(e,"message"))){const t=wf.serialize(e);va.session.save("unacked_stanzas",(va.session.get("unacked_stanzas")||[]).concat([t]));const n=Cl.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=va.session.get("num_stanzas_since_last_ack")+1;e%n==0&&Cl.send(Sf.toStanza(`<r xmlns="${wf.NS.SM}"/>`)),va.session.save({num_stanzas_since_last_ack:e})}}}else M.warn("No _converse.session!")}const{Strophe:Rf}=jl.env;Rf.addNamespace("SM","urn:xmpp:sm:3"),jl.plugins.add("converse-smacks",{initialize(){Cl.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),Cl.listen.on("afterResourceBinding",Of),Cl.listen.on("beforeResourceBinding",If),Cl.listen.on("send",Mf),Cl.listen.on("userSessionInitialized",Tf)}});const{Strophe:Df,$iq:Lf,dayjs:zf}=jl.env,Pf=jl.env.utils;jl.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){function e(e,t,n){const s=Lf(t?{type:e,to:t}:{type:e});return n?s.cnode(n):s.c("vCard",{xmlns:Df.NS.VCARD}),s}async function t(t,n){const s=Df.getBareJidFromJid(n)===t.bare_jid?null:n;let i;try{i=await Cl.sendIQ(e("get",s))}catch(i){return{stanza:i,jid:n,vcard_error:(new Date).toISOString()}}return async function(e,t){const n=t.querySelector("vCard");let s={};var i,r,o,a,c,l,d;if(null!==n&&(s={stanza:t,fullname:null===(i=n.querySelector("FN"))||void 0===i?void 0:i.textContent,nickname:null===(r=n.querySelector("NICKNAME"))||void 0===r?void 0:r.textContent,image:null===(o=n.querySelector("PHOTO BINVAL"))||void 0===o?void 0:o.textContent,image_type:null===(a=n.querySelector("PHOTO TYPE"))||void 0===a?void 0:a.textContent,url:null===(c=n.querySelector("URL"))||void 0===c?void 0:c.textContent,role:null===(l=n.querySelector("ROLE"))||void 0===l?void 0:l.textContent,email:null===(d=n.querySelector("EMAIL USERID"))||void 0===d?void 0:d.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0}),s.image){const e=Pf.base64ToArrayBuffer(s.image),t=await crypto.subtle.digest("SHA-1",e);s.image_hash=Pf.arrayBufferToHex(t)}return s}(0,i)}async function n(e){let t;if(e instanceof va.Message){if("error"===e.get("type"))return;t=e.get("from")}else t=e.get("jid");await Cl.waitUntil("VCardsInitialized"),e.vcard=va.vcards.findWhere({jid:t}),e.vcard||(e.vcard=va.vcards.create({jid:t})),e.vcard.on("change",(()=>e.trigger("vcard:change")))}Cl.promises.add("VCardsInitialized"),va.VCard=Zo.extend({defaults:{image:va.DEFAULT_IMAGE,image_type:va.DEFAULT_IMAGE_TYPE},set(e,t,n){let s;return"object"==typeof e?(s=e,n=t):(s={})[e]=t,"image"in s&&!s.image?(s.image=va.DEFAULT_IMAGE,s.image_type=va.DEFAULT_IMAGE_TYPE,Zo.prototype.set.call(this,s,n)):Zo.prototype.set.apply(this,arguments)},getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}}),va.VCards=tc.extend({model:va.VCard,initialize(){this.on("add",(e=>e.get("jid")&&Cl.vcard.update(e)))}}),va.initVCardCollection=async function(){va.vcards=new va.VCards;const e=`${va.bare_jid}-converse.vcards`;_o(va.vcards,e),await new Promise((e=>{va.vcards.fetch({success:e,error:e},{silent:!0})}));const t=va.vcards;if(va.session){const e=va.session.get("bare_jid");va.xmppstatus.vcard=t.findWhere({jid:e})||t.create({jid:e})}Cl.trigger("VCardsInitialized")},Cl.listen.on("chatBoxInitialized",(e=>n(e))),Cl.listen.on("chatRoomInitialized",(e=>n(e))),Cl.listen.on("chatRoomMessageInitialized",(e=>async function(e){await Cl.waitUntil("VCardsInitialized"),["error","info"].includes(e.get("type"))||(e.vcard=function(e){var t;const n=null==e||null===(t=e.collection)||void 0===t?void 0:t.chatbox,s=Df.getResourceFromJid(e.get("from"));if(n&&n.get("nick")===s)return va.xmppstatus.vcard;{const t=e.occupant&&e.occupant.get("jid")||e.get("from");return t?va.vcards.findWhere({jid:t})||va.vcards.create({jid:t}):void M.error(`Could not assign VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}(e))}(e))),Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(Df.NS.VCARD))),Cl.listen.on("clearSession",(()=>{va.shouldClearCache()&&(Cl.promises.add("VCardsInitialized"),va.vcards&&(va.vcards.clearStore(),delete va.vcards))})),Cl.listen.on("messageInitialized",(e=>n(e))),Cl.listen.on("rosterContactInitialized",(e=>n(e))),Cl.listen.on("statusInitialized",va.initVCardCollection),Object.assign(va.api,{vcard:{async set(t,n){if(!t)throw Error("No jid provided for the VCard data");const s=document.createElement("div"),i=Pf.toStanza(`\n                        <vCard xmlns="vcard-temp">\n                            <FN>${n.fn}</FN>\n                            <NICKNAME>${n.nickname}</NICKNAME>\n                            <URL>${n.url}</URL>\n                            <ROLE>${n.role}</ROLE>\n                            <EMAIL><INTERNET/><PREF/><USERID>${n.email}</USERID></EMAIL>\n                            <PHOTO>\n                                <TYPE>${n.image_type}</TYPE>\n                                <BINVAL>${n.image}</BINVAL>\n                            </PHOTO>\n                        </vCard>`,s);let r;try{r=await Cl.sendIQ(e("set",t,i))}catch(e){throw e}return await Cl.vcard.update(t,!0),r},get(e,n){if("string"==typeof e)return t(va,e);if(!n&&e.get("vcard_updated")&&zf(e.get("vcard_error")).isSame(new Date,"day"))return Promise.resolve({});{const n=e.get("jid");return n||M.error("No JID to get vcard for"),t(va,n)}},async update(e,t){const n=await this.get(e,t);(e="string"==typeof e?va.vcards.findWhere({jid:e}):e)?(delete n.stanza,e.save(n)):M.error(`Could not find a VCard model for ${e}`)}}})}});const Ff={};Cl.elements={registry:Ff,define:function(e,t){this.registry[e]=t},register:function(){Object.keys(Ff).forEach((e=>{customElements.get(e)||customElements.define(e,Ff[e])}))}};class Uf extends _l{constructor(){super(),Object.assign(this,ks)}createRenderRoot(){return this}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}}const Bf=["converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-dragresize","converse-fullscreen","converse-headlines-view","converse-mam-views","converse-minimize","converse-modal","converse-muc-views","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rootview","converse-rosterview","converse-singleton"];var qf=n(3379),Hf=n.n(qf),Gf=n(7795),Wf=n.n(Gf),Vf=n(569),Jf=n.n(Vf),Kf=n(3565),Yf=n.n(Kf),Qf=n(9216),Xf=n.n(Qf),Zf=n(4589),eg=n.n(Zf),tg=n(4452),ng={};ng.styleTagTransform=eg(),ng.setAttributes=Yf(),ng.insert=Jf().bind(null,"head"),ng.domAPI=Wf(),ng.insertStyleElement=Xf(),Hf()(tg.Z,ng),tg.Z&&tg.Z.locals&&tg.Z.locals;class sg extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid)}render(){return(e=>{const t=vh("Bookmark this groupchat"),n=vh("Would you like this groupchat to be automatically joined upon startup?"),s=vh("Cancel"),i=vh("The name for this bookmark:"),r=vh("What should your nickname for this groupchat be?"),o=vh("Save");return Qc`
        <form class="converse-form chatroom-form" @submit=${e.onSubmit}>
            <legend>${t}</legend>
            <fieldset class="form-group">
                <label for="converse_muc_bookmark_name">${i}</label>
                <input class="form-control" type="text" value="${e.name}" name="name" required="required" id="converse_muc_bookmark_name"/>
            </fieldset>
            <fieldset class="form-group">
                <label for="converse_muc_bookmark_nick">${r}</label>
                <input class="form-control" type="text" name="nick" value="${e.nick||""}" id="converse_muc_bookmark_nick"/>
            </fieldset>
            <fieldset class="form-group form-check">
                <input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" name="autojoin"/>
                <label class="form-check-label" for="converse_muc_bookmark_autojoin">${n}</label>
            </fieldset>
            <fieldset class="form-group">
                <input class="btn btn-primary" type="submit" value="${o}">
                <input class="btn btn-secondary button-cancel" type="button" value="${s}" @click=${e.onCancel}>
            </fieldset>
        </form>
    `})(Object.assign(this.model.toJSON(),{onCancel:e=>this.closeBookmarkForm(e),onSubmit:e=>this.onBookmarkFormSubmitted(e)}))}onBookmarkFormSubmitted(e){var t,n,s;e.preventDefault(),va.bookmarks.createBookmark({jid:this.model.get("jid"),autojoin:(null===(t=e.target.querySelector('input[name="autojoin"]'))||void 0===t?void 0:t.checked)||!1,name:null===(n=e.target.querySelector("input[name=name]"))||void 0===n?void 0:n.value,nick:null===(s=e.target.querySelector("input[name=nick]"))||void 0===s?void 0:s.value}),this.closeBookmarkForm(e)}closeBookmarkForm(e){e.preventDefault(),this.model.session.save("view",null)}}Cl.elements.define("converse-muc-bookmark-form",sg);const ig=sg,rg=Je((function(e,t,n){var s=-1,i="function"==typeof t,r=Ye(e)?Array(e.length):[];return ls(e,(function(e){r[++s]=i?ze(t,e,n):Sa(e,t,n)})),r}));function og(e,t){if(va.allow_bookmarks&&e.model.get("type")===va.CHATROOMS_TYPE){const n=e.model.get("bookmarked"),s={i18n_title:vh(n?"Unbookmark this groupchat":"Bookmark this groupchat"),i18n_text:vh(n?"Unbookmark":"Bookmark"),handler:t=>e.toggleBookmark(t),a_class:"toggle-bookmark",icon_class:"fa-bookmark",name:"bookmark"},i=t.map((e=>e.name)).indexOf("details"),r=xh().then((e=>e?s:""));return i>-1?[...t.slice(0,i),r,...t.slice(i)]:[r,...t]}return t}function ag(e){e.preventDefault();const t=e.target.getAttribute("data-bookmark-name"),n=e.target.getAttribute("data-room-jid");confirm(vh('Are you sure you want to remove the bookmark "%1$s"?',t))&&rg(va.bookmarks.where({jid:n}),Zo.prototype.destroy)}async function cg(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid");(await Cl.rooms.open(t,{bring_to_foreground:!0})).session.save("view",jl.MUC.VIEWS.BOOKMARK)}function lg(e){e.preventDefault();const{Strophe:t}=jl.env,n=e.target.textContent,s=e.target.getAttribute("data-room-jid"),i={name:n||t.unescapeNode(t.getNodeFromJid(s))||s};Cl.rooms.open(s,i,!0)}const dg=e=>{const t=e.bm.get("jid"),n=!(!Cl.settings.get("hide_open_bookmarks")||!va.chatboxes.get(t)),s=vh("Unbookmark this groupchat"),i=vh("Click to open this groupchat");return Qc`
        <div class="list-item controlbox-padded room-item available-chatroom d-flex flex-row ${n?"hidden":""}" data-room-jid="${t}">
            <a class="list-item-link open-room w-100" data-room-jid="${t}"
            title="${i}"
            @click=${lg}>${e.bm.getDisplayName()}</a>

            <a class="list-item-action remove-bookmark fa fa-bookmark align-self-center ${e.bm.get("bookmarked")?"button-on":""}"
            data-room-jid="${t}"
            data-bookmark-name="${e.bm.getDisplayName()}"
            title="${s}"
            @click=${ag}></a>
        </div>
    `};"undefined"!=typeof Element&&Element.prototype;const ug=/^(\S+)\s*(.*)$/,hg=["model","collection","events"];class mg extends HTMLElement{constructor(e){var t,n,s;super(),s={},(n="events")in(t=this)?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,this.cid=Ts("view"),this._domEvents=[],Ct(this,ko(e,hg))}createRenderRoot(){return this}connectedCallback(){this._initialized||(this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments),this._initialized=!0),this.delegateEvents()}disconnectedCallback(){this.undelegateEvents(),this.stopListening()}preinitialize(){}initialize(){}render(){return ve(this.beforeRender)&&this.beforeRender(),ve(this.toHTML)&&tl(this.toHTML(),this),ve(this.afterRender)&&this.afterRender(),this}delegateEvents(){if(!this.events)return this;this.undelegateEvents();for(const e in this.events){let t=this.events[e];if(ve(t)||(t=this[t]),!t)continue;const n=e.match(ug);this.delegate(n[1],n[2],t.bind(this))}return this}delegate(e,t,n){const s=this;if(!s)return this;if("function"==typeof t&&(n=t,t=null),-1!==["focus","blur"].indexOf(e)){const s=this.querySelectorAll(t);for(let t=0,i=s.length;t<i;t++){const i=s[t];i.addEventListener(e,n,!1),this._domEvents.push({el:i,eventName:e,handler:n})}return n}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=s;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,n(e))}:n;return this.addEventListener(e,i,!1),this._domEvents.push({el:this,eventName:e,handler:i,listener:n,selector:t}),this}undelegateEvents(){if(this){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this}undelegate(e,t,n){if("function"==typeof t&&(n=t,t=null),this){const s=this._domEvents.slice();let i=s.length;for(;i--;){const r=s[i];!(r.eventName!==e||n&&r.listener!==n||t&&r.selector!==t)&&(r.el.removeEventListener(r.eventName,r.handler,!1),this._domEvents.splice(i,1))}}return this}}Object.assign(mg.prototype,ks);const fg=jl.env.utils;class gg extends mg{async initialize(){await Cl.waitUntil("bookmarksInitialized"),this.listenTo(va.bookmarks,"add",this.render),this.listenTo(va.bookmarks,"remove",this.render),this.listenTo(va.chatboxes,"add",this.render),this.listenTo(va.chatboxes,"remove",this.render);const e=`converse.bookmarks-list-model-${va.bare_jid}`;this.model=new va.BookmarksList({id:e}),_o(this.model,e),this.model.fetch({success:()=>this.render(),error:(e,t)=>{M.error(t),this.render()}})}render(){tl((e=>{const t=!!va.bookmarks.getUnopenedBookmarks().length,n=vh("Click to toggle the bookmarks list"),s=vh("Bookmarks");return Qc`
        <div class="list-container list-container--bookmarks ${t?"":"hidden"}">
            <a class="list-toggle bookmarks-toggle controlbox-padded"
               title="${n}"
               @click=${e.toggleBookmarksList}>

                <span class="fa ${e.toggle_state===va.OPENED?"fa-caret-down":"fa-caret-right"}">
                </span> ${s}</a>
            <div class="items-list bookmarks rooms-list ${e.toggle_state!==va.OPENED?"hidden":""}">
            ${va.bookmarks.map((t=>dg(Object.assign({bm:t},e))))}
            </div>
        </div>
    `})({toggleBookmarksList:e=>this.toggleBookmarksList(e),toggle_state:this.model.get("toggle-state")}),this)}toggleBookmarksList(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=e.target.matches(".fa")?e.target:e.target.querySelector(".fa");fg.hasClass("fa-caret-down",n)?(fg.slideIn(this.querySelector(".bookmarks")),this.model.save({"toggle-state":va.CLOSED}),n.classList.remove("fa-caret-down"),n.classList.add("fa-caret-right")):(n.classList.remove("fa-caret-right"),n.classList.add("fa-caret-down"),fg.slideOut(this.querySelector(".bookmarks")),this.model.save({"toggle-state":va.OPENED}))}}Cl.elements.define("converse-bookmarks",gg);const{u:pg}=jl.env,vg={setBookmarkState(){void 0!==va.bookmarks&&(va.bookmarks.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1))},renderBookmarkForm(){this.bookmark_form||(this.bookmark_form=new va.MUCBookmarkForm({model:this.model,chatroomview:this}),this.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)),pg.showElement(this.bookmark_form.el)},toggleBookmark(e){null==e||e.preventDefault();const t=va.bookmarks.where({jid:this.model.get("jid")});t.length?t.forEach((e=>e.destroy())):this.model.session.set("view",jl.MUC.VIEWS.BOOKMARK)}};var bg=n(3742),yg={};yg.styleTagTransform=eg(),yg.setAttributes=Yf(),yg.insert=Jf().bind(null,"head"),yg.domAPI=Wf(),yg.insertStyleElement=Xf(),Hf()(bg.Z,yg),bg.Z&&bg.Z.locals&&bg.Z.locals,jl.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){Cl.settings.extend({hide_open_bookmarks:!0}),va.removeBookmarkViaEvent=ag,va.addBookmarkViaEvent=cg,Object.assign(va.ChatRoomView.prototype,vg),va.MUCBookmarkForm=ig,va.BookmarksView=gg,Cl.listen.on("getHeadingButtons",og),Cl.listen.on("chatRoomViewInitialized",(e=>e.setBookmarkState()))}});const _g=e=>(...t)=>({_$litDirective$:e,values:t});class wg{constructor(e){}T(e,t,n){this.Σdt=e,this.M=t,this.Σct=n}S(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const{et:Sg}=ml,xg=()=>document.createComment(""),Eg=(e,t,n)=>{var s;const i=e.A.parentNode,r=void 0===t?e.B:t.A;if(void 0===n){const t=i.insertBefore(xg(),r),s=i.insertBefore(xg(),r);n=new Sg(t,s,e,e.options)}else{const t=n.B.nextSibling,o=n.M!==e;if(o&&(null===(s=n.Q)||void 0===s||s.call(n,e),n.M=e),t!==r||o){let e=n.A;for(;e!==t;){const t=e.nextSibling;i.insertBefore(e,r),e=t}}}return n},Ag=(e,t,n=e)=>(e.I(t,n),e),Cg={},Tg=e=>{var t;null===(t=e.P)||void 0===t||t.call(e,!1,!0);let n=e.A;const s=e.B.nextSibling;for(;n!==s;){const e=n.nextSibling;n.remove(),n=e}},kg=(e,t,n)=>{const s=new Map;for(let i=t;i<=n;i++)s.set(e[i],i);return s},jg=_g(class extends wg{constructor(e){if(super(e),2!==e.type)throw Error("repeat() can only be used in text expressions")}Mt(e,t,n){let s;void 0===n?n=t:void 0!==t&&(s=t);const i=[],r=[];let o=0;for(const t of e)i[o]=s?s(t,o):o,r[o]=n(t,o),o++;return{values:r,keys:i}}render(e,t,n){return this.Mt(e,t,n).values}update(e,[t,n,s]){var i;const r=(e=>e.H)(e),{values:o,keys:a}=this.Mt(t,n,s);if(!r)return this.Pt=a,o;const c=null!==(i=this.Pt)&&void 0!==i?i:this.Pt=[],l=[];let d,u,h=0,m=r.length-1,f=0,g=o.length-1;for(;h<=m&&f<=g;)if(null===r[h])h++;else if(null===r[m])m--;else if(c[h]===a[f])l[f]=Ag(r[h],o[f]),h++,f++;else if(c[m]===a[g])l[g]=Ag(r[m],o[g]),m--,g--;else if(c[h]===a[g])l[g]=Ag(r[h],o[g]),Eg(e,l[g+1],r[h]),h++,g--;else if(c[m]===a[f])l[f]=Ag(r[m],o[f]),Eg(e,r[h],r[m]),m--,f++;else if(void 0===d&&(d=kg(a,f,g),u=kg(c,h,m)),d.has(c[h]))if(d.has(c[m])){const t=u.get(a[f]),n=void 0!==t?r[t]:null;if(null===n){const t=Eg(e,r[h]);Ag(t,o[f]),l[f]=t}else l[f]=Ag(n,o[f]),Eg(e,r[h],n),r[t]=null;f++}else Tg(r[m]),m--;else Tg(r[h]),h++;for(;f<=g;){const t=Eg(e,l[g+1]);Ag(t,o[f]),l[f++]=t}for(;h<=m;){const e=r[h++];null!==e&&Tg(e)}return this.Pt=a,((e,t=Cg)=>{e.H=t})(e,l),Xc}});function Ng(e){const{CONTROLBOX_TYPE:t}=va,n="overlayed"===Cl.settings.get("view_mode")&&e.get("minimized");return e.get("type")===t||!(e.get("hidden")||n)}Cl.elements.define("converse-chats",class extends mg{initialize(){this.model=va.chatboxes,this.listenTo(this.model,"add",this.render),this.listenTo(this.model,"change:closed",this.render),this.listenTo(this.model,"change:hidden",this.render),this.listenTo(this.model,"change:jid",this.render),this.listenTo(this.model,"change:minimized",this.render),this.listenTo(this.model,"destroy",this.render),this.listenTo(va,"connected",this.render),this.listenTo(va,"reconnected",this.render),this.listenTo(va,"disconnected",this.render);const e=document.getElementById("conversejs-bg");e&&!e.innerHTML.trim()&&tl(Qc`
    <div class="inner-content converse-brand row">
        <div class="converse-brand__padding"></div>
        <div class="converse-brand__heading">
            <svg height="200px"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                viewBox="0 0 364 364"
                version="1.1">
                <title>Logo Converse</title>
                <defs>
                    <linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse">
                        <stop offset="0" stop-color="#fff1d1"/>
                        <stop offset="0.05" stop-color="#fae8c1"/>
                        <stop offset="0.15" stop-color="#f0d5a1"/>
                        <stop offset="0.27" stop-color="#e7c687"/>
                        <stop offset="0.4" stop-color="#e1bb72"/>
                        <stop offset="0.54" stop-color="#dcb264"/>
                        <stop offset="0.71" stop-color="#daad5c"/>
                        <stop offset="1" stop-color="#d9ac59"/>
                    </linearGradient>
                    <filter id="shadow">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/>
                        <feOffset in="blur1" dx="3" dy="3" result="blur2"/>
                        <feColorMatrix in="blur2" type="matrix" result="blur3"
                            values="1 0 0 0 0.1
                                    0 1 0 0 0.1
                                    0 0 1 0 0.1
                                    0 0 0 1 0"/>
                        <feMerge>
                            <feMergeNode in="blur3"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <g filter="url(#shadow)">
                    <path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/>
                    <path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/>
                </g>
            </svg>
            <span class="converse-brand__text">
                <span>converse<span class="subdued">.js</span></span>
                <p class="byline">messaging freedom</p>
            </span>
        </div>
        ${"overlayed"===Cl.settings.get("view_mode")?Qc`<div class="converse-brand__padding"></div>`:""}
    </div>`,e),document.querySelector("body").classList.add(`converse-${Cl.settings.get("view_mode")}`),this.render(),Cl.trigger("chatBoxViewsInitialized")}render(){tl((()=>{const{chatboxes:e,CONTROLBOX_TYPE:t,CHATROOMS_TYPE:n,HEADLINES_TYPE:s}=va,i=Cl.settings.get("view_mode"),r=null==va?void 0:va.connection,o=!(null!=r&&r.connected)||!(null!=r&&r.authenticated)||(null==r?void 0:r.disconnecting);return Qc`
        ${o||"overlayed"!==i?"":Qc`<converse-minimized-chats></converse-minimized-chats>`}
        ${jg(e.filter(Ng),(e=>e.get("jid")),(e=>e.get("type")===t?Qc`
                    ${"overlayed"===i?Qc`<converse-controlbox-toggle class="${e.get("closed")?"":"hidden"}"></converse-controlbox-toggle>`:""}
                    <converse-controlbox
                        id="controlbox"
                        class="chatbox ${e.get("closed")?"hidden":""} ${o?"logged-out":""}"
                        style="${e.get("width")?`width: ${e.get("width")}`:""}"></converse-controlbox>
                `:e.get("type")===n?Qc`
                    <converse-muc jid="${e.get("jid")}" class="chatbox chatroom"></converse-muc>
                `:e.get("type")===s?Qc`
                    <converse-headlines jid="${e.get("jid")}" class="chatbox headlines"></converse-headlines>
                `:Qc`
                    <converse-chat jid="${e.get("jid")}" class="chatbox"></converse-chat>
                `))}
    `})(),this)}});const Og=e=>{return e.image?Qc`
                <svg xmlns="http://www.w3.org/2000/svg" class="avatar ${e.classes}" width="${e.width}" height="${e.height}">
                    <image width="${e.width}" height="${e.height}" preserveAspectRatio="xMidYMid meet" href="${t=e.image,n=e.image_type,t.startsWith("data:")?t:`data:${n};base64,${t}`}"/>
                </svg>`:"";var t,n},$g=/^\s*</,Ig=("undefined"!=typeof Element&&Element.prototype,function(e){this.cid=Ts("view"),this._domEvents=[],this.preinitialize.apply(this,arguments),Ct(this,ko(e,Rg)),this._ensureElement(),this.initialize.apply(this,arguments)});Ig.extend=Ws;const Mg=/^(\S+)\s*(.*)$/,Rg=["model","collection","el","id","attributes","className","tagName","events"];Object.assign(Ig.prototype,ks,{tagName:"div",$:function(e){return this.el.querySelectorAll(e)},preinitialize:function(){},initialize:function(){},render:function(){return ve(this.beforeRender)&&this.beforeRender(),ve(this.toHTML)&&tl(this.toHTML(),this.el),ve(this.afterRender)&&this.afterRender(),this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.undelegateEvents(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){if("string"==typeof e)if($g.test(e)){const t=document.createElement("div");t.innerHTML=e,this.el=t.firstChild}else this.el=document.querySelector(e);else e&&!T(e)&&e.length?this.el=e[0]:this.el=e},delegateEvents:function(e){if(e||(e=Gs(this,"events")),!e)return this;this.undelegateEvents();for(const t in e){let n=e[t];if(ve(n)||(n=this[n]),!n)continue;const s=t.match(Mg);this.delegate(s[1],s[2],n.bind(this))}return this},delegate:function(e,t,n){const s=this.el;if(!s)return this;if("function"==typeof t&&(n=t,t=null),-1!==["focus","blur"].indexOf(e)){const s=this.el.querySelectorAll(t);for(let t=0,i=s.length;t<i;t++){const i=s[t];i.addEventListener(e,n,!1),this._domEvents.push({el:i,eventName:e,handler:n})}return n}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=s;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,n(e))}:n;return this.el.addEventListener(e,i,!1),this._domEvents.push({el:this.el,eventName:e,handler:i,listener:n,selector:t}),this},undelegateEvents:function(){if(this.el){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this},undelegate:function(e,t,n){if("function"==typeof t&&(n=t,t=null),this.el){const s=this._domEvents.slice();let i=s.length;for(;i--;){const r=s[i];!(r.eventName!==e||n&&r.listener!==n||t&&r.selector!==t)&&(r.el.removeEventListener(r.eventName,r.handler,!1),this._domEvents.splice(i,1))}}return this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(Gs(this,"el"));else{const e=Ct({},Gs(this,"attributes"));this.id&&(e.id=Gs(this,"id")),this.className&&(e.class=Gs(this,"className")),this.setElement(this._createElement(Gs(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){for(const t in e)t in this.el?this.el[t]=e[t]:this.el.setAttribute(t,e[t])}});const Dg=jl.env.utils,Lg={renderAvatar(e){const t=(e=e||((null==this?void 0:this.el)??this)).querySelector("canvas.avatar, svg.avatar");if(null!==t&&this.model.vcard){const e={classes:t.getAttribute("class"),width:t.getAttribute("width"),height:t.getAttribute("height"),image_type:this.model.vcard.get("image_type"),image:this.model.vcard.get("image")};t.outerHTML=Dg.getElementFromTemplateResult(Og(e)).outerHTML}}},zg=Ig.extend(Lg);class Pg extends mg{renderAvatar(e){Lg.renderAvatar.call(this,e)}}function Fg(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}var Ug=n(7904),Bg={};Bg.styleTagTransform=eg(),Bg.setAttributes=Yf(),Bg.insert=Jf().bind(null,"head"),Bg.domAPI=Wf(),Bg.insertStyleElement=Xf(),Hf()(Ug.Z,Bg),Ug.Z&&Ug.Z.locals&&Ug.Z.locals,jl.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){Cl.elements.register(),Cl.promises.add(["chatBoxViewsInitialized"]),Cl.settings.extend({animate:!0,theme:"default"}),va.ViewWithAvatar=zg,va.chatboxviews=new class{constructor(){this.views={}}add(e,t){this.views[e]=t}get(e){return this.views[e]}getAll(){return Object.values(this.views)}keys(){return Object.keys(this.views)}remove(e){delete this.views[e]}map(e){return Object.values(this.views).map(e)}forEach(e){return Object.values(this.views).forEach(e)}filter(e){return Object.values(this.views).filter(e)}closeAllChatBoxes(){return Promise.all(Object.values(this.views).map((e=>e.close({name:"closeAllChatBoxes"}))))}},Cl.listen.on("chatBoxesInitialized",(()=>{va.chatboxes.on("destroy",(e=>va.chatboxviews.remove(e.get("jid"))))})),Cl.listen.on("cleanup",(()=>delete va.chatboxviews)),Cl.listen.on("clearSession",(()=>va.chatboxviews.closeAllChatBoxes())),Cl.listen.on("chatBoxViewsInitialized",Fg),window.addEventListener("resize",Fg),Object.assign(jl,{insertInto(e){var t;const n=null===(t=va.chatboxviews)||void 0===t?void 0:t.el;if(n&&!e.contains(n))e.insertAdjacentElement("afterBegin",n);else if(!n)throw new Error("Cannot insert non-existing #conversejs element into the DOM")}})}});var qg=n(6434),Hg=n.n(qg),Gg=n(6300),Wg={};Wg.styleTagTransform=eg(),Wg.setAttributes=Yf(),Wg.insert=Jf().bind(null,"head"),Wg.domAPI=Wf(),Wg.insertStyleElement=Xf(),Hf()(Gg.Z,Wg),Gg.Z&&Gg.Z.locals&&Gg.Z.locals;const{sizzle:Vg}=jl.env,Jg=jl.env.utils,Kg=Ig.extend({className:"modal",persistent:!1,events:{"click  .nav-item .nav-link":"switchTab"},initialize(e){if(!this.id)throw new Error("Each modal class must have a unique id attribute");Object.assign(this,e),this.render(),this.el.setAttribute("tabindex","-1"),this.el.setAttribute("role","dialog"),this.el.setAttribute("aria-hidden","true");const t=this.el.querySelector(".modal-title").getAttribute("id");t&&this.el.setAttribute("aria-labelledby",t),this.insertIntoDOM();const n=Hg().Modal;this.modal=new n(this.el,{backdrop:!0,keyboard:!0}),this.el.addEventListener("hide.bs.modal",(()=>this.onHide()),!1)},onHide(){Jg.removeClass("selected",this.trigger_el),!this.persistent&&Cl.modal.remove(this)},insertIntoDOM(){document.querySelector("#converse-modals").insertAdjacentElement("beforeEnd",this.el)},switchTab(e){e.stopPropagation(),e.preventDefault(),Vg(".nav-link.active",this.el).forEach((e=>{Jg.removeClass("active",this.el.querySelector(e.getAttribute("href"))),Jg.removeClass("active",e)})),Jg.addClass("active",e.target),Jg.addClass("active",this.el.querySelector(e.target.getAttribute("href")))},alert(e,t="primary"){const n=this.el.querySelector(".modal-alert");if(null===n)return void M.error("Could not find a .modal-alert element in the modal to show an alert message in!");tl((e=>Qc`<div class="alert ${e.type}" role="alert"><p>${e.message}</p></div>`)({type:`alert-${t}`,message:e}),n);const s=n.firstElementChild;setTimeout((()=>{Jg.addClass("fade-out",s),setTimeout((()=>Jg.removeElement(s)),600)}),5e3)},show(e){e&&(e.preventDefault(),this.trigger_el=e.target,!Jg.hasClass("chat-image",this.trigger_el)&&Jg.addClass("selected",this.trigger_el)),this.modal.show()}}),Yg=Qc`<button type="button" class="btn btn-secondary" data-dismiss="modal">${vh("Close")}</button>`,Qg=Qc`<button type="button" class="close" data-dismiss="modal" aria-label="${vh("Close")}"><span aria-hidden="true">×</span></button>`,Xg=Kg.extend({id:"alert-modal",initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render)},toHTML(){return(e=>Qc`
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header ${e.level}">
              <h5 class="modal-title">${e.title}</h5>
              ${Qg}
            </div>
            <div class="modal-body">
              <span class="modal-alert"></span>
              ${e.messages.map((e=>Qc`<p>${e}</p>`))}
            </div>
        </div>
    </div>
`)(Object.assign({__:vh},this.model.toJSON()))}}),Zg=Kg.extend({id:"confirm-modal",events:{"submit .confirm":"onConfimation"},initialize(){this.confirmation=ji(),Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.el.addEventListener("closed.bs.modal",(()=>this.confirmation.reject()),!1)},toHTML(){return(e=>Qc`
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header ${e.level||""}">
          <h5 class="modal-title">${e.title}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">
            <span class="modal-alert"></span>
            <form class="converse-form converse-form--modal confirm" action="#">
              <div class="form-group">
                  ${e.messages.map((e=>Qc`<p>${e}</p>`))}
              </div>
              ${e.fields.map((e=>(e=>Qc`
    <div class="form-group">
        <label>
            ${e.label||""}
            <input type="text"
                name="${e.name}"
                class="${e.challenge_failed?"error":""} form-control form-control--labeled"
                ?required="${e.required}"
                placeholder="${e.placeholder}" />
        </label>
    </div>
`)(e)))}
              <div class="form-group">
                  <button type="submit" class="btn btn-primary">${vh("OK")}</button>
                  <input type="button" class="btn btn-secondary" data-dismiss="modal" value="${vh("Cancel")}"/>
              </div>
          </form>
        </div>
      </div>
    </div>
`)(this.model.toJSON())},afterRender(){this.close_handler_registered||(this.el.addEventListener("closed.bs.modal",(()=>{this.confirmation.isResolved||this.confirmation.reject()}),!1),this.close_handler_registered=!0)},onConfimation(e){e.preventDefault();const t=new FormData(e.target),n=(this.model.get("fields")||[]).map((e=>{const n=t.get(e.name).trim();return e.value=n,e.challenge&&(e.challenge_failed=n!==e.challenge),e}));if(n.filter((e=>e.challenge_failed)).length)return this.model.set("fields",n),void this.model.trigger("change");this.confirmation.resolve(n),this.modal.hide()}});jl.env.BootstrapModal=Kg;let ep=[];const tp={modal:{show(e,t,n){const s=this.get(e.id)||this.create(e,t);return s.show(n),s},get:e=>ep.filter((t=>t.id==e)).pop(),create(e,t){const n=new e(t);return ep.push(n),n},remove(e){ep=ep.filter((t=>t!==e)),e.remove()},removeAll(){ep.forEach((e=>e.remove())),ep=[]}},async confirm(e,t=[],n=[]){"string"==typeof t&&(t=[t]);const s=new Zo({title:e,messages:t,fields:n,type:"confirm"}),i=new Zg({model:s});let r;i.show();try{r=await i.confirmation}catch(e){r=!1}return i.remove(),r},async prompt(e,t=[],n=""){"string"==typeof t&&(t=[t]);const s=new Zo({title:e,messages:t,fields:[{name:"reason",placeholder:n}],type:"prompt"}),i=new Zg({model:s});let r;i.show();try{var o;r=null===(o=(await i.confirmation).pop())||void 0===o?void 0:o.value}catch(e){r=!1}return i.remove(),r},alert(e,t,n){let s;"string"==typeof n&&(n=[n]),"error"===e?s="alert-danger":"info"===e?s="alert-info":"warn"===e&&(s="alert-warning");const i=new Zo({title:t,messages:n,level:s,type:"alert"});Cl.modal.show(Xg,{model:i})}};jl.plugins.add("converse-modal",{initialize(){Cl.listen.on("disconnect",(()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")})),Cl.listen.on("clearSession",(()=>Cl.modal.removeAll())),Object.assign(va.api,tp)}});const np=(e,t)=>{var n,s;const i=e.N;if(void 0===i)return!1;for(const e of i)null===(s=(n=e).O)||void 0===s||s.call(n,t,!1),np(e,t);return!0},sp=e=>{let t,n;do{if(void 0===(t=e.M))break;n=t.N,n.delete(e),e=t}while(0===(null==n?void 0:n.size))},ip=e=>{for(let t;t=e.M;e=t){let n=t.N;if(void 0===n)t.N=n=new Set;else if(n.has(e))break;n.add(e),ap(t)}};function rp(e){void 0!==this.N?(sp(this),this.M=e,ip(this)):this.M=e}function op(e,t=!1,n=0){const s=this.H,i=this.N;if(void 0!==i&&0!==i.size)if(t)if(Array.isArray(s))for(let e=n;e<s.length;e++)np(s[e],!1),sp(s[e]);else null!=s&&(np(s,!1),sp(s));else np(this,e)}const ap=e=>{var t,n,s,i;2==e.type&&(null!==(t=(s=e).P)&&void 0!==t||(s.P=op),null!==(n=(i=e).Q)&&void 0!==n||(i.Q=rp))};class cp extends wg{constructor(){super(...arguments),this.isConnected=!0,this.ut=Xc,this.N=void 0}T(e,t,n){super.T(e,t,n),ip(this)}O(e,t=!0){this.at(e),t&&(np(this,e),sp(this))}at(e){var t,n;e!==this.isConnected&&(e?(this.isConnected=!0,this.ut!==Xc&&(this.setValue(this.ut),this.ut=Xc),null===(t=this.reconnected)||void 0===t||t.call(this)):(this.isConnected=!1,null===(n=this.disconnected)||void 0===n||n.call(this)))}S(e,t){if(!this.isConnected)throw Error(`AsyncDirective ${this.constructor.name} was rendered while its tree was disconnected.`);return super.S(e,t)}setValue(e){if(this.isConnected)if((e=>void 0===this.Σdt.strings)())this.Σdt.I(e,this);else{const t=[...this.Σdt.H];t[this.Σct]=e,this.Σdt.I(t,this,0)}else this.ut=e}disconnected(){}reconnected(){}}const lp=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,dp=_g(class extends cp{constructor(){super(...arguments),this.Ct=2147483647,this.Rt=[]}render(...e){var t;return null!==(t=e.find((e=>!lp(e))))&&void 0!==t?t:Xc}update(e,t){const n=this.Rt;let s=n.length;this.Rt=t;for(let e=0;e<t.length&&!(e>this.Ct);e++){const i=t[e];if(!lp(i))return this.Ct=e,i;e<s&&i===n[e]||(this.Ct=2147483647,s=0,Promise.resolve(i).then((e=>{const t=this.Rt.indexOf(i);t>-1&&t<this.Ct&&(this.Ct=t,this.setValue(e))})))}return Xc}}),{Strophe:up,u:hp}=jl.env;class mp extends Uf{static get properties(){return{correcting:{type:Boolean},editable:{type:Boolean},hide_url_previews:{type:Boolean},is_retracted:{type:Boolean},message_type:{type:String},model:{type:Object},unfurls:{type:Number}}}render(){return Qc`${dp(this.renderActions(),"")}`}async renderActions(){const e=this.model.collection.length>2&&this.model===this.model.collection.last(),t=(await this.getActionButtons()).map((e=>mp.getActionsDropdownItem(e)));return t.length?Qc`<converse-dropdown
                class="chat-msg__actions ${e?"dropup dropup--left":"dropleft"}"
                .items=${t}
            ></converse-dropdown>`:""}static getActionsDropdownItem(e){return Qc`
            <button class="chat-msg__action ${e.button_class}" @click=${e.handler}>
                <converse-icon
                    class="${e.icon_class}"
                    path-prefix="${Cl.settings.get("assets_path")}"
                    color="var(--text-color-lighten-15-percent)"
                    size="1em"
                ></converse-icon>
                ${e.i18n_text}
            </button>
        `}onMessageEditButtonClicked(e){var t,n;e.preventDefault();const s=this.model.collection.findWhere("correcting"),i=null===(t=hp.ancestor(this,".chatbox"))||void 0===t||null===(n=t.querySelector(".chat-textarea"))||void 0===n?void 0:n.value;(!i||s&&s.get("message")===i||confirm(vh("You have an unsent message which will be lost if you continue. Are you sure?")))&&(s!==this.model?(null==s||s.save("correcting",!1),this.model.save("correcting",!0)):this.model.save("correcting",!1))}async onDirectMessageRetractButtonClicked(){if("me"!==this.model.get("sender"))return M.error("onMessageRetractButtonClicked called for someone else's message!");const e=vh("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),t=[vh("Are you sure you want to retract this message?")];Cl.settings.get("show_retraction_warning")&&(t[1]=e),await Cl.confirm(vh("Confirm"),t)&&this.model.collection.chatbox.retractOwnMessage(this.model)}async retractOtherMessage(e){const t=this.model.collection.chatbox,n=await t.retractOtherMessage(this.model,e);if(null===n){const e=vh("A timeout occurred while trying to retract the message");Cl.alert("error",vh("Error"),e),M(e,up.LogLevel.WARN)}else if(hp.isErrorStanza(n)){const e=vh("Sorry, you're not allowed to retract this message.");Cl.alert("error",vh("Error"),e),M(e,up.LogLevel.WARN),M(n,up.LogLevel.WARN)}}async onMUCMessageRetractButtonClicked(){const e=vh("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(this.model.mayBeRetracted()){const t=[vh("Are you sure you want to retract this message?")];Cl.settings.get("show_retraction_warning")&&(t[1]=e),await Cl.confirm(vh("Confirm"),t)&&this.model.collection.chatbox.retractOwnMessage(this.model)}else if(await this.model.mayBeModerated())if("me"===this.model.get("sender")){let t=[vh("Are you sure you want to retract this message?")];Cl.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]),await Cl.confirm(vh("Confirm"),t)&&this.retractOtherMessage()}else{let t=[vh("You are about to retract this message."),vh("You may optionally include a message, explaining the reason for the retraction.")];Cl.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]);const n=await Cl.prompt(vh("Message Retraction"),t,vh("Optional reason"));!1!==n&&this.retractOtherMessage(n)}else{const e=vh("Sorry, you're not allowed to retract this message");Cl.alert("error",vh("Error"),e)}}onMessageRetractButtonClicked(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.collection.chatbox.get("type")===va.CHATROOMS_TYPE?this.onMUCMessageRetractButtonClicked():this.onDirectMessageRetractButtonClicked()}onHidePreviewsButtonClicked(e){var t;if(null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.hide_url_previews)this.model.save({hide_url_previews:!1,url_preview_transition:"fade-in"});else{const e=this.model.get("ogp_metadata")||[];Cl.settings.get("muc_show_ogp_unfurls")&&e.length?this.model.set("url_preview_transition","fade-out"):this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}}async getActionButtons(){var e;const t=[];this.editable&&t.push({i18n_text:this.correcting?vh("Cancel Editing"):vh("Edit"),handler:e=>this.onMessageEditButtonClicked(e),button_class:"chat-msg__action-edit",icon_class:"fa fa-pencil-alt",name:"edit"});const n="groupchat"===this.model.get("type")&&await this.model.mayBeModerated();if(!this.is_retracted&&(this.model.mayBeRetracted()||n)&&t.push({i18n_text:vh("Retract"),handler:e=>this.onMessageRetractButtonClicked(e),button_class:"chat-msg__action-retract",icon_class:"fas fa-trash-alt",name:"retract"}),!this.model.collection)return[];const s=this.model.get("ogp_metadata")||[],i=Cl.settings.get("muc_show_ogp_unfurls")&&s.length,r=null===(e=this.model.get("media_urls"))||void 0===e?void 0:e.length;if(i||r){let e;const n=this.hide_url_previews;e=s.length>1?vh(n?"Show URL previews":"Hide URL previews"):1===s.length?vh(n?"Show URL preview":"Hide URL preview"):vh(n?"Show media":"Hide media"),t.push({i18n_text:e,handler:e=>this.onHidePreviewsButtonClicked(e),button_class:"chat-msg__action-hide-previews",icon_class:this.hide_url_previews?"fas fa-eye":"fas fa-eye-slash",name:"hide"})}return Cl.hook("getMessageActionButtons",this,t)}}Cl.elements.define("converse-message-actions",mp);const fp=Kg.extend({id:"image-modal",toHTML(){return(e=>Qc`
        <div class="modal-dialog fit-content" role="document">
            <div class="modal-content fit-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="message-versions-modal-label">${vh("Image: ")}<a target="_blank" rel="noopener" href="${e.src}">${e.src}</a></h4>
                    ${Qg}
                </div>
                <div class="modal-body modal-body--image fit-content">
                    <img class="chat-image" src="${e.src}" @load=${e.onload}>
                </div>
                <div class="modal-footer">${Yg}</div>
            </div>
        </div>`)({src:this.src,onload:e=>e.target.parentElement.style.height=`${e.target.height}px`})}}),gp=(e,t)=>Qc`<audio controls src="${e}"></audio>${t?"":Qc`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`;class pp{constructor(e){e.toString().indexOf("ArrayBuffer")>0&&(e=new Uint8Array(e)),this.data=e,this.len=this.data.length,this.pos=0}readByte(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return this.data instanceof Uint8Array?this.data[this.pos++]:255&this.data.charCodeAt(this.pos++)}readBytes(e){const t=[];for(let n=0;n<e;n++)t.push(this.readByte());return t}read(e){let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(this.readByte());return t}readUnsigned(){const e=this.readBytes(2);return(e[1]<<8)+e[0]}}function vp(e){return e.reduce((function(e,t){return 2*e+t}),0)}function bp(e){const t=[];for(let n=7;n>=0;n--)t.push(!!(e&1<<n));return t}function yp(e){let t,n;n="";do{t=e.readByte(),n+=e.read(t)}while(0!==t);return n}function _p(e,t){const n=[];for(let s=0;s<t;s++)n.push(e.readBytes(3));return n}function wp(e,t){const n={};switch(n.sentinel=e.readByte(),String.fromCharCode(n.sentinel)){case"!":n.type="ext",function(e,t,n){switch(t.label=e.readByte(),t.label){case 249:t.extType="gce",function(t){e.readByte();const s=bp(e.readByte());t.reserved=s.splice(0,3),t.disposalMethod=vp(s.splice(0,3)),t.userInput=s.shift(),t.transparencyGiven=s.shift(),t.delayTime=e.readUnsigned(),t.transparencyIndex=e.readByte(),t.terminator=e.readByte(),null==n||n.gce(t)}(t);break;case 254:t.extType="com",function(t){t.comment=yp(e),n.com&&n.com(t)}(t);break;case 1:t.extType="pte",function(t){e.readByte(),t.ptHeader=e.readBytes(12),t.ptData=yp(e),n.pte&&n.pte(t)}(t);break;case 255:t.extType="app",function(t){switch(e.readByte(),t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":!function(t){e.readByte(),t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),n.app&&n.app.NETSCAPE&&n.app.NETSCAPE(t)}(t);break;default:!function(t){t.appData=yp(e),n.app&&n.app[t.identifier]&&n.app[t.identifier](t)}(t)}}(t);break;default:t.extType="unknown",function(t){t.data=yp(e),n.unknown&&n.unknown(t)}(t)}}(e,n,t);break;case",":n.type="img",function(e,t,n){t.leftPos=e.readUnsigned(),t.topPos=e.readUnsigned(),t.width=e.readUnsigned(),t.height=e.readUnsigned();const s=bp(e.readByte());t.lctFlag=s.shift(),t.interlaced=s.shift(),t.sorted=s.shift(),t.reserved=s.splice(0,2),t.lctSize=vp(s.splice(0,3)),t.lctFlag&&(t.lct=_p(e,1<<t.lctSize+1)),t.lzwMinCodeSize=e.readByte();const i=yp(e);t.pixels=function(e,t){let n=0;function s(e){let s=0;for(let i=0;i<e;i++)t.charCodeAt(n>>3)&1<<(7&n)&&(s|=1<<i),n++;return s}const i=[],r=1<<e,o=r+1;let a=e+1,c=[];const l=function(){c=[],a=e+1;for(let e=0;e<r;e++)c[e]=[e];c[r]=[],c[o]=null};let d,u;for(;;)if(u=d,d=s(a),d!==r){if(d===o)break;if(d<c.length)u!==r&&c.push(c[u].concat(c[d][0]));else{if(d!==c.length)throw new Error("Invalid LZW code.");c.push(c[u].concat(c[u][0]))}i.push.apply(i,c[d]),c.length===1<<a&&a<12&&a++}else l();return i}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=function(e,t){const n=new Array(e.length),s=e.length/t;function i(s,i){const r=e.slice(i*t,(i+1)*t);n.splice.apply(n,[s*t,t].concat(r))}const r=[0,4,2,1],o=[8,8,4,2];let a=0;for(let e=0;e<4;e++)for(let t=r[e];t<s;t+=o[e])i(t,a),a++;return n}(t.pixels,t.width)),null==n||n(t)}(e,n,null==t?void 0:t.img);break;case";":n.type="eof",null==t||t.eof(n);break;default:throw new Error("Unknown block: 0x"+n.sentinel.toString(16))}"eof"!==n.type&&setTimeout((()=>wp(e,t)),0)}class Sp{constructor(e,t){this.options=Object.assign({width:null,height:null,autoplay:!0,loop:!0,show_progress_bar:!0,progress_bg_color:"rgba(0,0,0,0.4)",progress_color:"rgba(255,0,22,.8)",progress_bar_height:5},t),this.el=e,this.gif_el=e.querySelector("img"),this.canvas=e.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.ctx_scaled=!1,this.disposal_method=null,this.disposal_restore_from_idx=null,this.frame=null,this.frame_offsets=[],this.frames=[],this.last_disposal_method=null,this.last_img=null,this.load_error=null,this.playing=this.options.autoplay,this.transparency=null,this.frame_idx=0,this.iteration_count=0,this.start=null,this.initialize()}async initialize(){this.options.width&&this.options.height&&this.setSizes(this.options.width,this.options.height);const e=await this.fetchGIF(this.gif_el.src);requestAnimationFrame((()=>this.startParsing(e)))}initPlayer(){if(!this.load_error&&(this.options.width&&this.options.height||this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.frame_idx=0,this.putFrame(this.frame_idx),this.options.autoplay)){var e;const t=10*((null===(e=this.frames[this.frame_idx])||void 0===e?void 0:e.delay)??0);setTimeout((()=>this.play()),t)}}getNextFrameNo(){return(this.frame_idx+1+this.frames.length)%this.frames.length}onIterationEnd(){var e,t;return this.iteration_count++,null===(e=(t=this.options).onIterationEnd)||void 0===e||e.call(t,this),!this.options.loop&&(this.pause(),!0)}onAnimationFrame(e,t,n){var s;if(!this.playing)return;if(e-t<n)return this.hovering?this.drawPauseIcon():this.putFrame(this.frame_idx),void requestAnimationFrame((e=>this.onAnimationFrame(e,t,n)));const i=this.getNextFrameNo();if(0===i&&this.onIterationEnd())return;this.frame_idx=i,this.putFrame(this.frame_idx);const r=10*((null===(s=this.frames[this.frame_idx])||void 0===s?void 0:s.delay)||8);requestAnimationFrame((t=>this.onAnimationFrame(t,e,r)))}setSizes(e,t){this.canvas.width=e*this.getCanvasScale(),this.canvas.height=t*this.getCanvasScale(),this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,this.offscreenCanvas.style.width=e+"px",this.offscreenCanvas.style.height=t+"px",this.offscreenCanvas.getContext("2d").setTransform(1,0,0,1,0,0)}setFrameOffset(e,t){this.frame_offsets[e]?(void 0!==t.x&&(this.frame_offsets[e].x=t.x),void 0!==t.y&&(this.frame_offsets[e].y=t.y)):this.frame_offsets[e]=t}doShowProgress(e,t,n){if(n&&this.options.show_progress_bar){let n=this.options.progress_bar_height;const s=(this.canvas.height-n)/(this.ctx_scaled?this.getCanvasScale():1),i=e/t*this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1),r=this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1);n/=this.ctx_scaled?this.getCanvasScale():1,this.ctx.fillStyle=this.options.progress_bg_color,this.ctx.fillRect(i,s,r-i,n),this.ctx.fillStyle=this.options.progress_color,this.ctx.fillRect(0,s,i,n)}}startParsing(e){const t=new pp(e),n={hdr:this.withProgress(t,(e=>this.handleHeader(e))),gce:this.withProgress(t,(e=>this.handleGCE(e))),com:this.withProgress(t),img:this.withProgress(t,(e=>this.doImg(e)),!0),eof:()=>this.handleEOF(t)};try{!function(e,t={}){!function(e,t){const n={};if(n.sig=e.read(3),n.ver=e.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=e.readUnsigned(),n.height=e.readUnsigned();const s=bp(e.readByte());n.gctFlag=s.shift(),n.colorRes=vp(s.splice(0,3)),n.sorted=s.shift(),n.gctSize=vp(s.splice(0,3)),n.bgColor=e.readByte(),n.pixelAspectRatio=e.readByte(),n.gctFlag&&(n.gct=_p(e,1<<n.gctSize+1)),null==t||t(n)}(e,null==t?void 0:t.hdr),setTimeout((()=>wp(e,t)),0)}(t,n)}catch(e){this.showError("parse")}}drawError(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.options.width?this.options.width:this.hdr.width,this.options.height?this.options.height:this.hdr.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(this.options.width?this.options.width:this.hdr.width,this.options.height?this.options.height:this.hdr.height),this.ctx.moveTo(0,this.options.height?this.options.height:this.hdr.height),this.ctx.lineTo(this.options.width?this.options.width:this.hdr.width,0),this.ctx.stroke()}showError(e){this.load_error=e,this.hdr={width:this.gif_el.width,height:this.gif_el.height},this.frames=[],this.drawError(),this.el.requestUpdate()}handleHeader(e){this.hdr=e,this.setSizes(this.options.width??this.hdr.width,this.options.height??this.hdr.height)}handleGCE(e){this.pushFrame(e.delayTime),this.clear(),this.transparency=e.transparencyGiven?e.transparencyIndex:null,this.disposal_method=e.disposalMethod}handleEOF(e){this.doDecodeProgress(e,!1),this.options.width&&this.options.height||(this.canvas.width=this.hdr.width*this.getCanvasScale(),this.canvas.height=this.hdr.height*this.getCanvasScale()),this.initPlayer(),!this.options.autoplay&&this.drawPlayIcon()}pushFrame(e){this.frame&&(this.frames.push({data:this.frame.getImageData(0,0,this.hdr.width,this.hdr.height),delay:e}),this.frame_offsets.push({x:0,y:0}))}doImg(e){this.frame=this.frame||this.offscreenCanvas.getContext("2d");const t=this.frames.length,n=e.lctFlag?e.lct:this.hdr.gct;t>0&&(3===this.last_disposal_method?null!==this.disposal_restore_from_idx?this.frame.putImageData(this.frames[this.disposal_restore_from_idx].data,0,0):this.frame.clearRect(this.last_img.leftPos,this.last_img.topPos,this.last_img.width,this.last_img.height):this.disposal_restore_from_idx=t-1,2===this.last_disposal_method&&this.frame.clearRect(this.last_img.leftPos,this.last_img.topPos,this.last_img.width,this.last_img.height));const s=this.frame.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(((e,t)=>{e!==this.transparency&&(s.data[4*t+0]=n[e][0],s.data[4*t+1]=n[e][1],s.data[4*t+2]=n[e][2],s.data[4*t+3]=255)})),this.frame.putImageData(s,e.leftPos,e.topPos),this.ctx_scaled||(this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.ctx_scaled=!0),this.last_img||this.ctx.drawImage(this.offscreenCanvas,0,0),this.last_img=e}putFrame(e,t=!0){(e=parseInt(e,10))>this.frames.length-1&&(e=0),e<0&&(e=0);const n=this.frame_offsets[e];this.offscreenCanvas.getContext("2d").putImageData(this.frames[e].data,n.x,n.y),this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.offscreenCanvas,0,0),t&&this.hovering&&this.drawPauseIcon()}clear(){this.transparency=null,this.last_disposal_method=this.disposal_method,this.disposal_method=null,this.frame=null}play(){this.playing=!0,requestAnimationFrame((e=>this.onAnimationFrame(e,0,0)))}pause(){this.playing=!1,requestAnimationFrame((()=>this.drawPlayIcon()))}drawPauseIcon(){if(!this.playing)return;this.putFrame(this.frame_idx,!1),this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height;this.ctx.lineWidth=.04*this.canvas.height,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2-e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2+e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2+e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,1.5*e,0,2*Math.PI),this.ctx.stroke()}drawPlayIcon(){if(this.playing)return;this.putFrame(this.frame_idx,!1),this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height,t=new Path2D;t.moveTo(this.canvas.width/2+e,this.canvas.height/2),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2-e),t.closePath(),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.fill(t);const n=1.5*e;this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,n,0,2*Math.PI),this.ctx.stroke()}doDecodeProgress(e,t){this.doShowProgress(e.pos,e.data.length,t)}withProgress(e,t,n){return s=>{null==t||t(s),this.doDecodeProgress(e,n)}}getCanvasScale(){let e;return e=this.options.max_width&&this.hdr&&this.hdr.width>this.options.max_width?this.options.max_width/this.hdr.width:1,e}fetchGIF(e){const t=ji(),n=new XMLHttpRequest;return n.open("GET",e,!0),null==n||n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=()=>{if(200!=n.status)return this.showError("xhr - response"),t.reject();t.resolve(n.response)},n.onprogress=e=>e.lengthComputable&&this.doShowProgress(e.loaded,e.total,!0),n.onerror=()=>this.showError("xhr"),n.send(),t}}const xp=(e,t)=>{const n=vh('Download file "%1$s"',t);return Qc`<a target="_blank" rel="noopener" href="${e}">${n}</a>`},Ep=e=>Qc`
    <div class="form-group">
        ${"hidden"!==e.type?Qc`<label for="${e.id}">${e.label}</label>`:""}

        <!-- This is a hack to prevent Chrome from auto-filling the username in
             any of the other input fields in the MUC configuration form. -->
        ${"password"===e.type&&e.fixed_username?Qc`
            <input class="hidden-username" type="text" autocomplete="username" value="${e.fixed_username}"></input>
        `:""}

        <input
            autocomplete="${e.autocomplete||""}"
            class="form-control"
            id="${e.id}"
            name="${e.name}"
            placeholder="${e.placeholder||""}"
            type="${e.type}"
            value="${e.value||""}"
            ?required=${e.required} />
    </div>`,Ap=e=>Qc`
    <label>${e.label}
        <a class="form-url" target="_blank" rel="noopener" href="${e.value}">${e.value}</a>
    </label>`,Cp=e=>Qc`
    <div class="form-group">
        ${e.label?Qc`<label>${e.label}</label>`:""}
        <div class="input-group">
            <div class="input-group-prepend">
                <input name="${e.name}"
                       type="${e.type}"
                       value="${e.value||""}"
                       ?required="${e.required}" />
                <div class="input-group-text col" title="${e.domain}">${e.domain}</div>
            </div>
        </div>
    </div>`;function Tp(e){e.preventDefault(),Cl.rooms.open(e.target.href)}const kp=(e,t)=>{let n=e.normalize()._string;const s=e._parts.urn?n:e.readable(),i=t||s;return e._parts.protocol||n.startsWith("http://")||n.startsWith("https://")||(n="http://"+n),"xmpp"===e._parts.protocol&&"join"===e._parts.query?Qc`
            <a target="_blank"
               rel="noopener"
               @click=${Tp}
               href="${n}">${i}</a>`:Qc`<a target="_blank" rel="noopener" href="${n}">${i}</a>`},jp=(e,t)=>Qc`<video controls preload="metadata" src="${e}"></video>${t?"":Qc`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{sizzle:Np}=jl.env,Op=["http","https","xmpp","mailto"];function $p(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":null!=t&&t.new_password?"new-password":"current-password"}[e]}const Ip={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"};function Mp(e){const t=Il(e);return null===t?e:Bl(t)?jp(e):Ul(t)?gp(e):(ql(t),xp(t.toString(),function(e){try{return decodeURI(e.filename())}catch(t){return M.debug(t),e.filename()}}(t)))}function Rp(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e,n=Il(e);return null===n||!function(e){try{return!!new URL(e)}catch(e){return!1}}(t)||!function(e,t=Op){return!!t.includes(e)}(n._parts.protocol)&&n._parts.protocol?e:kp(n,e)}function Dp(e,t){e.classList.remove("visible"),ve(t)&&t()}la.calculateElementHeight=function(e){return Array.from(e.children).reduce(((e,t)=>e+t.offsetHeight),0)},la.getNextElement=function(e,t="*"){let n=e.nextElementSibling;for(;null!==n&&!Np.matchesSelector(n,t);)n=n.nextElementSibling;return n},la.getPreviousElement=function(e,t="*"){let n=e.previousElementSibling;for(;null!==n&&!Np.matchesSelector(n,t);)n=n.previousElementSibling;return n},la.getFirstChildElement=function(e,t="*"){let n=e.firstElementChild;for(;null!==n&&!Np.matchesSelector(n,t);)n=n.nextElementSibling;return n},la.getLastChildElement=function(e,t="*"){let n=e.lastElementChild;for(;null!==n&&!Np.matchesSelector(n,t);)n=n.previousElementSibling;return n},la.hasClass=function(e,t){return t instanceof Element&&t.classList.contains(e)},la.toggleClass=function(e,t){la.hasClass(e,t)?la.removeClass(e,t):la.addClass(e,t)},la.addClass=function(e,t){return t instanceof Element&&t.classList.add(e),t},la.removeClass=function(e,t){return t instanceof Element&&t.classList.remove(e),t},la.removeElement=function(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e},la.getElementFromTemplateResult=function(e){const t=document.createElement("div");return tl(e,t),t.firstElementChild},la.showElement=e=>{la.removeClass("collapsed",e),la.removeClass("hidden",e)},la.hideElement=function(e){return e instanceof Element&&e.classList.add("hidden"),e},la.ancestor=function(e,t){let n=e;for(;null!==n&&!Np.matchesSelector(n,t);)n=n.parentElement;return n},la.nextUntil=function(e,t){const n=[];let s=e.nextElementSibling;for(;null!==s&&!s.matches(t);)n.push(s),s=s.nextElementSibling;return n},la.unescapeHTML=function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},la.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},la.slideInAllElements=function(e,t=300){return Promise.all(Array.from(e).map((e=>la.slideIn(e,t))))},la.slideToggleElement=function(e,t){return la.hasClass("collapsed",e)||la.hasClass("hidden",e)?la.slideOut(e,t):la.slideIn(e,t)},la.slideOut=function(e,t=200){return new Promise(((n,s)=>{if(!e){const e="An element needs to be passed in to slideOut";return M.warn(e),void s(new Error(e))}const i=e.getAttribute("data-slider-marker");i&&(e.removeAttribute("data-slider-marker"),window.cancelAnimationFrame(i));const r=la.calculateElementHeight(e);if(window.converse_disable_effects)return e.style.height=r+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void n();if(!la.hasClass("collapsed",e)&&!la.hasClass("hidden",e))return void n();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",window.requestAnimationFrame((function t(){a+=r/o,a<r?(e.style.height=a+"px",e.setAttribute("data-slider-marker",window.requestAnimationFrame(t))):(e.removeAttribute("data-slider-marker"),e.style.height=la.calculateElementHeight(e)+"px",e.style.overflow="",e.style.height="",n())})))}))},la.slideIn=function(e,t=200){return new Promise(((n,s)=>{if(!e){const e="An element needs to be passed in to slideIn";return M.warn(e),s(new Error(e))}if(la.hasClass("collapsed",e))return n(e);if(window.converse_disable_effects)return e.classList.add("collapsed"),e.style.height="",n(e);const i=e.getAttribute("data-slider-marker");i&&(e.removeAttribute("data-slider-marker"),window.cancelAnimationFrame(i));const r=e.offsetHeight,o=t/17;let a=r;e.style.overflow="hidden",e.setAttribute("data-slider-marker",window.requestAnimationFrame((function t(){a-=r/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",window.requestAnimationFrame(t))):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",n(e))})))}))},la.isInDOM=function(e){return document.querySelector("body").contains(e)},la.isVisible=function(e){return null!==e&&!la.hasClass("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0)},la.fadeIn=function(e,t){if(e||M.warn("An element needs to be passed in to fadeIn"),window.converse_disable_effects)return e.classList.remove("hidden"),Dp(e,t);la.hasClass("hidden",e)?(e.classList.add("visible"),e.classList.remove("hidden"),e.addEventListener("webkitAnimationEnd",(()=>Dp(e,t))),e.addEventListener("animationend",(()=>Dp(e,t))),e.addEventListener("oanimationend",(()=>Dp(e,t)))):Dp(e,t)},la.xForm2TemplateResult=function(e,t,n){if("list-single"===e.getAttribute("type")||"list-multi"===e.getAttribute("type")){const t=la.queryChildren(e,"value").map((e=>null==e?void 0:e.textContent));return(e=>{var t;return Qc`
    <div class="form-group">
        <label for="${e.id}">${e.label}</label>
        <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">
            ${null===(t=e.options)||void 0===t?void 0:t.map((e=>(e=>Qc`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}
        </select>
    </div>`})({options:la.queryChildren(e,"option").map((n=>{var s;const i=null===(s=n.querySelector("value"))||void 0===s?void 0:s.textContent;return{value:i,label:n.getAttribute("label"),selected:t.includes(i),required:!!e.querySelector("required")}})),id:la.getUniqueId(),label:e.getAttribute("label"),multiple:"list-multi"===e.getAttribute("type"),name:e.getAttribute("var"),required:!!e.querySelector("required")})}var s,i,r,o;if("fixed"===e.getAttribute("type"))return(e=>Qc`<p class="form-help">${e.text}</p>`)({text:null===(s=e.querySelector("value"))||void 0===s?void 0:s.textContent});if("jid-multi"===e.getAttribute("type"))return(e=>Qc`
    <label class="label-ta">${e.label}</label>
    <textarea name="${e.name}">${e.value}</textarea>
`)({name:e.getAttribute("var"),label:e.getAttribute("label")||"",value:null===(i=e.querySelector("value"))||void 0===i?void 0:i.textContent,required:!!e.querySelector("required")});if("boolean"===e.getAttribute("type")){var a;const t=null===(a=e.querySelector("value"))||void 0===a?void 0:a.textContent;return(e=>Qc`
    <fieldset class="form-group">
        <input id="${e.id}" name="${e.name}" type="checkbox" ?checked=${e.checked} ?required=${e.required} />
        <label class="form-check-label" for="${e.id}">${e.label}</label>
    </fieldset>`)({id:la.getUniqueId(),name:e.getAttribute("var"),label:e.getAttribute("label")||"",checked:"1"===t||"true"===t?'checked="1"':"",required:!!e.querySelector("required")})}if("url"===e.getAttribute("var"))return Ap({label:e.getAttribute("label")||"",value:null===(r=e.querySelector("value"))||void 0===r?void 0:r.textContent});if("username"===e.getAttribute("var"))return Cp({domain:" @"+n.domain,name:e.getAttribute("var"),type:Ip[e.getAttribute("type")],label:e.getAttribute("label")||"",value:null===(o=e.querySelector("value"))||void 0===o?void 0:o.textContent,required:!!e.querySelector("required")});if("ocr"===e.getAttribute("var")){const n=e.querySelector("uri"),s=Np('data[cid="'+n.textContent.replace(/^cid:/,"")+'"]',t)[0];return(e=>Qc`
    <fieldset class="form-group">
        ${e.label?Qc`<label>${e.label}</label>`:""}
        <img src="data:${e.type};base64,${e.data}">
        <input name="${e.name}" type="text" ?required="${e.required}" />
    </fieldset>
`)({label:e.getAttribute("label"),name:e.getAttribute("var"),data:null==s?void 0:s.textContent,type:n.getAttribute("type"),required:!!e.querySelector("required")})}{var c;const t=e.getAttribute("var");return Ep({id:la.getUniqueId(),label:e.getAttribute("label")||"",name:t,fixed_username:null==n?void 0:n.fixed_username,autocomplete:$p(t,n),placeholder:null,required:!!e.querySelector("required"),type:Ip[e.getAttribute("type")],value:null===(c=e.querySelector("value"))||void 0===c?void 0:c.textContent})}},Object.assign(la,{getOOBURLMarkup:Mp});const Lp=la;var zp=n(3735),Pp={};Pp.styleTagTransform=eg(),Pp.setAttributes=Yf(),Pp.insert=Jf().bind(null,"head"),Pp.domAPI=Wf(),Pp.insertStyleElement=Xf(),Hf()(zp.Z,Pp),zp.Z&&zp.Z.locals&&zp.Z.locals,Cl.elements.define("converse-gif",class extends Uf{static get properties(){return{autoplay:{type:Boolean},noloop:{type:Boolean},progress_color:{type:String},fallback:{type:String},src:{type:String}}}constructor(){super(),this.autoplay=!1,this.noloop=!1,this.fallback="url"}initialize(){const e={autoplay:this.autoplay,loop:!this.noloop};this.progress_color&&(e.progress_color=this.progress_color),this.supergif=new Sp(this,e)}updated(e){this.supergif&&!e.has("src")?(e.has("autoplay")&&(this.supergif.options.autoplay=this.autoplay),e.has("noloop")&&(this.supergif.options.loop=!this.noloop),e.has("progress_color")&&(this.supergif.options.progress_color=this.progress_color)):this.initialize()}render(){var e;return null!==(e=this.supergif)&&void 0!==e&&e.load_error&&["url","empty"].includes(this.fallback)?this.renderErrorFallback():Qc`<canvas class="gif-canvas"
                @mouseover=${()=>this.setHover()}
                @mouseleave=${()=>this.unsetHover()}
                @click=${e=>this.onControlsClicked(e)}><img class="gif" src="${this.src}"></a></canvas>`}renderErrorFallback(){return"url"===this.fallback?Rp(this.src):"empty"===this.fallback?"":void 0}setHover(){this.supergif&&(this.supergif.hovering=!0,this.hover_timeout&&clearTimeout(this.hover_timeout),this.hover_timeout=setTimeout((()=>this.unsetHover()),2e3))}unsetHover(){this.supergif&&(this.supergif.hovering=!1)}onControlsClicked(e){e.preventDefault(),this.supergif.playing?this.supergif.pause():(this.supergif.options.loop=!0,this.supergif.play())}});const{URI:Fp}=jl.env,Up=_g(class extends cp{render(e,t,n,s){return t?Qc`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,n,s)}</a>`:this.renderImage(e,t,n,s)}renderImage(e,t,n,s){return Qc`<img class="chat-image img-thumbnail"
                src="${e}"
                @click=${s}
                @error=${()=>this.onError(e,t,n,s)}
                @load=${n}/></a>`}onError(e,t,n,s){if(Pl(e))t&&this.setValue(Rp(t));else{const i=new Fp(e),r=i.filename();i.filename(`${r}.png`),this.setValue(Up(i.toString(),t,n,s))}}}),Bp=e=>Qc`${Up(e.url,e.href,e.onLoad,e.onClick)}`,qp=_g(class extends wg{render(e,t,n,s){const i=new tv(e,t,n,Object.assign(s,{show_images:!1,embed_videos:!1,embed_audio:!1}));return Qc`${dp(async function(e){return await e.addTemplates(),e.payload}(i),Qc`${i}`)}`}}),Hp=["*","_","~","`"],Gp=[...Hp,"```",">"],Wp={"*":{name:"strong",type:"span"},_:{name:"emphasis",type:"span"},"~":{name:"strike",type:"span"},"`":{name:"preformatted",type:"span"},"```":{name:"preformatted_block",type:"block"},">":{name:"quote",type:"block"}},Vp=["_",">","`","~"],Jp={emphasis:(e,t,n,s)=>Qc`<span class="styling-directive">_</span><i>${qp(e,t,n,s)}</i><span class="styling-directive">_</span>`,preformatted:e=>Qc`<span class="styling-directive">\`</span><code>${e}</code><span class="styling-directive">\`</span>`,preformatted_block:e=>Qc`<div class="styling-directive">\`\`\`</div><code class="block">${e}</code><div class="styling-directive">\`\`\`</div>`,quote:(e,t,n,s)=>Qc`<blockquote>${qp(e,t,n,s)}</blockquote>`,strike:(e,t,n,s)=>Qc`<span class="styling-directive">~</span><del>${qp(e,t,n,s)}</del><span class="styling-directive">~</span>`,strong:(e,t,n,s)=>Qc`<span class="styling-directive">*</span><b>${qp(e,t,n,s)}</b><span class="styling-directive">*</span>`};function Kp(e,t,n=!0){let s;if(!/(^```\s*\n|^```\s*$)/.test(e.slice(t))||0!==t&&"\n"!==e[t-1]&&">"!==e[t-1]){if(!Gp.includes(e.slice(t,t+1)))return null;if(s=e.slice(t,t+1),!function(e,t,n,s){if(s){const s=RegExp(Vp.includes(e)?`^(\\p{L}|\\p{N})${e}`:`^(\\p{L}|\\p{N})\\${e}`,"u");if(n>1&&s.test(t.slice(n-1)))return!1;if(Qp(e)&&n>0&&"\n"!==t[n-1])return!1;if(Hp.includes(e)&&t[n+1]===e)return!1}else{const s=RegExp(Vp.includes(e)?`^${e}(\\p{L}|\\p{N})`:`^\\${e}(\\p{L}|\\p{N})`,"u");if(n<t.length-1&&s.test(t.slice(n)))return!1;if(Hp.includes(e)&&t[n-1]===e)return!1}return!0}(s,e,t,n))return null}else s=e.slice(t,t+3);return s}function Yp(e,t){const n=Kp(e,t),s=n?function(e,t,n){if(!e)return 0;const s=n;if(n+=e.length,Qp(e))return(n+=t.slice(n).split(/\n[^>]/).shift().length)-s;if("span"===Wp[e].type){const s=t.slice(n).split("\n").shift();let i=0,r=s.indexOf(e);for(;-1!==r;){if(Kp(t,n+r,!1)===e)return r+2*e.length;r=s.indexOf(e,i++)}return 0}{const s=t.slice(n+1);let i=0,r=s.indexOf(e);for(;-1!==r;){if(Kp(t,n+1+r,!1)===e)return r+1+2*e.length;r=s.indexOf(e,i++)}return 0}}(n,e,t):0;return s>0?{d:n,length:s}:{}}const Qp=e=>[">","&gt;"].includes(e);function Xp(e,t,n,s,i){const r=Jp[Wp[e].name];return Qp(e)?r(t.replace(/\n>/g,"\n").replace(/\n$/,""),n,s,i):r(t,n,s,i)}const{URI:Zp}=jl.env,ev=e=>"string"==typeof e;class tv extends String{constructor(e,t=0,n=[],s={}){super(e),this.embed_audio=null==s?void 0:s.embed_audio,this.embed_videos=null==s?void 0:s.embed_videos,this.mentions=n,this.nick=null==s?void 0:s.nick,this.offset=t,this.onImgClick=null==s?void 0:s.onImgClick,this.onImgLoad=null==s?void 0:s.onImgLoad,this.options=s,this.payload=[],this.references=[],this.render_styling=null==s?void 0:s.render_styling,this.show_images=null==s?void 0:s.show_images,this.hide_media_urls=null==s?void 0:s.hide_media_urls}addHyperlinks(e,t){const n=[];try{Zp.withinString(e,((e,t,s)=>(n.push({url:e,start:t,end:s}),e)),ge)}catch(e){return void M.debug(e)}n.filter((t=>!e.slice(t.start,t.end).startsWith("aesgcm://"))).forEach((e=>{const n=e.url,s=function(e){const t=Cl.settings.get("filter_url_query_params");return t?Il(e).removeQuery(t).toString():e}(n);let i;var r,o;this.show_images&&Fl(n)&&zl(n)?(r=s,o=this.hide_media_urls,i=Qc`<converse-gif autoplay noloop fallback='empty' src=${r}></converse-gif>${o?"":Qc`<a target="_blank" rel="noopener" href="${r}">${r}</a>`}`):i=this.show_images&&ql(n)&&zl(n)?Bp({url:s,href:this.hide_media_urls?null:s,onClick:this.onImgClick,onLoad:this.onImgLoad}):this.embed_videos&&Bl(n)&&Ll(n)?jp(s,this.hide_media_urls):this.embed_audio&&Ul(n)&&Dl(n)?gp(s,this.hide_media_urls):Rp(s),this.addTemplateResult(e.start+t,e.end+t,i)}))}addMapURLs(e,t){const n=/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,s=e.matchAll(n);for(const e of s)this.addTemplateResult(e.index+t,e.index+e[0].length+t,Rp(e[0].replace(n,va.geouri_replacement)))}addEmojis(e,t){[...au(e.toString()),...cu(e.toString())].forEach((e=>{this.addTemplateResult(e.begin+t,e.end+t,ou(e,{add_title_wrapper:!0}))}))}addMentions(e,t){var n;const s=t+this.offset;null===(n=this.mentions)||void 0===n||n.forEach((n=>{const i=Number(n.begin)-s;if(i<0||i>=s+e.length)return;const r=Number(n.end)-s,o=e.slice(i,r);o===this.nick?this.addTemplateResult(i+t,r+t,(e=>Qc`<span class="mention mention--self badge badge-info">${e.mention}</span>`)({mention:o})):this.addTemplateResult(i+t,r+t,(e=>Qc`<span class="mention">${e.mention}</span>`)({mention:o}))}))}addStyling(){const e=[];if(function(e){for(let t=0;t<Gp.length;t++)if(e.includes(Gp[t]))return!0}(this,this.mentions)){const t=this.mentions.map((e=>Array.from({length:Number(e.end)},((t,n)=>Number(e.begin)+n))));let n=0;for(;n<this.length;){if(t.filter((e=>e.includes(n))).length){n++;continue}const{d:s,length:i}=Yp(this,n);if(s&&i){const t=Qp(s),r=n+i,o=t?r:r-s.length;let a="```"===s?n+s.length+1:n+s.length;t&&" "===this[a]&&(a+=1);const c=a,l=this.slice(a,o);e.push({begin:n,template:Xp(s,l,c,this.mentions,this.options),end:r}),n=r}n++}}e.forEach((e=>this.addTemplateResult(e.begin,e.end,e.template)))}trimMeMessage(){0===this.offset&&this.isMeCommand()&&(this.payload[0]=this.payload[0].substring(4))}addAnnotations(e){const t=this.marshall();let n=0;for(const s of t)s&&(ev(s)?(e.call(this,s,n),n+=s.length):n=s.end)}async addTemplates(){await Cl.trigger("beforeMessageBodyTransformed",this,{Synchronous:!0}),this.render_styling&&this.addStyling(),this.addAnnotations(this.addMentions),this.addAnnotations(this.addHyperlinks),this.addAnnotations(this.addMapURLs),await Cl.emojis.initialize(),this.addAnnotations(this.addEmojis),await Cl.trigger("afterMessageBodyTransformed",this,{Synchronous:!0}),this.payload=this.marshall(),this.options.show_me_message&&this.trimMeMessage(),this.payload=this.payload.map((e=>ev(e)?e:e.template))}addTemplateResult(e,t,n){this.references.push({begin:e,end:t,template:n})}isMeCommand(){const e=this.toString();return!!e&&e.startsWith("/me ")}marshall(){let e=[this.toString()];return this.references.sort(((e,t)=>t.begin-e.begin)).forEach((t=>{const n=e.shift();e=[n.slice(0,t.begin),t,n.slice(t.end),...e]})),e.reduce(((e,t)=>{return ev(t)?[...e,ru((n=t,n.replace(/\n\n+/g,(e=>`\n${"​".repeat(e.length-2)}\n`))))]:[...e,t];var n}),[])}}class nv{constructor(e,t,n=[],s={}){this.mentions=n,this.offset=t,this.options=s,this.text=e}async transform(){const e=new tv(this.text,this.offset,this.mentions,this.options);return await e.addTemplates(),e.payload}render(){return Qc`${dp(this.transform(),Qc`${this.text}`)}`}}const sv=_g(class extends wg{render(e,t,n,s,i){const r=new nv(e,t,n,s).render();return null==i||i(),r}});var iv=n(5223),rv={};rv.styleTagTransform=eg(),rv.setAttributes=Yf(),rv.insert=Jf().bind(null,"head"),rv.domAPI=Wf(),rv.insertStyleElement=Xf(),Hf()(iv.Z,rv),iv.Z&&iv.Z.locals&&iv.Z.locals,Cl.elements.define("converse-chat-message-body",class extends Uf{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},hide_url_previews:{type:Boolean},is_me_message:{type:Boolean},model:{type:Object},show_images:{type:Boolean},text:{type:String}}}onImgClick(e){e.preventDefault(),Cl.modal.create(fp,{src:e.target.src},e).show(e)}onImgLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}render(){const e=this.model.get("references"),t={embed_audio:!this.hide_url_previews&&this.embed_audio,embed_videos:!this.hide_url_previews&&this.embed_videos,nick:this.model.collection.chatbox.get("nick"),onImgClick:e=>this.onImgClick(e),onImgLoad:()=>this.onImgLoad(),render_styling:!this.model.get("is_unstyled")&&Cl.settings.get("allow_message_styling"),show_images:!this.hide_url_previews&&this.show_images,show_me_message:!0};return sv(this.text,0,e,t,(()=>{var e;return null===(e=this.model.collection)||void 0===e?void 0:e.trigger("rendered",this.model)}))}});var ov=n(3543),av={};av.styleTagTransform=eg(),av.setAttributes=Yf(),av.insert=Jf().bind(null,"head"),av.domAPI=Wf(),av.insertStyleElement=Xf(),Hf()(ov.Z,av),ov.Z&&ov.Z.locals&&ov.Z.locals,customElements.define("converse-icon",class extends Uf{static get properties(){return{color:String,class_name:{attribute:"class"},style:String,size:String}}constructor(){super(),this.class_name="",this.style="",this.size="",this.color=""}getSource(){return`#icon-${this.class_name.split(" ")[1].replace("fa-","")}`}getStyles(){var e;const t=null===(e=this.color.match(/var\((--.*)\)/))||void 0===e?void 0:e[1],n=t?getComputedStyle(this).getPropertyValue(t):this.color;return`\n            ${this.size?`width: ${this.size};`:""}\n            ${this.size?`height: ${this.size};`:""}\n            ${n?`fill: ${n};`:""}\n            ${this.style}\n        `}render(){return Qc`<svg .style="${this.getStyles()}"> <use href="${this.getSource()}"> </use> </svg>`}});const{keycodes:cv}=jl;function lv(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function dv(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}class uv{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:[`${cv.SHIFT}+${cv.UP_ARROW}`],end:[`${cv.SHIFT}+${cv.DOWN_ARROW}`],up:[cv.UP_ARROW],down:[cv.DOWN_ARROW],left:[cv.LEFT_ARROW,`${cv.SHIFT}+${cv.TAB}`],right:[cv.RIGHT_ARROW,cv.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce(((e,n)=>{const s=t(n);return s<e.distance?{distance:s,element:n}:e}),{distance:1/0}).element}constructor(e,t){this.doc=window.document,this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},uv.DEFAULTS,t),this.init()}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach((e=>this.keys[e]=uv.DIRECTION.down)),this.options.end.forEach((e=>this.keys[e]=uv.DIRECTION.end)),this.options.home.forEach((e=>this.keys[e]=uv.DIRECTION.home)),this.options.left.forEach((e=>this.keys[e]=uv.DIRECTION.left)),this.options.right.forEach((e=>this.keys[e]=uv.DIRECTION.right)),this.options.up.forEach((e=>this.keys[e]=uv.DIRECTION.up))}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e),this.doc.addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){this.keydownHandler&&this.doc.removeEventListener("keydown",this.keydownHandler),this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable(),this.container.domNavigator&&delete this.container.domNavigator}getNextElement(e){let t;if(e===uv.DIRECTION.home)t=this.getElements(e)[0];else if(e===uv.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===uv.DIRECTION.right){const n=this.getElements(e);t=n.slice(n.indexOf(this.selected))[1]}else if(e==uv.DIRECTION.left){const n=this.getElements(e);t=n.slice(0,n.indexOf(this.selected)).pop()||this.selected}else if(e==uv.DIRECTION.down){const e=this.selected.offsetLeft,n=this.selected.offsetTop+this.selected.offsetHeight,s=this.elementsAfter(0,n),i=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-n);t=uv.getClosestElement(s,i)}else{if(e!=uv.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,n=this.selected.offsetTop-1,s=this.elementsBefore(1/0,n),i=t=>Math.abs(e-t.offsetLeft)+Math.abs(n-t.offsetTop);t=uv.getClosestElement(s,i)}}else t=e===uv.DIRECTION.right||e===uv.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():Lp.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(Lp.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case uv.DIRECTION.left:document.body.scrollLeft=dv(e)-document.body.offsetLeft;break;case uv.DIRECTION.up:document.body.scrollTop=lv(e)-document.body.offsetTop;break;case uv.DIRECTION.right:document.body.scrollLeft=dv(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case uv.DIRECTION.down:document.body.scrollTop=lv(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const n=this.scroll_container;if(!n.contains(e))return;switch(t){case uv.DIRECTION.left:n.scrollLeft=e.offsetLeft-n.offsetLeft,n.scrollTop=e.offsetTop-n.offsetTop;break;case uv.DIRECTION.up:n.scrollTop=e.offsetTop-n.offsetTop;break;case uv.DIRECTION.right:n.scrollLeft=e.offsetLeft-n.offsetLeft-(n.offsetWidth-e.offsetWidth),n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight);break;case uv.DIRECTION.down:n.scrollTop=e.offsetTop-n.offsetTop-(n.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft||e.offsetTop-t.scrollTop<t.offsetTop||e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth||e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(uv.DIRECTION.down).filter((n=>n.offsetLeft>=e&&n.offsetTop>=t))}elementsBefore(e,t){return this.getElements(uv.DIRECTION.up).filter((n=>n.offsetLeft<=e&&n.offsetTop<=t))}handleKeydown(e){const t=cv,n=e.shiftKey?this.keys[`${t.SHIFT}+${e.which}`]:this.keys[e.which];if(n){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(n,e);this.select(t,n)}}}const hv=uv,mv=jl.env.utils;class fv extends Uf{connectedCallback(){super.connectedCallback(),this.registerEvents()}registerEvents(){this.clickOutside=e=>this._clickOutside(e),document.addEventListener("click",this.clickOutside)}firstUpdated(){super.firstUpdated(),this.menu=this.querySelector(".dropdown-menu"),this.button=this.querySelector("button"),this.addEventListener("click",(e=>this.toggleMenu(e))),this.addEventListener("keyup",(e=>this.handleKeyUp(e)))}_clickOutside(e){this.contains(e.composedPath()[0])||this.hideMenu(e)}hideMenu(){var e,t;mv.removeClass("show",this.menu),null===(e=this.button)||void 0===e||e.setAttribute("aria-expanded",!1),null===(t=this.button)||void 0===t||t.blur()}showMenu(){mv.addClass("show",this.menu),this.button.setAttribute("aria-expanded",!0)}toggleMenu(e){e.preventDefault(),mv.hasClass("show",this.menu)?this.hideMenu():this.showMenu()}handleKeyUp(e){e.keyCode===jl.keycodes.ESCAPE&&this.hideMenu()}disconnectedCallback(){document.removeEventListener("click",this.clickOutside),super.disconnectedCallback()}}var gv=n(1065),pv={};pv.styleTagTransform=eg(),pv.setAttributes=Yf(),pv.insert=Jf().bind(null,"head"),pv.domAPI=Wf(),pv.insertStyleElement=Xf(),Hf()(gv.Z,pv),gv.Z&&gv.Z.locals&&gv.Z.locals;class vv extends fv{static get properties(){return{icon_classes:{type:String},color:{type:String},items:{type:Array}}}constructor(){super(),this.color="var(--text-color)",this.icon_classes="fa fa-bars"}render(){return Qc`
            <button type="button" class="btn btn--transparent btn--standalone" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <converse-icon color="${this.color}" size="1em" class="${this.icon_classes}">
            </button>
            <div class="dropdown-menu">
                ${this.items.map((e=>dp(e,"")))}
            </div>
        `}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}hideMenu(){var e;super.hideMenu(),null===(e=this.navigator)||void 0===e||e.disable()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-item",onSelected:e=>e.focus()};this.navigator=new hv(this.menu,e)}}enableArrowNavigation(e){e&&(e.preventDefault(),e.stopPropagation()),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}handleKeyUp(e){super.handleKeyUp(e),e.keyCode!==jl.keycodes.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e)}}Cl.elements.define("converse-dropdown",vv);const{dayjs:bv}=jl.env;Cl.elements.define("converse-message-versions",class extends Uf{static get properties(){return{model:{type:Object}}}render(){const e=this.model.get("older_versions"),t=this.model.get("message");return Qc`
            <h4>Older versions</h4>
            ${Object.keys(e).map((t=>Qc`<p class="older-msg"><time>${bv(t).format("MMM D, YYYY, HH:mm:ss")}</time>: ${e[t]}</p>`))}
            <hr/>
            <h4>Current version</h4>
            <p>${t}</p>`}});const yv=Kg.extend({id:"message-versions-modal",toHTML(){return(e=>Qc`
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="message-versions-modal-label">${vh("Message versions")}</h4>
                ${Qg}
            </div>
            <div class="modal-body">
                <converse-message-versions .model=${e}></converse-message-versions>
            </div>
            <div class="modal-footer">${Yg}</div>
        </div>
    </div>
`)(this.model)}}),_v=_g(class extends wg{render(e){const t={classes:e.classes?`${e.classes} avatar`:"avatar",height:e.width||36,image:e.image,image_type:e.image_type,width:e.height||36};return Og(t)}}),wv=Kg.extend({initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),Cl.trigger("occupantModalInitialized",this.model)},toHTML(){return(e=>Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-details-modal-label">${e.display_name}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    ${_v(e.avatar_data)}
                </div>
                <div class="modal-footer">
                    ${Yg}
                </div>
            </div>
        </div>
    `)(Object.assign(this.model.toJSON(),{avatar_data:this.getAvatarData(),display_name:this.model.getDisplayName()}))},getAvatarData(){const e=va.vcards.findWhere({jid:this.model.get("jid")});return{classes:"chat-msg__avatar",height:120,width:120,image:"data:"+((null==e?void 0:e.get("image_type"))||va.DEFAULT_IMAGE_TYPE)+";base64,"+((null==e?void 0:e.get("image"))||va.DEFAULT_IMAGE)}}});va.OccupantModal=wv;const Sv=wv,xv=e=>{const t=vh("XMPP Address"),n=vh("Email"),s=vh("Full Name"),i=vh("Nickname"),r=vh("The User's Profile Image"),o=vh("Refresh"),a=vh("Role"),c=vh("URL"),l={alt_text:r,extra_classes:"mb-3",height:"120",width:"120"};return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-details-modal-label">${e.display_name}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    ${e.image?Qc`<div class="mb-4">${Og(Object.assign(e,l))}</div>`:""}
                    ${e.fullname?Qc`<p><label>${s}:</label> ${e.fullname}</p>`:""}
                    <p><label>${t}:</label> <a href="xmpp:${e.jid}">${e.jid}</a></p>
                    ${e.nickname?Qc`<p><label>${i}:</label> ${e.nickname}</p>`:""}
                    ${e.url?Qc`<p><label>${c}:</label> <a target="_blank" rel="noopener" href="${e.url}">${e.url}</a></p>`:""}
                    ${e.email?Qc`<p><label>${n}:</label> <a href="mailto:${e.email}">${e.email}</a></p>`:""}
                    ${e.role?Qc`<p><label>${a}:</label> ${e.role}</p>`:""}

                    ${e._converse.pluggable.plugins["converse-omemo"].enabled(e._converse)?(e=>{const t=vh("OMEMO Fingerprints"),n=vh("No OMEMO-enabled devices found"),s=e.view.devicelist.devices;return Qc`
        <hr/>
        <ul class="list-group fingerprints">
            <li class="list-group-item active">${t}</li>
            ${s.length?s.map((t=>(e=>{const t=vh("Trusted"),n=vh("Untrusted");return e.device.get("bundle")&&e.device.get("bundle").fingerprint?Qc`
            <li class="list-group-item">
                <form class="fingerprint-trust">
                <div class="btn-group btn-group-toggle">
                    <label class="btn btn--small ${-1!==e.device.get("trusted")?"btn-primary active":"btn-secondary"}">
                        <input type="radio" name="${e.device.get("id")}" value="1" ?checked=${-1!==e.device.get("trusted")}>${t}
                    </label>
                    <label class="btn btn--small ${-1!==e.device.get("trusted")?"btn-primary active":"btn-secondary"}">
                        <input type="radio" name="${e.device.get("id")}" value="-1" ?checked=${-1===e.device.get("trusted")}>${n}
                    </label>
                </div>
                <code class="fingerprint">${e.utils.formatFingerprint(e.device.get("bundle").fingerprint)}</code>
                </form>
            </li>
        `:""})(Object.assign({device:t},e)))):Qc`<li class="list-group-item"> ${n} </li>`}
        </ul>
    `})(e):""}
                </div>
                <div class="modal-footer">
                    ${Yg}
                    <button type="button" class="btn btn-info refresh-contact"><i class="fa fa-refresh"> </i>${o}</button>
                    ${e.allow_contact_removal&&e.is_roster_contact?(e=>{const t=vh("Remove as contact");return Qc`
        <button type="button" @click="${e.removeContact}" class="btn btn-danger remove-contact">
            <i class="far fa-trash-alt"></i>${t}
        </button>
    `})(e):""}

                </div>
            </div>
        </div>
    `},Ev=jl.env.utils,Av=Kg.extend({id:"user-details-modal",persistent:!0,events:{"click button.refresh-contact":"refreshContact","click .fingerprint-trust .btn input":"toggleDeviceTrust"},initialize(){Kg.prototype.initialize.apply(this,arguments),this.model.rosterContactAdded.then((()=>this.registerContactEventHandlers())),this.listenTo(this.model,"change",this.render),this.registerContactEventHandlers(),Cl.trigger("userDetailsModalInitialized",this.model)},toHTML(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.vcard,n=t?t.toJSON():{};return xv(Object.assign(this.model.toJSON(),n,{_converse:va,allow_contact_removal:Cl.settings.get("allow_contact_removal"),display_name:this.model.getDisplayName(),is_roster_contact:void 0!==this.model.contact,removeContact:e=>this.removeContact(e),view:this,utils:Ev}))},registerContactEventHandlers(){void 0!==this.model.contact&&(this.listenTo(this.model.contact,"change",this.render),this.listenTo(this.model.contact.vcard,"change",this.render),this.model.contact.on("destroy",(()=>{delete this.model.contact,this.render()})))},async refreshContact(e){e&&e.preventDefault&&e.preventDefault();const t=this.el.querySelector(".fa-refresh");Ev.addClass("fa-spin",t);try{await Cl.vcard.update(this.model.contact.vcard,!0)}catch(e){M.fatal(e),this.alert(vh("Sorry, something went wrong while trying to refresh"),"danger")}Ev.removeClass("fa-spin",t)},removeContact(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Cl.settings.get("allow_contact_removal")&&!0===confirm(vh("Are you sure you want to remove this contact?"))&&(setTimeout((()=>function(e){e.removeFromRoster((()=>e.destroy()),(t=>{t&&M.error(t),Cl.alert("error",vh("Error"),[vh("Sorry, there was an error while trying to remove %1$s as a contact.",e.getDisplayName())])}))}(this.model.contact)),1),this.modal.hide())}});va.UserDetailsModal=Av;const Cv=Av,{dayjs:Tv}=jl.env;function kv(e){return!!Il(e).host()}const jv=(e,t)=>e.url&&kv(e.url)&&!Fl(e.url)?Qc`<a href="${e.url}" target="_blank" rel="noopener">${t(e)}</a>`:t(e),Nv=e=>Qc`<converse-rich-text class="card-img-top" text="${e.image}" show_images ?hide_media_urls=${function(e){return Fl(e.url)||Bl(e.url)||Ul(e.url)}(e.url)} .onImgLoad=${e.onload}></converse-rich-text>`;var Ov=n(7415),$v={};$v.styleTagTransform=eg(),$v.setAttributes=Yf(),$v.insert=Jf().bind(null,"head"),$v.domAPI=Wf(),$v.insertStyleElement=Xf(),Hf()(Ov.Z,$v),Ov.Z&&Ov.Z.locals&&Ov.Z.locals,Cl.elements.define("converse-message-unfurl",class extends Uf{static get properties(){return{description:{type:String},image:{type:String},jid:{type:String},title:{type:String},url:{type:String}}}render(){return(e=>{const t=(n=e.image)&&zl(n)&&kv(n);var n;const s=e.title||e.description||e.url;return t||s?Qc`<div class="card card--unfurl">
            ${t?jv(e,Nv):""}
            ${s?Qc`
                <div class="card-body">
                ${e.title?jv(e,(e=>Qc`<h5 class="card-title">${e.title}</h5>`)):""}
                ${e.description?Qc`<p class="card-text"><converse-rich-text text=${e.description}></converse-rich-text></p>`:""}
                ${e.url?Qc`<p class="card-text"><a href="${e.url}" target="_blank" rel="noopener">${Il(e.url).domain()}</a></p>`:""}
                </div>`:""}
        </div>`:""})(Object.assign({onload:()=>this.onImageLoad()},{description:this.description||"",image:this.image||"",title:this.title||"",url:this.url||""}))}onImageLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}});const Iv=(e={})=>{var t;return null!==(t=e.classes)&&void 0!==t&&t.includes("hor_centered")?Qc`<div class="spinner__container"><span class="spinner fa fa-spinner centered ${e.classes||""}"/></div>`:Qc`<span class="spinner fa fa-spinner centered ${e.classes||""}"/>`};var Mv=n(4971),Rv=n.n(Mv);const{dayjs:Dv}=jl.env;function Lv(e){if(!e.isHidden()&&Cl.settings.get("allow_url_history_change")){const t=window.location.hash;t&&e.messages.get(t.slice(1))&&va.router.history.navigate()}}const zv=Rv()((e=>function(e){const t=e.target;if("converse-chat-content"!==t.nodeName.toLowerCase())return;let n=!0;const s=0===Math.floor(t.scrollTop),i=Math.ceil(t.clientHeight-t.scrollTop)>=t.scrollHeight-Math.ceil(t.scrollHeight/20);s?(n=!1,Lv(t.model)):i&&Cl.trigger("chatBoxScrolledUp",t),t.model.get("scolled")!==n&&t.model.ui.set({scrolled:n})}(e)),50);function Pv(e){if("groupchat"===e.get("type")){var t;const n=Cl.settings.get("muc_hats").filter((e=>e)).map((e=>e.toLowerCase()));let s=[];n.includes("vcard_roles")&&(s=e.vcard?e.vcard.get("role"):null,s=s?s.split(",").filter((e=>e)).map((e=>({title:e}))):[]);const i=[...e.occupant?[e.occupant.get("role")]:[],...e.occupant?[e.occupant.get("affiliation")]:[]].filter((e=>e)).filter((e=>n.includes(e.toLowerCase()))).map((e=>({title:e})));return[...n.includes("xep317")&&(null===(t=e.occupant)||void 0===t?void 0:t.get("hats"))||[],...s,...i]}return[]}const{Strophe:Fv,dayjs:Uv}=jl.env;Cl.elements.define("converse-chat-message",class extends Uf{static get properties(){return{jid:{type:String},mid:{type:String}}}connectedCallback(){super.connectedCallback(),this.initialize()}async initialize(){await this.setModels(),this.model?(this.listenTo(this.chatbox,"change:first_unread_id",this.requestUpdate),this.listenTo(this.model,"change",this.requestUpdate),this.model.vcard&&this.listenTo(this.model.vcard,"change",this.requestUpdate),"groupchat"===this.model.get("type")&&(this.model.occupant?this.listenTo(this.model.occupant,"change",this.requestUpdate):this.listenTo(this.model,"occupantAdded",(()=>{this.listenTo(this.model.occupant,"change",this.requestUpdate)})))):M.error("Could not find module for converse-chat-message")}async setModels(){this.chatbox=await Cl.chatboxes.get(this.jid),await this.chatbox.initialized,await this.chatbox.messages.fetched,this.model=this.chatbox.messages.get(this.mid),this.model&&this.requestUpdate()}render(){return this.model?this.show_spinner?Iv():this.model.get("file")&&this.model.get("upload")!==va.SUCCESS?this.renderFileProgress():["error","info"].includes(this.model.get("type"))?this.renderInfoMessage():this.renderChatMessage():""}getProps(){return Object.assign(this.model.toJSON(),this.getDerivedMessageProps())}renderInfoMessage(){return(e=>{const t=Tv(e.model.get("time")).toISOString(),n=vh("Retry");return Qc`
        <div class="message chat-info chat-${e.model.get("type")}"
            data-isodate="${t}"
            data-type="${e.data_name}"
            data-value="${e.data_value}">

            <div class="chat-info__message">
                <converse-rich-text
                    .mentions=${e.model.get("references")}
                    render_styling
                    text=${e.model.getMessageText()}>
                </converse-rich-text>
            </div>
            ${e.model.get("reason")?Qc`<q class="reason">${e.model.get("reason")}</q>`:""}
            ${e.model.get("error_text")?Qc`<q class="reason">${e.model.get("error_text")}</q>`:""}
            ${e.model.get("retry_event_id")?Qc`<a class="retry" @click=${e.onRetryClicked}>${n}</a>`:""}
        </div>`})(this)}renderFileProgress(){if(!this.model.file)return"";const e=vh("Uploading file:"),t=this.model.file.name,n=vd()(this.model.file.size);return Qc`
            <div class="message chat-msg">
                ${_v(this.getAvatarData())}
                <div class="chat-msg__content">
                    <span class="chat-msg__text">${e} <strong>${t}</strong>, ${n}</span>
                    <progress value="${this.model.get("progress")}"/>
                </div>
            </div>`}renderChatMessage(){return((e,t)=>{var n,s;const i=vh("New messages");return Qc`
        ${t.is_first_unread?Qc`<div class="message separator"><hr class="separator"><span class="separator-text">${i}</span></div>`:""}
        <div class="message chat-msg ${e.getExtraMessageClasses()}"
                data-isodate="${t.time}"
                data-msgid="${t.msgid}"
                data-from="${t.from}"
                data-encrypted="${t.is_encrypted}">

            <!-- Anchor to allow us to scroll the message into view -->
            <a id="${t.msgid}"></a>

            <a class="show-msg-author-modal" @click=${e.showUserModal}>${t.should_show_avatar?_v(e.getAvatarData()):""}</a>
            <div class="chat-msg__content chat-msg__content--${t.sender} ${t.is_me_message?"chat-msg__content--action":""}">

                ${t.is_me_message?"":Qc`
                    <span class="chat-msg__heading">
                        <span class="chat-msg__author"><a class="show-msg-author-modal" @click=${e.showUserModal}>${t.username}</a></span>
                        ${t.hats.map((e=>Qc`<span class="badge badge-secondary">${e.title}</span>`))}
                        <time timestamp="${e.model.get("edited")||e.model.get("time")}" class="chat-msg__time">${t.pretty_time}</time>
                        ${t.is_encrypted?Qc`<span class="fa fa-lock"></span>`:""}
                    </span>`}
                <div class="chat-msg__body chat-msg__body--${t.message_type} ${t.received?"chat-msg__body--received":""} ${t.is_delayed?"chat-msg__body--delayed":""}">
                    <div class="chat-msg__message">
                        ${t.is_me_message?Qc`
                            <time timestamp="${t.edited||t.time}" class="chat-msg__time">${t.pretty_time}</time>&nbsp;
                            <span class="chat-msg__author">${t.is_me_message?"**":""}${t.username}</span>&nbsp;`:""}
                        ${t.is_retracted?e.renderRetraction():e.renderMessageText()}
                    </div>
                    <converse-message-actions
                        .model=${e.model}
                        ?correcting=${t.correcting}
                        ?editable=${t.editable}
                        ?hide_url_previews=${e.model.get("hide_url_previews")}
                        ?is_retracted=${t.is_retracted}
                        unfurls="${null===(n=e.model.get("ogp_metadata"))||void 0===n?void 0:n.length}"
                        message_type="${t.message_type}"></converse-message-actions>
                </div>

                ${e.model.get("hide_url_previews")?"":null===(s=e.model.get("ogp_metadata"))||void 0===s?void 0:s.map((t=>{var n;return Qc`<converse-message-unfurl
                        @animationend="${e.onUnfurlAnimationEnd}"
                        class="${e.model.get("url_preview_transition")}"
                        jid="${null===(n=e.chatbox)||void 0===n?void 0:n.get("jid")}"
                        description="${t["og:description"]||""}"
                        title="${t["og:title"]||""}"
                        image="${t["og:image"]||""}"
                        url="${t["og:url"]||""}"></converse-message-unfurl>`}))}
            </div>
        </div>`})(this,this.getProps())}shouldShowAvatar(){return Cl.settings.get("show_message_avatar")&&!this.model.isMeCommand()&&"headline"!==this.type}getAvatarData(){var e,t;return{classes:"chat-msg__avatar",height:36,width:36,image:"data:"+((null===(e=this.model.vcard)||void 0===e?void 0:e.get("image_type"))||va.DEFAULT_IMAGE_TYPE)+";base64,"+((null===(t=this.model.vcard)||void 0===t?void 0:t.get("image"))||va.DEFAULT_IMAGE)}}onUnfurlAnimationEnd(){"fade-out"===this.model.get("url_preview_transition")&&this.model.save({hide_url_previews:!this.model.get("hide_url_previews"),url_preview_transition:"fade-in"})}async onRetryClicked(){this.show_spinner=!0,this.requestUpdate(),await Cl.trigger(this.model.get("retry_event_id"),{synchronous:!0}),this.model.destroy(),this.parentElement.removeChild(this)}isRetracted(){return this.model.get("retracted")||"retracted"===this.model.get("moderated")}hasMentions(){return"groupchat"===this.model.get("type")&&"them"===this.model.get("sender")&&this.chatbox.isUserMentioned(this.model)}getOccupantAffiliation(){var e;return null===(e=this.model.occupant)||void 0===e?void 0:e.get("affiliation")}getOccupantRole(){var e;return null===(e=this.model.occupant)||void 0===e?void 0:e.get("role")}getExtraMessageClasses(){const e=[this.model.isFollowup()?"chat-msg--followup":null,this.model.get("is_delayed")?"delayed":null,this.model.isMeCommand()?"chat-msg--action":null,this.isRetracted()?"chat-msg--retracted":null,this.model.get("type"),this.shouldShowAvatar()?"chat-msg--with-avatar":null].map((e=>e));return"groupchat"===this.model.get("type")&&(e.push(this.getOccupantRole()??""),e.push(this.getOccupantAffiliation()??""),"them"===this.model.get("sender")&&this.hasMentions()&&e.push("mentioned")),this.model.get("correcting")&&e.push("correcting"),e.filter((e=>e)).join(" ")}getDerivedMessageProps(){const e=Cl.settings.get("time_format");return{pretty_time:Uv(this.model.get("edited")||this.model.get("time")).format(e),has_mentions:this.hasMentions(),hats:Pv(this.model),is_first_unread:this.chatbox.get("first_unread_id")===this.model.get("id"),is_me_message:this.model.isMeCommand(),is_retracted:this.isRetracted(),username:this.model.getDisplayName(),should_show_avatar:this.shouldShowAvatar()}}getRetractionText(){if("groupchat"===this.model.get("type")&&this.model.get("moderated_by")){const e=this.model.get("moderated_by"),t=this.model.collection.chatbox;this.model.mod||(this.model.mod=t.occupants.findOccupant({jid:e})||t.occupants.findOccupant({nick:Fv.getResourceFromJid(e)}));const n=this.model.mod?this.model.mod.getDisplayName():"A moderator";return vh("%1$s has removed this message",n)}return vh("%1$s has removed this message",this.model.getDisplayName())}renderRetraction(){const e=this.isRetracted()?this.getRetractionText():null;return Qc`
            <div>${e}</div>
            ${this.model.get("moderation_reason")?Qc`<q class="chat-msg--retracted__reason">${this.model.get("moderation_reason")}</q>`:""}
        `}renderMessageText(){return(e=>{const t=vh("Show more"),n="groupchat"===e.model.get("type"),s=vh("Show less"),i=Qc`
        <div class="chat-msg__spoiler-hint">
            <span class="spoiler-hint">${e.model.get("spoiler_hint")}</span>
            <a class="badge badge-info spoiler-toggle" href="#" @click=${e.toggleSpoilerMessage}>
                <i class="fa ${e.model.get("is_spoiler_visible")?"fa-eye-slash":"fa-eye"}"></i>
                ${e.model.get("is_spoiler_visible")?s:t}
            </a>
        </div>
    `,r=e.model.get("is_spoiler")?"spoiler "+(e.model.get("is_spoiler_visible")?"":"hidden"):"",o=e.model.getMessageText(),a=e.model.get("oob_url")&&o!==e.model.get("oob_url");return Qc`
        ${e.model.get("is_spoiler")?i:""}
        ${e.model.get("subject")?Qc`<div class="chat-msg__subject">${e.model.get("subject")}</div>`:""}
        <span>
            <converse-chat-message-body
                class="chat-msg__text ${e.model.get("is_only_emojis")?"chat-msg__text--larger":""} ${r}"
                .model="${e.model}"
                ?hide_url_previews=${e.model.get("hide_url_previews")}
                ?is_me_message=${e.model.isMeCommand()}
                ?show_images=${Cl.settings.get("show_images_inline")}
                ?embed_videos=${Cl.settings.get("embed_videos")}
                ?embed_audio=${Cl.settings.get("embed_audio")}
                text="${o}"></converse-chat-message-body>
            ${!e.model.get("received")||e.model.isMeCommand()||n?"":Qc`<span class="fa fa-check chat-msg__receipt"></span>`}
            ${e.model.get("edited")?(e=>{const t=vh("This message has been edited");return Qc`<converse-icon title="${t}" class="fa fa-edit chat-msg__edit-modal" @click=${e.showMessageVersionsModal} size="1em"></converse-icon>`})(e):""}
        </span>
        ${a?Qc`<div class="chat-msg__media">${Mp(e.model.get("oob_url"))}</div>`:""}
        <div class="chat-msg__error">${e.model.get("error_text")||e.model.get("error")}</div>
    `})(this)}showUserModal(e){if("me"===this.model.get("sender"))Cl.modal.show(va.ProfileModal,{model:this.model},e);else if("groupchat"===this.model.get("type"))e.preventDefault(),Cl.modal.show(Sv,{model:this.model.occupant},e);else{e.preventDefault();const t=this.model.collection.chatbox;Cl.modal.show(Cv,{model:t},e)}}showMessageVersionsModal(e){e.preventDefault(),Cl.modal.show(yv,{model:this.model},e)}toggleSpoilerMessage(e){null==e||e.preventDefault(),this.model.save({is_spoiler_visible:!this.model.get("is_spoiler_visible")})}}),Cl.elements.define("converse-message-history",class extends Uf{static get properties(){return{model:{type:Object},messages:{type:Array}}}render(){const e=this.messages;return e.length?jg(e,(e=>e.get("id")),(e=>Qc`${this.renderMessage(e)}`)):""}renderMessage(e){if(e.get("dangling_retraction")||e.get("is_only_key"))return"";const t=e.get("template_hook");if("string"==typeof t){const n=Cl.hook(t,e,"");return dp(n,"")}{const t=Qc`<converse-chat-message
                jid="${this.model.get("jid")}"
                mid="${e.get("id")}"></converse-chat-message>`,n=function(e){var t;const n=null===(t=e.collection)||void 0===t?void 0:t.models;if(!n)return;const s=n.indexOf(e),i=n[s-1];if(!i||Dv(e.get("time")).isAfter(Dv(i.get("time")),"day")){const t=Dv(e.get("time")).startOf("day");return(e=>Qc`
    <div class="message date-separator" data-isodate="${e.time}">
        <hr class="separator"/>
        <time class="separator-text" datetime="${e.time}"><span>${e.datestring}</span></time>
    </div>
`)({type:"date",time:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")})}}(e);return n?[n,t]:t}}});var Bv=n(8269),qv={};qv.styleTagTransform=eg(),qv.setAttributes=Yf(),qv.insert=Jf().bind(null,"head"),qv.domAPI=Wf(),qv.insertStyleElement=Xf(),Hf()(Bv.Z,qv),Bv.Z&&Bv.Z.locals&&Bv.Z.locals,Cl.elements.define("converse-chat-content",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("scroll",zv)}async initialize(){await this.setModels(),this.listenTo(this.model,"change:hidden_occupants",this.requestUpdate),this.listenTo(this.model.messages,"add",this.requestUpdate),this.listenTo(this.model.messages,"change",this.requestUpdate),this.listenTo(this.model.messages,"remove",this.requestUpdate),this.listenTo(this.model.messages,"rendered",this.requestUpdate),this.listenTo(this.model.messages,"reset",this.requestUpdate),this.listenTo(this.model.notifications,"change",this.requestUpdate),this.listenTo(this.model.ui,"change",this.requestUpdate),this.listenTo(this.model.ui,"change:scrolled",this.scrollDown),this.model.occupants&&this.listenTo(this.model.occupants,"change",this.requestUpdate),this.addEventListener("scroll",zv)}async setModels(){this.model=await Cl.chatboxes.get(this.jid),await this.model.initialized,this.requestUpdate()}render(){var e;return this.model?Qc`
            <div class="chat-content__notifications">${this.model.getNotificationsText()}</div>
            <converse-message-history
                .model=${this.model}
                .messages=${[...this.model.messages.models]}>
            </converse-message-history>
            ${null!==(e=this.model.ui)&&void 0!==e&&e.get("chat-content-spinner-top")?Qc`<span class="spinner fa fa-spinner centered"></span>`:""}
        `:""}scrollDown(){if(!this.model.ui.get("scrolled")){if(this.scrollTo){const e=this.scrollTop?"smooth":"auto";this.scrollTo({top:0,behavior:e})}else this.scrollTop=0;Cl.trigger("chatBoxScrolledDown",{chatbox:this.model})}}});class Hv extends wg{constructor(e){if(super(e),this.vt=Zc,2!==e.type)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===Zc)return this.Vt=void 0,this.vt=e;if(e===Xc)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.vt)return this.Vt;this.vt=e;const t=[e];return t.raw=t,this.Vt={_$litType$:this.constructor.resultType,strings:t,values:[]}}}Hv.directiveName="unsafeHTML",Hv.resultType=1;const Gv=_g(Hv);Cl.elements.define("converse-chat-help",class extends Uf{static get properties(){return{chat_type:{type:String},messages:{type:Array},model:{type:Object},type:{type:String}}}render(){const e=(new Date).toISOString();return[Qc`<converse-icon class="fas fa-times close-chat-help"
                    @click=${this.close}
                    path-prefix="${Cl.settings.get("assets_path")}"
                    size="1em"></converse-icon>`,...this.messages.map((t=>this.renderHelpMessage({isodate:e,markup:No().sanitize(t,{ALLOWED_TAGS:["strong"]})})))]}close(){this.model.set({show_help_messages:!1})}renderHelpMessage(e){return Qc`<div class="message chat-${this.type}" data-isodate="${e.isodate}">${Gv(e.markup)}</div>`}});const Wv=jl.env.utils,Vv=e=>Qc`
        <li class="emoji insert-emoji ${e.shouldBeHidden(e.emoji.sn)?"hidden":""}" data-emoji="${e.emoji.sn}" title="${e.emoji.sn}">
            <a href="#" @click=${e.insertEmoji} data-emoji="${e.emoji.sn}">${Wv.shortnamesToEmojis(e.emoji.sn)}</a>
        </li>
    `,Jv=e=>{const t=vh("Search");return Qc`
        <div class="emoji-picker__header">
            <input class="form-control emoji-search" name="emoji-search" placeholder="${t}"
                .value=${e.query||""}
                @keydown=${e.onSearchInputKeyDown}
                @blur=${e.onSearchInputBlurred}
                @focus=${e.onSearchInputFocus}>
            ${e.query?"":(e=>{const t=Cl.settings.get("emoji_categories");return Qc`<ul>${Object.keys(t).map((n=>t[n]?(e=>Qc`
        <li data-category="${e.category}"
            class="emoji-category ${e.category} ${e.current_category===e.category?"picked":""}"
            title="${vh(Cl.settings.get("emoji_category_labels")[e.category])}">

            <a class="pick-category"
               @click=${e.onCategoryPicked}
               href="#emoji-picker-${e.category}"
               data-category="${e.category}">${e.emoji} </a>
        </li>
    `)(Object.assign({category:n,emoji:e.sn2Emoji(t[n])},e)):""))}</ul>`})(e)}
        </div>
        ${e.render_emojis?Qc`<converse-emoji-picker-content
                .chatview=${e.chatview}
                .model=${e.model}
                .search_results="${e.search_results}"
                current_skintone="${e.current_skintone}"
                query="${e.query}"></converse-emoji-picker-content>`:""}

        <div class="emoji-skintone-picker">
            <label>Skin tone</label>
            <ul>${["tone1","tone2","tone3","tone4","tone5"].map((t=>(e=>Qc`
        <li data-skintone="${e.skintone}" class="emoji-skintone ${e.current_skintone===e.skintone?"picked":""}">
            <a class="pick-skintone" href="#" data-skintone="${e.skintone}" @click=${e.onSkintonePicked}>${Wv.shortnamesToEmojis(":"+e.skintone+":")}</a>
        </li>`)(Object.assign({skintone:t},e))))}</ul>
        </div>`},{sizzle:Kv}=jl.env;Cl.elements.define("converse-emoji-picker-content",class extends Uf{static get properties(){return{chatview:{type:Object},search_results:{type:Array},current_skintone:{type:String},model:{type:Object},query:{type:String}}}render(){const e={current_skintone:this.current_skintone,insertEmoji:e=>this.insertEmoji(e),query:this.query,search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e)};return Qc`
          <div class="emoji-picker__lists">
              ${(e=>{const t=vh("Search results");return Qc`
        <span ?hidden=${!e.query} class="emoji-lists__container emojis-lists__container--search">
        <a id="emoji-picker-search-results" class="emoji-category__heading">${t}</a>
        <ul class="emoji-picker">
            ${e.search_results.map((t=>Vv(Object.assign({emoji:t},e))))}
        </ul>
        </span>
    `})(e)}
              ${(e=>{const t=Cl.settings.get("emoji_categories");return Qc`
        <span ?hidden=${e.query} class="emoji-lists__container emoji-lists__container--browse">
            ${Object.keys(t).map((n=>t[n]?(e=>Qc`
        <a id="emoji-picker-${e.category}" class="emoji-category__heading" data-category="${e.category}">${vh(Cl.settings.get("emoji_category_labels")[e.category])}</a>
        <ul class="emoji-picker" data-category="${e.category}">
            ${Object.values(jl.emojis.json[e.category]).map((t=>Vv(Object.assign({emoji:t},e))))}
        </ul>`)(Object.assign({category:n},e)):""))}
        </span>`})(e)}
          </div>
      `}firstUpdated(){this.initIntersectionObserver()}initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}Kv(".emoji-picker",this).forEach((e=>this.observer.observe(e)))}}setCategoryOnVisibilityChange(e){const t=this.parentElement.navigator.selected;let n;if(n=e.filter((e=>e.target.contains(t))).pop()||e.reduce(((e,t)=>t.intersectionRatio>=((null==e?void 0:e.intersectionRatio)||0)?t:e),null),n&&n.isIntersecting){const e=n.target.getAttribute("data-category");e!==this.model.get("current_category")&&(this.parentElement.preserve_scroll=!0,this.model.save({current_category:e}))}}insertEmoji(e){e.preventDefault(),e.stopPropagation();const t="IMG"===e.target.nodeName?e.target.parentElement:e.target;this.parentElement.insertIntoTextArea(t.getAttribute("data-emoji"))}shouldBeHidden(e){if(e.includes("_tone")){if(!this.current_skintone||!e.includes(this.current_skintone))return!0}else if(this.current_skintone&&jl.emojis.toned.includes(e))return!0;return!(!this.query||va.FILTER_CONTAINS(e,this.query))}});const Yv=jl.env.utils;Cl.elements.define("converse-emoji-dropdown",class extends vv{static get properties(){return{chatview:{type:Object}}}constructor(){super(),this.render_emojis=!1}initModel(){return this.init_promise||(this.init_promise=(async()=>{await Cl.emojis.initialize();const e=`converse.emoji-${va.bare_jid}-${this.chatview.model.get("jid")}`;this.model=new va.EmojiPicker({id:e}),_o(this.model,e),await new Promise((e=>this.model.fetch({success:e,error:e}))),this.model.set({autocompleting:null,ac_position:null})})()),this.init_promise}render(){return Qc`
            <div class="dropup">
                <button class="toggle-emojis"
                        title="${vh("Insert emojis")}"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <converse-icon
                        class="fa fa-smile "
                        path-prefix="${Cl.settings.get("assets_path")}"
                        size="1em"></converse-icon>
                </button>
                <div class="dropdown-menu">
                    ${dp(this.initModel().then((()=>Qc`
                        <converse-emoji-picker
                                .chatview=${this.chatview}
                                .model=${this.model}
                                ?render_emojis=${this.render_emojis}
                                current_category="${this.model.get("current_category")||""}"
                                current_skintone="${this.model.get("current_skintone")||""}"
                                query="${this.model.get("query")||""}"
                        ></converse-emoji-picker>`)),"")}
                </div>
            </div>`}connectedCallback(){super.connectedCallback(),this.render_emojis=!1}toggleMenu(e){e.stopPropagation(),e.preventDefault(),Yv.hasClass("show",this.menu)?Yv.ancestor(e.target,".toggle-emojis")&&this.hideMenu():this.showMenu()}async showMenu(){await this.initModel(),this.render_emojis||(this.render_emojis=!0,await this.requestUpdate()),super.showMenu(),setTimeout((()=>{var e;return null===(e=this.querySelector(".emoji-search"))||void 0===e?void 0:e.focus()}))}});var Qv=n(9796),Xv={};Xv.styleTagTransform=eg(),Xv.setAttributes=Yf(),Xv.insert=Jf().bind(null,"head"),Xv.domAPI=Wf(),Xv.insertStyleElement=Xf(),Hf()(Qv.Z,Xv),Qv.Z&&Qv.Z.locals&&Qv.Z.locals;const Zv=jl.env.utils;Cl.elements.define("converse-emoji-picker",class extends Uf{static get properties(){return{chatview:{type:Object},current_category:{type:String,reflect:!0},current_skintone:{type:String,reflect:!0},model:{type:Object},query:{type:String,reflet:!0},render_emojis:{type:Boolean}}}firstUpdated(){super.firstUpdated(),this.listenTo(this.model,"change",(e=>this.onModelChanged(e.changed))),this.initArrowNavigation()}constructor(){super(),this._search_results=[],this.debouncedFilter=hc((e=>this.model.set({query:e.value})),250)}get search_results(){return this._search_results}set search_results(e){this._search_results=e,this.requestUpdate()}render(){return Jv({chatview:this.chatview,current_category:this.current_category,current_skintone:this.current_skintone,model:this.model,onCategoryPicked:e=>this.chooseCategory(e),onSearchInputBlurred:e=>this.chatview.emitFocused(e),onSearchInputFocus:e=>this.onSearchInputFocus(e),onSearchInputKeyDown:e=>this.onKeyDown(e),onSkintonePicked:e=>this.chooseSkinTone(e),query:this.query,search_results:this.search_results,render_emojis:this.render_emojis,sn2Emoji:e=>Zv.shortnamesToEmojis(this.getTonedShortname(e))})}updated(e){e.has("query")&&this.updateSearchResults(e),e.has("current_category")&&this.setScrollPosition()}onModelChanged(e){"current_category"in e&&(this.current_category=e.current_category),"current_skintone"in e&&(this.current_skintone=e.current_skintone),"query"in e&&(this.query=e.query)}setScrollPosition(){if(this.preserve_scroll)return void(this.preserve_scroll=!1);const e=this.querySelector(".emoji-lists__container--browse"),t=this.querySelector(`#emoji-picker-${this.current_category}`);t&&(e.scrollTop=t.offsetTop-3*t.offsetHeight+4)}updateSearchResults(e){const t=e.get("query"),n=va.FILTER_CONTAINS;if(this.query){if(this.query===t)return this.search_results;t&&this.query.includes(t)?this.search_results=this.search_results.filter((e=>n(e.sn,this.query))):this.search_results=jl.emojis.list.filter((e=>n(e.sn,this.query)))}else this.search_results.length&&(this.search_results=[]);this.requestUpdate()}registerEvents(){this.onGlobalKeyDown=e=>this._onGlobalKeyDown(e),document.querySelector("body").addEventListener("keydown",this.onGlobalKeyDown)}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){document.querySelector("body").removeEventListener("keydown",this.onGlobalKeyDown),super.disconnectedCallback()}_onGlobalKeyDown(e){this.navigator&&(e.keyCode===jl.keycodes.ENTER&&this.navigator.selected&&Zv.isVisible(this)?this.onEnterPressed(e):e.keyCode===jl.keycodes.DOWN_ARROW&&!this.navigator.enabled&&Zv.isVisible(this)&&this.enableArrowNavigation(e))}setCategoryForElement(e){const t=this.current_category,n=(null==e?void 0:e.getAttribute("data-category"))||t;t!==n&&this.model.save({current_category:n})}insertIntoTextArea(e){const t=this.model.get("autocompleting"),n=this.model.get("ac_position");this.chatview.getMessageForm().insertIntoTextArea(e,t,!1,n),this.model.set({autocompleting:null,query:"",ac_position:null})}chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=("IMG"===e.target.nodeName?e.target.parentElement:e.target).getAttribute("data-skintone").trim();this.current_skintone===t?this.model.save({current_skintone:""}):this.model.save({current_skintone:t})}chooseCategory(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const t=e.target.matches("li")?e.target:Zv.ancestor(e.target,"li");this.setCategoryForElement(t),this.navigator.select(t),!this.navigator.enabled&&this.navigator.enable()}onKeyDown(e){if(e.keyCode===jl.keycodes.TAB)if(e.target.value){e.preventDefault();const t=jl.emojis.shortnames.find((t=>va.FILTER_CONTAINS(t,e.target.value)));t&&this.model.set({query:t})}else this.navigator.enabled||this.enableArrowNavigation(e);else e.keyCode!==jl.keycodes.DOWN_ARROW||this.navigator.enabled?e.keyCode===jl.keycodes.ENTER?this.onEnterPressed(e):e.keyCode===jl.keycodes.ESCAPE?(Zv.ancestor(this,"converse-emoji-dropdown").hideMenu(),this.chatview.el.querySelector(".chat-textarea").focus(),e.stopPropagation(),e.preventDefault()):e.keyCode!==jl.keycodes.ENTER&&e.keyCode!==jl.keycodes.DOWN_ARROW&&this.debouncedFilter(e.target):this.enableArrowNavigation(e)}onEnterPressed(e){e.emoji_keypress_handled||(e.preventDefault(),e.stopPropagation(),e.emoji_keypress_handled=!0,jl.emojis.shortnames.includes(e.target.value)?this.insertIntoTextArea(e.target.value):1===this.search_results.length?this.insertIntoTextArea(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.insertIntoTextArea(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory({target:this.navigator.selected}))}onSearchInputFocus(e){this.chatview.emitBlurred(e),this.disableArrowNavigation()}getTonedShortname(e){return jl.emojis.toned.includes(e)&&this.current_skintone?`${e.slice(0,e.length-1)}_${this.current_skintone}:`:e}initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:hv.DIRECTION.down,picked_selector:".picked",scroll_container:this.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===hv.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?`ul[data-category="${t}"] li:not(.hidden):not(.emoji-skintone), .emoji-search`:e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new hv(this,t)}}disableArrowNavigation(){this.navigator.disable()}enableArrowNavigation(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)}}),Cl.elements.define("converse-message-limit-indicator",class extends Uf{static get properties(){return{model:{type:Object}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:draft",this.requestUpdate)}render(){const e=Cl.settings.get("message_limit");return e?(e=>{const t=vh("Message characters remaining");return Qc`<span class="message-limit ${e<1?"error":""}" title="${t}">${e}</span>`})(e-(this.model.get("draft")||"").length):""}});var eb=n(7991),tb={};tb.styleTagTransform=eg(),tb.setAttributes=Yf(),tb.insert=Jf().bind(null,"head"),tb.domAPI=Wf(),tb.insertStyleElement=Xf(),Hf()(eb.Z,tb),eb.Z&&eb.Z.locals&&eb.Z.locals;const nb=jl.env.Strophe;async function sb(e){const t=await e;return Qc`
        <a href="#" class="dropdown-item ${t.a_class}" @click=${t.handler} title="${t.i18n_title}">
            <converse-icon size="1em" color="var(--text-color-lighten-15-percent)" class="fa ${t.icon_class}"></converse-icon>
            ${t.i18n_text}
        </a>
    `}async function ib(e){const t=await e;return Qc`
        <a
            href="#"
            class="chatbox-btn ${t.a_class} fa ${t.icon_class}"
            @click=${t.handler}
            title="${t.i18n_title}"
        ></a>
    `}async function rb(e){!0===confirm(vh("Are you sure you want to clear the messages from this conversation?"))&&await e.clearMessages()}function ob(e,t){const n=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(n){if("clear"===n[1])return rb(e),!0;var s;if("close"===n[1])return null===(s=va.chatboxviews.get(e.get("jid")))||void 0===s||s.close(),!0;if("help"===n[1])return e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0}),!0}}function ab(e){if(e.target.value){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)}else e.target.style=""}window.customElements.define("converse-chat-toolbar",class extends Uf{static get properties(){return{composing_spoiler:{type:Boolean},hidden_occupants:{type:Boolean},is_groupchat:{type:Boolean},message_limit:{type:Number},model:{type:Object},show_call_button:{type:Boolean},show_emoji_button:{type:Boolean},show_send_button:{type:Boolean},show_spoiler_button:{type:Boolean}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:composing_spoiler",this.requestUpdate)}render(){const e=vh("Send the message");return Qc`
            <span class="toolbar-buttons">${dp(this.getButtons(),"")}</span>
            ${this.show_send_button?Qc`<button type="submit" class="btn send-button fa fa-paper-plane" title="${e}"></button>`:""}
        `}firstUpdated(){Cl.trigger("renderToolbar",this)}getButtons(){var e;const t=[];if(this.show_emoji_button){const e=va.chatboxviews.get(this.model.get("jid"));t.push(Qc`<converse-emoji-dropdown .chatview=${e}></converse-emoji-dropdown>`)}if(this.show_call_button){const e=vh("Start a call");t.push(Qc`
                <button class="toggle-call" @click=${this.toggleCall} title="${e}">
                    <converse-icon class="fa fa-phone" path-prefix="/dist" size="1em"></converse-icon>
                </button>`)}Cl.settings.get("message_limit")&&t.push(Qc`
                <converse-message-limit-indicator .model=${this.model} class="right">
                </converse-message-limit-indicator>`),this.show_spoiler_button&&t.push(this.getSpoilerButton());const n=Cl.disco.supports(nb.NS.HTTPUPLOAD,va.domain);if(t.push(Qc`${dp(n.then((e=>this.getHTTPUploadButton(e))),"")}`),this.is_groupchat&&null!==(e=Cl.settings.get("visible_toolbar_buttons"))&&void 0!==e&&e.toggle_occupants){const e=vh("Hide participants"),n=vh("Show participants");t.push(Qc`
                <button class="toggle_occupants right"
                        title="${this.hidden_occupants?n:e}"
                        @click=${this.toggleOccupants}>
                    <converse-icon class="fa ${this.hidden_occupants?"fa-angle-double-left":"fa-angle-double-right"}"
                             path-prefix="${Cl.settings.get("assets_path")}" size="1em"></converse-icon>
                </button>`)}return va.api.hook("getToolbarButtons",this,t)}getHTTPUploadButton(e){if(e){const e=vh("Choose a file to send");return Qc`
                <button title="${e}" @click=${this.toggleFileUpload}>
                    <converse-icon class="fa fa-paperclip"
                        path-prefix="${Cl.settings.get("assets_path")}"
                        size="1em"></converse-icon>
                </button>
                <input type="file" @change=${this.onFileSelection} class="fileupload" multiple="" style="display:none"/>`}return""}getSpoilerButton(){var e;const t=this.model;if(!(this.is_groupchat||null!==(e=t.presence)&&void 0!==e&&e.resources.length))return;let n;n=this.composing_spoiler?vh("Click to write as a normal (non-spoiler) message"):vh("Click to write your message as a spoiler");const s=Qc`
            <button class="toggle-compose-spoiler"
                    title="${n}"
                    @click=${this.toggleComposeSpoilerMessage}>
                <converse-icon class="fa ${this.composing_spoiler?"fa-eye-slash":"fa-eye"}"
                         path-prefix="${Cl.settings.get("assets_path")}"
                         size="1em"></converse-icon>
            </button>`;if(this.is_groupchat)return s;{const e=t.get("jid"),n=Promise.all(t.presence.resources.map((t=>Cl.disco.supports(nb.NS.SPOILER,`${e}/${t.get("name")}`)))).then((e=>e.reduce(((e,t)=>e&&t),!0)));return Qc`${dp(n.then((()=>s)),"")}`}}toggleFileUpload(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.querySelector(".fileupload").click()}onFileSelection(e){this.model.sendFiles(e.target.files)}toggleComposeSpoilerMessage(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.set("composing_spoiler",!this.model.get("composing_spoiler"))}toggleOccupants(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")})}toggleCall(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),Cl.trigger("callButtonClicked",{connection:va.connection,model:this.model})}});var cb=n(6220),lb={};lb.styleTagTransform=eg(),lb.setAttributes=Yf(),lb.insert=Jf().bind(null,"head"),lb.domAPI=Wf(),lb.insertStyleElement=Xf(),Hf()(cb.Z,lb),cb.Z&&cb.Z.locals&&cb.Z.locals,Cl.elements.define("converse-chat-heading",class extends Uf{connectedCallback(){super.connectedCallback(),this.initialize()}initialize(){var e;this.model=va.chatboxes.get(this.getAttribute("jid")),this.listenTo(this.model,"change:status",this.requestUpdate),this.listenTo(this.model,"vcard:change",this.requestUpdate),this.model.contact&&this.listenTo(this.model.contact,"destroy",this.requestUpdate),null===(e=this.model.rosterContactAdded)||void 0===e||e.then((()=>{this.listenTo(this.model.contact,"change:nickname",this.requestUpdate),this.requestUpdate()}))}render(){return(e=>{var t;const n=null===(t=e.model)||void 0===t?void 0:t.vcard,s=n?n.toJSON():{},i=vh("The User's Profile Image"),r=Object.assign({alt_text:i,extra_classes:"",height:40,width:40},s),o=Qc`<span class="mr-2">${_v(r)}</span>`,a=e.model.getDisplayName();return Qc`
        <div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}">
            <div class="chatbox-title--row">
                ${va.api.settings.get("singleton")?"":Qc`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}
                ${e.type!==va.HEADLINES_TYPE?Qc`<a class="show-msg-author-modal" @click=${e.showUserDetailsModal}>${o}</a>`:""}
                <div class="chatbox-title__text" title="${e.jid}">
                    ${e.type!==va.HEADLINES_TYPE?Qc`<a class="user show-msg-author-modal" @click=${e.showUserDetailsModal}>${a}</a>`:a}
                </div>
            </div>
            <div class="chatbox-title__buttons row no-gutters">
                ${dp(async function(e){return(await e).filter((e=>!e.standalone)).map((e=>sb(e)))}(e.heading_buttons_promise).then((e=>e.length?Qc`<converse-dropdown class="dropleft" color="var(--chat-head-text-color)" .items=${e}></converse-dropdown>`:"")),"")}
                ${dp(async function(e){return(await e).filter((e=>e.standalone)).map((e=>ib(e)))}(e.heading_buttons_promise).then((e=>e.reverse().map((e=>dp(e,""))))),"")}
            </div>
        </div>
        ${e.status?Qc`<p class="chat-head__desc">${e.status}</p>`:""}
    `})(Object.assign(this.model.toJSON(),{heading_buttons_promise:this.getHeadingButtons(),model:this.model,showUserDetailsModal:e=>this.showUserDetailsModal(e)}))}showUserDetailsModal(e){e.preventDefault(),Cl.modal.show(Cv,{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}getHeadingButtons(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:vh("Details"),i18n_title:vh("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:"overlayed"===Cl.settings.get("view_mode")}];Cl.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:vh("Close"),i18n_title:vh("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Cl.settings.get("view_mode")});const t=va.chatboxviews.get(this.getAttribute("jid"));return t?va.api.hook("getHeadingButtons",t,e):e}});const{u:db}=jl.env;class ub extends mg{async connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.getAttribute("jid")),await this.model.initialized,this.listenTo(this.model.messages,"change:correcting",this.onMessageCorrecting),this.render()}toHTML(){var e,t;return(e=>{const t=e.composing_spoiler?vh("Hidden message"):vh("Message"),n=vh("Optional hint"),s=Cl.settings.get("show_send_button");return Qc`
        <form class="sendXMPPMessage">
            <input type="text" placeholder="${n||""}" value="${e.hint_value||""}" class="${e.composing_spoiler?"":"hidden"} spoiler-hint"/>
            <textarea
                autofocus
                type="text"
                @drop=${e.onDrop}
                @input=${ab}
                @keydown=${e.onKeyDown}
                @keyup=${e.onKeyUp}
                @paste=${e.onPaste}
                @change=${e.onChange}
                class="chat-textarea
                    ${s?"chat-textarea-send-button":""}
                    ${e.composing_spoiler?"spoiler":""}"
                placeholder="${t}">${e.message_value||""}</textarea>
        </form>`})(Object.assign(this.model.toJSON(),{onDrop:e=>this.onDrop(e),hint_value:null===(e=this.querySelector(".spoiler-hint"))||void 0===e?void 0:e.value,message_value:null===(t=this.querySelector(".chat-textarea"))||void 0===t?void 0:t.value,onChange:e=>this.model.set({draft:e.target.value}),onKeyDown:e=>this.onKeyDown(e),onKeyUp:e=>this.onKeyUp(e),onPaste:e=>this.onPaste(e),viewUnreadMessages:e=>this.viewUnreadMessages(e)}))}insertIntoTextArea(e,t=!1,n=!1,s){const i=this.querySelector(".chat-textarea");if(n?db.addClass("correcting",i):db.removeClass("correcting",i),t)i.value=s&&"string"==typeof t?i.value.replace(new RegExp(t,"g"),((n,i)=>i==s-t.length?e+" ":n)):e;else{let t=i.value;t&&" "!==t[t.length-1]&&(t+=" "),i.value=t+e+" "}const r=document.createEvent("HTMLEvents");r.initEvent("change",!1,!0),i.dispatchEvent(r),db.placeCaretAtEnd(i)}onMessageCorrecting(e){if(e.get("correcting"))this.insertIntoTextArea(db.prefixMentions(e),!0,!0);else{const t=this.model.messages.findWhere("correcting");t&&t!==e?this.insertIntoTextArea(db.prefixMentions(e),!0,!0):this.insertIntoTextArea("",!0,!1)}}onEscapePressed(e){e.preventDefault();const t=this.model.messages.findLastIndex("correcting"),n=t>=0?this.model.messages.at(t):null;n&&n.save("correcting",!1),this.insertIntoTextArea("",!0,!1)}onPaste(e){if(e.stopPropagation(),0!==e.clipboardData.files.length)return e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));this.model.set({draft:e.clipboardData.getData("text/plain")})}onKeyUp(e){this.model.set({draft:e.target.value})}onKeyDown(e){if(!e.ctrlKey){if(!e.shiftKey&&!e.altKey&&!e.metaKey)if(e.keyCode===jl.keycodes.TAB){const t=db.getCurrentWord(e.target,null,/(:.*?:)/g);t.startsWith(":")&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("emoji-picker-autocomplete",e.target,t))}else{if(e.keyCode===jl.keycodes.FORWARD_SLASH)return;if(e.keyCode===jl.keycodes.ESCAPE)return this.onEscapePressed(e,this);if(e.keyCode===jl.keycodes.ENTER)return this.onFormSubmitted(e);if(e.keyCode!==jl.keycodes.UP_ARROW||e.target.selectionEnd){if(e.keyCode===jl.keycodes.DOWN_ARROW&&e.target.selectionEnd===e.target.value.length&&db.hasClass("correcting",this.querySelector(".chat-textarea")))return this.model.editLaterMessage()}else{const e=this.querySelector(".chat-textarea");if(!e.value||db.hasClass("correcting",e))return this.model.editEarlierMessage()}}[jl.keycodes.SHIFT,jl.keycodes.META,jl.keycodes.META_RIGHT,jl.keycodes.ESCAPE,jl.keycodes.ALT].includes(e.keyCode)||this.model.get("chat_state")!==va.COMPOSING&&this.model.setChatState(va.COMPOSING)}}parseMessageForCommands(e){return ob(this.model,e)}async onFormSubmitted(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const s=this.querySelector(".chat-textarea"),i=s.value.trim();if(Cl.settings.get("message_limit")&&i.length>Cl.settings.get("message_limit")||!i.replace(/\s/g,"").length)return;if(!va.connection.authenticated){const e=vh("Sorry, the connection has been lost, and your message could not be sent");return Cl.alert("error",vh("Error"),e),void Cl.connection.reconnect()}let r,o={};this.model.get("composing_spoiler")&&(o=this.querySelector("form.sendXMPPMessage input.spoiler-hint"),r=o.value),db.addClass("disabled",s),s.setAttribute("disabled","disabled"),null===(n=this.querySelector("converse-emoji-dropdown"))||void 0===n||n.hideMenu();const a=this.parseMessageForCommands(i),c=a?null:await this.model.sendMessage({body:i,spoiler_hint:r});(a||c)&&(o.value="",s.value="",db.removeClass("correcting",s),s.style.height="auto",this.model.set({draft:""})),"overlayed"===Cl.settings.get("view_mode")&&(va.chatboxviews.get(this.getAttribute("jid")).querySelector(".chat-content__messages").parentElement.style.display="none"),s.removeAttribute("disabled"),db.removeClass("disabled",s),"overlayed"===Cl.settings.get("view_mode")&&(va.chatboxviews.get(this.getAttribute("jid")).querySelector(".chat-content__messages").parentElement.style.display=""),this.model.setChatState(va.ACTIVE,{silent:!0}),s.focus()}}Cl.elements.define("converse-message-form",ub);var hb=n(4639),mb={};mb.styleTagTransform=eg(),mb.setAttributes=Yf(),mb.insert=Jf().bind(null,"head"),mb.domAPI=Wf(),mb.insertStyleElement=Xf(),Hf()(hb.Z,mb),hb.Z&&hb.Z.locals&&hb.Z.locals;class fb extends mg{constructor(){var e,t,n;super(),n={"click .send-button":"sendButtonClicked","click .toggle-clear":"clearMessages"},(t="events")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.debouncedRender=hc(this.render,100)}async connectedCallback(){super.connectedCallback(),await this.initialize(),this.render()}async initialize(){this.model=await Cl.chatboxes.get(this.getAttribute("jid")),await this.model.initialized,this.listenTo(this.model,"change:num_unread",this.debouncedRender),this.listenTo(this.model,"emoji-picker-autocomplete",this.autocompleteInPicker),this.addEventListener("focusin",(e=>this.emitFocused(e))),this.addEventListener("focusout",(e=>this.emitBlurred(e)))}render(){tl((e=>{const t=vh("You have unread messages"),n=Cl.settings.get("message_limit"),s=Cl.settings.get("visible_toolbar_buttons").call,i=Cl.settings.get("visible_toolbar_buttons").emoji,r=Cl.settings.get("show_send_button"),o=Cl.settings.get("visible_toolbar_buttons").spoiler,a=Cl.settings.get("show_toolbar");return Qc`
        ${e.model.ui.get("scrolled")&&e.model.get("num_unread")?Qc`<div class="new-msgs-indicator" @click=${t=>e.viewUnreadMessages(t)}>▼ ${t} ▼</div>`:""}
        ${Cl.settings.get("show_toolbar")?Qc`
            <converse-chat-toolbar
                class="chat-toolbar no-text-select"
                .model=${e.model}
                ?composing_spoiler="${e.model.get("composing_spoiler")}"
                ?show_call_button="${s}"
                ?show_emoji_button="${i}"
                ?show_send_button="${r}"
                ?show_spoiler_button="${o}"
                ?show_toolbar="${a}"
                message_limit="${n}"></converse-chat-toolbar>`:""}
        <converse-message-form jid="${e.model.get("jid")}"></converse-message-form>
    `})({model:this.model,viewUnreadMessages:e=>this.viewUnreadMessages(e)}),this)}sendButtonClicked(e){var t;null===(t=this.querySelector("converse-message-form"))||void 0===t||t.onFormSubmitted(e)}viewUnreadMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.ui.set({scrolled:!1})}emitFocused(e){var t;null===(t=va.chatboxviews.get(this.getAttribute("jid")))||void 0===t||t.emitFocused(e)}emitBlurred(e){var t;null===(t=va.chatboxviews.get(this.getAttribute("jid")))||void 0===t||t.emitBlurred(e)}onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))}onDragOver(e){e.preventDefault()}clearMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),rb(this.model)}async autocompleteInPicker(e,t){await Cl.emojis.initialize();const n=this.querySelector("converse-emoji-picker");if(n){n.model.set({ac_position:e.selectionStart,autocompleting:t,query:t});const s=this.querySelector("converse-emoji-dropdown");null==s||s.showMenu()}}}Cl.elements.define("converse-chat-bottom-panel",fb);class gb extends Uf{static get properties(){return{jid:{type:String}}}disconnectedCallback(){super.disconnectedCallback(),va.chatboxviews.remove(this.jid,this)}updated(){this.model&&this.jid!==this.model.get("jid")&&(this.stopListening(),va.chatboxviews.remove(this.model.get("jid"),this),delete this.model,this.requestUpdate(),this.initialize())}close(e){var t;return null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.close(e)}maybeFocus(){Cl.settings.get("auto_focus")&&this.focus()}focus(){const e=this.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this}emitBlurred(e){this.contains(document.activeElement)||this.contains(e.relatedTarget)||Cl.trigger("chatBoxBlurred",this,e)}emitFocused(e){this.contains(e.relatedTarget)||Cl.trigger("chatBoxFocused",this,e)}getBottomPanel(){return this.model.get("type")===va.CHATROOMS_TYPE?this.querySelector("converse-muc-bottom-panel"):this.querySelector("converse-chat-bottom-panel")}getMessageForm(){return this.model.get("type")===va.CHATROOMS_TYPE?this.querySelector("converse-muc-message-form"):this.querySelector("converse-message-form")}scrollDown(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.ui.get("scrolled")&&this.model.ui.set({scrolled:!1}),Lv(this.model)}onWindowStateChanged(e){"visible"===e.state?this.model.isHidden()||this.model.clearUnreadMsgCounter():"hidden"===e.state&&(this.model.setChatState(va.INACTIVE,{silent:!0}),this.model.sendChatState())}}class pb extends gb{constructor(...e){var t,n;super(...e),(n="length")in(t=this)?Object.defineProperty(t,n,{value:200,enumerable:!0,configurable:!0,writable:!0}):t[n]=200}connectedCallback(){super.connectedCallback(),this.initialize()}async initialize(){va.chatboxviews.add(this.jid,this),this.model=va.chatboxes.get(this.jid),this.listenTo(va,"windowStateChanged",this.onWindowStateChanged),this.listenTo(this.model,"change:hidden",(()=>!this.model.get("hidden")&&this.afterShown())),this.listenTo(this.model,"change:show_help_messages",this.requestUpdate),await this.model.messages.fetched,!this.model.get("hidden")&&this.afterShown(),Cl.trigger("chatBoxViewInitialized",this)}render(){return(e=>Qc`
    <div class="flyout box-flyout">
        <converse-dragresize></converse-dragresize>
        ${e.model?Qc`
            <converse-chat-heading jid="${e.jid}" class="chat-head chat-head-chatbox row no-gutters"></converse-chat-heading>
            <div class="chat-body">
                <div class="chat-content ${e.show_send_button?"chat-content-sendbutton":""}" aria-live="polite">
                    <converse-chat-content
                        class="chat-content__messages"
                        jid="${e.jid}"></converse-chat-content>

                    ${e.show_help_messages?Qc`<div class="chat-content__help">
                            <converse-chat-help
                                .model=${e.model}
                                .messages=${e.help_messages}
                                ?hidden=${!e.show_help_messages}
                                type="info"
                                chat_type="${va.CHATROOMS_TYPE}"
                            ></converse-chat-help></div>`:""}
                </div>
                <converse-chat-bottom-panel jid="${e.jid}" class="bottom-panel"> </converse-chat-bottom-panel>
            </div>
        `:""}
    </div>
`)(Object.assign({model:this.model,help_messages:this.getHelpMessages(),show_help_messages:this.model.get("show_help_messages")},this.model.toJSON()))}getHelpMessages(){return[`<strong>/clear</strong>: ${vh("Remove messages")}`,`<strong>/close</strong>: ${vh("Close this chat")}`,`<strong>/me</strong>: ${vh("Write in the third person")}`,`<strong>/help</strong>: ${vh("Show this menu")}`]}showControlBox(){var e;null===(e=va.chatboxviews.get("controlbox"))||void 0===e||e.show()}afterShown(){this.model.setChatState(va.ACTIVE),this.model.clearUnreadMsgCounter(),this.maybeFocus()}}Cl.elements.define("converse-chat",pb);var vb=n(9107),bb={};bb.styleTagTransform=eg(),bb.setAttributes=Yf(),bb.insert=Jf().bind(null,"head"),bb.domAPI=Wf(),bb.insertStyleElement=Xf(),Hf()(vb.Z,bb),vb.Z&&vb.Z.locals&&vb.Z.locals;const{Strophe:yb}=jl.env;jl.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-modal"],initialize(){Cl.settings.extend({auto_focus:!0,debounced_content_rendering:!0,embed_videos:!0,embed_audio:!0,filter_url_query_params:null,image_urls_regex:null,message_limit:0,muc_hats:["xep317"],show_images_inline:!0,show_message_avatar:!0,show_retraction_warning:!0,show_send_button:!0,show_toolbar:!0,time_format:"HH:mm",use_system_emojis:!0,visible_toolbar_buttons:{call:!1,clear:!0,emoji:!0,spoiler:!0}}),va.ChatBoxView=pb,Cl.listen.on("connected",(()=>Cl.disco.own.features.add(yb.NS.SPOILER))),Cl.listen.on("chatBoxClosed",(e=>{return t=e.get("jid"),void(va.router.history.getFragment()===`converse/chat?jid=${t}`&&va.router.navigate(""));var t}))}}),Cl.elements.define("converse-brand-byline",class extends Uf{render(){const e="fullscreen"===Cl.settings.get("view_mode");return Qc`
            ${e?Qc`
                    <p class="brand-subtitle">${va.VERSION_NAME}</p>
                    <p class="brand-subtitle">
                        <a target="_blank" rel="nofollow" href="https://conversejs.org">Open Source</a> XMPP chat client
                        brought to you by <a target="_blank" rel="nofollow" href="https://opkode.com">Opkode</a>
                    </p>
                    <p class="brand-subtitle">
                        <a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages"
                            >Translate</a
                        >
                        it into your own language
                    </p>
                `:""}
            `}}),Cl.elements.define("converse-brand-logo",class extends Uf{render(){const e="fullscreen"===Cl.settings.get("view_mode");return Qc`
            <a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener">
                <span class="brand-name-wrapper ${e?"brand-name-wrapper--fullscreen":""}">
                    <svg
                        class="converse-svg-logo"
                        xmlns:svg="http://www.w3.org/2000/svg"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 364 364">

                        <title>Converse</title>
                        <g class="cls-1" id="g904">
                            <g data-name="Layer 2">
                                <g data-name="Layer 7">
                                    <path
                                        class="cls-3"
                                        d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z"
                                    />
                                    <path
                                        class="cls-4"
                                        d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z"
                                    />
                                </g>
                            </g>
                        </g>
                    </svg>
                    <span class="brand-name">
                        <span class="brand-name__text">converse<span class="subdued">.js</span></span>
                        ${e?Qc`
                                <p class="byline">messaging freedom</p>
                            `:""}
                    </span>
                </span>
            </a>
        `}}),Cl.elements.define("converse-brand-heading",class extends Uf{render(){return Qc`
            <converse-brand-logo></converse-brand-logo>
            <converse-brand-byline></converse-brand-byline>
        `}});const _b=e=>Qc`
    <converse-brand-heading></converse-brand-heading>
    <form id="converse-login" class="converse-form" method="post">
        <div class="conn-feedback fade-in ${e.conn_feedback_subject?e.conn_feedback_class:"hidden"}">
            <p class="feedback-subject">${e.conn_feedback_subject}</p>
            <p class="feedback-message ${e.conn_feedback_message?"":"hidden"}">${e.conn_feedback_message}</p>
        </div>
        ${"CONNECTING"===va.CONNECTION_STATUS[e.connection_status]?Iv({classes:"hor_centered"}):(e=>{const t=vh("Disconnected"),n=vh("Click here to log in anonymously");return Qc`
        ${e.authentication==e.LOGIN||e.authentication==e.EXTERNAL?(e=>{const t=vh("Log in"),n=vh("XMPP Address");return Qc`
        <div class="form-group">
            <label for="converse-login-jid">${n}:</label>
            <input id="converse-login-jid"
                ?autofocus=${!!Cl.settings.get("auto_focus")}
                required
                class="form-control"
                type="text"
                name="jid"
                placeholder="${e.placeholder_username}"/>
        </div>
        ${e.authentication!==e.EXTERNAL?(()=>{const e=vh("Password");return Qc`
        <div class="form-group">
            <label for="converse-login-password">${e}</label>
            <input id="converse-login-password" class="form-control" required="required" type="password" name="password" placeholder="${e}"/>
        </div>
    `})():""}
        ${e.show_trust_checkbox?(e=>{const t=vh("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),n=vh("This is a trusted device");return Qc`
        <div class="form-group form-check login-trusted">
            <input id="converse-login-trusted" type="checkbox" class="form-check-input" name="trusted" ?checked=${e}>
            <label for="converse-login-trusted" class="form-check-label login-trusted__desc">${n}</label>
            <i class="fa fa-info-circle" data-toggle="popover"
                data-title="Trusted device?"
                data-content="${t}"></i>
        </div>
    `})("off"!==e.show_trust_checkbox):""}
        <fieldset class="form-group buttons">
            <input class="btn btn-primary" type="submit" value="${t}"/>
        </fieldset>
        ${va.allow_registration&&!Cl.settings.get("auto_login")&&va.pluggable.plugins["converse-register"].enabled(va)?(()=>{const e=vh("Create an account"),t=vh("Don't have a chat account?");return Qc`
        <fieldset class="switch-form">
            <p>${t}</p>
            <p><a class="register-account toggle-register-login" href="#converse/register">${e}</a></p>
        </fieldset>
    `})():""}
    `})(e):""}
        ${e.authentication==e.ANONYMOUS?Qc`<input class="btn btn-primary login-anon" type="submit" value="${n}">`:""}
        ${e.authentication==e.PREBIND?Qc`<p>${t}</p>`:""}
    `})(e)}
    </form>
`;function wb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Sb=jl.env.utils,{Strophe:xb}=jl.env,Eb=[0,1,2,3,4,7,10],Ab={0:"Error",1:"Connecting",2:"Connection failure",3:"Authenticating",4:"Authentication failure",5:"Connected",6:"Disconnected",7:"Disconnecting",8:"Attached",9:"Redirect",10:"Reconnecting"},Cb={Error:"error",Connecting:"info","Connection failure":"error",Authenticating:"info","Authentication failure":"error",Connected:"info",Disconnected:"error",Disconnecting:"warn",Attached:"info",Redirect:"info",Reconnecting:"warn"},Tb=Zo.extend({defaults:{errors:[]}});Cl.elements.define("converse-login-panel",class extends mg{constructor(...e){super(...e),wb(this,"id","converse-login-panel"),wb(this,"className","controlbox-pane fade-in row no-gutters"),wb(this,"events",{"submit form#converse-login":"authenticate","change input":"validate"})}initialize(){this.model=new Tb,this.listenTo(this.model,"change",this.render),this.listenTo(va.connfeedback,"change",this.render),this.render(),this.initPopovers()}render(){const e=va.connfeedback.get("connection_status");let t,n;Eb.includes(e)&&(n=Ab[e],t=Cb[n]),tl(_b(Object.assign(this.model.toJSON(),{_converse:va,ANONYMOUS:va.ANONYMOUS,EXTERNAL:va.EXTERNAL,LOGIN:va.LOGIN,PREBIND:va.PREBIND,auto_login:Cl.settings.get("auto_login"),authentication:Cl.settings.get("authentication"),connection_status:e,conn_feedback_class:t,conn_feedback_subject:n,conn_feedback_message:va.connfeedback.get("message"),placeholder_username:(Cl.settings.get("locked_domain")||Cl.settings.get("default_domain"))&&vh("Username")||vh("user@domain"),show_trust_checkbox:Cl.settings.get("allow_user_trust_override")})),this)}initPopovers(){Array.from(this.querySelectorAll("[data-title]")).forEach((e=>{new(Hg().Popover)(e,{trigger:"mobile"===Cl.settings.get("view_mode")?"click":"hover",dismissible:"mobile"===Cl.settings.get("view_mode"),container:this.parentElement.parentElement.parentElement})}))}validate(){const e=this.querySelector("form").querySelector("input[name=jid]");return!e.value||Cl.settings.get("locked_domain")||Cl.settings.get("default_domain")||Sb.isValidJID(e.value)?(e.setCustomValidity(""),!0):(e.setCustomValidity(vh("Please enter a valid XMPP address")),!1)}authenticate(e){if(null==e||e.preventDefault(),Cl.settings.get("authentication")===va.ANONYMOUS)return this.connect(va.jid,null);if(!this.validate())return;const t=new FormData(e.target);va.config.save({trusted:!!t.get("trusted")});let n=t.get("jid");if(Cl.settings.get("locked_domain")){const e="@"+Cl.settings.get("locked_domain");n.endsWith(e)&&(n=n.substr(0,n.length-e.length)),n=xb.escapeNode(n)+e}else Cl.settings.get("default_domain")&&!n.includes("@")&&(n=n+"@"+Cl.settings.get("default_domain"));this.connect(n,t.get("password"))}connect(e,t){["converse/login","converse/register"].includes(va.router.history.getFragment())&&va.router.navigate("",{replace:!0}),va.connection&&va.connection.reset(),Cl.user.login(e,t)}});const kb=jl.env.utils;function jb(){var e;const t=va.chatboxes.add(new va.ControlBox({id:"controlbox"}));return null===(e=va.chatboxviews.get("controlbox"))||void 0===e||e.setModel(),t}function Nb(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=va.chatboxes.get("controlbox")||jb();kb.safeSave(n,{closed:!1})}function Ob(){const e=va.chatboxviews.get("controlbox");return e.model.set({connected:!1}),e}function $b(){const e=null==va?void 0:va.chatboxviews,t=e&&e.get("controlbox");t&&(kb.safeSave(t.model,{connected:!1}),null!=t&&t.controlbox_pane&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}function Ib(){(va.chatboxes.get("controlbox")||jb()).save({connected:!0})}Cl.elements.define("converse-controlbox-navback",class extends Uf{static get properties(){return{jid:{type:String}}}render(){return e=this.jid,Qc`<i class="fa fa-arrow-left" @click=${()=>function(e){Nb();const t=va.chatboxes.get(e);kb.safeSave(t,{hidden:!0})}(e)}></i>`;var e}});const{dayjs:Mb}=jl.env,Rb=Zo.extend({defaults:()=>({bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!Cl.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:Mb(0).valueOf(),type:va.CONTROLBOX_TYPE,url:""}),validate(e){return e.type===va.CONTROLBOX_TYPE?"embedded"===Cl.settings.get("view_mode")&&Cl.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:va.ChatBox.prototype.validate.call(this,e)},maybeShow(e){return e||"controlbox"!==this.get("id")?va.ChatBox.prototype.maybeShow.call(this,e):this},onReconnection(){this.save("connected",!0)}});class Db extends Uf{async connectedCallback(){super.connectedCallback(),await Cl.waitUntil("initialized"),this.model=va.chatboxes.get("controlbox"),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.requestUpdate()}render(){var e;return(e=>{const t=Cl.connection.connected()?vh("Chat Contacts"):vh("Toggle chat");return Qc`<a id="toggle-controlbox" class="toggle-controlbox ${e.hide?"hidden":""}" @click=${e.onClick}><span class="toggle-feedback">${t}</span></a>`})({onClick:Nb,hide:!(null!==(e=this.model)&&void 0!==e&&e.get("closed"))})}}Cl.elements.define("converse-controlbox-toggle",Db);const Lb=Db,zb=jl.env.utils;class Pb extends mg{initialize(){this.setModel(),this.render(),va.chatboxviews.add("controlbox",this),Cl.trigger("controlBoxInitialized",this)}setModel(){this.model=va.chatboxes.get("controlbox"),this.initEventHandlers()}initEventHandlers(){this.listenTo(this.model,"change:active-form",this.render),this.listenTo(this.model,"change:connected",this.render),this.listenTo(this.model,"change:closed",(()=>!this.model.get("closed")&&this.afterShown()))}render(){tl((e=>Qc`
    <div class="flyout box-flyout">
        <converse-dragresize></converse-dragresize>
        <div class="chat-head controlbox-head">
            ${e.sticky_controlbox?"":Qc`
                      <a class="chatbox-btn close-chatbox-button fa fa-times" @click=${e.close}></a>
                  `}
        </div>
        <div class="controlbox-panes">
            <div class="controlbox-pane">
                ${e.connected?Qc`
                          <converse-user-profile></converse-user-profile>
                          <converse-headlines-panel class="controlbox-section"></converse-headlines-panel>
                          <div id="chatrooms" class="controlbox-section">
                              <converse-rooms-list></converse-rooms-list>
                              <converse-bookmarks></converse-bookmarks>
                          </div>
                          ${Cl.settings.get("authentication")===va.ANONYMOUS?"":Qc`<div id="converse-roster" class="controlbox-section"><converse-roster></converse-roster></div>`}`:"register"===e["active-form"]?Qc`<converse-register-panel></converse-register-panel>`:Qc`<converse-login-panel></converse-login-panel>`}
            </div>
        </div>
    </div>
`)({sticky_controlbox:Cl.settings.get("sticky_controlbox"),...this.model.toJSON(),close:e=>this.close(e)}),this)}afterRender(){this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!Cl.settings.get("show_controlbox_by_default"))}close(e){var t;if(null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),("closeAllChatBoxes"!==(null==e?void 0:e.name)||va.disconnection_cause===va.LOGOUT&&!Cl.settings.get("show_controlbox_by_default"))&&!Cl.settings.get("sticky_controlbox"))return zb.safeSave(this.model,{closed:!0}),Cl.trigger("controlBoxClosed",this),this}afterShown(){return Cl.trigger("controlBoxOpened",this),this}showHelpMessages(){}}Cl.elements.define("converse-controlbox",Pb);const Fb=Pb,{u:Ub}=jl.env,Bb={controlbox:{async open(){await Cl.waitUntil("chatBoxesFetched");const e=await Cl.chatboxes.get("controlbox")||Cl.chatboxes.create("controlbox",{},va.Controlbox);return Ub.safeSave(e,{closed:!1}),e},get:()=>va.chatboxviews.get("controlbox")}};var qb=n(7581),Hb={};Hb.styleTagTransform=eg(),Hb.setAttributes=Yf(),Hb.insert=Jf().bind(null,"head"),Hb.domAPI=Wf(),Hb.insertStyleElement=Xf(),Hf()(qb.Z,Hb),qb.Z&&qb.Z.locals&&qb.Z.locals,jl.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),overrides:{ChatBoxes:{model(e,t){return e&&"controlbox"==e.id?new Rb(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){Cl.settings.extend({allow_logout:!0,allow_user_trust_override:!0,default_domain:void 0,locked_domain:void 0,show_controlbox_by_default:!1,sticky_controlbox:!1}),Cl.promises.add("controlBoxInitialized"),Object.assign(Cl,Bb),va.ControlBoxView=Fb,va.ControlBox=Rb,va.ControlBoxToggle=Lb,Cl.listen.on("chatBoxesFetched",Ib),Cl.listen.on("cleanup",(()=>delete va.controlboxtoggle)),Cl.listen.on("clearSession",$b),Cl.listen.on("will-reconnect",Ob),Cl.waitUntil("chatBoxViewsInitialized").then(jb).catch((e=>M.fatal(e)))}});const{u:Gb}=jl.env;function Wb(e,t=!0){if(!Cl.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=Gb.ancestor(e.target,".box-flyout"),s=window.getComputedStyle(n),i=n.parentElement;i.height=parseInt(s.height.replace(/px$/,""),10),va.resizing={chatbox:i,direction:"top"},i.prev_pageY=e.pageY,t&&Cl.trigger("startVerticalResize",i)}function Vb(e,t=!0){if(!Cl.settings.get("allow_dragresize"))return!0;e.preventDefault();const n=Gb.ancestor(e.target,".box-flyout"),s=window.getComputedStyle(n),i=n.parentElement;i.width=parseInt(s.width.replace(/px$/,""),10),va.resizing={chatbox:i,direction:"left"},i.prev_pageX=e.pageX,t&&Cl.trigger("startHorizontalResize",i)}function Jb(e){Vb(e,!1),Wb(e,!1),va.resizing.direction="topleft",Cl.trigger("startDiagonalResize",this)}function Kb(e,t){if(void 0!==e)return void 0===t?e:e!==t&&Math.abs(e-t)<10?t:e}function Yb(e){if(!va.resizing||!Cl.settings.get("allow_dragresize"))return!0;e.preventDefault(),va.resizing.chatbox.resizeChatBox(e)}function Qb(e){if(!va.resizing||!Cl.settings.get("allow_dragresize"))return!0;e.preventDefault();const t=Kb(va.resizing.chatbox.height,va.resizing.chatbox.model.get("default_height")),n=Kb(va.resizing.chatbox.width,va.resizing.chatbox.model.get("default_width"));Cl.connection.connected()?(va.resizing.chatbox.model.save({height:t}),va.resizing.chatbox.model.save({width:n})):(va.resizing.chatbox.model.set({height:t}),va.resizing.chatbox.model.set({width:n})),va.resizing=null}const Xb=()=>Qc`
    <div class="dragresize dragresize-top" @mousedown="${Wb}"></div>
    <div class="dragresize dragresize-topleft" @mousedown="${Jb}"></div>
    <div class="dragresize dragresize-left" @mousedown="${Vb}"></div>
`;customElements.define("converse-dragresize",class extends Uf{render(){return Xb()}});const Zb={initDragResize(){var e;const t=this,n=hc((()=>t.setDimensions()));window.addEventListener("resize",t.debouncedSetDimensions),this.listenTo(this.model,"destroy",(()=>window.removeEventListener("resize",n)));const s=this.querySelector(".box-flyout"),i=window.getComputedStyle(s);if(void 0===this.model.get("height")){const e=parseInt(i.height.replace(/px$/,""),10),t=parseInt(i.width.replace(/px$/,""),10);this.model.set("height",e),this.model.set("default_height",e),this.model.set("width",t),this.model.set("default_width",t)}const r=i["min-width"],o=i["min-height"];return this.model.set("min_width",r.endsWith("px")?Number(r.replace(/px$/,"")):0),this.model.set("min_height",o.endsWith("px")?Number(o.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,null!==(e=va.connection)&&void 0!==e&&e.connected&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},resizeChatBox(e){let t;0===va.resizing.direction.indexOf("top")&&(t=e.pageY-this.prev_pageY,t&&(this.height=this.height-t>(this.model.get("min_height")||0)?this.height-t:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height))),va.resizing.direction.includes("left")&&(t=this.prev_pageX-e.pageX,t&&(this.width=this.width+t>(this.model.get("min_width")||0)?this.width+t:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))},setDimensions(){this.adjustToViewport(),this.setChatBoxHeight(this.model.get("height")),this.setChatBoxWidth(this.model.get("width"))},setChatBoxHeight(e){e=e?Kb(e,this.model.get("default_height"))+"px":"";const t=this.querySelector(".box-flyout");null!==t&&(t.style.height=e)},setChatBoxWidth(e){e=e?Kb(e,this.model.get("default_width"))+"px":"",this.style.width=e;const t=this.querySelector(".box-flyout");null!==t&&(t.style.width=e)},adjustToViewport(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)}};jl.plugins.add("converse-dragresize",{dependencies:["converse-chatview","converse-headlines-view","converse-muc-views"],enabled:e=>"overlayed"==e.api.settings.get("view_mode"),overrides:{ChatBox:{initialize(){const e=this.__super__.initialize.apply(this,arguments),t=this.get("height"),n=this.get("width");return("controlbox"===this.get("id")?e=>this.set(e):e=>this.save(e))({height:Kb(t,this.get("default_height")),width:Kb(n,this.get("default_width"))}),e}}},initialize(){Cl.settings.extend({allow_dragresize:!0}),Object.assign(va.ChatBoxView.prototype,Zb),Object.assign(va.ChatRoomView.prototype,Zb),Object.assign(va.ControlBoxView.prototype,Zb),Cl.listen.on("registeredGlobalEventHandlers",(function(){document.addEventListener("mousemove",Yb),document.addEventListener("mouseup",Qb)})),Cl.listen.on("unregisteredGlobalEventHandlers",(function(){document.removeEventListener("mousemove",Yb),document.removeEventListener("mouseup",Qb)})),Cl.listen.on("beforeShowingChatView",(e=>e.initDragResize().setDimensions()))}}),jl.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){if(Cl.settings.extend({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0}),!Array.isArray(Cl.settings.get("auto_join_rooms"))&&!Array.isArray(Cl.settings.get("auto_join_private_chats")))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(Cl.settings.get("auto_join_rooms").length>1||Cl.settings.get("auto_join_private_chats").length>1)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});var ey=n(6752),ty={};ty.styleTagTransform=eg(),ty.setAttributes=Yf(),ty.insert=Jf().bind(null,"head"),ty.domAPI=Wf(),ty.insertStyleElement=Xf(),Hf()(ey.Z,ty),ey.Z&&ey.Z.locals&&ey.Z.locals,jl.plugins.add("converse-fullscreen",{enabled:e=>e.isUniView(),initialize(){Cl.settings.extend({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),Cl.elements.define("converse-headlines-heading",class extends mg{async connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.getAttribute("jid")),await this.model.initialized,this.render()}async render(){const e=await this.generateHeadingTemplate();tl(e,this)}async generateHeadingTemplate(){const e=await this.getHeadingButtons(),t=e.filter((e=>e.standalone)),n=e.filter((e=>!e.standalone));return(e=>Qc`
        <div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}">
            <div class="chatbox-title--row">
                ${va.api.settings.get("singleton")?"":Qc`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}
                <div class="chatbox-title__text" title="${e.jid}">${e.display_name}</div>
            </div>
            <div class="chatbox-title__buttons row no-gutters">
                ${e.dropdown_btns.length?Qc`<converse-dropdown class="dropleft" .items=${e.dropdown_btns}></converse-dropdown>`:""}
                ${e.standalone_btns.length?(e=>e.standalone_btns.reverse().map((e=>dp(e,""))))(e):""}
            </div>
        </div>
        ${e.status?Qc`<p class="chat-head__desc">${e.status}</p>`:""}
    `)(Object.assign(this.model.toJSON(),{display_name:this.model.getDisplayName(),dropdown_btns:n.map((e=>sb(e))),standalone_btns:t.map((e=>ib(e)))}))}getHeadingButtons(){const e=[];return Cl.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:vh("Close"),i18n_title:vh("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===Cl.settings.get("view_mode")}),va.api.hook("getHeadingButtons",this,e)}close(e){e.preventDefault(),this.model.close()}}),Cl.elements.define("converse-headlines",class extends gb{connectedCallback(){super.connectedCallback(),this.initialize()}async initialize(){va.chatboxviews.add(this.jid,this),this.model=va.chatboxes.get(this.jid),this.model.disable_mam=!0,this.listenTo(va,"windowStateChanged",this.onWindowStateChanged),this.listenTo(this.model,"change:hidden",(()=>this.afterShown())),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.messages,"add",this.requestUpdate),this.listenTo(this.model.messages,"remove",this.requestUpdate),this.listenTo(this.model.messages,"reset",this.requestUpdate),await this.model.messages.fetched,this.model.maybeShow(),Cl.trigger("headlinesBoxViewInitialized",this)}render(){return(e=>Qc`
    <div class="flyout box-flyout">
        <converse-dragresize></converse-dragresize>
        ${e?Qc`
            <converse-headlines-heading jid="${e.get("jid")}" class="chat-head chat-head-chatbox row no-gutters">
            </converse-headlines-heading>
            <div class="chat-body">
                <div class="chat-content" aria-live="polite">
                    <converse-chat-content
                        class="chat-content__messages"
                        jid="${e.get("jid")}"></converse-chat-content>
                </div>
            </div>`:""}
    </div>
`)(this.model)}async close(e){var t;return null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),va.router.history.getFragment()==="converse/chat?jid="+this.model.get("jid")&&va.router.navigate(""),await this.model.close(e),this}getNotifications(){return[]}afterShown(){this.model.clearUnreadMsgCounter()}});class ny extends mg{constructor(...e){var t,n,s;super(...e),s={"click .open-headline":"openHeadline"},(n="events")in(t=this)?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s}initialize(){this.model=va.chatboxes,this.listenTo(this.model,"add",this.renderIfHeadline),this.listenTo(this.model,"remove",this.renderIfHeadline),this.listenTo(this.model,"destroy",this.renderIfHeadline),this.render()}toHTML(){return(e=>Qc`
    <div class="controlbox-section" id="headline">
        <div class="d-flex controlbox-padded ${e.headlineboxes.length?"":"hidden"}">
            <span class="w-100 controlbox-heading controlbox-heading--headline">${e.heading_headline}</span>
        </div>
    </div>
    ${(e=>Qc`
    <div class="list-container list-container--headline ${e.headlineboxes.length?"":"hidden"}">
        <div class="items-list rooms-list headline-list">
            ${e.headlineboxes.map((t=>(e=>Qc`
    <div class="list-item controlbox-padded d-flex flex-row"
        data-headline-jid="${e.headlinebox.get("jid")}">
    <a class="list-item-link open-headline available-room w-100"
        data-headline-jid="${e.headlinebox.get("jid")}"
        title="${e.open_title}" href="#">${e.headlinebox.get("jid")}</a>
    </div>
`)(Object.assign({headlinebox:t},e))))}
        </div>
    </div>
`)(e)}
`)({heading_headline:vh("Announcements"),headlineboxes:this.model.filter((e=>e.get("type")===va.HEADLINES_TYPE)),open_title:vh("Click to open this server message")})}renderIfHeadline(e){return e&&e.get("type")===va.HEADLINES_TYPE&&this.render()}openHeadline(e){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");va.chatboxes.get(t).maybeShow(!0)}}Cl.elements.define("converse-headlines-panel",ny);var sy=n(115),iy={};iy.styleTagTransform=eg(),iy.setAttributes=Yf(),iy.insert=Jf().bind(null,"head"),iy.domAPI=Wf(),iy.insertStyleElement=Xf(),Hf()(sy.Z,iy),sy.Z&&sy.Z.locals&&sy.Z.locals,jl.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],initialize(){va.HeadlinesPanel=ny}});var ry=n(8859),oy={};function ay(e,t){return e instanceof Bh?Qc`<converse-mam-placeholder .model=${e}></converse-mam-placeholder>`:t}async function cy(e){if(!e.model.ui.get("chat-content-spinner-top")&&e.model.messages.length){const t=e.model.get("type")===va.CHATROOMS_TYPE,n=e.model.getOldestMessage();if(n){const s=t?e.model.get("jid"):va.bare_jid,i=n&&n.get(`stanza_id ${s}`);e.model.ui.set("chat-content-spinner-top",!0);try{i?await mm(e.model,{before:i}):await mm(e.model,{end:n.get("time")})}catch(t){return M.error(t),void e.model.ui.set("chat-content-spinner-top",!1)}Cl.settings.get("allow_url_history_change")&&va.router.history.navigate(`#${n.get("msgid")}`),setTimeout((()=>e.model.ui.set("chat-content-spinner-top",!1)),250)}}}oy.styleTagTransform=eg(),oy.setAttributes=Yf(),oy.insert=Jf().bind(null,"head"),oy.domAPI=Wf(),oy.insertStyleElement=Xf(),Hf()(ry.Z,oy),ry.Z&&ry.Z.locals&&ry.Z.locals,Cl.elements.define("converse-mam-placeholder",class extends Uf{static get properties(){return{model:{type:Object}}}render(){return(e=this).model.get("fetching")?Iv({classes:"hor_centered"}):Qc`<a @click="${t=>e.fetchMissingMessages(t)}" title="${vh("Click to load missing messages")}">
            <div class="message mam-placeholder"></div>
        </a>`;var e}async fetchMissingMessages(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.set("fetching",!0);const n={before:this.model.get("before"),start:this.model.get("start")};await mm(this.model.collection.chatbox,n),this.model.destroy()}}),jl.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],initialize(){Cl.listen.on("chatBoxScrolledUp",cy),Cl.listen.on("getMessageTemplate",ay)}});const ly=jl.env.utils;function dy(e){return"controlbox"===e.model.get("id")?ly.isVisible(e)?ly.getOuterWidth(e,!0):ly.getOuterWidth(va.controlboxtoggle.el,!0):!e.model.get("minimized")&&ly.isVisible(e)?ly.getOuterWidth(e,!0):0}function uy(){var e;const t=null===(e=va.minimized_chats)||void 0===e?void 0:e.el;return va.chatboxes.pluck("minimized").includes(!0)?ly.getOuterWidth(t,!0):0}function hy(e){const t=e?e.model.get("id"):null,n=e?ly.getOuterWidth(e.el,!0):0;return Object.values(va.chatboxviews.xget(t)).reduce(((e,t)=>e+dy(t)),n)}async function my(e){var t;if(va.isTestEnv()||Cl.settings.get("no_trimming")||!Cl.connection.connected()||"overlayed"!==Cl.settings.get("view_mode"))return;const n=va.chatboxviews.filter((e=>!e.model.get("minimized")&&!e.model.get("closed")&&ly.isVisible(e)));if(n.length<=1)return;const s=ly.getOuterWidth(document.querySelector("body"),!0);if(dy(n[0])!==s&&(await Cl.waitUntil("minimizedChatsInitialized"),null===(t=va.minimized_chats)||void 0===t?void 0:t.el))for(;uy()+hy(e)>s;){const t=fy([e?e.model.get("id"):null]);if(!t)break;{const e=va.chatboxviews.get(t.get("id"));e&&e.hide(),py(t)}}}function fy(e){e.push("controlbox");let t=0,n=va.chatboxes.sort().at(t);for(;e.includes(n.get("id"))||!0===n.get("minimized");)if(t++,n=va.chatboxes.at(t),!n)return null;return n}function gy(e,t){null!=e&&e.preventDefault?e.preventDefault():t=e,ly.safeSave(t,{hidden:!1,minimized:!1,time_opened:(new Date).getTime()})}function py(e,t){null!=e&&e.preventDefault?e.preventDefault():t=e,t.setChatState(va.INACTIVE),ly.safeSave(t,{hidden:!0,minimized:!0,time_minimized:(new Date).toISOString()})}Cl.elements.define("converse-minimized-chat",class extends Uf{static get properties(){return{model:{type:Object},title:{type:String},type:{type:String},num_unread:{type:Number}}}render(){return(e=>{const t=vh("Click to restore this chat");return Qc`
    <div class="chat-head-${e.type} chat-head row no-gutters">
        <a class="restore-chat w-100 align-self-center" title="${t}" @click=${e.restore}>
            ${e.num_unread?Qc`<span class="message-count badge badge-light">${e.num_unread}</span>`:""}
            ${e.title}
        </a>
        <a class="chatbox-btn close-chatbox-button" @click=${e.close}>
            <converse-icon color=${"chatroom"===e.type?"var(--chatroom-head-color)":"var(--chat-head-text-color)"} class="fas fa-times" @click=${e.close} size="1em"></converse-icon>
        </a>
    </div>`})({close:e=>this.close(e),num_unread:this.num_unread,restore:e=>this.restore(e),title:this.title,type:this.type})}close(e){null==e||e.preventDefault(),this.model.close()}restore(e){null==e||e.preventDefault(),gy(this.model)}});const vy=Zo.extend({defaults:{collapsed:!1}});class by extends Uf{constructor(){super(),this.initialize()}async initialize(){this.model=va.chatboxes,await this.initToggle(),this.listenTo(this.minchats,"change:collapsed",this.requestUpdate),this.listenTo(this.model,"add",this.requestUpdate),this.listenTo(this.model,"change:fullname",this.requestUpdate),this.listenTo(this.model,"change:jid",this.requestUpdate),this.listenTo(this.model,"change:minimized",this.requestUpdate),this.listenTo(this.model,"change:name",this.requestUpdate),this.listenTo(this.model,"change:num_unread",this.requestUpdate),this.listenTo(this.model,"remove",this.requestUpdate),this.listenTo(va,"connected",this.requestUpdate),this.listenTo(va,"reconnected",this.requestUpdate),this.listenTo(va,"disconnected",this.requestUpdate)}render(){const e=this.model.where({minimized:!0}),t=e.reduce(((e,t)=>e+t.get("num_unread")),0),n=e.reduce(((e,t)=>e+(t.get("minimized")?1:0)),0),s={chats:e,num_unread:t,num_minimized:n,collapsed:this.minchats.get("collapsed")};return s.toggle=e=>this.toggle(e),(e=>Qc`<div id="minimized-chats" class="${e.chats.length?"":"hidden"}">
        <a id="toggle-minimized-chats" class="row no-gutters" @click=${e.toggle}>
            ${e.num_minimized} ${vh("Minimized")}
            <span class="unread-message-count ${e.num_unread?"":"unread-message-count-hidden"}" href="#">${e.num_unread}</span>
        </a>
        <div class="flyout minimized-chats-flyout row no-gutters ${e.collapsed?"hidden":""}">
            ${e.chats.map((e=>Qc`<converse-minimized-chat
                        .model=${e}
                        title=${e.getDisplayName()}
                        type=${e.get("type")}
                        num_unread=${e.get("num_unread")}></converse-minimized-chat>`))}
        </div>
    </div>`)(s)}async initToggle(){const e=`converse.minchatstoggle-${va.bare_jid}`;this.minchats=new vy({id:e}),_o(this.minchats,e,"session"),await new Promise((e=>this.minchats.fetch({success:e,error:e})))}toggle(e){null==e||e.preventDefault(),this.minchats.save({collapsed:!this.minchats.get("collapsed")})}}Cl.elements.define("converse-minimized-chats",by);var yy=n(7926),_y={};_y.styleTagTransform=eg(),_y.setAttributes=Yf(),_y.insert=Jf().bind(null,"head"),_y.domAPI=Wf(),_y.insertStyleElement=Xf(),Hf()(yy.Z,_y),yy.Z&&yy.Z.locals&&yy.Z.locals;const{dayjs:wy}=jl.env;jl.plugins.add("converse-minimize",{dependencies:["converse-chatview","converse-controlbox","converse-muc-views","converse-headlines-view","converse-dragresize"],enabled:e=>"overlayed"===e.api.settings.get("view_mode"),overrides:{ChatBox:{initialize(){this.__super__.initialize.apply(this,arguments),this.on("change:hidden",(e=>!e.get("hidden")&&gy(this)),this),"controlbox"!==this.get("id")&&this.save({minimized:this.get("minimized")||!1,time_minimized:this.get("time_minimized")||wy()})},maybeShow(e){return!e&&this.get("minimized")?this:this.__super__.maybeShow.apply(this,arguments)},isHidden(){return this.__super__.isHidden.call(this)||this.get("minimized")}},ChatBoxView:{isNewMessageHidden(){return this.model.get("minimized")||this.__super__.isNewMessageHidden.apply(this,arguments)},setChatBoxHeight(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxHeight.call(this,e)},setChatBoxWidth(e){if(!this.model.get("minimized"))return this.__super__.setChatBoxWidth.call(this,e)}}},initialize(){function e(e){e.on("change:minimized",(()=>function(e){e.get("minimized")?function(e){Cl.trigger("chatBoxMinimized",e)}(e):function(e){e.isScrolledUp()||e.clearUnreadMsgCounter(),e.setChatState(va.ACTIVE),Cl.trigger("chatBoxMaximized",e)}(e)}(e)))}Cl.settings.extend({no_trimming:!1}),Cl.promises.add("minimizedChatsInitialized"),va.MinimizedChatsToggle=vy,va.MinimizedChats=by,va.minimize={},va.minimize.trimChats=my,va.minimize.minimize=py,va.minimize.maximize=gy,Cl.listen.on("chatBoxViewInitialized",(e=>va.minimize.trimChats(e))),Cl.listen.on("chatRoomViewInitialized",(e=>va.minimize.trimChats(e))),Cl.listen.on("chatBoxMaximized",(e=>va.minimize.trimChats(e))),Cl.listen.on("controlBoxOpened",(e=>va.minimize.trimChats(e))),Cl.listen.on("chatBoxInitialized",e),Cl.listen.on("chatRoomInitialized",e),Cl.listen.on("getHeadingButtons",((e,t)=>e.model.get("type")===va.CHATROOMS_TYPE?function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>py(t,e.model),i18n_text:vh("Minimize"),i18n_title:vh("Minimize this groupchat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===va.api.settings.get("view_mode")},s=t.map((e=>e.name)).indexOf("signout");return s>-1?[...t.slice(0,s),n,...t.slice(s)]:[n,...t]}(e,t):function(e,t){const n={a_class:"toggle-chatbox-button",handler:t=>py(t,e.model),i18n_text:vh("Minimize"),i18n_title:vh("Minimize this chat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===va.api.settings.get("view_mode")},s=t.map((e=>e.name)).indexOf("close");return s>-1?[...t.slice(0,s),n,...t.slice(s)]:[n,...t]}(e,t)));const t=hc((()=>va.minimize.trimChats()),250);Cl.listen.on("registeredGlobalEventHandlers",(()=>window.addEventListener("resize",t))),Cl.listen.on("unregisteredGlobalEventHandlers",(()=>window.removeEventListener("resize",t)))}});const Sy=jl.env.utils,xy={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const s=t[n];n.split(/\s+/).forEach((t=>e.addEventListener(t,s)))}},unbind(e,t){if(e)for(var n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const s=t[n];n.split(/\s+/).forEach((t=>e.removeEventListener(t,s)))}},regExpEscape:e=>e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),isMention:(e,t)=>t.includes(e[0])||Sy.isMentionBoundary(e[0])&&t.includes(e[1])},Ey=function(e,t){return RegExp(xy.regExpEscape(t.trim()),"i").test(e)},Ay=function(e,t){return RegExp("^"+xy.regExpEscape(t.trim()),"i").test(e)},Cy=function(e,t){const n=e.query.toLowerCase(),s=e.label.toLowerCase().indexOf(n),i=t.label.toLowerCase().indexOf(n);return s===i?function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1}(e,t):(-1===s?1/0:s)<(-1===i?1/0:i)?-1:1},Ty=(e,t)=>{t=t.trim();const n=document.createElement("li");n.setAttribute("aria-selected","false");const s=new RegExp("("+t+")","ig");return(t?e.split(s):[e]).forEach((e=>{if(t&&e.match(s)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))})),n},ky=class extends String{constructor(e,t){super();const n=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=n.label||n.value,this.value=n.value,this.query=t}get lenth(){return this.label.length}toString(){return""+this.label}valueOf(){return this.toString()}},jy=jl.env.utils;class Ny{constructor(e,t={}){this.suggestions=[],this.is_opened=!1,jy.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,{match_current_word:!1,ac_triggers:[],include_triggers:[],min_chars:2,max_items:10,auto_evaluate:!0,auto_first:!1,data:e=>e,filter:Ey,sort:!1!==t.sort&&Cy,item:Ty},t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}bindEvents(){const e={blur:()=>this.close({reason:"blur"})};this.auto_evaluate&&(e.input=()=>this.evaluate()),this._events={input:e,form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},xy.bind(this.input,this._events.input),xy.bind(this.input.form,this._events.form),xy.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else{var t;const n=(null===(t=xy.getElement(e))||void 0===t?void 0:t.children)||[];this._list=Array.from(n).filter((e=>!e.disabled)).map((e=>{const t=e.textContent.trim(),n=e.value||t,s=e.label||t;return""!==n?{label:s,value:n}:null})).filter((e=>e))}document.activeElement===this.input&&this.evaluate()}get list(){return this._list}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?jy.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){xy.unbind(this.input,this._events.input),xy.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e){const t=this.ul.children;this.selected&&t[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&t.length>0&&(t[e].setAttribute("aria-selected","true"),t[e].focus(),this.status.textContent=t[e].textContent,this.ul.scrollTop=t[e].offsetTop-this.ul.clientHeight+t[e].clientHeight,this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=jy.siblingIndex(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e})}}onMouseOver(e){const t=jy.ancestor(e.target,"li");t&&this.goto(Array.prototype.slice.call(this.ul.children).indexOf(t))}onMouseDown(e){if(0!==e.button)return;const t=jy.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t,e.target))}onKeyDown(e){if(this.opened){if([jl.keycodes.ENTER,jl.keycodes.TAB].includes(e.keyCode)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.keyCode===jl.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([jl.keycodes.UP_ARROW,jl.keycodes.DOWN_ARROW].includes(e.keyCode))return e.preventDefault(),e.stopPropagation(),this[e.keyCode===jl.keycodes.UP_ARROW?"previous":"next"](),!0}if(![jl.keycodes.SHIFT,jl.keycodes.META,jl.keycodes.META_RIGHT,jl.keycodes.ESCAPE,jl.keycodes.ALT].includes(e.keyCode))if(this.ac_triggers.includes(e.key))"Tab"===e.key&&e.preventDefault(),this.auto_completing=!0;else if("Backspace"===e.key){const t=jy.getCurrentWord(e.target,e.target.selectionEnd-1);xy.isMention(t,this.ac_triggers)&&(this.auto_completing=!0)}}async evaluate(e){const t=this.selected&&e&&(e.keyCode===jl.keycodes.UP_ARROW||e.keyCode===jl.keycodes.DOWN_ARROW);if(!this.auto_evaluate&&!this.auto_completing||t)return;const n="function"==typeof this._list?await this._list():this._list;if(0===n.length)return;let s=this.match_current_word?jy.getCurrentWord(this.input):this.input.value;const i=xy.isMention(s,this.ac_triggers);i&&(this.auto_completing=!0,this.include_triggers.includes(e.key)||(s=jy.isMentionBoundary(s[0])?s.slice("2"):s.slice("1"))),(i||s.length)&&s.length>=this.min_chars?(this.index=-1,this.ul.innerHTML="",this.suggestions=n.map((e=>new ky(this.data(e,s),s))).filter((e=>this.filter(e,s))),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),this.suggestions.forEach((e=>this.ul.appendChild(this.item(e,s)))),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()):(this.close({reason:"nomatches"}),i||(this.auto_completing=!1))}}Object.assign(Ny.prototype,ks);const Oy=Ny;Cl.elements.define("converse-autocomplete",class extends Uf{static get properties(){return{getAutoCompleteList:{type:Function},auto_evaluate:{type:Boolean},auto_first:{type:Boolean},filter:{type:String},include_triggers:{type:String},min_chars:{type:Number},name:{type:String},placeholder:{type:String},triggers:{type:String}}}constructor(){super(),this.auto_evaluate=!0,this.auto_first=!1,this.filter="contains",this.include_triggers="",this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.triggers=""}render(){return Qc`
            <div class="suggestion-box suggestion-box__name">
                <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>
                <input
                    type="text"
                    name="${this.name}"
                    autocomplete="off"
                    @keydown=${this.onKeyDown}
                    @keyup=${this.onKeyUp}
                    class="form-control suggestion-box__input"
                    placeholder="${this.placeholder}"
                />
                <span
                    class="suggestion-box__additions visually-hidden"
                    role="status"
                    aria-live="assertive"
                    aria-relevant="additions"
                ></span>
            </div>
        `}firstUpdated(){this.auto_complete=new Oy(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_evaluate:this.auto_evaluate,auto_first:this.auto_first,filter:"contains"==this.filter?Ey:Ay,include_triggers:[],list:()=>this.getAutoCompleteList(),match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}onKeyDown(e){this.auto_complete.onKeyDown(e)}onKeyUp(e){this.auto_complete.evaluate(e)}});var $y=n(8481),Iy={};Iy.styleTagTransform=eg(),Iy.setAttributes=Yf(),Iy.insert=Jf().bind(null,"head"),Iy.domAPI=Wf(),Iy.insertStyleElement=Xf(),Hf()($y.Z,Iy),$y.Z&&$y.Z.locals&&$y.Z.locals,va.FILTER_CONTAINS=Ey,va.FILTER_STARTSWITH=Ay,va.AutoComplete=Oy;function My(e){return"moderator"===e?vh("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?vh("The default role, implies that you can read and write messages."):"visitor"==e?vh("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function Ry(e){return"owner"===e?vh("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?vh("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?vh('To ban a user, you give them the affiliation of "outcast".'):void 0}const Dy=e=>{const t=vh("Affiliation"),n=vh("No users with that affiliation found."),s=vh("No users with that role found."),i=vh("Type here to filter the search results"),r=vh("Role"),o=vh("Show users"),a=vh("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),c=vh("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role."),l=e.queryable_roles.length&&e.queryable_affiliations.length;return Qc`
        ${e.alert_message?Qc`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""}
        ${l?Qc`
    <ul class="nav nav-pills justify-content-center">
        <li role="presentation" class="nav-item">
            <a class="nav-link active" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-toggle="tab">Affiliations</a>
        </li>
        <li role="presentation" class="nav-item">
            <a class="nav-link" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-toggle="tab">Roles</a>
        </li>
    </ul>
`:""}

        <div class="tab-content">

            ${e.queryable_affiliations.length?Qc`
            <div class="tab-pane tab-pane--columns ${e.queryable_affiliations.length?"active":""}" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab">
                <form class="converse-form query-affiliation" @submit=${e.queryAffiliation}>
                    <p class="helptext pb-3">${c}</p>
                    <div class="form-group">
                        <label for="affiliation">
                            <strong>${t}:</strong>
                        </label>
                        <div class="row">
                            <div class="col">
                                <select class="custom-select select-affiliation" name="affiliation">
                                    ${e.queryable_affiliations.map((t=>(e=>Qc`
    <option value="${e.item||""}"
            ?selected=${e.item===e.affiliation}
            title="${Ry(e.item)}">${e.item}</option>
`)(Object.assign({item:t},e))))}
                                </select>
                            </div>
                            <div class="col">
                                <input type="submit" class="btn btn-primary" name="users_with_affiliation" value="${o}"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col mt-3">
                                ${Array.isArray(e.users_with_affiliation)&&e.users_with_affiliation.length>5?Qc`<input class="form-control" .value="${e.affiliations_filter}" @keyup=${e.filterAffiliationResults} type="text" name="filter" placeholder="${i}"/>`:""}
                            </div>
                        </div>

                        ${Ry(e.affiliation)?Qc`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${Ry(e.affiliation)}</p></div></div>`:""}
                    </div>
                </form>
                <div class="scrollable-container">
                    <ul class="list-group list-group--users">
                        ${e.loading_users_with_affiliation?Qc`<li class="list-group-item"> ${Iv()} </li>`:""}
                        ${Array.isArray(e.users_with_affiliation)&&0===e.users_with_affiliation.length?Qc`<li class="list-group-item">${n}</li>`:""}

                        ${e.users_with_affiliation instanceof Error?Qc`<li class="list-group-item">${e.users_with_affiliation.message}</li>`:(e.users_with_affiliation||[]).map((t=>(t.nick||t.jid).match(new RegExp(e.affiliations_filter,"i"))?(e=>Qc`
    <li class="list-group-item" data-nick="${e.item.nick}">
        <ul class="list-group">
            <li class="list-group-item active">
                <div><strong>JID:</strong> ${e.item.jid}</div>
            </li>
            <li class="list-group-item">
                <div><strong>Nickname:</strong> ${e.item.nick}</div>
            </li>
            <li class="list-group-item">
                <div><strong>Affiliation:</strong> ${e.item.affiliation} ${e.assignable_affiliations.length?(e=>Qc`
    <a href="#" data-form="affiliation-form" class="toggle-form right" color="var(--subdued-color)" @click=${e.toggleForm}>
        <converse-icon class="fa fa-wrench" size="1em"></converse-icon>
    </a>`)(e):""}</div>
                ${e.assignable_affiliations.length?(e=>{const t=vh("Change affiliation"),n=vh("New affiliation"),s=vh("Reason");return Qc`
        <form class="affiliation-form hidden" @submit=${e.assignAffiliation}>
            <div class="form-group">
                <input type="hidden" name="jid" value="${e.item.jid}"/>
                <input type="hidden" name="nick" value="${e.item.nick}"/>
                <div class="row">
                    <div class="col">
                        <label><strong>${n}:</strong></label>
                        <select class="custom-select select-affiliation" name="affiliation">
                            ${e.assignable_affiliations.map((t=>Qc`<option value="${t}" ?selected=${t===e.item.affiliation}>${t}</option>`))}
                        </select>
                    </div>
                    <div class="col">
                        <label><strong>${s}:</strong></label>
                        <input class="form-control" type="text" name="reason"/>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" class="btn btn-primary" name="change" value="${t}"/>
            </div>
        </form>
    `})(e):""}
            </li>
        </ul>
    </li>
`)(Object.assign({item:t},e)):""))}
                    </ul>
                </div>
            </div>`:""}

            ${e.queryable_roles.length?Qc`
            <div class="tab-pane tab-pane--columns ${!l&&e.queryable_roles.length?"active":""}" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab">
                <form class="converse-form query-role" @submit=${e.queryRole}>
                    <p class="helptext pb-3">${a}</p>
                    <div class="form-group">
                        <label for="role"><strong>${r}:</strong></label>
                        <div class="row">
                            <div class="col">
                                <select class="custom-select select-role" name="role">
                                    ${e.queryable_roles.map((t=>(e=>Qc`
    <option value="${e.item||""}"
            ?selected=${e.item===e.role}
            title="${My(e.item)}">${e.item}</option>
`)(Object.assign({item:t},e))))}
                                </select>
                            </div>
                            <div class="col">
                                <input type="submit" class="btn btn-primary" name="users_with_role" value="${o}"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col mt-3">
                                ${Array.isArray(e.users_with_role)&&e.users_with_role.length>5?Qc`<input class="form-control" .value="${e.roles_filter}" @keyup=${e.filterRoleResults} type="text" name="filter" placeholder="${i}"/>`:""}
                            </div>
                        </div>

                        ${My(e.role)?Qc`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${My(e.role)}</p></div></div>`:""}
                    </div>
                </form>
                <div class="scrollable-container">
                    <ul class="list-group list-group--users">
                        ${e.loading_users_with_role?Qc`<li class="list-group-item"> ${Iv()} </li>`:""}
                        ${e.users_with_role&&0===e.users_with_role.length?Qc`<li class="list-group-item">${s}</li>`:""}
                        ${(e.users_with_role||[]).map((t=>t.nick.match(e.roles_filter)?(e=>Qc`
    <li class="list-group-item" data-nick="${e.item.nick}">
        <ul class="list-group">
            <li class="list-group-item active">
                <div><strong>JID:</strong> ${e.item.jid}</div>
            </li>
            <li class="list-group-item">
                <div><strong>Nickname:</strong> ${e.item.nick}</div>
            </li>
            <li class="list-group-item">
                <div><strong>Role:</strong> ${e.item.role} ${e.assignable_roles.length?(e=>Qc`
    <a href="#" data-form="role-form" class="toggle-form right" color="var(--subdued-color)" @click=${e.toggleForm}>
        <converse-icon class="fa fa-wrench" size="1em"></converse-icon>
    </a>`)(e):""}</div>
                ${e.assignable_roles.length?(e=>{const t=vh("Change role"),n=vh("New Role"),s=vh("Reason");return Qc`
        <form class="role-form hidden" @submit=${e.assignRole}>
            <div class="form-group">
                <input type="hidden" name="jid" value="${e.item.jid}"/>
                <input type="hidden" name="nick" value="${e.item.nick}"/>
                <div class="row">
                    <div class="col">
                        <label><strong>${n}:</strong></label>
                        <select class="custom-select select-role" name="role">
                            ${e.assignable_roles.map((t=>Qc`<option value="${t}" ?selected=${t===e.item.role}>${t}</option>`))}
                        </select>
                    </div>
                    <div class="col">
                        <label><strong>${s}:</strong></label>
                        <input class="form-control" type="text" name="reason"/>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <input type="submit" class="btn btn-primary" value="${t}"/>
            </div>
        </form>
    `})(e):""}
            </li>
        </ul>
    </li>
`)(Object.assign({item:t},e)):""))}
                    </ul>
                </div>
            </div>`:""}
        </div>`},{Strophe:Ly,sizzle:zy,u:Py}=jl.env;Cl.elements.define("converse-modtools",class extends Uf{static get properties(){return{affiliation:{type:String},affiliations_filter:{type:String,attribute:!1},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1},jid:{type:String},muc:{type:Object,attribute:!1},role:{type:String},roles_filter:{type:String,attribute:!1},users_with_affiliation:{type:Array,attribute:!1},users_with_role:{type:Array,attribute:!1}}}constructor(){super(),this.affiliation="",this.affiliations_filter="",this.role="",this.roles_filter=""}connectedCallback(){super.connectedCallback(),this.initialize()}updated(e){e.has("role")&&this.onSearchRoleChange(),e.has("affiliation")&&this.onSearchAffiliationChange(),e.has("jid")&&e.get("jid")&&this.initialize()}async initialize(){this.initialized=ji();const e=await Cl.rooms.get(this.jid);await e.initialized,this.muc=e,this.initialized.resolve()}render(){var e;if(null!==(e=this.muc)&&void 0!==e&&e.occupants){const e=this.muc.occupants.findWhere({jid:va.bare_jid});return Dy({affiliations_filter:this.affiliations_filter,alert_message:this.alert_message,alert_type:this.alert_type,assignAffiliation:e=>this.assignAffiliation(e),assignRole:e=>this.assignRole(e),assignable_affiliations:Cu(e),assignable_roles:Wu(e),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:oh.filter((e=>!Cl.settings.get("modtools_disable_query").includes(e))),queryable_roles:rh.filter((e=>!Cl.settings.get("modtools_disable_query").includes(e))),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role})}return""}async onSearchAffiliationChange(){if(this.affiliation){if(await this.initialized,this.clearAlert(),this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.shouldFetchAffiliationsList()){const e=await Au(this.affiliation,this.jid);e instanceof Error?(this.alert(e.message,"danger"),this.users_with_affiliation=[]):this.users_with_affiliation=e}else this.users_with_affiliation=this.muc.getOccupantsWithAffiliation(this.affiliation);this.loading_users_with_affiliation=!1}}async onSearchRoleChange(){this.role&&(await this.initialized,this.clearAlert(),this.users_with_role=this.muc.getOccupantsWithRole(this.role))}shouldFetchAffiliationsList(){const e=this.affiliation;return"none"!==e&&!this.muc.occupants.getAutoFetchedAffiliationLists().includes(e)}toggleForm(e){e.stopPropagation(),e.preventDefault();const t=Py.ancestor(e.target,".toggle-form"),n=t.getAttribute("data-form"),s=Py.ancestor(t,".list-group-item").querySelector(`.${n}`);Py.hasClass("hidden",s)?Py.removeClass("hidden",s):Py.addClass("hidden",s)}filterRoleResults(e){this.roles_filter=e.target.value,this.render()}filterAffiliationResults(e){this.affiliations_filter=e.target.value}queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.role=null,this.role=t}queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.affiliation=null,this.affiliation=t}alert(e,t){this.alert_message=e,this.alert_type=t}clearAlert(){this.alert_message=void 0,this.alert_type=void 0}async assignAffiliation(e){e.stopPropagation(),e.preventDefault(),this.clearAlert();const t=new FormData(e.target),n=t.get("affiliation"),s={jid:t.get("jid"),reason:t.get("reason")},i=this.affiliation,r=this.muc.get("jid");try{await ku(n,r,[s])}catch(e){return null===e?this.alert(vh("Timeout error while trying to set the affiliation"),"danger"):zy(`not-allowed[xmlns="${Ly.NS.STANZAS}"]`,e).length?this.alert(vh("Sorry, you're not allowed to make that change"),"danger"):this.alert(vh("Sorry, something went wrong while trying to set the affiliation"),"danger"),void M.error(e)}await this.muc.occupants.fetchMembers(),this.affiliation=null,this.affiliation=i,this.alert(vh("Affiliation changed"),"primary")}assignRole(e){e.stopPropagation(),e.preventDefault(),this.clearAlert();const t=new FormData(e.target),n=this.muc.getOccupant(t.get("jid")||t.get("nick")),s=t.get("role"),i=t.get("reason"),r=this.role;this.muc.setRole(n,s,i,(()=>{this.alert(vh("Role changed"),"primary"),this.role=null,this.role=r}),(e=>{zy(`not-allowed[xmlns="${Ly.NS.STANZAS}"]`,e).length?this.alert(vh("You're not allowed to make that change"),"danger"):(this.alert(vh("Sorry, something went wrong while trying to set the role"),"danger"),Py.isErrorObject(e)&&M.error(e))}))}});const Fy=Kg.extend({id:"converse-modtools-modal",persistent:!0,initialize(e){this.jid=e.jid,this.affiliation=e.affiliation,Kg.prototype.initialize.apply(this,arguments)},toHTML(){return(e=>{const t=vh("Moderator Tools");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="converse-modtools-modal-label">${t}</h5>
                    ${Qg}
                </div>
                <div class="modal-body d-flex flex-column">
                    <converse-modtools jid=${e.jid} affiliation=${e.affiliation}></converse-modtools>
                </div>
            </div>
        </div>`})(this)}}),{Strophe:Uy,$pres:By,$iq:qy,sizzle:Hy,u:Gy}=jl.env,Wy={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"},Vy={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"};async function Jy(e){const t=[vh("Are you sure you want to destroy this groupchat?")];let n=[{name:"challenge",label:vh("Please enter the XMPP address of this groupchat to confirm"),challenge:e.get("jid"),placeholder:vh("name@example.org"),required:!0},{name:"reason",label:vh("Optional reason for destroying this groupchat"),placeholder:vh("Reason")},{name:"newjid",label:vh("Optional XMPP address for a new groupchat that replaces this one"),placeholder:vh("replacement@example.org")}];try{var s,i;n=await Cl.confirm(vh("Confirm"),t,n);const r=null===(s=n.filter((e=>"reason"===e.name)).pop())||void 0===s?void 0:s.value,o=null===(i=n.filter((e=>"newjid"===e.name)).pop())||void 0===i?void 0:i.value;return e.sendDestroyIQ(r,o).then((()=>e.close()))}catch(e){M.error(e)}}function Ky(e,t){t.querySelector("converse-rooms-list").model.save("muc_domain",Uy.getDomainFromJid(e))}function Yy(e){e.model.get("connected")&&(e.querySelector("converse-rooms-list").model.get("muc_domain")||(void 0===Cl.settings.get("muc_domain")?function(e){function t(t){t&&t.get("var")===Uy.NS.MUC&&t.entity.getIdentity("conference","text").then((n=>{n&&Ky(t.get("from"),e)}))}Cl.waitUntil("discoInitialized").then((()=>{Cl.listen.on("serviceDiscovered",t),va.disco_entities.each((e=>t(e.features.findWhere({var:Uy.NS.MUC}))))})).catch((e=>M.error(e)))}(e):Ky(Cl.settings.get("muc_domain"),e)))}function Qy(e,t){t=t.trim();const n=document.createElement("li");if(n.setAttribute("aria-selected","false"),Cl.settings.get("muc_mention_autocomplete_show_avatar")){const t=document.createElement("img");let s="data:"+va.DEFAULT_IMAGE_TYPE+";base64,"+va.DEFAULT_IMAGE;if(va.vcards){const t=va.vcards.findWhere({nickname:e});t&&(s="data:"+t.get("image_type")+";base64,"+t.get("image"))}t.setAttribute("src",s),t.setAttribute("width","22"),t.setAttribute("class","avatar avatar-autocomplete"),n.appendChild(t)}const s=new RegExp("("+t+")","ig");return(t?e.split(s):[e]).forEach((e=>{if(t&&e.match(s)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))})),n}async function Xy(){const e=[...await Cl.rooms.get(),...await Cl.contacts.get()];return[...new Set(e.map((e=>Uy.getDomainFromJid(e.get("jid")))))]}function Zy(e,t,n,s=[],i=[]){const r=Vy[t];if(!r)throw Error(`ChatRoomView#setRole called with invalid command: ${t}`);if(!e.verifyAffiliations(s)||!e.verifyRoles(i))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const o=e.getNickOrJIDFromCommandArgs(n);if(!o)return!1;const a=n.split(o,2)[1].trim(),c=e.getOccupant(o);return e.setRole(c,r,a,void 0,(t=>e.onCommandError(t))),!0}function e_(e,t,n,s){const i=Wy[t];if(!i)throw Error(`verifyAffiliations called with invalid command: ${t}`);if(!e.verifyAffiliations(s))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,n))return!1;const r=e.getNickOrJIDFromCommandArgs(n);if(!r)return!1;let o;const a=n.split(r,2)[1].trim(),c=e.getOccupant(r);if(c)o=c.get("jid");else{if(!Gy.isValidJID(r)){const t=vh("Couldn't find a participant with that nickname. They might have left the groupchat.");return void e.createMessage({message:t,type:"error"})}o=r}const l={jid:o,reason:a};c&&Cl.settings.get("auto_register_muc_nickname")&&(l.nick=c.get("nick")),ku(i,e.get("jid"),[l]).then((()=>e.occupants.fetchMembers())).catch((t=>e.onCommandError(t)))}function t_(e,t){if(!e.verifyRoles(["moderator"]))return;let n=Cl.modal.get(Fy.id);n?(n.affiliation=t,n.render()):n=Cl.modal.create(Fy,{affiliation:t,jid:e.get("jid")}),n.show()}const n_=e=>{const t=vh("On which entity do you want to run commands?"),n=vh("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),s=vh("Commands found"),i=vh("List available commands"),r=vh("XMPP Address"),o=vh("No commands found");return Qc`
        ${e.alert?Qc`<div class="alert alert-${e.alert_type}" role="alert">${e.alert}</div>`:""}
        <form class="converse-form" @submit=${e.fetchCommands}>
            <fieldset class="form-group">
                <label>
                    ${t}
                    <p class="form-help">${n}</p>
                    <converse-autocomplete
                        .getAutoCompleteList="${Xy}"
                        placeholder="${r}"
                        name="jid"/>
                </label>
            </fieldset>
            <fieldset class="form-group">
                <input type="submit" class="btn btn-primary" value="${i}">
            </fieldset>
            ${"list-commands"===e.view?Qc`
            <fieldset class="form-group">
                <ul class="list-group">
                    <li class="list-group-item active">${e.commands.length?s:o}:</li>
                    ${e.commands.map((t=>((e,t)=>Qc`
    <li class="room-item list-group-item">
        <div class="available-chatroom d-flex flex-row">
            <a class="open-room available-room w-100"
               @click=${e.toggleCommandForm}
               data-command-node="${t.node}"
               data-command-jid="${t.jid}"
               data-command-name="${t.name}"
               title="${t.name}"
               href="#">${t.name||t.jid}</a>
        </div>
        ${t.node===e.showform?((e,t)=>{const n=vh("Hide"),s=vh("Execute");return Qc`
        <form @submit=${e.runCommand}>
            ${t.alert?Qc`<div class="alert alert-${t.alert_type}" role="alert">${t.alert}</div>`:""}
            <fieldset class="form-group">
                <input type="hidden" name="command_node" value="${t.node}"/>
                <input type="hidden" name="command_jid" value="${t.jid}"/>

                <p class="form-help">${t.instructions}</p>
                ${t.fields}
            </fieldset>
            <fieldset>
                <input type="submit" class="btn btn-primary" value="${s}">
                <input type="button" class="btn btn-secondary button-cancel" value="${n}" @click=${e.hideCommandForm}>
            </fieldset>
        </form>
    `})(e,t):""}
    </li>
`)(e,t)))}
                </ul>
            </fieldset>`:""}

        </form>
    `},{Strophe:s_,$iq:i_,sizzle:r_,u:o_}=jl.env;Cl.elements.define("converse-adhoc-commands",class extends Uf{static get properties(){return{alert:{type:String},alert_type:{type:String},nonce:{type:String},showform:{type:String},view:{type:String}}}constructor(){super(),this.view="choose-service",this.showform="",this.commands=[]}render(){return n_({alert:this.alert,alert_type:this.alert_type,commands:this.commands,fetchCommands:e=>this.fetchCommands(e),hideCommandForm:e=>this.hideCommandForm(e),runCommand:e=>this.runCommand(e),showform:this.showform,toggleCommandForm:e=>this.toggleCommandForm(e),view:this.view})}async fetchCommands(e){e.preventDefault(),delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let n;try{n=await Cl.disco.supports(s_.NS.ADHOC,t)}catch(e){M.error(e)}if(n)try{this.commands=await Cl.adhoc.getCommands(t),this.view="list-commands"}catch(e){return M.error(e),this.alert_type="danger",this.alert=vh("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void M.error(e)}else this.alert_type="danger",this.alert=vh("The specified entity doesn't support ad-hoc commands")}async toggleCommandForm(e){e.preventDefault();const t=e.target.getAttribute("data-command-node"),n=this.commands.filter((e=>e.node===t))[0];this.showform!==t&&await async function(e){const t=e.node,n=e.jid,s=qy({type:"set",to:n}).c("command",{xmlns:Uy.NS.ADHOC,node:t,action:"execute"});try{var i;const t=await Cl.sendIQ(s),n=Hy(`command[xmlns="${Uy.NS.ADHOC}"]`,t).pop();e.sessionid=n.getAttribute("sessionid"),e.instructions=null===(i=Hy('x[type="form"][xmlns="jabber:x:data"] instructions',n).pop())||void 0===i?void 0:i.textContent,e.fields=Hy('x[type="form"][xmlns="jabber:x:data"] field',n).map((e=>Gy.xForm2TemplateResult(e,n)))}catch(t){null===t?M.error(`Error: timeout while trying to execute command for ${n}`):(M.error(`Error while trying to execute command for ${n}`),M.error(t)),e.fields=[]}}(n),this.showform=t}hideCommandForm(e){e.preventDefault(),this.showform=""}async runCommand(e){e.preventDefault();const t=new FormData(e.target),n=t.get("command_jid").trim(),s=t.get("command_node").trim(),i=this.commands.filter((e=>e.node===s))[0];i.alert=null,this.nonce=o_.getUniqueId();const r=r_(":input:not([type=button]):not([type=submit])",e.target).filter((e=>!["command_jid","command_node"].includes(e.getAttribute("name")))).map(o_.webForm2xForm).filter((e=>e)),o=i_({to:n,type:"set"}).c("command",{sessionid:i.sessionid,node:i.node,xmlns:s_.NS.ADHOC}).c("x",{xmlns:s_.NS.XFORM,type:"submit"});let a;r.forEach((e=>o.cnode(e).up()));try{a=await Cl.sendIQ(o)}catch(e){i.alert_type="danger",i.alert=vh("Sorry, an error occurred while trying to execute the command. See the developer console for details"),M.error("Error while trying to execute an ad-hoc command"),M.error(e)}var c;i.alert=a?null===(c=a.querySelector("note"))||void 0===c?void 0:c.textContent:"Done",i.alert_type="primary",this.nonce=o_.getUniqueId()}}),Cl.elements.define("converse-muc-message-form",class extends ub{toHTML(){var e,t;return(e=>{const t=e.composing_spoiler?vh("Hidden message"):vh("Message"),n=vh("Optional hint"),s=Cl.settings.get("show_send_button");return Qc`
        <form class="setNicknameButtonForm hidden">
            <input type="submit" class="btn btn-primary" name="join" value="Join"/>
        </form>
        <form class="sendXMPPMessage">
            <input type="text" placeholder="${n||""}" value="${e.hint_value||""}" class="${e.composing_spoiler?"":"hidden"} spoiler-hint"/>
            <div class="suggestion-box">
                <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>
                <textarea
                    autofocus
                    type="text"
                    @drop=${e.onDrop}
                    @input=${ab}
                    @keydown=${e.onKeyDown}
                    @keyup=${e.onKeyUp}
                    @paste=${e.onPaste}
                    @change=${e.onChange}
                    class="chat-textarea suggestion-box__input
                        ${s?"chat-textarea-send-button":""}
                        ${e.composing_spoiler?"spoiler":""}"
                    placeholder="${t}">${e.message_value||""}</textarea>
                <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>
            </div>
        </form>`})(Object.assign(this.model.toJSON(),{hint_value:null===(e=this.querySelector(".spoiler-hint"))||void 0===e?void 0:e.value,message_value:null===(t=this.querySelector(".chat-textarea"))||void 0===t?void 0:t.value,onChange:e=>this.model.set({draft:e.target.value}),onDrop:e=>this.onDrop(e),onKeyDown:e=>this.onKeyDown(e),onKeyUp:e=>this.onKeyUp(e),onPaste:e=>this.onPaste(e),scrolled:this.model.ui.get("scrolled"),viewUnreadMessages:e=>this.viewUnreadMessages(e)}))}afterRender(){const e=this.model.session.get("connection_status")===jl.ROOMSTATUS.ENTERED,t=e&&!(this.model.features.get("moderated")&&"visitor"===this.model.getOwnRole());e&&t&&this.initMentionAutoComplete()}initMentionAutoComplete(){this.mention_auto_complete=new va.AutoComplete(this,{auto_first:!0,auto_evaluate:!1,min_chars:Cl.settings.get("muc_mention_autocomplete_min_chars"),match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==Cl.settings.get("muc_mention_autocomplete_filter")?va.FILTER_CONTAINS:va.FILTER_STARTSWITH,ac_triggers:["Tab","@"],include_triggers:[],item:Qy}),this.mention_auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}parseMessageForCommands(e){return function(e,t){if(Cl.settings.get("muc_disable_slash_commands")&&!Array.isArray(Cl.settings.get("muc_disable_slash_commands")))return ob(e,t);const n=((t=t.replace(/^\s*/,"")).match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!n)return!1;const s=t.slice(("/"+n).length+1).trim();if(!e.getAllowedCommands().includes(n))return!1;switch(n){case"admin":e_(e,n,s,["owner"]);break;case"ban":e_(e,n,s,["admin","owner"]);break;case"modtools":t_(e,s);break;case"deop":Zy(e,n,s,["admin","owner"]);break;case"destroy":if(!e.verifyAffiliations(["owner"]))break;Jy(e).catch((t=>e.onCommandError(t)));break;case"help":e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0});break;case"kick":case"mute":Zy(e,n,s,[],["moderator"]);break;case"member":e_(e,n,s,["admin","owner"]);break;case"nick":if(!e.verifyRoles(["visitor","participant","moderator"]))break;if(0===s.length){const t=vh('Your nickname is "%1$s"',e.get("nick"));e.createMessage({message:t,type:"error"})}else{const t=Uy.getBareJidFromJid(e.get("jid"));Cl.send(By({from:va.connection.jid,to:`${t}/${s}`,id:Gy.getUniqueId()}).tree())}break;case"owner":e_(e,n,s,["owner"]);break;case"op":Zy(e,n,s,["admin","owner"]);break;case"register":s.length>1?e.createMessage({message:vh("Error: invalid number of arguments"),type:"error"}):e.registerNickname().then((t=>{t&&e.createMessage({message:t,type:"error"})}));break;case"revoke":e_(e,n,s,["admin","owner"]);break;case"topic":case"subject":e.setSubject(s);break;case"voice":Zy(e,n,s,[],["moderator"]);break;default:return ob(e,t)}return!0}(this.model,e)}getAutoCompleteList(){return this.model.getAllKnownNicknames().map((e=>({label:e,value:`@${e}`})))}onKeyDown(e){this.mention_auto_complete.onKeyDown(e)||super.onKeyDown(e)}onKeyUp(e){this.mention_auto_complete.evaluate(e),super.onKeyUp(e)}});const a_=e=>{const t=vh("Nickname"),n=vh("Enter groupchat"),s=Cl.settings.get("muc_show_logs_before_join")?vh("Choose a nickname to enter"):vh("Please choose your nickname"),i=e.get("nickname_validation_message");return Qc`
        <div class="chatroom-form-container muc-nickname-form"
                @submit=${t=>function(e,t){e.preventDefault();const n=e.target.nick.value.trim();n&&t.join(n)}(t,e)}>
            <form class="converse-form chatroom-form converse-centered-form">
                <fieldset class="form-group">
                    <label>${s}</label>
                    <p class="validation-message">${i}</p>
                    <input type="text"
                        required="required"
                        name="nick"
                        value="${e.get("nick")||""}"
                        class="form-control ${i?"error":""}"
                        placeholder="${t}"/>
                </fieldset>
                <fieldset class="form-group">
                    <input type="submit" class="btn btn-primary" name="join" value="${n}"/>
                </fieldset>
            </form>
        </div>`};var c_=n(2490),l_={};l_.styleTagTransform=eg(),l_.setAttributes=Yf(),l_.insert=Jf().bind(null,"head"),l_.domAPI=Wf(),l_.insertStyleElement=Xf(),Hf()(c_.Z,l_),c_.Z&&c_.Z.locals&&c_.Z.locals,Cl.elements.define("converse-muc-bottom-panel",class extends fb{constructor(...e){var t,n,s;super(...e),s={"click .hide-occupants":"hideOccupants","click .send-button":"sendButtonClicked"},(n="events")in(t=this)?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s}async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",this.debouncedRender),this.listenTo(this.model,"change:num_unread_general",this.debouncedRender),this.listenTo(this.model.features,"change:moderated",this.debouncedRender),this.listenTo(this.model.occupants,"add",this.renderIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.renderIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",this.debouncedRender)}render(){const e=this.model.session.get("connection_status")===jl.ROOMSTATUS.ENTERED,t=e&&!(this.model.features.get("moderated")&&"visitor"===this.model.getOwnRole());tl((e=>{const t=vh("You have unread messages"),n=e.model.session.get("connection_status"),s=vh("You're not allowed to send messages in this room");return n===jl.ROOMSTATUS.ENTERED?Qc`
            ${e.model.ui.get("scrolled")&&e.model.get("num_unread_general")?Qc`<div class="new-msgs-indicator" @click=${t=>e.viewUnreadMessages(t)}>▼ ${t} ▼</div>`:""}
            ${e.can_edit?(e=>{const t=vh("You have unread messages"),n=Cl.settings.get("message_limit"),s=Cl.settings.get("visible_toolbar_buttons").call,i=Cl.settings.get("visible_toolbar_buttons").emoji,r=Cl.settings.get("show_send_button"),o=Cl.settings.get("visible_toolbar_buttons").spoiler,a=Cl.settings.get("show_toolbar");return Qc`
        ${e.model.ui.get("scrolled")&&e.model.get("num_unread")?Qc`<div class="new-msgs-indicator" @click=${t=>e.viewUnreadMessages(t)}>▼ ${t} ▼</div>`:""}
        ${a?Qc`
            <converse-chat-toolbar
                class="chat-toolbar no-text-select"
                .model=${e.model}
                ?composing_spoiler="${e.model.get("composing_spoiler")}"
                ?hidden_occupants="${e.model.get("hidden_occupants")}"
                ?is_groupchat="${e.is_groupchat}"
                ?show_call_button="${s}"
                ?show_emoji_button="${i}"
                ?show_send_button="${r}"
                ?show_spoiler_button="${o}"
                ?show_toolbar="${a}"
                message_limit="${n}"></converse-chat-toolbar>`:""}
        <converse-muc-message-form jid=${e.model.get("jid")}></converse-muc-message-form>`})(e):Qc`<span class="muc-bottom-panel muc-bottom-panel--muted">${s}</span>`}`:n!=jl.ROOMSTATUS.NICKNAME_REQUIRED?"":Cl.settings.get("muc_show_logs_before_join")?Qc`<span class="muc-bottom-panel muc-bottom-panel--nickname">${a_(e.model)}</span>`:void 0})({can_edit:t,entered:e,model:this.model,is_groupchat:!0,viewUnreadMessages:e=>this.viewUnreadMessages(e)}),this)}renderIfOwnOccupant(e){e.get("jid")===va.bare_jid&&this.debouncedRender()}sendButtonClicked(e){var t;null===(t=this.querySelector("converse-message-form"))||void 0===t||t.onFormSubmitted(e)}hideOccupants(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),this.model.save({hidden_occupants:!0})}});const d_={offline:"Offline",unavailable:"Unavailable",xa:"Extended Away",away:"Away",dnd:"Do not disturb",chat:"Chattty",online:"Online"};var u_=n(1107),h_={};h_.styleTagTransform=eg(),h_.setAttributes=Yf(),h_.insert=Jf().bind(null,"head"),h_.domAPI=Wf(),h_.insertStyleElement=Xf(),Hf()(u_.Z,h_),u_.Z&&u_.Z.locals&&u_.Z.locals;const{u:m_}=jl.env;Cl.elements.define("converse-muc-sidebar",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid),this.listenTo(this.model.occupants,"add",this.requestUpdate),this.listenTo(this.model.occupants,"remove",this.requestUpdate),this.listenTo(this.model.occupants,"change",this.requestUpdate),this.model.initialized.then((()=>this.requestUpdate()))}render(){return(e=>{const t=e=>vh("Click to mention %1$s in your message.",e.get("nick")),n=vh("Participants"),s=e.occupants.map((n=>(e=>{const t=vh("Owner"),n=vh("Admin"),s=vh("Member"),i=vh("Moderator"),r=vh("Visitor");return Qc`
        <li class="occupant" id="${e.id}" title="${(e=>{const t=vh("This user is a moderator."),n=vh("This user can send messages in this groupchat."),s=vh("This user can NOT send messages in this groupchat."),i=`${e.jid} `||"";return"moderator"===e.role?`${i}${t} ${e.hint_occupant}`:"participant"===e.role?`${i}${n} ${e.hint_occupant}`:"visitor"===e.role?`${i}${s} ${e.hint_occupant}`:["visitor","participant","moderator"].includes(e.role)?void 0:`${i}${e.hint_occupant}`})(e)}">
            <div class="row no-gutters">
                <div class="col-auto">
                    <div class="occupant-status occupant-${e.show} circle" title="${e.hint_show}"></div>
                </div>
                <div class="col occupant-nick-badge">
                    <span class="occupant-nick" @click=${e.onOccupantClicked}>${e.nick||e.jid}</span>
                    <span class="occupant-badges">
                        ${"owner"===e.affiliation?Qc`<span class="badge badge-groupchat">${t}</span>`:""}
                        ${"admin"===e.affiliation?Qc`<span class="badge badge-info">${n}</span>`:""}
                        ${"member"===e.affiliation?Qc`<span class="badge badge-info">${s}</span>`:""}
                        ${"moderator"===e.role?Qc`<span class="badge badge-info">${i}</span>`:""}
                        ${"visitor"===e.role?Qc`<span class="badge badge-secondary">${r}</span>`:""}
                    </span>
                </div>
            </div>
        </li>
    `})(Object.assign({jid:"",hint_show:d_[n.get("show")],hint_occupant:t(n),onOccupantClicked:e.onOccupantClicked},n.toJSON()))));return Qc`
        <div class="occupants-header">
            <i class="hide-occupants fa fa-times" @click=${e.closeSidebar}></i>
            <div class="occupants-header--title">
                <span class="occupants-heading">${n}</span>
            </div>
        </div>
        <div class="dragresize dragresize-occupants-left"></div>
        <ul class="occupant-list">${s}</ul>
    `})(Object.assign(this.model.toJSON(),{occupants:[...this.model.occupants.models],closeSidebar:e=>this.closeSidebar(e),onOccupantClicked:e=>this.onOccupantClicked(e)}))}closeSidebar(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),m_.safeSave(this.model,{hidden_occupants:!0})}onOccupantClicked(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=va.chatboxviews.get(this.getAttribute("jid"));null==n||n.getBottomPanel().insertIntoTextArea(`@${e.target.textContent}`)}});const{u:f_}=jl.env;Cl.elements.define("converse-muc-chatarea",class extends Uf{static get properties(){return{jid:{type:String},show_help_messages:{type:Boolean},type:{type:String}}}connectedCallback(){super.connectedCallback(),this.initialize()}async initialize(){this.model=await Cl.rooms.get(this.jid),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.onMouseMove=this._onMouseMove.bind(this),this.onMouseUp=this._onMouseUp.bind(this),this.requestUpdate()}render(){return(e=>{var t;return Qc`
    <div class="chat-area">
        <div class="chat-content ${e.show_send_button?"chat-content-sendbutton":""}" aria-live="polite">
            <converse-chat-content
                class="chat-content__messages"
                jid="${e.jid}"></converse-chat-content>

            ${null!==(t=e.model)&&void 0!==t&&t.get("show_help_messages")?Qc`<div class="chat-content__help">
                    <converse-chat-help
                        .model=${e.model}
                        .messages=${e.getHelpMessages()}
                        type="info"
                        chat_type="${va.CHATROOMS_TYPE}"
                    ></converse-chat-help></div>`:""}
        </div>
        <converse-muc-bottom-panel jid="${e.jid}" class="bottom-panel"></converse-muc-bottom-panel>
    </div>
    <div class="disconnect-container hidden"></div>
    ${e.model?Qc`
        <converse-muc-sidebar
            class="occupants col-md-3 col-4 ${e.shouldShowSidebar()?"":"hidden"}"
            style="flex: 0 0 ${e.model.get("occupants_width")}px"
            jid=${e.jid}
            @mousedown=${e.onMousedown}></converse-muc-sidebar>`:""}
`})({getHelpMessages:()=>this.getHelpMessages(),jid:this.jid,model:this.model,onMousedown:e=>this.onMousedown(e),show_send_button:va.show_send_button,shouldShowSidebar:()=>this.shouldShowSidebar(),type:this.type})}shouldShowSidebar(){return!this.model.get("hidden_occupants")&&this.model.session.get("connection_status")===jl.ROOMSTATUS.ENTERED}getHelpMessages(){const e=Cl.settings.get("muc_disable_slash_commands"),t=Array.isArray(e)?e:[];return[`<strong>/admin</strong>: ${vh("Change user's affiliation to admin")}`,`<strong>/ban</strong>: ${vh("Ban user by changing their affiliation to outcast")}`,`<strong>/clear</strong>: ${vh("Clear the chat area")}`,`<strong>/close</strong>: ${vh("Close this groupchat")}`,`<strong>/deop</strong>: ${vh("Change user role to participant")}`,`<strong>/destroy</strong>: ${vh("Remove this groupchat")}`,`<strong>/help</strong>: ${vh("Show this menu")}`,`<strong>/kick</strong>: ${vh("Kick user from groupchat")}`,`<strong>/me</strong>: ${vh("Write in 3rd person")}`,`<strong>/member</strong>: ${vh("Grant membership to a user")}`,`<strong>/modtools</strong>: ${vh("Opens up the moderator tools GUI")}`,`<strong>/mute</strong>: ${vh("Remove user's ability to post messages")}`,`<strong>/nick</strong>: ${vh("Change your nickname")}`,`<strong>/op</strong>: ${vh("Grant moderator role to user")}`,`<strong>/owner</strong>: ${vh("Grant ownership of this groupchat")}`,`<strong>/register</strong>: ${vh("Register your nickname")}`,`<strong>/revoke</strong>: ${vh("Revoke the user's current affiliation")}`,`<strong>/subject</strong>: ${vh("Set groupchat subject")}`,`<strong>/topic</strong>: ${vh("Set groupchat subject (alias for /subject)")}`,`<strong>/voice</strong>: ${vh("Allow muted user to post messages")}`].filter((e=>t.every((t=>!e.startsWith(t+"<",9))))).filter((e=>this.model.getAllowedCommands().some((t=>e.startsWith(t+"<",9)))))}onMousedown(e){f_.hasClass("dragresize-occupants-left",e.target)&&this.onStartResizeOccupants(e)}onStartResizeOccupants(e){this.resizing=!0,this.addEventListener("mousemove",this.onMouseMove),this.addEventListener("mouseup",this.onMouseUp);const t=this.querySelector("converse-muc-sidebar"),n=window.getComputedStyle(t);this.width=parseInt(n.width.replace(/px$/,""),10),this.prev_pageX=e.pageX}_onMouseMove(e){if(this.resizing){e.preventDefault();const t=this.prev_pageX-e.pageX;this.resizeSidebarView(t,e.pageX),this.prev_pageX=e.pageX}}_onMouseUp(e){if(this.resizing){e.preventDefault(),this.resizing=!1,this.removeEventListener("mousemove",this.onMouseMove),this.removeEventListener("mouseup",this.onMouseUp);const t=this.querySelector("converse-muc-sidebar").getBoundingClientRect(),n=this.calculateSidebarWidth(t,0);f_.safeSave(this.model,{occupants_width:n})}}calculateSidebarWidth(e,t){let n=e.width+t;const s=this.clientWidth;return n<.2*s?(n=.2*s,this.is_minimum=!0):n>.75*s?(n=.75*s,this.is_maximum=!0):s-n<250?(n=s-250,this.is_maximum=!0):(this.is_maximum=!1,this.is_minimum=!1),n}resizeSidebarView(e,t){const n=this.querySelector("converse-muc-sidebar"),s=n.getBoundingClientRect();if(this.is_minimum)this.is_minimum=s.left<t;else if(this.is_maximum)this.is_maximum=s.left>t;else{const t=this.calculateSidebarWidth(s,e);n.style.flex="0 0 "+t+"px"}}});const{sizzle:g_}=jl.env,p_=jl.env.utils,{sizzle:v_}=jl.env,b_=jl.env.utils;Cl.elements.define("converse-muc-config-form",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid),this.listenTo(this.model.features,"change:passwordprotected",this.requestUpdate),this.listenTo(this.model.session,"change:config_stanza",this.requestUpdate),this.getConfig()}render(){return(e=>{const t=Cl.settings.get("roomconfig_whitelist"),n=e.model.session.get("config_stanza");let s,i=[],r="";if(n){var o,a;const c=p_.toStanza(n);i=g_("field",c),t.length&&(i=i.filter((e=>t.includes(e.getAttribute("var")))));const l={new_password:!e.model.features.get("passwordprotected"),fixed_username:e.model.get("jid")};i=i.map((e=>p_.xForm2TemplateResult(e,c,l))),r=null===(o=c.querySelector("instructions"))||void 0===o?void 0:o.textContent,s=null===(a=c.querySelector("title"))||void 0===a?void 0:a.textContent}else s=vh("Loading configuration form");const c=vh("Save"),l=vh("Cancel");return Qc`
        <form class="converse-form chatroom-form ${i.length?"":"converse-form--spinner"}"
                autocomplete="off"
                @submit=${e.submitConfigForm}>

            <fieldset class="form-group">
                <legend class="centered">${s}</legend>
                ${s!==r?Qc`<p class="form-help">${r}</p>`:""}
                ${i.length?i:Iv({classes:"hor_centered"})}
            </fieldset>
            ${i.length?Qc`
                <fieldset>
                    <input type="submit" class="btn btn-primary" value="${c}">
                    <input type="button" class="btn btn-secondary button-cancel" value="${l}" @click=${e.closeConfigForm}>
                </fieldset>`:""}
        </form>
    `})({model:this.model,closeConfigForm:e=>this.closeForm(e),submitConfigForm:e=>this.submitConfigForm(e)})}async getConfig(){const e=await this.model.fetchRoomConfiguration();this.model.session.set("config_stanza",e.outerHTML)}async submitConfigForm(e){e.preventDefault();const t=v_(":input:not([type=button]):not([type=submit])",e.target).map(b_.webForm2xForm).filter((e=>e));try{await this.model.sendConfiguration(t)}catch(e){M.error(e);const t=vh("Sorry, an error occurred while trying to submit the config form.")+" "+vh("Check your browser's developer console for details.");Cl.alert("error",vh("Error"),t)}await this.model.refreshDiscoInfo(),this.closeForm()}closeForm(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.session.set("view",null)}});Cl.elements.define("converse-muc-destroyed",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid)}render(){const e=this.model.get("destroyed_reason");return(e=>{const t=vh("This groupchat no longer exists"),n=vh('The following reason was given: "%1$s"',e.reason||"");return Qc`
        <div class="alert alert-danger">
            <h3 class="alert-heading disconnect-msg">${t}</h3>
        </div>
        ${e.reason?Qc`<p class="destroyed-reason">${n}</p>`:""}
        ${e.moved_jid?(e=>{const t=vh("The conversation has moved to a new address. Click the link below to enter.");return Qc`
        <p class="moved-label">${t}</p>
        <p class="moved-link">
            <a class="switch-chat" @click=${t=>e.onSwitch(t)}>${e.moved_jid}</a>
        </p>`})(e):""}
    `})({moved_jid:this.model.get("moved_jid"),reason:e,onSwitch:e=>this.onSwitch(e)})}async onSwitch(e){e.preventDefault();const t=this.model.get("moved_jid");(await Cl.rooms.get(t,{},!0)).maybeShow(!0),this.model.destroy()}}),Cl.elements.define("converse-muc-disconnected",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid)}render(){const e=this.model.session.get("disconnection_message");if(!e)return;const t=[e],n=this.model.session.get("disconnection_actor");n&&t.push(vh("This action was done by %1$s.",n));const s=this.model.session.get("disconnection_reason");return s&&t.push(vh('The reason given is: "%1$s".',s)),(e=>Qc`
        <div class="alert alert-danger">
            <h3 class="alert-heading disconnect-msg">${e[0]}</h3>
            ${e.slice(1).map((e=>Qc`<p class="disconnect-msg">${e}</p>`))}
        </div>`)(t)}});const y_=jl.env.utils,__=Kg.extend({id:"muc-invite-modal",initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.initInviteWidget()},toHTML(){return(e=>{const t=vh("Invite"),n=vh("Invite someone to this groupchat"),s=vh("user@example.org"),i=vh("Please enter a valid XMPP address"),r=vh("XMPP Address"),o=vh("Optional reason for the invitation");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add-chatroom-modal-label">${n}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    <span class="modal-alert"></span>
                    <div class="suggestion-box room-invite">
                        <form @submit=${e.submitInviteForm}>
                            <div class="form-group">
                                <label class="clearfix" for="invitee_jids">${r}:</label>
                                ${e.invalid_invite_jid?Qc`<div class="error error-feedback">${i}</div>`:""}
                                <input class="form-control suggestion-box__input"
                                    required="required"
                                    name="invitee_jids"
                                    id="invitee_jids"
                                    placeholder="${s}"
                                    type="text"/>
                                <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>
                                <ul class="suggestion-box__results suggestion-box__results--below" hidden=""></ul>
                            </div>
                            <div class="form-group">
                                <label>${o}:</label>
                                <textarea class="form-control" name="reason"></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">${t}</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),{submitInviteForm:e=>this.submitInviteForm(e)}))},initInviteWidget(){this.invite_auto_complete&&this.invite_auto_complete.destroy();const e=va.roster.map((e=>({label:e.getDisplayName(),value:e.get("jid")}))),t=this.el.querySelector(".suggestion-box").parentElement;this.invite_auto_complete=new va.AutoComplete(t,{min_chars:1,list:e})},submitInviteForm(e){e.preventDefault();const t=new FormData(e.target),n=t.get("invitee_jids"),s=t.get("reason");y_.isValidJID(n)?(this.chatroomview.model.directInvite(n,s),this.modal.hide()):this.model.set({invalid_invite_jid:!0})}}),w_=Kg.extend({id:"muc-details-modal",initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.listenTo(this.model.features,"change",this.render),this.listenTo(this.model.occupants,"add",this.render),this.listenTo(this.model.occupants,"change",this.render)},toHTML(){return(e=>{const t=vh("Groupchat XMPP address"),n=vh("Message archiving"),s=vh("Messages are archived on the server"),i=vh("Description"),r=vh("Features"),o=vh("Hidden"),a=vh("This groupchat is not publicly searchable"),c=vh("This groupchat is restricted to members only"),l=vh("Members only"),d=vh("Moderated"),u=vh("Participants entering this groupchat need to request permission to write"),h=vh("Name"),m=vh("This groupchat does not require a password upon entry"),f=vh("No password required"),g=vh("Not anonymous"),p=vh("All other groupchat participants can see your XMPP address"),v=vh("Not moderated"),b=vh("Participants entering this groupchat can write right away"),y=vh("Online users"),_=vh("Open"),w=vh("Anyone can join this groupchat"),S=vh("This groupchat requires a password before entry"),x=vh("Password protected"),E=vh("Persistent"),A=vh("This groupchat persists even if it's unoccupied"),C=vh("Public"),T=vh("Semi-anonymous"),k=vh("Only moderators can see your XMPP address"),j=vh("Temporary"),N=vh("This groupchat will disappear once the last person leaves");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="muc-details-modal-label">${e.display_name}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    <span class="modal-alert"></span>
                    <div class="room-info">
                        <p class="room-info"><strong>${h}</strong>: ${e.name}</p>
                        <p class="room-info"><strong>${t}</strong>: ${e.jid}</p>
                        <p class="room-info"><strong>${i}</strong>: ${e.config.description}</p>
                        ${e.subject?(e=>{const t=vh("Topic"),n=vh("Topic author");return Qc`
        <p class="room-info"><strong>${t}</strong>: ${e.subject.text}</p>
        <p class="room-info"><strong>${n}</strong>: ${e.subject&&e.subject.author}</p>
    `})(e):""}
                        <p class="room-info"><strong>${y}</strong>: ${e.num_occupants}</p>
                        <p class="room-info"><strong>${r}</strong>:
                            <div class="chatroom-features">
                            <ul class="features-list">
                                ${e.features.passwordprotected?Qc`<li class="feature" ><span class="fa fa-lock"></span>${x} - <em>${S}</em></li>`:""}
                                ${e.features.unsecured?Qc`<li class="feature" ><span class="fa fa-unlock"></span>${f} - <em>${m}</em></li>`:""}
                                ${e.features.hidden?Qc`<li class="feature" ><span class="fa fa-eye-slash"></span>${o} - <em>${a}</em></li>`:""}
                                ${e.features.public_room?Qc`<li class="feature" ><span class="fa fa-eye"></span>${C} - <em>${e.__("This groupchat is publicly searchable")}</em></li>`:""}
                                ${e.features.membersonly?Qc`<li class="feature" ><span class="fa fa-address-book"></span>${l} - <em>${c}</em></li>`:""}
                                ${e.features.open?Qc`<li class="feature" ><span class="fa fa-globe"></span>${_} - <em>${w}</em></li>`:""}
                                ${e.features.persistent?Qc`<li class="feature" ><span class="fa fa-save"></span>${E} - <em>${A}</em></li>`:""}
                                ${e.features.temporary?Qc`<li class="feature" ><span class="fa fa-snowflake-o"></span>${j} - <em>${N}</em></li>`:""}
                                ${e.features.nonanonymous?Qc`<li class="feature" ><span class="fa fa-id-card"></span>${g} - <em>${p}</em></li>`:""}
                                ${e.features.semianonymous?Qc`<li class="feature" ><span class="fa fa-user-secret"></span>${T} - <em>${k}</em></li>`:""}
                                ${e.features.moderated?Qc`<li class="feature" ><span class="fa fa-gavel"></span>${d} - <em>${u}</em></li>`:""}
                                ${e.features.unmoderated?Qc`<li class="feature" ><span class="fa fa-info-circle"></span>${v} - <em>${b}</em></li>`:""}
                                ${e.features.mam_enabled?Qc`<li class="feature" ><span class="fa fa-database"></span>${n} - <em>${s}</em></li>`:""}
                            </ul>
                            </div>
                        </p>
                    </div>
                </div>
                <div class="modal-footer">${Yg}</div>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),{config:this.model.config.toJSON(),display_name:vh("Groupchat info for %1$s",this.model.getDisplayName()),features:this.model.features.toJSON(),num_occupants:this.model.occupants.length}))}});Cl.elements.define("converse-rich-text",class extends Uf{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},mentions:{type:Array},nick:{type:String},offset:{type:Number},onImgClick:{type:Function},onImgLoad:{type:Function},render_styling:{type:Boolean},show_images:{type:Boolean},hide_media_urls:{type:Boolean},show_me_message:{type:Boolean},text:{type:String}}}constructor(){super(),this.embed_audio=!1,this.embed_videos=!1,this.hide_media_urls=!1,this.mentions=[],this.offset=0,this.render_styling=!1,this.show_image_urls=!0,this.show_images=!1,this.show_me_message=!1}render(){const e={embed_audio:this.embed_audio,embed_videos:this.embed_videos,nick:this.nick,onImgClick:this.onImgClick,onImgLoad:this.onImgLoad,render_styling:this.render_styling,show_images:this.show_images,show_me_message:this.show_me_message,hide_media_urls:this.hide_media_urls};return sv(this.text,this.offset,this.mentions,e)}});var S_=n(679),x_={};x_.styleTagTransform=eg(),x_.setAttributes=Yf(),x_.insert=Jf().bind(null,"head"),x_.domAPI=Wf(),x_.insertStyleElement=Xf(),Hf()(S_.Z,x_),S_.Z&&S_.Z.locals&&S_.Z.locals,Cl.elements.define("converse-muc-heading",class extends mg{async connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.getAttribute("jid")),this.debouncedRender=hc(this.render,100),this.listenTo(this.model,"change",this.debouncedRender);const e=await va.api.user.settings.getModel();this.listenTo(e,"change:mucs_with_hidden_subject",this.debouncedRender),await this.model.initialized,this.listenTo(this.model.features,"change:open",this.debouncedRender),this.model.occupants.forEach((e=>this.onOccupantAdded(e))),this.listenTo(this.model.occupants,"add",this.onOccupantAdded),this.listenTo(this.model.occupants,"change:affiliation",this.onOccupantAffiliationChanged),this.render()}async render(){const e=await this.generateHeadingTemplate();tl(e,this)}onOccupantAdded(e){e.get("jid")===va.bare_jid&&this.debouncedRender()}onOccupantAffiliationChanged(e){e.get("jid")===va.bare_jid&&this.debouncedRender()}showRoomDetailsModal(e){e.preventDefault(),Cl.modal.show(w_,{model:this.model},e)}showInviteModal(e){e.preventDefault(),Cl.modal.show(__,{model:new Zo,chatroomview:this},e)}toggleTopic(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.toggleSubjectHiddenState()}getAndRenderConfigurationForm(){this.model.session.set("view",jl.MUC.VIEWS.CONFIG)}close(e){e.preventDefault(),this.model.close()}destroy(e){e.preventDefault(),Jy(this.model)}getHeadingButtons(e){const t=[];t.push({i18n_text:vh("Details"),i18n_title:vh("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-muc-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&t.push({i18n_text:vh("Configure"),i18n_title:vh("Configure this groupchat"),handler:()=>this.getAndRenderConfigurationForm(),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),this.model.invitesAllowed()&&t.push({i18n_text:vh("Invite"),i18n_title:vh("Invite someone to join this groupchat"),handler:e=>this.showInviteModal(e),a_class:"open-invite-modal",icon_class:"fa-user-plus",name:"invite"});const n=this.model.get("subject");if(n&&n.text&&t.push({i18n_text:vh(e?"Show topic":"Hide topic"),i18n_title:vh(e?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),this.model.session.get("connection_status")===jl.ROOMSTATUS.ENTERED){const e=this.model.getAllowedCommands();e.includes("modtools")&&t.push({i18n_text:vh("Moderate"),i18n_title:vh("Moderate this groupchat"),handler:()=>t_(this.model),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&t.push({i18n_text:vh("Destroy"),i18n_title:vh("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}Cl.settings.get("singleton")||t.push({i18n_text:vh("Leave"),i18n_title:vh("Leave and close this groupchat"),handler:async e=>{e.stopPropagation();const t=[vh("Are you sure you want to leave this groupchat?")];await Cl.confirm(vh("Confirm"),t)&&this.close(e)},a_class:"close-chatbox-button",standalone:"overlayed"===Cl.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"});const s=va.chatboxviews.get(this.getAttribute("jid"));return s?va.api.hook("getHeadingButtons",s,t):t}async generateHeadingTemplate(){const e=await this.model.isSubjectHidden(),t=await this.getHeadingButtons(e),n=t.filter((e=>e.standalone)),s=t.filter((e=>!e.standalone));return(e=>{const t=vh("Hide the groupchat topic"),n=vh("This groupchat is bookmarked"),s=e.subject?e.subject.text:"",i=s&&!e.subject_hidden;return Qc`
        <div class="chatbox-title ${i?"":"chatbox-title--no-desc"}">
            ${va.api.settings.get("singleton")?"":Qc`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}
            <div class="chatbox-title__text" title="${"hidden"!==va.locked_muc_domain?e.jid:""}">${e.title}
                ${e.bookmarked?Qc`<i class="fa fa-bookmark chatbox-title__text--bookmarked" title="${n}"></i>`:""}
            </div>
            <div class="chatbox-title__buttons row no-gutters">
                ${e.standalone_btns.length?(e=>e.standalone_btns.reverse().map((e=>dp(e,""))))(e):""}
                ${e.dropdown_btns.length?Qc`<converse-dropdown class="dropleft" color="var(--chatroom-head-color)" .items=${e.dropdown_btns}></converse-dropdown>`:""}
            </div>
        </div>
        ${i?Qc`<p class="chat-head__desc" title="${t}">
            <converse-rich-text text=${s} render_styling></converse-rich-text>
          </p>`:""}
    `})(Object.assign(this.model.toJSON(),{_converse:va,subject_hidden:e,dropdown_btns:s.map((e=>sb(e))),standalone_btns:n.map((e=>ib(e))),title:this.model.getDisplayName()}))}});Cl.elements.define("converse-muc-nickname-form",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid)}render(){return a_(this.model)}});function E_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Cl.elements.define("converse-muc-password-form",class extends Uf{static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=va.chatboxes.get(this.jid),this.listenTo(this.model,"change:password_validation_message",this.render),this.render()}render(){return(e=>{const t=vh("This groupchat requires a password"),n=vh("Password: "),s=vh("Submit");return Qc`
        <form class="converse-form chatroom-form converse-centered-form" @submit=${e.submitPassword}>
            <fieldset class="form-group">
                <label>${t}</label>
                <p class="validation-message">${e.validation_message}</p>
                <input class="hidden-username" type="text" autocomplete="username" value="${e.jid}"></input>
                <input type="password"
                    name="password"
                    required="required"
                    class="form-control ${e.validation_message?"error":""}"
                    placeholder="${n}"/>
            </fieldset>
            <fieldset class="form-group">
                <input class="btn btn-primary" type="submit" value="${s}"/>
            </fieldset>
        </form>
    `})({jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("password_validation_message")})}submitPassword(e){e.preventDefault();const t=this.querySelector("input[type=password]").value;this.model.join(this.model.get("nick"),t),this.model.set("password_validation_message",null)}});class A_ extends gb{constructor(...e){super(...e),E_(this,"length",300),E_(this,"is_chatroom",!0)}connectedCallback(){super.connectedCallback(),this.initialize()}async initialize(){this.model=await Cl.rooms.get(this.jid),va.chatboxviews.add(this.jid,this),this.setAttribute("id",this.model.get("box_id")),this.listenTo(va,"windowStateChanged",this.onWindowStateChanged),this.listenTo(this.model,"change:composing_spoiler",this.requestUpdateMessageForm),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model.session,"change:view",this.requestUpdate),this.onConnectionStatusChanged(),this.model.maybeShow(),Cl.trigger("chatRoomViewInitialized",this)}render(){return(e=>Qc`
        <div class="flyout box-flyout">
            <converse-dragresize></converse-dragresize>
            ${e.model?Qc`
                <converse-muc-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatroom row no-gutters">
                </converse-muc-heading>
                <div class="chat-body chatroom-body row no-gutters">${function(e){const t=e.model.session.get("view"),n=e.model.get("jid"),s=jl.ROOMSTATUS,i=e.model.session.get("connection_status");return t===jl.MUC.VIEWS.CONFIG?Qc`<converse-muc-config-form class="muc-form-container" jid="${n}"></converse-muc-config-form>`:t===jl.MUC.VIEWS.BOOKMARK?Qc`<converse-muc-bookmark-form class="muc-form-container" jid="${n}"></converse-muc-bookmark-form>`:Qc`
            ${i==s.PASSWORD_REQUIRED?Qc`<converse-muc-password-form class="muc-form-container" jid="${n}"></converse-muc-password-form>`:""}
            ${i==s.ENTERED?Qc`<converse-muc-chatarea jid="${n}"></converse-muc-chatarea>`:""}
            ${i==s.CONNECTING?Iv():""}
            ${i==s.NICKNAME_REQUIRED?function(e){const t=e.get("jid");return Cl.settings.get("muc_show_logs_before_join")?Qc`<converse-muc-chatarea jid="${t}"></converse-muc-chatarea>`:Qc`<converse-muc-nickname-form jid="${t}"></converse-muc-nickname-form>`}(e.model):""}
            ${i==s.DISCONNECTED?Qc`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""}
            ${i==s.BANNED?Qc`<converse-muc-disconnected jid="${n}"></converse-muc-disconnected>`:""}
            ${i==s.DESTROYED?Qc`<converse-muc-destroyed jid="${n}"></converse-muc-destroyed>`:""}
        `}(e)}</div>
            `:""}
        </div>`)({model:this.model})}onConnectionStatusChanged(){this.model.session.get("connection_status")===jl.ROOMSTATUS.CONNECTING&&(this.model.session.save({disconnection_actor:void 0,disconnection_message:void 0,disconnection_reason:void 0}),this.model.save({moved_jid:void 0,password_validation_message:void 0,reason:void 0})),this.requestUpdate()}}Cl.elements.define("converse-muc",A_);var C_=n(1557),T_={};T_.styleTagTransform=eg(),T_.setAttributes=Yf(),T_.insert=Jf().bind(null,"head"),T_.domAPI=Wf(),T_.insertStyleElement=Xf(),Hf()(C_.Z,T_),C_.Z&&C_.Z.locals&&C_.Z.locals,jl.MUC.VIEWS={CONFIG:"config-form",BOOKMARK:"bookmark-form"},jl.plugins.add("converse-muc-views",{dependencies:["converse-modal","converse-controlbox","converse-chatview"],initialize(){const{_converse:e}=this;Cl.settings.extend({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,roomconfig_whitelist:[],show_retraction_warning:!0,visible_toolbar_buttons:{toggle_occupants:!0}}),e.ChatRoomView=A_,Cl.listen.on("clearsession",(()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)})),Cl.listen.on("controlBoxInitialized",(e=>{Cl.settings.get("allow_muc")&&(Yy(e),e.model.on("change:connected",(()=>Yy(e))))})),Cl.listen.on("chatBoxClosed",(t=>{var n;t.get("type")===e.CHATROOMS_TYPE&&(n=t.get("jid"),va.router.history.getFragment()===`converse/room?jid=${n}`&&va.router.navigate(""))}))}});var k_=n(2329),j_=n.n(k_);const{Strophe:N_}=jl.env,O_="Notification"in window;let $_;function I_(e){var t;return va.isTestEnv()||((null===(t=va.chatboxes.get(e.from))||void 0===t?void 0:t.isHidden())??!1)}function M_(){return va.isTestEnv()||O_&&Cl.settings.get("show_desktop_notifications")&&"granted"===Notification.permission}function R_(){var e,t;$_=null,null===(e=(t=navigator).clearAppBadge)||void 0===e||e.call(t).catch((e=>M.error("Could not clear unread count in app badge "+e)))}function D_(){if(Cl.settings.get("show_tab_notifications")){var e,t;$_=$_??new jl.env.Favico({type:"circle",animation:"pop"});const n=va.chatboxes.models.reduce(((e,t)=>e+(t.get("num_unread")||0)),0);$_.badge(n),null===(e=(t=navigator).setAppBadge)||void 0===e||e.call(t,n).catch((e=>M.error("Could set unread count in app badge - "+e)))}}function L_(e,t,n){return e.reduce(((e,s)=>e||(e=>[va.bare_jid,`${t}/${n}`].includes(e.uri.replace(/^xmpp:/,"")))(s)),!1)}async function z_(e){if(!await function(e){const{attrs:t}=e;if(!t||t.is_forwarded)return!1;if("groupchat"===t.type)return async function(e){if(!(null!=e&&e.body||null!=e&&e.message))return!1;const t=e.from,n=e.from_muc,s=Cl.settings.get("notify_all_room_messages"),i=va.chatboxes.get(n),r=N_.getResourceFromJid(t),o=r&&N_.unescapeNode(r)||"";let a=!1;const c=i.get("nick");Cl.settings.get("notify_nicknames_without_references")&&(a=new RegExp(`\\b${c}\\b`).test(e.body));const l=o!==c,d=!0===s||Array.isArray(s)&&s.includes(n)||L_(e.references,n,c)||a;return!(!l||!d)&&await Cl.hook("shouldNotifyOfGroupMessage",e,!0)}(t);if("info"===t.type)return async function(e){if(!e.from_muc)return!1;const t=await Cl.rooms.get(e.from_muc);if(!t)return!1;const n=t.get("nick"),s=e.from_muc,i=Cl.settings.get("notify_all_room_messages");return!0===i||Array.isArray(i)&&i.includes(s)||L_(e.references,s,n)}(t);if(t.is_headline)return I_(t);const n=N_.getBareJidFromJid(t.from)===va.bare_jid;return!ea(t)&&!n&&("all"===Cl.settings.get("show_desktop_notifications")||I_(t))}(e))return!1;Cl.trigger("messageNotification",e),function(){if(Cl.settings.get("play_sounds")&&void 0!==window.Audio){const e=new Audio(Cl.settings.get("sounds_path")+"msg_received.ogg"),t=e.canPlayType("audio/ogg");if("probably"===t)return e.play();const n=new Audio(Cl.settings.get("sounds_path")+"msg_received.mp3"),s=n.canPlayType("audio/mp3");"probably"===s?n.play():"maybe"===t?e.play():"maybe"===s&&n.play()}}(),function(e){const{attrs:t}=e;if(t.is_error)return;if(!M_())return;let n,s;const i=t.from,r=N_.getBareJidFromJid(i);if("info"==t.type)n=t.message;else if("headline"===t.type){if(r.includes("@")&&!Cl.settings.get("allow_non_roster_messaging"))return;n=vh("Notification from %1$s",r)}else if(r.includes("@"))if("groupchat"===t.type)n=vh("%1$s says",N_.getResourceFromJid(i));else{if(void 0===va.roster)return void M.error("Could not send notification, because roster is undefined");if(s=va.roster.get(r),void 0!==s)n=vh("%1$s says",s.getDisplayName());else{if(!Cl.settings.get("allow_non_roster_messaging"))return;n=vh("%1$s says",r)}}else n=vh("Notification from %1$s",r);let o;if("info"==t.type)o=t.reason;else if(o=t.is_encrypted?t.plaintext:t.body,!o)return;const a=new Notification(n,{body:o,lang:va.locale,icon:Cl.settings.get("notification_icon"),requireInteraction:!va.notification_delay});Cl.settings.get("notification_delay")&&setTimeout((()=>a.close()),Cl.settings.get("notification_delay")),a.onclick=function(e){e.preventDefault(),window.focus(),va.chatboxes.get(r).maybeShow(!0)}}(e)}function P_(e){M_()&&function(e){if("error"===e.klass||"warn"===e.klass){const t=new Notification(e.subject,{body:e.message,lang:va.locale,icon:va.notification_icon});setTimeout(t.close.bind(t),5e3)}}(e)}function F_(e){M_()&&Cl.settings.get("show_chat_state_notifications")&&function(e){if(va.chatstate_notification_blacklist.includes(e.jid))return;const t=e.presence.get("show");let n=null;if("offline"===t?n=vh("has gone offline"):"away"===t?n=vh("has gone away"):"dnd"===t?n=vh("is busy"):"online"===t&&(n=vh("has come online")),null===n)return;const s=new Notification(e.getDisplayName(),{body:n,lang:va.locale,icon:va.notification_icon});setTimeout((()=>s.close()),5e3)}(e)}function U_(e){M_()&&function(e){const t=new Notification(e.getDisplayName(),{body:vh("wants to be your contact"),lang:va.locale,icon:va.notification_icon});setTimeout((()=>t.close()),5e3)}(e)}function B_(){O_&&!["denied","granted"].includes(Notification.permission)&&Notification.requestPermission()}jl.env.Favico=j_(),jl.plugins.add("converse-notification",{dependencies:["converse-chatboxes"],initialize(){Cl.settings.extend({chatstate_notification_blacklist:[],notification_delay:5e3,notification_icon:"logo/conversejs-filled.svg",notify_all_room_messages:!1,notify_nicknames_without_references:!1,play_sounds:!0,show_chat_state_notifications:!1,show_desktop_notifications:!0,show_tab_notifications:!0,sounds_path:Cl.settings.get("assets_path")+"/sounds/"}),Cl.listen.on("clearSession",R_),Cl.waitUntil("chatBoxesInitialized").then((()=>va.chatboxes.on("change:num_unread",D_))),Cl.listen.on("pluginsInitialized",(function(){Cl.listen.on("contactRequest",U_),Cl.listen.on("contactPresenceChanged",F_),Cl.listen.on("message",z_),Cl.listen.on("feedback",P_),Cl.listen.on("connected",B_)}))}});let q_;const H_=Kg.extend({id:"converse-client-info-modal",initialize(e){q_=e._converse,Kg.prototype.initialize.apply(this,arguments)},toHTML(){return(e=>{const t=vh("Settings"),n=vh("%1$s Open Source %2$s XMPP chat client brought to you by %3$s Opkode %2$s",'<a target="_blank" rel="nofollow" href="https://conversejs.org">',"</a>",'<a target="_blank" rel="nofollow" href="https://opkode.com">'),s=vh("%1$s Translate %2$s it into your own language",'<a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">',"</a>"),i=Cl.settings.get("show_client_info"),r=Cl.settings.get("allow_adhoc_commands");return Qc`
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="converse-modtools-modal-label">${t}</h5>
                ${Qg}
            </div>
            <div class="modal-body">
                ${i&&r?(e=>{const t=vh("About"),n=vh("Commands");return Qc`
        <ul class="nav nav-pills justify-content-center">
            <li role="presentation" class="nav-item">
                <a class="nav-link active" id="about-tab" href="#about-tabpanel" aria-controls="about-tabpanel" role="tab" data-toggle="tab" @click=${e.switchTab}>${t}</a>
            </li>
            <li role="presentation" class="nav-item">
                <a class="nav-link" id="commands-tab" href="#commands-tabpanel" aria-controls="commands-tabpanel" role="tab" data-toggle="tab" @click=${e.switchTab}>${n}</a>
            </li>
        </ul>
    `})(e):""}

                <div class="tab-content">
                    <div class="tab-pane tab-pane--columns ${i?"active":""}"
                         id="about-tabpanel" role="tabpanel" aria-labelledby="about-tab">

                        <span class="modal-alert"></span>
                        <br/>
                        <div class="container">
                            <h6 class="brand-heading">Converse</h6>
                            <p class="brand-subtitle">${e.version_name}</p>
                            <p class="brand-subtitle">${Gv(No().sanitize(n))}</p>
                            <p class="brand-subtitle">${Gv(No().sanitize(s))}</p>
                        </div>
                    </div>

                    <div class="tab-pane tab-pane--columns ${!i&&r?"active":""}"
                         id="commands-tabpanel"
                         role="tabpanel"
                         aria-labelledby="commands-tab">
                        <converse-adhoc-commands/>
                    </div>
                </div>
            </div>
        </div>
    </div>
`})(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{version_name:q_.VERSION_NAME}))}});Cl.elements.define("converse-user-profile",class extends Pg{async initialize(){this.model=va.xmppstatus,this.listenTo(this.model,"change",this.render),await Cl.waitUntil("VCardsInitialized"),this.listenTo(this.model.vcard,"change",this.render),this.render()}render(){const e=this.model.get("status")||"offline";var t;tl((e=>{const t=vh("Log out"),n=vh("Click to change your chat status"),s=vh("Show details about this chat client"),i=Cl.settings.get("show_client_info")||Cl.settings.get("allow_adhoc_commands");return Qc`
    <div class="userinfo controlbox-padded">
        <div class="controlbox-section profile d-flex">
            <a class="show-profile" href="#" @click=${e.showProfileModal}>
                <canvas class="avatar align-self-center" height="40" width="40"></canvas>
            </a>
            <span class="username w-100 align-self-center">${e.fullname}</span>
            ${i?Qc`<a class="controlbox-heading__btn show-client-info fa fa-cog align-self-center" title="${s}" @click=${e.showUserSettingsModal}></a>`:""}
            ${Cl.settings.get("allow_logout")?Qc`<a class="controlbox-heading__btn logout fa fa-sign-out-alt align-self-center" title="${t}" @click=${e.logout}></a>`:""}
        </div>
        <div class="d-flex xmpp-status">
            <a class="change-status" title="${n}" data-toggle="modal" data-target="#changeStatusModal" @click=${e.showStatusChangeModal}>
                <span class="${e.chat_status} w-100 align-self-center" data-value="${e.chat_status}">
                    <span class="
                        ${"online"===e.chat_status&&"fa fa-circle chat-status chat-status--online"}
                        ${"dnd"===e.chat_status&&"fa fa-minus-circle chat-status chat-status--busy"}
                        ${"away"===e.chat_status&&"fa fa-circle chat-status chat-status--away"}
                        ${"xa"===e.chat_status&&"far fa-circle chat-status chat-status--xa "}
                        ${"offline"===e.chat_status&&"fa fa-circle chat-status chat-status--offline"}"></span> ${e.status_message}</span>
            </a>
        </div>
    </div>
`})(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{chat_status:e,fullname:this.model.vcard.get("fullname")||va.bare_jid,showUserSettingsModal:e=>this.showUserSettingsModal(e),status_message:this.model.get("status_message")||vh("I am %1$s",(t=e,"chat"===t?vh("online"):"dnd"===t?vh("busy"):"xa"===t?vh("away for long"):"away"===t?vh("away"):"offline"===t?vh("offline"):vh(t)||vh("online"))),logout:this.logout,showStatusChangeModal:()=>this.showStatusChangeModal(),showProfileModal:()=>this.showProfileModal()})),this),this.renderAvatar()}showProfileModal(e){null==e||e.preventDefault(),Cl.modal.show(va.ProfileModal,{model:this.model},e)}showStatusChangeModal(e){null==e||e.preventDefault(),Cl.modal.show(va.ChatStatusModal,{model:this.model},e)}showUserSettingsModal(e){null==e||e.preventDefault(),Cl.modal.show(H_,{model:this.model,_converse:va},e)}logout(e){null==e||e.preventDefault(),!0===confirm(vh("Are you sure you want to log out?"))&&Cl.user.logout()}});const G_=jl.env.utils,W_=Kg.extend({id:"modal-status-change",events:{"submit form#set-xmpp-status":"onFormSubmitted","click .clear-input":"clearStatusMessage"},toHTML(){return(e=>Qc`
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeStatusModalLabel">${e.modal_title}</h5>
                ${Qg}
            </div>
            <div class="modal-body">
                <span class="modal-alert"></span>
                <form class="converse-form set-xmpp-status" id="set-xmpp-status">
                    <div class="form-group">
                        <div class="custom-control custom-radio">
                            <input ?checked=${"online"===e.status}
                                type="radio" id="radio-online" value="online" name="chat_status" class="custom-control-input"/>
                            <label class="custom-control-label" for="radio-online">
                                <span class="fa fa-circle chat-status chat-status--online"></span>${e.label_online}</label>
                        </div>
                        <div class="custom-control custom-radio">
                            <input ?checked=${"busy"===e.status}
                                type="radio" id="radio-busy" value="dnd" name="chat_status" class="custom-control-input"/>
                            <label class="custom-control-label" for="radio-busy">
                                <span class="fa fa-minus-circle  chat-status chat-status--busy"></span>${e.label_busy}</label>
                        </div>
                        <div class="custom-control custom-radio">
                            <input ?checked=${"away"===e.status}
                                type="radio" id="radio-away" value="away" name="chat_status" class="custom-control-input"/>
                            <label class="custom-control-label" for="radio-away">
                                <span class="fa fa-circle chat-status chat-status--away"></span>${e.label_away}</label>
                        </div>
                        <div class="custom-control custom-radio">
                            <input ?checked=${"xa"===e.status}
                                type="radio" id="radio-xa" value="xa" name="chat_status" class="custom-control-input"/>
                            <label class="custom-control-label" for="radio-xa">
                                <span class="far fa-circle chat-status chat-status--xa"></span>${e.label_xa}</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="btn-group w-100">
                            <input name="status_message" type="text" class="form-control"
                                value="${e.status_message||""}" placeholder="${e.placeholder_status_message}"/>
                            <span class="clear-input fa fa-times ${e.status_message?"":"hidden"}"></span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">${e.label_save}</button>
                </form>
            </div>
        </div>
    </div>
`)(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),{label_away:vh("Away"),label_busy:vh("Busy"),label_cancel:vh("Cancel"),label_close:vh("Close"),label_custom_status:vh("Custom status"),label_offline:vh("Offline"),label_online:vh("Online"),label_save:vh("Save"),label_xa:vh("Away for long"),modal_title:vh("Change chat status"),placeholder_status_message:vh("Personal status message")}))},afterRender(){this.el.addEventListener("shown.bs.modal",(()=>{this.el.querySelector('input[name="status_message"]').focus()}),!1)},clearStatusMessage(e){e&&e.preventDefault&&(e.preventDefault(),G_.hideElement(this.el.querySelector(".clear-input"))),this.el.querySelector('input[name="status_message"]').value=""},onFormSubmitted(e){e.preventDefault();const t=new FormData(e.target);this.model.save({status_message:t.get("status_message"),status:t.get("chat_status")}),this.modal.hide()}});va.ChatStatusModal=W_;const V_=vh("Your profile picture");Cl.elements.define("converse-image-picker",class extends Uf{static get properties(){return{height:{type:Number},image:{type:String},width:{type:Number}}}render(){const e={height:this.height,image:this.image,width:this.width};return Qc`
            <a class="change-avatar" @click=${this.openFileSelection} title="${V_}">
                ${_v(e)}
            </a>
            <input @change=${this.updateFilePreview} class="hidden" name="image" type="file"/>
        `}openFileSelection(e){e.preventDefault(),this.querySelector('input[type="file"]').click()}updateFilePreview(e){const t=e.target.files[0],n=new FileReader;n.onloadend=()=>this.image=n.result,n.readAsDataURL(t)}});const J_=jl.env.utils,K_=e=>{var t;const n=vh("This device's OMEMO fingerprint"),s=vh("Generate new keys and fingerprint");return Qc`
        <div class="tab-pane" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">
            <form class="converse-form fingerprint-removal">
                <ul class="list-group fingerprints">
                    <li class="list-group-item active">${n}</li>
                    <li class="list-group-item">
                        ${e.view.current_device&&e.view.current_device.get("bundle")&&e.view.current_device.get("bundle").fingerprint?(e=>Qc`
    <span class="fingerprint">${J_.formatFingerprint(e.view.current_device.get("bundle").fingerprint)}</span>`)(e):Iv()}
                    </li>
                </ul>
                <div class="form-group">
                    <button type="button" class="generate-bundle btn btn-danger">${s}</button>
                </div>
                ${null!==(t=e.view.other_devices)&&void 0!==t&&t.length?(e=>{var t;const n=vh("Other OMEMO-enabled devices"),s=vh("Checkbox to select fingerprints of all other OMEMO devices"),i=vh("Remove checked devices and close"),r=vh("Select all");return Qc`
        <ul class="list-group fingerprints">
            <li class="list-group-item nopadding active">
                <label>
                    <input type="checkbox" class="select-all" title="${r}" aria-label="${s}"/>
                    ${n}
                </label>
            </li>
            ${null===(t=e.view.other_devices)||void 0===t?void 0:t.map((t=>(e=>Qc`
    ${e.device.get("bundle")&&e.device.get("bundle").fingerprint?(e=>{const t=vh("Checkbox for selecting the following fingerprint");return Qc`
        <li class="fingerprint-removal-item list-group-item nopadding">
            <label>
            <input type="checkbox" value="${e.device.get("id")}"
                aria-label="${t}"/>
            <span class="fingerprint">${J_.formatFingerprint(e.device.get("bundle").fingerprint)}</span>
            </label>
        </li>
    `})(e):(e=>{const t=vh("Device without a fingerprint"),n=vh("Checkbox for selecting the following device");return Qc`
        <li class="fingerprint-removal-item list-group-item nopadding">
            <label>
            <input type="checkbox" value="${e.device.get("id")}"
                aria-label="${n}"/>
            <span>${t}</span>
            </label>
        </li>
    `})(e)}
`)(Object.assign({device:t},e))))}
        </ul>
        <div class="form-group"><button type="submit" class="save-form btn btn-primary">${i}</button></div>
    `})(e):""}
            </form>
        </div>`},{sizzle:Y_}=converse.env,Q_=Kg.extend({id:"user-profile-modal",events:{"submit .profile-form":"onFormSubmitted"},initialize(){this.listenTo(this.model,"change",this.render),Kg.prototype.initialize.apply(this,arguments),Cl.trigger("profileModalInitialized",this.model)},toHTML(){return(e=>{const t=vh("Your Profile"),n=vh("Email"),s=vh("Full Name"),i=vh("XMPP Address"),r=vh("Nickname"),o=vh("Role"),a=vh("Save and close"),c=vh("Use commas to separate multiple roles. Your roles are shown next to your name on your chat messages."),l=vh("URL"),d=vh("OMEMO"),u=vh("Profile"),h=e.view.current_device?Qc`<ul class="nav nav-pills justify-content-center">
            <li role="presentation" class="nav-item">
                <a class="nav-link active" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" data-toggle="tab">${u}</a>
            </li>
            <li role="presentation" class="nav-item">
                <a class="nav-link" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" data-toggle="tab">${d}</a>
            </li>
        </ul>`:"";return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-profile-modal-label">${t}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    <span class="modal-alert"></span>
                    ${va.pluggable.plugins["converse-omemo"].enabled(va)&&h||""}
                    <div class="tab-content">
                        <div class="tab-pane active" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab">
                            <form class="converse-form converse-form--modal profile-form" action="#">
                                <div class="row">
                                    <div class="col-auto">
                                        <converse-image-picker image="${e.image}" width="${e.width}" height="${e.height}"></converse-image-picker>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label class="col-form-label">${i}:</label>
                                            <div>${e.jid}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="vcard-fullname" class="col-form-label">${s}:</label>
                                    <input id="vcard-fullname" type="text" class="form-control" name="fn" value="${e.fullname||""}"/>
                                </div>
                                <div class="form-group">
                                    <label for="vcard-nickname" class="col-form-label">${r}:</label>
                                    <input id="vcard-nickname" type="text" class="form-control" name="nickname" value="${e.nickname||""}"/>
                                </div>
                                <div class="form-group">
                                    <label for="vcard-url" class="col-form-label">${l}:</label>
                                    <input id="vcard-url" type="url" class="form-control" name="url" value="${e.url||""}"/>
                                </div>
                                <div class="form-group">
                                    <label for="vcard-email" class="col-form-label">${n}:</label>
                                    <input id="vcard-email" type="email" class="form-control" name="email" value="${e.email||""}"/>
                                </div>
                                <div class="form-group">
                                    <label for="vcard-role" class="col-form-label">${o}:</label>
                                    <input id="vcard-role" type="text" class="form-control" name="role" value="${e.role||""}" aria-describedby="vcard-role-help"/>
                                    <small id="vcard-role-help" class="form-text text-muted">${c}</small>
                                </div>
                                <hr/>
                                <div class="form-group">
                                    <button type="submit" class="save-form btn btn-primary">${a}</button>
                                </div>
                            </form>
                        </div>
                        ${va.pluggable.plugins["converse-omemo"].enabled(va)&&K_(e)||""}
                    </div>
                </div>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),this.model.vcard.toJSON(),this.getAvatarData(),{view:this}))},getAvatarData(){return{height:128,width:128,image:"data:"+this.model.vcard.get("image_type")+";base64,"+this.model.vcard.get("image")}},afterRender(){this.tabs=Y_(".nav-item .nav-link",this.el).map((e=>new(Hg().Tab)(e)))},async setVCard(e){try{await Cl.vcard.set(va.bare_jid,e)}catch(e){return M.fatal(e),void this.alert([vh("Sorry, an error happened while trying to save your profile data."),vh("You can check your browser's developer console for any error output.")].join(" "))}this.modal.hide()},onFormSubmitted(e){e.preventDefault();const t=new FileReader,n=new FormData(e.target),s=n.get("image"),i={fn:n.get("fn"),nickname:n.get("nickname"),role:n.get("role"),email:n.get("email"),url:n.get("url")};s.size?(t.onloadend=()=>{Object.assign(i,{image:btoa(t.result),image_type:s.type}),this.setVCard(i)},t.readAsBinaryString(s)):(Object.assign(i,{image:this.model.vcard.get("image"),image_type:this.model.vcard.get("image_type")}),this.setVCard(i))}});va.ProfileModal=Q_,jl.plugins.add("converse-profile",{dependencies:["converse-status","converse-modal","converse-vcard","converse-chatboxviews"],initialize(){Cl.settings.extend({allow_adhoc_commands:!0,show_client_info:!0})}});const X_={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",m4a:"audio/mp4",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"text/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"},Z_={name:"AES-GCM",length:128},{u:ew}=jl.env;function tw(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function nw(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function sw(e){return new TextDecoder("utf-8").decode(e)}function iw(e){return new TextEncoder("utf-8").encode(e).buffer}function rw(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function ow(e){const t=window.atob(e),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.charCodeAt(e);return s.buffer}function aw(e){return new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16)))).buffer}Object.assign(ew,{arrayBufferToHex:nw,arrayBufferToString:sw,stringToArrayBuffer:iw,arrayBufferToBase64:rw,base64ToArrayBuffer:ow});const{$msg:cw,Strophe:lw,URI:dw,sizzle:uw,u:hw}=jl.env,mw={decryptMessage:async function(e){const t=await crypto.subtle.importKey("raw",e.key,Z_,!0,["encrypt","decrypt"]),n=tw(ow(e.payload),e.tag),s={name:"AES-GCM",iv:ow(e.iv),tagLength:128};return sw(await crypto.subtle.decrypt(s,t,n))},encryptMessage:async function(e){const t=crypto.getRandomValues(new window.Uint8Array(12)),n=await crypto.subtle.generateKey(Z_,!0,["encrypt","decrypt"]),s={name:"AES-GCM",iv:t,tagLength:128},i=await crypto.subtle.encrypt(s,n,iw(e)),r=i.byteLength-16,o=i.slice(0,r),a=i.slice(r),c=await crypto.subtle.exportKey("raw",n);return{key:c,tag:a,key_and_tag:tw(c,a),payload:rw(o),iv:rw(t)}}};function fw(e,t,n){const s=[];try{const t={start:/\b(aesgcm:\/\/)/gi};dw.withinString(e,((e,t,n)=>(s.push({url:e,start:t,end:n}),e)),t)}catch(e){return void M.debug(e)}s.forEach((s=>{const i=Il(e.slice(s.start,s.end)),r=async function(e){var t;const n=e.hash().slice(1),s="localhost"===window.location.hostname?"http":"https",i=e.toString().replace(/^aesgcm/,s),r=await async function(e){let t;try{t=await fetch(e)}catch(t){return M.error(`${t.name}: Failed to download encrypted media: ${e}`),M.error(t),null}if(t.status>=200&&t.status<400)return t.arrayBuffer()}(i);if(null===r)return M.error(`Could not decrypt file ${e.toString()} since it could not be downloaded`),null;const o=n.slice(0,24),a=n.slice(24);let c;try{c=await async function(e,t,n){const s=await crypto.subtle.importKey("raw",aw(t),"AES-GCM",!1,["decrypt"]),i={name:"AES-GCM",iv:aw(e)};return crypto.subtle.decrypt(i,s,n)}(o,a,r)}catch(t){return M.error(`Could not decrypt file ${e.toString()}`),M.error(t),null}const[l,d]=null===(t=e.filename())||void 0===t?void 0:t.split("."),u=X_[d];try{const e=new File([c],l,{type:u});return URL.createObjectURL(e)}catch(t){return M.error(`Could not decrypt file ${e.toString()}`),M.error(t),null}}(i).then((e=>function(e,t,n){const s=e.toString();return null===t?s:ql(s)?Bp({url:t,onClick:n.onImgClick,onLoad:n.onImgLoad}):Ul(s)?gp(t):Bl(s)?jp(t):xp(t,e.filename())}(i,e,n))),o=Qc`${dp(r,"")}`;n.addTemplateResult(s.start+t,s.end+t,o)}))}function gw(e){va.config.get("trusted")&&e.addAnnotations(((t,n)=>fw(t,n,e)))}function pw(e,t){return t.is_encrypted&&t.encrypted.key?!0===t.encrypted.prekey?async function(e){const t=yw(e.from,parseInt(e.encrypted.device_id,10)),n=ow(e.encrypted.key);let s;try{s=await t.decryptPreKeyWhisperMessage(n,"binary")}catch(t){return M.error(`${t.name} ${t.message}`),Object.assign(e,ww(t))}try{const t=await _w(e,s);return await va.omemo_store.generateMissingPreKeys(),await va.omemo_store.publishBundle(),t?Object.assign(e,{plaintext:t}):Object.assign(e,{is_only_key:!0})}catch(t){return M.error(`${t.name} ${t.message}`),Object.assign(e,ww(t))}}(t):async function(e){const t=e.from_muc?e.from_real_jid:e.from;t||Object.assign(e,{error_text:vh("Sorry, could not decrypt a received OMEMO message because we don't have the XMPP address for that user."),error_type:"Decryption",is_ephemeral:!1,is_error:!0,type:"error"});const n=yw(t,parseInt(e.encrypted.device_id,10)),s=ow(e.encrypted.key);try{const t=await n.decryptWhisperMessage(s,"binary"),i=await _w(e,t);return Object.assign(e,{plaintext:i})}catch(t){return M.error(`${t.name} ${t.message}`),Object.assign(e,ww(t))}}(t):t}function vw(){va.chatboxes.on("add",(e=>{kw(e),e.get("type")===va.CHATROOMS_TYPE&&(e.occupants.on("add",(t=>async function(e,t){!t.isSelf()&&e.features.get("nonanonymous")&&e.features.get("membersonly")&&e.get("omemo_active")&&(await va.contactHasOMEMOSupport(t.get("jid"))||(e.createMessage({message:vh("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1})))}(e,t))),e.features.on("change",(()=>kw(e))))}))}function bw(e){e.listenTo(e.model.messages,"add",(t=>{t.get("is_encrypted")&&!t.get("is_error")&&e.model.save("omemo_supported",!0)})),e.listenTo(e.model,"change:omemo_supported",(()=>{var t;!e.model.get("omemo_supported")&&e.model.get("omemo_active")?e.model.set("omemo_active",!1):null===(t=e.querySelector("converse-chat-toolbar"))||void 0===t||t.requestUpdate()})),e.listenTo(e.model,"change:omemo_active",(()=>{e.querySelector("converse-chat-toolbar").requestUpdate()}))}function yw(e,t){const n=new libsignal.SignalProtocolAddress(e,t);return new window.libsignal.SessionCipher(va.omemo_store,n)}async function _w(e,t){const n=e.encrypted,s=va.devicelists.getDeviceList(e.from);await s._devices_promise;let i=s.get(n.device_id);if(i||(i=await s.devices.create({id:n.device_id,jid:e.from},{promise:!0})),n.payload){const e=t.slice(0,16),s=t.slice(16),r=await mw.decryptMessage(Object.assign(n,{key:e,tag:s}));return i.save("active",!0),r}}function ww(e){return"debug"===Cl.settings.get("loglevel")?{error_text:vh("Sorry, could not decrypt a received OMEMO message due to an error.")+` ${e.name} ${e.message}`,error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}:{}}function Sw(e){const t=e.querySelector("signedPreKeyPublic"),n=e.querySelector("signedPreKeySignature"),s=uw("prekeys > preKeyPublic",e).map((e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent})));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:n.textContent},prekeys:s}}async function xw(e){var t;if(null!==(t=e.get("bundle"))&&void 0!==t&&t.fingerprint)return;const n=await e.getBundle();n.fingerprint=nw(ow(n.identity_key)),e.save("bundle",n),e.trigger("change:bundle")}async function Ew(e){await Cl.waitUntil("OMEMOInitialized");const t=va.devicelists.get(e)||va.devicelists.create({jid:e});return await t.fetchDevices(),t.devices}function Aw(){va.connection.addHandler((e=>{try{uw(`event[xmlns="${lw.NS.PUBSUB}#event"]`,e).length&&(function(e){const t=uw(`items[node="${lw.NS.OMEMO_DEVICELIST}"]`,e).pop();if(!t)return;const n=`item list[xmlns="${lw.NS.OMEMO}"] device`,s=uw(n,t).map((e=>e.getAttribute("id"))),i=e.getAttribute("from"),r=va.devicelists.getDeviceList(i),o=r.devices;za(o.pluck("id"),s).forEach((e=>{i===va.bare_jid&&e===va.omemo_store.get("device_id")||o.get(e).save("active",!1)})),s.forEach((e=>{const t=o.get(e);t?t.save("active",!0):o.create({id:e,jid:i})})),hw.isSameBareJID(i,va.bare_jid)&&r.publishCurrentDevice(s)}(e),function(e){const t=uw("items",e).pop();if(!t||!t.getAttribute("node").startsWith(lw.NS.OMEMO_BUNDLES))return;const n=t.getAttribute("node").split(":")[1],s=e.getAttribute("from"),i=uw("item > bundle",t).pop(),r=va.devicelists.getDeviceList(s);(r.devices.get(n)||r.devices.create({id:n,jid:s})).save({bundle:Sw(i)})}(e))}catch(e){M.error(e.message)}return!0}),null,"message","headline")}function Cw(){if(void 0===va.omemo_store){const e=`converse.omemosession-${va.bare_jid}`;va.omemo_store=new va.OMEMOStore({id:e}),_o(va.omemo_store,e)}return va.omemo_store.fetchSession()}async function Tw(){if(!va.config.get("trusted")||Cl.settings.get("clear_cache_on_logout"))return void M.warn("Not initializing OMEMO, since this browser is not trusted or clear_cache_on_logout is set to true");va.devicelists=new va.DeviceLists;const e=`converse.devicelists-${va.bare_jid}`;_o(va.devicelists,e);try{await async function(){await new Promise(((e,t)=>va.devicelists.fetch({success:e,error:(e,n)=>t(n)})));let e=va.devicelists.get(va.bare_jid);return e?e.fetchDevices():e=await va.devicelists.create({jid:va.bare_jid},{promise:!0}),e._devices_promise}(),await Cw(),await va.omemo_store.publishBundle()}catch(e){return M.error("Could not initialize OMEMO support"),void M.error(e)}Cl.trigger("OMEMOInitialized")}async function kw(e){let t;e.get("type")===va.CHATROOMS_TYPE?(await Cl.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===va.PRIVATE_CHAT_TYPE&&(t=await va.contactHasOMEMOSupport(e.get("jid"))),e.set("omemo_supported",t),t&&Cl.settings.get("omemo_default")&&e.set("omemo_active",!0)}function jw(e){e.stopPropagation(),e.preventDefault();const t=hw.ancestor(e.target,"converse-chat-toolbar");if(!t.model.get("omemo_supported")){let e;return e=t.model.get("type")===va.CHATROOMS_TYPE?[vh("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[vh("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",t.model.contact.getDisplayName())],Cl.alert("error",vh("Error"),e)}t.model.save({omemo_active:!t.model.get("omemo_active")})}function Nw(e,t){const n=e.model,s=n.get("type")===va.CHATROOMS_TYPE;let i,r;if(n.get("omemo_supported")){const e=vh("Messages are being sent in plaintext"),t=vh("Messages are sent encrypted");i=n.get("omemo_active")?t:e}else i=vh(s?"This groupchat needs to be members-only and non-anonymous in order to support OMEMO encrypted messages":"OMEMO encryption is not supported");return r=n.get("omemo_supported")?n.get("omemo_active")?"var(--info-color)":"var(--error-color)":"var(--muc-toolbar-btn-disabled-color)",t.push(Qc`
        <button class="toggle-omemo" title="${i}" data-disabled=${!n.get("omemo_supported")} @click=${jw}>
            <converse-icon
                class="fa ${n.get("omemo_active")?"fa-lock":"fa-unlock"}"
                path-prefix="${Cl.settings.get("assets_path")}"
                size="1em"
                color="${r}"
            ></converse-icon>
        </button>
    `),t}const Ow={async sendMessage(e){var t;if(this.get("omemo_active")&&null!==(t=e)&&void 0!==t&&t.body){var n;const t=null===(n=e)||void 0===n?void 0:n.body;let s,i;(e=this.getOutgoingMessageAttributes(e)).is_encrypted=!0,e.plaintext=t;try{const t=await async function(e){const t=vh("Sorry, no devices found to which we can send an OMEMO encrypted message.");let n;if(e.get("type")===va.CHATROOMS_TYPE){const t=await Promise.all(e.occupants.map((e=>Ew(e.get("jid")))));n=t.reduce(((e,t)=>function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),n=arguments[0],s=e;s--;)t[s-1]=arguments[s];return Xt(ot(n)?_i(n):[n],Ao(t,1))}(e,t.models)),[])}else if(e.get("type")===va.PRIVATE_CHAT_TYPE){const s=await Ew(e.get("jid"));if(0===s.length){const e=new Error(t);throw e.user_facing=!0,e}const i=va.devicelists.get(va.bare_jid).devices;n=[...i.models,...s.models]}const s=va.omemo_store.get("device_id");n=n.filter((e=>e.get("id")!==s)),await Promise.all(n.map((e=>e.getBundle())));const i=n.filter((e=>e)).map((e=>async function(e){if(!e.get("bundle"))return M.error(`Could not build an OMEMO session for device ${e.get("id")} because we don't have its bundle`),null;const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=await va.omemo_store.loadSession(t.toString());if(n)return n;try{return await async function(e){const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=new libsignal.SessionBuilder(va.omemo_store,t),s=e.getRandomPreKey(),i=await e.getBundle();return n.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:ow(i.identity_key),signedPreKey:{keyId:i.signed_prekey.id,publicKey:ow(i.signed_prekey.public_key),signature:ow(i.signed_prekey.signature)},preKey:{keyId:s.id,publicKey:ow(s.key)}})}(e)}catch(t){return M.error(`Could not build an OMEMO session for device ${e.get("id")}`),M.error(t),null}}(e)));if(await Promise.all(i),i.includes(null)&&(n=n.filter((e=>i[n.indexOf(e)])),0===n.length)){const e=new Error(t);throw e.user_facing=!0,e}return n}(this);s=await this.createMessage(e),i=await function(e,t,n){const s=vh("This is an OMEMO encrypted message which your client doesn’t seem to support. Find more information on https://conversations.im/omemo");if(!t.get("message"))throw new Error("No message body to encrypt!");const i=cw({from:va.connection.jid,to:e.get("jid"),type:e.get("message_type"),id:t.get("msgid")}).c("body").t(s).up();return"chat"===t.get("type")&&i.c("request",{xmlns:lw.NS.RECEIPTS}).up(),i.c("encrypted",{xmlns:lw.NS.OMEMO}).c("header",{sid:va.omemo_store.get("device_id")}),mw.encryptMessage(t.get("message")).then((t=>{const s=n.filter((e=>-1!=e.get("trusted")&&e.get("active"))).map((n=>e.encryptKey(t.key_and_tag,n)));return Promise.all(s).then((e=>function(e,t,n){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const i=t[s].payload,r=t[s].device,o=3==parseInt(i.type,10);e.c("key",{rid:r.get("id")}).t(btoa(i.body)),o&&e.attrs({prekey:o}),e.up(),s==t.length-1&&e.c("iv").t(n).up().up()}return Promise.resolve(e)}(i,e,t.iv))).then((e=>(e.c("payload").t(t.payload).up().up(),e.c("store",{xmlns:lw.NS.HINTS}).up(),e.c("encryption",{xmlns:lw.NS.EME,namespace:lw.NS.OMEMO}),e)))}))}(this,s,t)}catch(e){return this.handleMessageSendError(e),null}return va.api.send(i),s}return this.__super__.sendMessage.apply(this,arguments)}},$w={generateFingerprints:async function(e){const t=await Ew(e);return Promise.all(t.map((e=>xw(e))))},getDeviceForContact:function(e,t){return Ew(e).then((e=>e.get(t)))},contactHasOMEMOSupport:async function(e){return(await Ew(e)).length>0}};class Iw extends Error{constructor(e,t){super(e,t),this.name="IQError",this.iq=t}}const{Strophe:Mw,sizzle:Rw,u:Dw,$iq:Lw}=jl.env,zw=Zo.extend({defaults:{trusted:0,active:!0},getRandomPreKey(){const e=this.get("bundle");return e.prekeys[Dw.getRandomInt(e.prekeys.length)]},async fetchBundleFromServer(){const e=Lw({type:"get",from:va.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:Mw.NS.PUBSUB}).c("items",{node:`${Mw.NS.OMEMO_BUNDLES}:${this.get("id")}`});let t;try{t=await Cl.sendIQ(e)}catch(t){return M.error(`Could not fetch bundle for device ${this.get("id")} from ${this.get("jid")}`),M.error(t),null}if(t.querySelector("error"))throw new Iw("Could not fetch bundle",t);const n=Rw(`items[node="${Mw.NS.OMEMO_BUNDLES}:${this.get("id")}"]`,t).pop(),s=Sw(Rw(`bundle[xmlns="${Mw.NS.OMEMO}"]`,n).pop());return this.save("bundle",s),s},getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle"),this):this.fetchBundleFromServer()}}),{Strophe:Pw,$build:Fw,$iq:Uw,sizzle:Bw}=jl.env,qw=Zo.extend({idAttribute:"jid",initialize(){this.initDevices()},initDevices(){this.devices=new va.Devices;const e=`converse.devicelist-${va.bare_jid}-${this.get("jid")}`;_o(this.devices,e),this.fetchDevices()},async onDevicesFound(e){if(0===e.length){let e;try{e=await this.fetchDevicesFromServer()}catch(e){null===e?M.error(`Timeout error while fetching devices for ${this.get("jid")}`):(M.error(`Could not fetch devices for ${this.get("jid")}`),M.error(e)),this.destroy()}this.get("jid")===va.bare_jid&&await this.publishCurrentDevice(e)}},fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise((e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,n)=>{M.error(n),e()}})}))),this._devices_promise},async getOwnDeviceId(){let e=va.omemo_store.get("device_id");return this.devices.findWhere({id:e})||(await va.omemo_store.generateBundle(),e=va.omemo_store.get("device_id")),e},async publishCurrentDevice(e){if(this.get("jid")===va.bare_jid){if(await Cw(),va.omemo_store)return e.includes(await this.getOwnDeviceId())?void 0:this.publishDevices();M.warn("publishCurrentDevice: omemo_store is not defined, likely a timing issue")}},async fetchDevicesFromServer(){const e=Uw({type:"get",from:va.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:Pw.NS.PUBSUB}).c("items",{node:Pw.NS.OMEMO_DEVICELIST});let t;try{t=await Cl.sendIQ(e)}catch(e){return M.error(e),[]}const n=`list[xmlns="${Pw.NS.OMEMO}"] device`,s=Bw(n,t).map((e=>e.getAttribute("id")));return await Promise.all(s.map((e=>this.devices.create({id:e,jid:this.get("jid")},{promise:!0})))),s},publishDevices(){const e=Fw("item",{id:"current"}).c("list",{xmlns:Pw.NS.OMEMO});return this.devices.filter((e=>e.get("active"))).forEach((t=>e.c("device",{id:t.get("id")}).up())),Cl.pubsub.publish(null,Pw.NS.OMEMO_DEVICELIST,e,{"pubsub#access_model":"open"},!1)},removeOwnDevices(e){if(this.get("jid")!==va.bare_jid)throw new Error("Cannot remove devices from someone else's device list");return e.forEach((e=>this.devices.get(e).destroy())),this.publishDevices()}}),Hw=tc.extend({model:qw,getDeviceList(e){return this.get(e)||this.create({jid:e})}}),Gw=tc.extend({model:zw});var Ww=Math.ceil,Vw=Math.max;const Jw=function(e,t,n){return n&&"number"!=typeof n&&Ze(e,t,n)&&(t=n=void 0),e=xs(e),void 0===t?(t=e,e=0):t=xs(t),function(e,t,n,s){for(var i=-1,r=Vw(Ww((t-e)/(n||1)),0),o=Array(r);r--;)o[s?r:++i]=e,e+=n;return o}(e,t,n=void 0===n?e<t?1:-1:xs(n),void 0)},{Strophe:Kw,$build:Yw,u:Qw}=jl.env,Xw=Zo.extend({Direction:{SENDING:1,RECEIVING:2},getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:Qw.base64ToArrayBuffer(e.privKey),pubKey:Qw.base64ToArrayBuffer(e.pubKey)})},getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))},isTrustedIdentity(e,t,n){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const s=this.get("identity_key"+e);return void 0===s?Promise.resolve(!0):Promise.resolve(Qw.arrayBufferToBase64(t)===s)},loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(Qw.base64ToArrayBuffer(this.get("identity_key"+e)))},saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const n=new libsignal.SignalProtocolAddress.fromString(e),s=this.get("identity_key"+n.getName()),i=Qw.arrayBufferToBase64(t);return this.save("identity_key"+n.getName(),i),s&&i!==s?Promise.resolve(!0):Promise.resolve(!1)},getPreKeys(){return this.get("prekeys")||{}},loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:Qw.base64ToArrayBuffer(t.privKey),pubKey:Qw.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()},storePreKey(e,t){const n={};return n[e]={pubKey:Qw.arrayBufferToBase64(t.pubKey),privKey:Qw.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),n)),Promise.resolve()},removePreKey(e){return this.save("prekeys",Xo(this.getPreKeys(),e)),Promise.resolve()},loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:Qw.base64ToArrayBuffer(t.privKey),pubKey:Qw.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()},storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:Qw.arrayBufferToBase64(e.keyPair.privKey),pubKey:Qw.arrayBufferToBase64(e.keyPair.pubKey),signature:Qw.arrayBufferToBase64(e.signature)}),Promise.resolve()},removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()},loadSession(e){return Promise.resolve(this.get("session"+e))},storeSession(e,t){return Promise.resolve(this.save("session"+e,t))},removeSession(e){return Promise.resolve(this.unset("session"+e))},removeAllSessions(e){const t=Object.keys(this.attributes).filter((t=>!!t.startsWith("session"+e)&&t)),n={};return t.forEach((e=>{n[e]=void 0})),this.save(n),Promise.resolve()},publishBundle(){const e=this.get("signed_prekey"),t=`${Kw.NS.OMEMO_BUNDLES}:${this.get("device_id")}`,n=Yw("item").c("bundle",{xmlns:Kw.NS.OMEMO}).c("signedPreKeyPublic",{signedPreKeyId:e.id}).t(e.pubKey).up().c("signedPreKeySignature").t(e.signature).up().c("identityKey").t(this.get("identity_keypair").pubKey).up().c("prekeys");return Object.values(this.get("prekeys")).forEach(((e,t)=>n.c("preKeyPublic",{preKeyId:t}).t(e.pubKey).up())),Cl.pubsub.publish(null,t,n,{"pubsub#access_model":"open"},!1)},async generateMissingPreKeys(){const e=za(rg(Jw(0,va.NUM_PREKEYS),Number.prototype.toString),Object.keys(this.getPreKeys()));if(e.length<1)return M.warn("No missing prekeys to generate for our own device"),Promise.resolve();(await Promise.all(e.map((e=>libsignal.KeyHelper.generatePreKey(parseInt(e,10)))))).forEach((e=>this.storePreKey(e.keyId,e.keyPair)));const t=Object.keys(this.getPreKeys()).map((e=>({id:e.keyId,key:Qw.arrayBufferToBase64(e.pubKey)}))),n=va.devicelists.get(va.bare_jid).devices.get(this.get("device_id")),s=await n.getBundle();n.save("bundle",Object.assign(s,{prekeys:t}))},async generateBundle(){const e=await libsignal.KeyHelper.generateIdentityKeyPair(),t={},n=Qw.arrayBufferToBase64(e.pubKey),s=function(){const e=va.devicelists.get(va.bare_jid).devices.pluck("id");let t=libsignal.KeyHelper.generateRegistrationId(),n=0;for(;e.includes(t);)if(t=libsignal.KeyHelper.generateRegistrationId(),n++,10===n)throw new Error("Unable to generate a unique device ID");return t.toString()}();t.identity_key=n,t.device_id=s,this.save({device_id:s,identity_keypair:{privKey:Qw.arrayBufferToBase64(e.privKey),pubKey:n},identity_key:n});const i=await libsignal.KeyHelper.generateSignedPreKey(e,0);va.omemo_store.storeSignedPreKey(i),t.signed_prekey={id:i.keyId,public_key:Qw.arrayBufferToBase64(i.keyPair.pubKey),signature:Qw.arrayBufferToBase64(i.signature)};const r=await Promise.all(Jw(0,va.NUM_PREKEYS).map((e=>libsignal.KeyHelper.generatePreKey(e))));r.forEach((e=>va.omemo_store.storePreKey(e.keyId,e.keyPair)));const o=va.devicelists.get(va.bare_jid),a=await o.devices.create({id:t.device_id,jid:va.bare_jid},{promise:!0}),c=r.map((e=>({id:e.keyId,key:Qw.arrayBufferToBase64(e.keyPair.pubKey)})));t.prekeys=c,a.save("bundle",t)},fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise(((e,t)=>{this.fetch({success:()=>{va.omemo_store.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(n,s)=>{M.warn("Could not fetch OMEMO session from cache, we'll generate a new one."),M.warn(s),this.generateBundle().then(e).catch(t)}})}))),this._setup_promise}}),{Strophe:Zw,sizzle:eS,u:tS}=jl.env,nS={events:{"change input.select-all":"selectAll","click .generate-bundle":"generateOMEMODeviceBundle","submit .fingerprint-removal":"removeSelectedFingerprints"},initialize(){return this.debouncedRender=hc(this.render,50),this.devicelist=va.devicelists.get(va.bare_jid),this.listenTo(this.devicelist.devices,"change:bundle",this.debouncedRender),this.listenTo(this.devicelist.devices,"reset",this.debouncedRender),this.listenTo(this.devicelist.devices,"reset",this.debouncedRender),this.listenTo(this.devicelist.devices,"remove",this.debouncedRender),this.listenTo(this.devicelist.devices,"add",this.debouncedRender),this.__super__.initialize.apply(this,arguments)},beforeRender(){var e,t;const n=null===(e=va.omemo_store)||void 0===e?void 0:e.get("device_id");return n&&(this.current_device=this.devicelist.devices.get(n),this.other_devices=this.devicelist.devices.filter((e=>e.get("id")!==n))),null===(t=this.__super__.beforeRender)||void 0===t?void 0:t.apply(this,arguments)},selectAll(e){let t=tS.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling},removeSelectedFingerprints(e){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=eS('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map((e=>e.value));this.devicelist.removeOwnDevices(t).then(this.modal.hide).catch((e=>{M.error(e),va.api.alert(Zw.LogLevel.ERROR,vh("Error"),[vh("Sorry, an error occurred while trying to remove the devices.")])}))},generateOMEMODeviceBundle(e){e.preventDefault(),confirm(vh("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device."))&&Cl.omemo.bundle.generate()}},sS={events:{"click .fingerprint-trust .btn input":"toggleDeviceTrust"},initialize(){const e=this.model.get("jid");return this.devicelist=va.devicelists.getDeviceList(e),this.listenTo(this.devicelist.devices,"change:bundle",this.render),this.listenTo(this.devicelist.devices,"change:trusted",this.render),this.listenTo(this.devicelist.devices,"remove",this.render),this.listenTo(this.devicelist.devices,"add",this.render),this.listenTo(this.devicelist.devices,"reset",this.render),this.__super__.initialize.apply(this,arguments)},toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}},iS={omemo:{bundle:{generate:async()=>{const e=va.devicelists.get(va.bare_jid),t=va.omemo_store.get("device_id");if(t){const n=e.devices.get(t);va.omemo_store.unset(t),n&&await new Promise((e=>n.destroy({success:e,error:e}))),e.devices.trigger("remove")}await va.omemo_store.generateBundle(),await e.publishDevices();const n=xw(e.devices.get(va.omemo_store.get("device_id")));return await va.omemo_store.publishBundle(),n}}}},{Strophe:rS,sizzle:oS}=jl.env,aS={encryptKey:(e,t)=>yw(t.get("jid"),t.get("id")).encrypt(e).then((e=>({payload:e,device:t}))),handleMessageSendError(e){if("IQError"===e.name){this.save("omemo_supported",!1);const t=[];oS(`presence-subscription-required[xmlns="${rS.NS.PUBSUB_ERROR}"]`,e.iq).length?t.push(vh("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):oS('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?t.push(vh("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(t.push(vh("Unable to send an encrypted message due to an unexpected error.")),t.push(e.iq.outerHTML)),Cl.alert("error",vh("Error"),t),M.error(e)}else{if(!e.user_facing)throw e;Cl.alert("error",vh("Error"),[e.message]),M.error(e)}}},{Strophe:cS}=jl.env;jl.env.omemo=mw,cS.addNamespace("OMEMO_DEVICELIST",cS.NS.OMEMO+".devicelist"),cS.addNamespace("OMEMO_VERIFICATION",cS.NS.OMEMO+".verification"),cS.addNamespace("OMEMO_WHITELISTED",cS.NS.OMEMO+".whitelisted"),cS.addNamespace("OMEMO_BUNDLES",cS.NS.OMEMO+".bundles"),jl.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&e.config.get("trusted")&&!Cl.settings.get("clear_cache_on_logout")&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],overrides:{ProfileModal:nS,UserDetailsModal:sS,ChatBox:Ow},initialize(){Cl.settings.extend({omemo_default:!1}),Cl.promises.add(["OMEMOInitialized"]),va.NUM_PREKEYS=100,Object.assign(va.ChatBox.prototype,aS),Object.assign(va,$w),Object.assign(va.api,iS),va.OMEMOStore=Xw,va.Device=zw,va.Devices=Gw,va.DeviceList=qw,va.DeviceLists=Hw,Cl.waitUntil("chatBoxesInitialized").then(vw),Cl.listen.on("afterFileUploaded",((e,t)=>e.file.xep454_ivkey?function(e,t){const n=t.oob_url.replace(/^https?:/,"aesgcm:")+"#"+e.file.xep454_ivkey;return Object.assign(t,{oob_url:null,message:n,body:n})}(e,t):t)),Cl.listen.on("beforeFileUpload",((e,t)=>e.get("omemo_active")?async function(e){const t=crypto.getRandomValues(new Uint8Array(12)),n=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},n,await e.arrayBuffer()),i=await window.crypto.subtle.exportKey("raw",n),r=new File([s],e.name,{type:e.type,lastModified:e.lastModified});return r.xep454_ivkey=nw(t)+nw(i),r}(t):t)),Cl.listen.on("parseMessage",pw),Cl.listen.on("parseMUCMessage",pw),Cl.listen.on("chatBoxViewInitialized",bw),Cl.listen.on("chatRoomViewInitialized",bw),Cl.listen.on("connected",Aw),Cl.listen.on("getToolbarButtons",Nw),Cl.listen.on("statusInitialized",Tw),Cl.listen.on("addClientFeatures",(()=>Cl.disco.own.features.add(`${cS.NS.OMEMO_DEVICELIST}+notify`))),Cl.listen.on("afterMessageBodyTransformed",gw),Cl.listen.on("userDetailsModalInitialized",(e=>{const t=e.get("jid");va.generateFingerprints(t).catch((e=>M.error(e)))})),Cl.listen.on("profileModalInitialized",(()=>{va.generateFingerprints(va.bare_jid).catch((e=>M.error(e)))})),Cl.listen.on("afterTearDown",(()=>delete va.omemo_store)),Cl.listen.on("clearSession",(()=>{va.shouldClearCache()&&va.devicelists&&(va.devicelists.clearStore(),delete va.devicelists)}))}});const{Strophe:lS,$iq:dS}=jl.env;async function uS(e){e=e||va.bare_jid;const t=va.session.get("push_enabled")||[];if(t.includes(e))return;const n=Cl.settings.get("push_app_servers").filter((e=>!e.disable)),s=Cl.settings.get("push_app_servers").filter((e=>e.disable)),i=n.map((t=>async function(e,t){if(!t.jid||!t.node)return;if(!await Cl.disco.getIdentity("pubsub","push",t.jid))return M.warn(`Not enabling push the service "${t.jid}", it doesn't have the right disco identtiy.`);const n=await Promise.all([Cl.disco.supports(lS.NS.PUSH,t.jid),Cl.disco.supports(lS.NS.PUSH,e)]);if(!n[0]&&!n[1])return void M.warn(`Not enabling push app server "${t.jid}", no disco support from your server.`);const s=dS({type:"set"});return e!==va.bare_jid&&s.attrs({to:e}),s.c("enable",{xmlns:lS.NS.PUSH,jid:t.jid,node:t.node}),t.secret&&s.c("x",{xmlns:lS.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t(`${lS.NS.PUBSUB}#publish-options`).up().up().c("field",{var:"secret"}).c("value").t(t.secret),Cl.sendIQ(s)}(e,t))),r=s.map((t=>async function(e,t){if(!t.jid)return;if(!await Cl.disco.supports(lS.NS.PUSH,e||va.bare_jid))return void M.warn(`Not disabling push app server "${t.jid}", no disco support from your server.`);const n=dS({type:"set"});e!==va.bare_jid&&n.attrs({to:e}),n.c("disable",{xmlns:lS.NS.PUSH,jid:t.jid}),t.node&&n.attrs({node:t.node}),Cl.sendIQ(n).catch((e=>{M.error(`Could not disable push app server for ${t.jid}`),M.error(e)}))}(e,t)));try{await Promise.all(i.concat(r))}catch(e){M.error("Could not enable or disable push App Server"),e&&M.error(e)}finally{t.push(e)}va.session.save("push_enabled",t)}function hS(e){e.get("type")==va.CHATROOMS_TYPE&&uS(lS.getDomainFromJid(e.get("jid")))}const{Strophe:mS}=jl.env;mS.addNamespace("PUSH","urn:xmpp:push:0"),jl.plugins.add("converse-push",{initialize(){Cl.settings.extend({push_app_servers:[],enable_muc_push:!1}),Cl.listen.on("statusInitialized",(()=>uS())),Cl.settings.get("enable_muc_push")&&Cl.listen.on("chatBoxesInitialized",(()=>va.chatboxes.on("add",hS)))}});const fS=e=>Qc`
        <converse-brand-logo></converse-brand-logo>
        ${0===e.model.get("registration_status")?(()=>{const e=Cl.settings.get("registration_domain"),t=vh("Create your account"),n=vh("Please enter the XMPP provider to register with:");return Qc`
        <form id="converse-register" class="converse-form">
            <legend class="col-form-label">${t}</legend>
            <div class="form-group">
                <label>${n}</label>
                <div class="form-errors hidden"></div>
                ${e||(()=>{const e=Cl.settings.get("domain_placeholder"),t=vh("Tip: A list of public XMPP providers is available"),n=vh("here"),s=Cl.settings.get("providers_link");return Qc`
        <input class="form-control" required="required" type="text" name="domain" placeholder="${e}" />
        <p class="form-text text-muted">
            ${t}
            <a href="${s}" class="url" target="_blank" rel="noopener">${n}</a>.
        </p>
    `})()}
            </div>
            ${e?"":(()=>{const e=vh("Fetch registration form"),t=vh("Already have a chat account?"),n=vh("Log in here");return Qc`
        <fieldset class="form-group buttons">
            <input class="btn btn-primary" type="submit" value="${e}" />
        </fieldset>
        <div class="switch-form">
            <p>${t}</p>
            <p><a class="login-here toggle-register-login" href="#converse/login">${n}</a></p>
        </div>
    `})()}
        </form>
    `})():""}
        ${1===e.model.get("registration_status")?(()=>{const e=Cl.settings.get("registration_domain"),t=vh("Hold tight, we're fetching the registration form…"),n=vh("Cancel");return Qc`
        <form id="converse-register" class="converse-form no-scrolling">
            ${Iv({classes:"hor_centered"})}
            <p class="info">${t}</p>
            ${e?"":Qc`
                      <button class="btn btn-secondary button-cancel hor_centered">${n}</button>
                  `}
        </form>
    `})():""}
        ${2===e.model.get("registration_status")?(e=>{const t=vh("Choose a different provider"),n=vh("Already have a chat account?"),s=vh("Account Registration:"),i=vh("Log in here"),r=vh("Register"),o=Cl.settings.get("registration_domain");return Qc`
        <form id="converse-register" class="converse-form">
            <legend class="col-form-label">${s} ${e.domain}</legend>
            <p class="title">${e.title}</p>
            <p class="form-help instructions">${e.instructions}</p>
            <div class="form-errors hidden"></div>
            ${e.form_fields}

            <fieldset class="buttons form-group">
                ${e.fields?Qc`
                          <input type="submit" class="btn btn-primary" value="${r}" />
                      `:""}
                ${o?"":Qc`
                          <input
                              type="button"
                              class="btn btn-secondary button-cancel"
                              value="${t}"
                          />
                      `}
                <div class="switch-form">
                    <p>${n}</p>
                    <p><a class="login-here toggle-register-login" href="#converse/login">${i}</a></p>
                </div>
            </fieldset>
        </form>
    `})(e):""}
    `;function gS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{Strophe:pS,sizzle:vS,$iq:bS}=jl.env,yS=jl.env.utils,_S=1,wS=2;Cl.elements.define("converse-register-panel",class extends mg{constructor(...e){super(...e),gS(this,"id","converse-register-panel"),gS(this,"className","controlbox-pane fade-in"),gS(this,"events",{"submit form#converse-register":"onFormSubmission","click .button-cancel":"renderProviderChoiceForm"})}initialize(){this.reset();const e=va.chatboxes.get("controlbox");this.model=e,this.listenTo(va,"connectionInitialized",this.registerHooks),this.listenTo(this.model,"change:registration_status",this.render);const t=Cl.settings.get("registration_domain");t?this.fetchRegistrationForm(t):this.model.set("registration_status",0)}render(){tl(fS({domain:this.domain,fields:this.fields,form_fields:this.form_fields,instructions:this.instructions,model:this.model,title:this.title}),this)}registerHooks(){const e=va.connection,t=e._connect_cb.bind(e);e._connect_cb=(e,n,s)=>{this._registering?this.getRegistrationFields(e,n)&&(this._registering=!1):t(e,n,s)}}connectedCallback(){super.connectedCallback(),this.render()}getRegistrationFields(e,t){const n=va.connection;n.connected=!0;const s=n._proto._reqToData(e);if(!s)return;if(n._proto._connect_cb(s)===pS.Status.CONNFAIL)return this.showValidationError(vh("Sorry, we're unable to connect to your chosen provider.")),!1;const i=s.getElementsByTagName("register"),r=s.getElementsByTagName("mechanism");if(0===i.length&&0===r.length)return n._proto._no_auth_received(t),!1;if(0===i.length)return n._changeConnectStatus(pS.Status.REGIFAIL),this.showValidationError(vh("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;n._addSysHandler(this.onRegistrationFields.bind(this),null,"iq",null,null);const o=bS({type:"get"}).c("query",{xmlns:pS.NS.REGISTER}).tree();return o.setAttribute("id",n.getUniqueId("sendIQ")),n.send(o),n.connected=!1,!0}onRegistrationFields(e){return"error"===e.getAttribute("type")?(va.connection._changeConnectStatus(pS.Status.REGIFAIL,vh('Something went wrong while establishing a connection with "%1$s". Are you sure it exists?',this.domain)),!1):1!==e.getElementsByTagName("query").length?(va.connection._changeConnectStatus(pS.Status.REGIFAIL,"unknown"),!1):(this.setFields(e),this.model.get("registration_status")===_S&&this.renderRegistrationForm(e),!1)}reset(e){const t={fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null};Object.assign(this,t),e&&Object.assign(this,ko(e,Object.keys(t)))}onFormSubmission(e){e&&e.preventDefault&&e.preventDefault(),null===e.target.querySelector("input[name=domain]")?this.submitRegistrationForm(e.target):this.onProviderChosen(e.target)}onProviderChosen(e){const t=e.querySelector("input[name=domain]"),n=null==t?void 0:t.value;n?(e.querySelector("input[type=submit]").classList.add("hidden"),this.fetchRegistrationForm(n.trim())):t.classList.add("error")}async fetchRegistrationForm(e){var t;return this.model.set("registration_status",_S),this.reset({domain:pS.getDomainFromJid(e),_registering:!0}),await va.initConnection(this.domain),null===(t=va.connection)||void 0===t||t.connect(this.domain,"",(e=>this.onConnectStatusChanged(e))),!1}giveFeedback(e,t){let n=this.querySelector(".reg-feedback");null!==n&&n.parentNode.removeChild(n);const s=this.querySelector("form");s.insertAdjacentHTML("afterbegin",'<span class="reg-feedback"></span>'),n=s.querySelector(".reg-feedback"),n.textContent=e,t&&n.classList.add(t)}showSpinner(){const e=this.querySelector("form");return tl(Iv(),e),this}onConnectStatusChanged(e){M.debug("converse-register: onConnectStatusChanged"),[pS.Status.DISCONNECTED,pS.Status.CONNFAIL,pS.Status.REGIFAIL,pS.Status.NOTACCEPTABLE,pS.Status.CONFLICT].includes(e)?(M.error(`Problem during registration: Strophe.Status is ${va.CONNECTION_STATUS[e]}`),this.abortRegistration()):e===pS.Status.REGISTERED&&(M.debug("Registered successfully."),va.connection.reset(),this.showSpinner(),["converse/login","converse/register"].includes(va.router.history.getFragment())&&va.router.navigate("",{replace:!0}),this.fields.password&&this.fields.username?(va.connection.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,va.onConnectStatusChanged),this.giveFeedback(vh("Now logging you in"),"info")):va.giveFeedback(vh("Registered successfully")),this.reset())}getLegacyFormFields(){return[...Object.keys(this.fields).map((e=>"username"===e?Cp({domain:` @${this.domain}`,name:e,type:"text",label:e,value:"",required:!0}):Ep({label:e,name:e,placeholder:e,required:!0,type:"password"===e||"email"===e?e:"text",value:""}))),...this.urls.map((e=>Ap({label:"",value:e})))]}getFormFields(e){return"xform"===this.form_type?Array.from(e.querySelectorAll("field")).map((t=>fu.xForm2TemplateResult(t,e,{domain:this.domain}))):this.getLegacyFormFields()}renderRegistrationForm(e){this.form_fields=this.getFormFields(e),this.model.set("registration_status",wS)}showValidationError(e){const t=this.querySelector("form");let n=t.querySelector(".form-errors");if(null===n){n='<div class="form-errors hidden"></div>';const e=t.querySelector("p.instructions");null===e?t.insertAdjacentHTML("afterbegin",n):e.insertAdjacentHTML("afterend",n),n=t.querySelector(".form-errors")}else n.innerHTML="";n.insertAdjacentHTML("beforeend",'<p class="form-help error">'+e+"</p>"),n.classList.remove("hidden")}reportErrors(e){const t=e.querySelectorAll("error");if(t.forEach((e=>this.showValidationError(e.textContent))),!t.length){const e=vh("The provider rejected your registration attempt. Please check the values you entered for correctness.");this.showValidationError(e)}}renderProviderChoiceForm(e){e&&e.preventDefault&&e.preventDefault(),va.connection._proto._abortAllRequests(),va.connection.reset(),this.render()}abortRegistration(){va.connection._proto._abortAllRequests(),va.connection.reset(),[_S,wS].includes(this.model.get("registration_status"))?Cl.settings.get("registration_domain")&&this.fetchRegistrationForm(Cl.settings.get("registration_domain")):this.render()}submitRegistrationForm(e){if(Array.from(this.querySelectorAll("input.required")).reduce(((e,t)=>""===t.value?(t.classList.add("error"),e+1):e),0))return;const t=vS(":input:not([type=button]):not([type=submit])",e),n=bS({type:"set",id:yS.getUniqueId()}).c("query",{xmlns:pS.NS.REGISTER});"xform"===this.form_type?(n.c("x",{xmlns:pS.NS.XFORM,type:"submit"}),t.map((e=>fu.webForm2xForm(e))).filter((e=>e)).forEach((e=>n.cnode(e).up()))):t.forEach((e=>n.c(e.getAttribute("name"),{},e.value))),va.connection._addSysHandler(this._onRegisterIQ.bind(this),null,"iq",null,null),va.connection.send(n),this.setFields(n.tree())}setFields(e){const t=e.querySelector("query"),n=vS(`x[xmlns="${pS.NS.XFORM}"]`,t);n.length>0?this._setFieldsFromXForm(n.pop()):this._setFieldsFromLegacy(t)}_setFieldsFromLegacy(e){[].forEach.call(e.children,(e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=pS.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(vS("url",e).map((e=>e.textContent))):this.instructions=pS.getText(e)})),this.form_type="legacy"}_setFieldsFromXForm(e){var t,n;this.title=null===(t=e.querySelector("title"))||void 0===t?void 0:t.textContent,this.instructions=null===(n=e.querySelector("instructions"))||void 0===n?void 0:n.textContent,e.querySelectorAll("field").forEach((e=>{const t=e.getAttribute("var");var n;t?this.fields[t.toLowerCase()]=(null===(n=e.querySelector("value"))||void 0===n?void 0:n.textContent)??"":M.warn("Found field we couldn't parse")})),this.form_type="xform"}_onRegisterIQ(e){if("error"===e.getAttribute("type")){M.error("Registration failed."),this.reportErrors(e);let t=e.getElementsByTagName("error");if(1!==t.length)return va.connection._changeConnectStatus(pS.Status.REGIFAIL,"unknown"),!1;t=t[0].firstElementChild.tagName.toLowerCase(),"conflict"===t?va.connection._changeConnectStatus(pS.Status.CONFLICT,t):"not-acceptable"===t?va.connection._changeConnectStatus(pS.Status.NOTACCEPTABLE,t):va.connection._changeConnectStatus(pS.Status.REGIFAIL,t)}else va.connection._changeConnectStatus(pS.Status.REGISTERED,null);return!1}});const{Strophe:SS}=jl.env;SS.addNamespace("REGISTER","jabber:iq:register");const xS=Object.keys(SS.Status).reduce(((e,t)=>Math.max(e,SS.Status[t])),0);SS.Status.REGIFAIL=xS+1,SS.Status.REGISTERED=xS+2,SS.Status.CONFLICT=xS+3,SS.Status.NOTACCEPTABLE=xS+5,jl.plugins.add("converse-register",{dependencies:["converse-controlbox"],enabled:()=>!0,initialize(){async function e(e){await Cl.waitUntil("controlBoxInitialized"),va.chatboxes.get("controlbox").set({"active-form":e})}va.CONNECTION_STATUS[SS.Status.REGIFAIL]="REGIFAIL",va.CONNECTION_STATUS[SS.Status.REGISTERED]="REGISTERED",va.CONNECTION_STATUS[SS.Status.CONFLICT]="CONFLICT",va.CONNECTION_STATUS[SS.Status.NOTACCEPTABLE]="NOTACCEPTABLE",Cl.settings.extend({allow_registration:!0,domain_placeholder:vh(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""}),va.router.route("converse/login",(()=>e("login"))),va.router.route("converse/register",(()=>e("register"))),Cl.listen.on("controlBoxInitialized",(e=>{e.model.on("change:active-form",e.showLoginOrRegisterForm,e)}))}});const ES=jl.env.utils,{Strophe:AS}=jl.env,CS=Kg.extend({persistent:!0,id:"add-chatroom-modal",events:{"submit form.add-chatroom":"openChatRoom","keyup .roomjid-input":"checkRoomidPolicy","change .roomjid-input":"checkRoomidPolicy"},initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:muc_domain",this.render),this.muc_roomid_policy_error_msg=null},toHTML(){let e="";if(!Cl.settings.get("locked_muc_domain")){const t=this.model.get("muc_domain")||Cl.settings.get("muc_domain");e=t?`name@${t}`:vh("name@conference.example.org")}return(e=>{const t=vh("Join"),n=vh("Enter a new Groupchat");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add-chatroom-modal-label">${n}</h5>
                    ${Qg}
                </div>
                <div class="modal-body">
                    <span class="modal-alert"></span>
                    <form class="converse-form add-chatroom">
                        <div class="form-group">
                            <label for="chatroom">${e.label_room_address}:</label>
                            ${e.muc_roomid_policy_error_msg?Qc`<label class="roomid-policy-error">${e.muc_roomid_policy_error_msg}</label>`:""}
                            <input type="text" required="required" name="chatroom" class="form-control roomjid-input" placeholder="${e.chatroom_placeholder}"/>
                        </div>
                        ${e.muc_roomid_policy_hint?Qc`<div class="form-group">${Gv(No().sanitize(e.muc_roomid_policy_hint,{ALLOWED_TAGS:["b","br","em"]}))}</div>`:""}
                        ${e._converse.locked_muc_nickname?"":(e=>{const t=vh("Nickname"),n=vh("This field is required");return Qc`
        <div class="form-group" >
            <label for="nickname">${t}:</label>
            <input type="text" title="${n}" required="required" name="nickname" value="${e.nick||""}" class="form-control"/>
        </div>
    `})(e)}
                        <input type="submit" class="btn btn-primary" name="join" value="${t||""}" ?disabled=${e.muc_roomid_policy_error_msg}>
                    </form>
                </div>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),{_converse:va,label_room_address:Cl.settings.get("muc_domain")?vh("Groupchat name"):vh("Groupchat address"),chatroom_placeholder:e,muc_roomid_policy_error_msg:this.muc_roomid_policy_error_msg,muc_roomid_policy_hint:Cl.settings.get("muc_roomid_policy_hint")}))},afterRender(){this.el.addEventListener("shown.bs.modal",(()=>{this.el.querySelector('input[name="chatroom"]').focus()}),!1)},parseRoomDataFromEvent(e){const t=new FormData(e),n=t.get("chatroom");let s;if(Cl.settings.get("locked_muc_nickname")){if(s=va.getDefaultMUCNickname(),!s)throw new Error("Using locked_muc_nickname but no nickname found!")}else s=t.get("nickname").trim();return{jid:n,nick:s}},openChatRoom(e){e.preventDefault();const t=this.parseRoomDataFromEvent(e.target);let n;""===t.nick&&(t.nick=void 0),Cl.settings.get("locked_muc_domain")||Cl.settings.get("muc_domain")&&!ES.isValidJID(t.jid)?n=`${AS.escapeNode(t.jid)}@${Cl.settings.get("muc_domain")}`:(n=t.jid,this.model.setDomain(n)),Cl.rooms.open(n,Object.assign(t,{jid:n}),!0),this.modal.hide(),e.target.reset()},checkRoomidPolicy(){if(Cl.settings.get("muc_roomid_policy")&&Cl.settings.get("muc_domain")){let e=this.el.querySelector(".roomjid-input").value;!jl.locked_muc_domain&&ES.isValidJID(e)||(e=`${AS.escapeNode(e)}@${Cl.settings.get("muc_domain")}`);const t=AS.getNodeFromJid(e),n=AS.getDomainFromJid(e);Cl.settings.get("muc_domain")!==n||Cl.settings.get("muc_roomid_policy").test(t)?this.muc_roomid_policy_error_msg=null:this.muc_roomid_policy_error_msg=vh("Groupchat id is invalid."),this.render()}}}),TS=function(e){return e&&e.length?e[0]:void 0},{Strophe:kS,$iq:jS,sizzle:NS}=jl.env,OS=jl.env.utils;const $S=Kg.extend({id:"muc-list-modal",persistent:!0,initialize(){this.items=[],this.loading_items=!1,Kg.prototype.initialize.apply(this,arguments),Cl.settings.get("muc_domain")&&!this.model.get("muc_domain")&&this.model.save("muc_domain",Cl.settings.get("muc_domain")),this.listenTo(this.model,"change:muc_domain",this.onDomainChange),this.el.addEventListener("shown.bs.modal",(()=>Cl.settings.get("locked_muc_domain")?this.updateRoomsList():this.el.querySelector('input[name="server"]').focus()))},toHTML(){const e=this.model.get("muc_domain")||Cl.settings.get("muc_domain");return(e=>{const t=vh("Query for Groupchats");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="muc-list-modal-label">${t}</h5>
                    ${Qg}
                </div>
                <div class="modal-body d-flex flex-column">
                    <span class="modal-alert"></span>
                    ${e.show_form?(e=>{const t=vh("Show groupchats"),n=vh("Server address");return Qc`
        <form class="converse-form list-chatrooms"
            @submit=${e.submitForm}>
            <div class="form-group">
                <label for="chatroom">${n}:</label>
                <input type="text"
                    @change=${e.setDomainFromEvent}
                    value="${e.muc_domain||""}"
                    required="required"
                    name="server"
                    class="form-control"
                    placeholder="${e.server_placeholder}"/>
            </div>
            <input type="submit" class="btn btn-primary" name="list" value="${t}"/>
        </form>
    `})(e):""}
                    <ul class="available-chatrooms list-group">
                        ${e.loading_items?Qc`<li class="list-group-item"> ${Iv()} </li>`:""}
                        ${e.feedback_text?Qc`<li class="list-group-item active">${e.feedback_text}</li>`:""}
                        ${jg(e.items,(e=>e.jid),(t=>((e,t)=>{const n=vh("Show more information on this groupchat"),s=vh("Click to open this groupchat");return Qc`
        <li class="room-item list-group-item">
            <div class="available-chatroom d-flex flex-row">
                <a class="open-room available-room w-100"
                @click=${e.openRoom}
                data-room-jid="${t.jid}"
                data-room-name="${t.name}"
                title="${s}"
                href="#">${t.name||t.jid}</a>
                <a class="right room-info icon-room-info"
                @click=${e.toggleRoomInfo}
                data-room-jid="${t.jid}"
                title="${n}"
                href="#"></a>
            </div>
        </li>
    `})(e,t)))}
                    </ul>
                </div>
                <div class="modal-footer">${Yg}</div>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),{show_form:!Cl.settings.get("locked_muc_domain"),server_placeholder:e||vh("conference.example.org"),items:this.items,loading_items:this.loading_items,openRoom:e=>this.openRoom(e),setDomainFromEvent:e=>this.setDomainFromEvent(e),submitForm:e=>this.showRooms(e),toggleRoomInfo:e=>this.toggleRoomInfo(e)}))},openRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid"),n=e.target.getAttribute("data-room-name");this.modal.hide(),Cl.rooms.open(t,{name:n},!0)},toggleRoomInfo(e){e.preventDefault(),function(e){const t=OS.ancestor(e.target,".room-item"),n=t.querySelector("div.room-info");n?(OS.slideIn(n).then(OS.removeElement),t.querySelector("a.room-info").classList.remove("selected")):(t.insertAdjacentElement("beforeend",OS.getElementFromTemplateResult(Iv())),Cl.disco.info(e.target.getAttribute("data-room-jid"),null).then((e=>function(e,t){var n,s;e.querySelector("span.spinner").remove(),e.querySelector("a.room-info").classList.add("selected"),e.insertAdjacentHTML("beforeEnd",OS.getElementFromTemplateResult((e=>{const t=vh("Description:"),n=vh("Groupchat XMPP Address:"),s=vh("Participants:"),i=vh("Features:"),r=vh("Requires authentication"),o=vh("Hidden"),a=vh("Requires an invitation"),c=vh("Moderated"),l=vh("Non-anonymous"),d=vh("Open"),u=vh("Permanent"),h=vh("Public"),m=vh("Semi-anonymous"),f=vh("Temporary"),g=vh("Unmoderated");return Qc`
    <div class="room-info">
        <p class="room-info"><strong>${n}</strong> ${e.jid}</p>
        <p class="room-info"><strong>${t}</strong> ${e.desc}</p>
        <p class="room-info"><strong>${s}</strong> ${e.occ}</p>
        <p class="room-info"><strong>${i}</strong>
            <ul>
                ${e.passwordprotected?Qc`<li class="room-info locked">${r}</li>`:""}
                ${e.hidden?Qc`<li class="room-info">${o}</li>`:""}
                ${e.membersonly?Qc`<li class="room-info">${a}</li>`:""}
                ${e.moderated?Qc`<li class="room-info">${c}</li>`:""}
                ${e.nonanonymous?Qc`<li class="room-info">${l}</li>`:""}
                ${e.open?Qc`<li class="room-info">${d}</li>`:""}
                ${e.persistent?Qc`<li class="room-info">${u}</li>`:""}
                ${e.publicroom?Qc`<li class="room-info">${h}</li>`:""}
                ${e.semianonymous?Qc`<li class="room-info">${m}</li>`:""}
                ${e.temporary?Qc`<li class="room-info">${f}</li>`:""}
                ${e.unmoderated?Qc`<li class="room-info">${g}</li>`:""}
            </ul>
        </p>
    </div>
`})({jid:t.getAttribute("from"),desc:null===(n=TS(NS('field[var="muc#roominfo_description"] value',t)))||void 0===n?void 0:n.textContent,occ:null===(s=TS(NS('field[var="muc#roominfo_occupants"] value',t)))||void 0===s?void 0:s.textContent,hidden:NS('feature[var="muc_hidden"]',t).length,membersonly:NS('feature[var="muc_membersonly"]',t).length,moderated:NS('feature[var="muc_moderated"]',t).length,nonanonymous:NS('feature[var="muc_nonanonymous"]',t).length,open:NS('feature[var="muc_open"]',t).length,passwordprotected:NS('feature[var="muc_passwordprotected"]',t).length,persistent:NS('feature[var="muc_persistent"]',t).length,publicroom:NS('feature[var="muc_publicroom"]',t).length,semianonymous:NS('feature[var="muc_semianonymous"]',t).length,temporary:NS('feature[var="muc_temporary"]',t).length,unmoderated:NS('feature[var="muc_unmoderated"]',t).length})))}(t,e))).catch((e=>M.error(e))))}(e)},onDomainChange(){Cl.settings.get("auto_list_rooms")&&this.updateRoomsList()},onRoomsFound(e){this.loading_items=!1;const t=e?NS("query item",e):[];return t.length?(this.model.set({feedback_text:vh("Groupchats found")},{silent:!0}),this.items=t.map(dd)):(this.items=[],this.model.set({feedback_text:vh("No groupchats found")},{silent:!0})),this.render(),!0},updateRoomsList(){const e=jS({to:this.model.get("muc_domain"),from:va.connection.jid,type:"get"}).c("query",{xmlns:kS.NS.DISCO_ITEMS});Cl.sendIQ(e).then((e=>this.onRoomsFound(e))).catch((()=>this.onRoomsFound()))},showRooms(e){e.preventDefault(),this.loading_items=!0,this.render();const t=new FormData(e.target);this.model.setDomain(t.get("server")),this.updateRoomsList()},setDomainFromEvent(e){this.model.setDomain(e.target.value)},setNick(e){this.model.save({nick:e.target.value})}}),{Strophe:IS}=jl.env,MS=Zo.extend({defaults:function(){return{muc_domain:Cl.settings.get("muc_domain"),nick:va.getDefaultMUCNickname(),"toggle-state":va.OPENED}},setDomain(e){Cl.settings.get("locked_muc_domain")||this.save("muc_domain",IS.getDomainFromJid(e))}}),{Strophe:RS,u:DS}=jl.env;function LS(){if(!Cl.settings.get("auto_insert"))return;const e=Cl.settings.get("root");if(!e.querySelector("converse-root#conversejs")){const t=document.createElement("converse-root"),n=e.querySelector("body");n?n.appendChild(t):e.appendChild(t)}}Cl.elements.define("converse-rooms-list",class extends mg{initialize(){const e=`converse.roomspanel${va.bare_jid}`;this.model=new MS({id:e}),_o(this.model,e),this.model.fetch(),this.listenTo(va.chatboxes,"add",this.renderIfChatRoom),this.listenTo(va.chatboxes,"remove",this.renderIfChatRoom),this.listenTo(va.chatboxes,"destroy",this.renderIfChatRoom),this.listenTo(va.chatboxes,"change",this.renderIfRelevantChange),this.render()}renderIfChatRoom(e){DS.isChatRoom(e)&&this.render()}renderIfRelevantChange(e){const t=["bookmarked","hidden","name","num_unread","num_unread_general","has_activity"],n=e.changed||{};DS.isChatRoom(e)&&Object.keys(n).filter((e=>t.includes(e))).length&&this.render()}render(){tl((e=>{const t=vh("Click to toggle the list of open groupchats"),n=vh("Groupchats"),s=vh("Query for groupchats"),i=vh("Add a new groupchat");return Qc`
        <div class="d-flex controlbox-padded">
            <span class="w-100 controlbox-heading controlbox-heading--groupchats">${n}</span>
            <a class="controlbox-heading__btn show-list-muc-modal"
                @click=${t=>Cl.modal.show($S,{model:e.model},t)}
                title="${s}" data-toggle="modal" data-target="#muc-list-modal">
                    <converse-icon class="fa fa-list-ul right" color="var(--subdued-color)" path-prefix="/dist" size="1em"></converse-icon>
            </a>
            <a class="controlbox-heading__btn show-add-muc-modal"
                @click=${t=>Cl.modal.show(CS,{model:e.model},t)}
                title="${i}" data-toggle="modal" data-target="#add-chatrooms-modal">
                    <converse-icon class="fa fa-plus right" color="var(--subdued-color)" path-prefix="/dist" size="1em"></converse-icon>
            </a>
        </div>

        <div class="list-container list-container--openrooms ${e.rooms.length?"":"hidden"}">
            <a class="list-toggle open-rooms-toggle controlbox-padded" title="${t}" @click=${e.toggleRoomsList}>
            <span class="fa ${e.toggle_state===va.OPENED?"fa-caret-down":"fa-caret-right"}"></span> ${vh("Open Groupchats")}</a>
            <div class="items-list rooms-list open-rooms-list ${e.collapsed&&"collapsed"}">
                ${e.rooms.map((t=>(e=>{const t=vh("Leave this groupchat"),n=e.room.get("num_unread_general")||e.room.get("has_activity");return Qc`
        <div class="list-item controlbox-padded available-chatroom d-flex flex-row ${e.currently_open(e.room)?"open":""} ${n?"unread-msgs":""}"
            data-room-jid="${e.room.get("jid")}">

            ${e.room.get("num_unread")?(e=>Qc`<span class="list-item-badge badge badge--muc msgs-indicator">${e.room.get("num_unread")}</span>`)(e):e.room.get("has_activity")?Qc`<span class="list-item-badge badge badge--muc msgs-indicator"></span>`:""}

            <a class="list-item-link open-room available-room w-100"
                data-room-jid="${e.room.get("jid")}"
                title="${vh("Click to open this groupchat")}"
                @click=${e.openRoom}>${e.room.getDisplayName()}</a>

            ${e.allow_bookmarks?(e=>{const t=vh("Bookmark this groupchat"),n=vh("Unbookmark this groupchat");return e.bookmarked?Qc`
            <a class="list-item-action fa fa-bookmark remove-bookmark button-on"
               data-room-jid="${e.room.get("jid")}"
               data-bookmark-name="${e.room.getDisplayName()}"
               @click=${e.removeBookmark}
               title="${e.bookmarked?n:t}"></a>`:Qc`
            <a class="list-item-action fa fa-bookmark add-bookmark"
               data-room-jid="${e.room.get("jid")}"
               data-bookmark-name="${e.room.getDisplayName()}"
               @click=${e.addBookmark}
               title="${e.bookmarked?n:t}"></a>`})(e):""}

            <a class="list-item-action room-info fa fa-info-circle"
                data-room-jid="${e.room.get("jid")}"
                title="${vh("Show more information on this groupchat")}"
                @click=${e.showRoomDetailsModal}></a>

            <a class="list-item-action fa fa-sign-out-alt close-room"
                data-room-jid="${e.room.get("jid")}"
                data-room-name="${e.room.getDisplayName()}"
                title="${t}"
                @click=${e.closeRoom}></a>
        </div>`})(Object.assign({room:t},e))))}
            </div>
        </div>`})({addBookmark:e=>this.addBookmark(e),allow_bookmarks:va.allow_bookmarks&&va.bookmarks,closeRoom:e=>this.closeRoom(e),collapsed:this.model.get("toggle-state")!==va.OPENED,currently_open:e=>va.isUniView()&&!e.get("hidden"),model:this.model,openRoom:e=>this.openRoom(e),removeBookmark:e=>this.removeBookmark(e),rooms:va.chatboxes.filter((e=>e.get("type")===va.CHATROOMS_TYPE)),showRoomDetailsModal:e=>this.showRoomDetailsModal(e),toggleRoomsList:e=>this.toggleRoomsList(e),toggle_state:this.model.get("toggle-state")}),this)}showRoomDetailsModal(e){const t=e.target.getAttribute("data-room-jid"),n=va.chatboxes.get(t);e.preventDefault(),Cl.modal.show(w_,{model:n},e)}async openRoom(e){e.preventDefault();const t=e.target.textContent,n=e.target.getAttribute("data-room-jid"),s={name:t||RS.unescapeNode(RS.getNodeFromJid(n))||n};await Cl.rooms.open(n,s,!0)}async closeRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-name");if(confirm(vh("Are you sure you want to leave the groupchat %1$s?",t))){const t=e.target.getAttribute("data-room-jid");(await Cl.rooms.get(t)).close()}}removeBookmark(e){va.removeBookmarkViaEvent(e)}addBookmark(e){va.addBookmarkViaEvent(e)}toggleRoomsList(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e);const n=e.target.matches(".fa")?e.target:e.target.querySelector(".fa");n.classList.contains("fa-caret-down")?DS.slideIn(this.querySelector(".open-rooms-list")).then((()=>{this.model.save({"toggle-state":va.CLOSED}),n.classList.remove("fa-caret-down"),n.classList.add("fa-caret-right")})):DS.slideOut(this.querySelector(".open-rooms-list")).then((()=>{this.model.save({"toggle-state":va.OPENED}),n.classList.remove("fa-caret-right"),n.classList.add("fa-caret-down")}))}}),jl.plugins.add("converse-roomslist",{dependencies:["converse-singleton","converse-controlbox","converse-muc","converse-bookmarks"],initialize(){Cl.listen.on("connected",(async()=>{va.allow_bookmarks?await Cl.waitUntil("bookmarksInitialized"):await Promise.all([Cl.waitUntil("chatBoxesFetched")])}))}}),window.customElements.define("converse-fontawesome",class extends Uf{render(){return Qc`
    <?xml version="1.0" encoding="UTF-8"?>
    <!--
    Font Awesome Free 5.13.0 by @fontawesome - https://fontawesome.com
    License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
    -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="icon-address-book" viewBox="0 0 448 512">
        <path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path>
    </symbol>
    <symbol id="icon-angle-double-down" viewBox="0 0 320 512">
        <path d="M143 256.3L7 120.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0L313 86.3c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.4 9.5-24.6 9.5-34 .1zm34 192l136-136c9.4-9.4 9.4-24.6 0-33.9l-22.6-22.6c-9.4-9.4-24.6-9.4-33.9 0L160 352.1l-96.4-96.4c-9.4-9.4-24.6-9.4-33.9 0L7 278.3c-9.4 9.4-9.4 24.6 0 33.9l136 136c9.4 9.5 24.6 9.5 34 .1z"></path>
    </symbol>
    <symbol id="icon-angle-double-left" viewBox="0 0 448 512">
        <path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"></path>
    </symbol>
    <symbol id="icon-angle-double-right" viewBox="0 0 448 512">
        <path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"></path>
    </symbol>
    <symbol id="icon-angle-double-up" viewBox="0 0 320 512">
        <path d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"></path>
    </symbol>
    <symbol id="icon-angle-down" viewBox="0 0 320 512">
        <path d="M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"></path>
    </symbol>
    <symbol id="icon-angle-left" viewBox="0 0 256 512">
        <path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path>
    </symbol>
    <symbol id="icon-angle-right" viewBox="0 0 256 512">
        <path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path>
    </symbol>
    <symbol id="icon-angle-up" viewBox="0 0 320 512">
        <path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"></path>
    </symbol>
    <symbol id="icon-arrow-alt-circle-down" viewBox="0 0 512 512">
        <path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z"></path>
    </symbol>
    <symbol id="icon-arrow-alt-circle-left" viewBox="0 0 512 512">
        <path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path>
    </symbol>
    <symbol id="icon-arrow-alt-circle-right" viewBox="0 0 512 512">
        <path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path>
    </symbol>
    <symbol id="icon-arrow-alt-circle-up" viewBox="0 0 512 512">
        <path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"></path>
    </symbol>
    <symbol id="icon-arrow-circle-down" viewBox="0 0 512 512">
        <path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-143.6-28.9L288 302.6V120c0-13.3-10.7-24-24-24h-16c-13.3 0-24 10.7-24 24v182.6l-72.4-75.5c-9.3-9.7-24.8-9.9-34.3-.4l-10.9 11c-9.4 9.4-9.4 24.6 0 33.9L239 404.3c9.4 9.4 24.6 9.4 33.9 0l132.7-132.7c9.4-9.4 9.4-24.6 0-33.9l-10.9-11c-9.5-9.5-25-9.3-34.3.4z"></path>
    </symbol>
    <symbol id="icon-arrow-circle-left" viewBox="0 0 512 512">
        <path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3z"></path>
    </symbol>
    <symbol id="icon-arrow-circle-right" viewBox="0 0 512 512">
        <path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path>
    </symbol>
    <symbol id="icon-arrow-circle-up" viewBox="0 0 512 512">
        <path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm143.6 28.9l72.4-75.5V392c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V209.4l72.4 75.5c9.3 9.7 24.8 9.9 34.3.4l10.9-11c9.4-9.4 9.4-24.6 0-33.9L273 107.7c-9.4-9.4-24.6-9.4-33.9 0L106.3 240.4c-9.4 9.4-9.4 24.6 0 33.9l10.9 11c9.6 9.5 25.1 9.3 34.4-.4z"></path>
    </symbol>
    <symbol id="icon-arrow-down" viewBox="0 0 448 512">
        <path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path>
    </symbol>
    <symbol id="icon-arrow-left" viewBox="0 0 448 512">
        <path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path>
    </symbol>
    <symbol id="icon-arrow-right" viewBox="0 0 448 512">
        <path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path>
    </symbol>
    <symbol id="icon-arrow-up" viewBox="0 0 448 512">
        <path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path>
    </symbol>
    <symbol id="icon-arrows-alt" viewBox="0 0 512 512">
        <path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path>
    </symbol>
    <symbol id="icon-arrows-alt-h" viewBox="0 0 512 512">
        <path d="M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"></path>
    </symbol>
    <symbol id="icon-arrows-alt-v" viewBox="0 0 256 512">
        <path d="M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"></path>
    </symbol>
    <symbol id="icon-bars" viewBox="0 0 448 512">
        <path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path>
    </symbol>
    <symbol id="icon-bookmark" viewBox="0 0 384 512">
        <path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"></path>
    </symbol>
    <symbol id="icon-caret-down" viewBox="0 0 320 512">
        <path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path>
    </symbol>
    <symbol id="icon-caret-right" viewBox="0 0 192 512">
        <path d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path>
    </symbol>
    <symbol id="icon-check" viewBox="0 0 512 512">
        <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path>
    </symbol>
    <symbol id="icon-circle" viewBox="0 0 512 512">
        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path>
    </symbol>
    <symbol id="icon-cog" viewBox="0 0 512 512">
        <path d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path>
    </symbol>
    <symbol id="icon-database" viewBox="0 0 448 512">
        <path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path>
    </symbol>
    <symbol id="icon-edit" viewBox="0 0 576 512">
        <path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path>
    </symbol>
    <symbol id="icon-eye" viewBox="0 0 576 512">
        <path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path>
    </symbol>
    <symbol id="icon-eye-slash" viewBox="0 0 640 512">
        <path d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path>
    </symbol>
    <symbol id="icon-gavel" viewBox="0 0 512 512">
        <path d="M504.971 199.362l-22.627-22.627c-9.373-9.373-24.569-9.373-33.941 0l-5.657 5.657L329.608 69.255l5.657-5.657c9.373-9.373 9.373-24.569 0-33.941L312.638 7.029c-9.373-9.373-24.569-9.373-33.941 0L154.246 131.48c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l5.657-5.657 39.598 39.598-81.04 81.04-5.657-5.657c-12.497-12.497-32.758-12.497-45.255 0L9.373 412.118c-12.497 12.497-12.497 32.758 0 45.255l45.255 45.255c12.497 12.497 32.758 12.497 45.255 0l114.745-114.745c12.497-12.497 12.497-32.758 0-45.255l-5.657-5.657 81.04-81.04 39.598 39.598-5.657 5.657c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l124.451-124.451c9.372-9.372 9.372-24.568 0-33.941z"></path>
    </symbol>
    <symbol id="icon-globe" viewBox="0 0 496 512">
        <path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path>
    </symbol>
    <symbol id="icon-id-card" viewBox="0 0 576 512">
        <path d="M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"></path>
    </symbol>
    <symbol id="icon-id-card-alt" viewBox="0 0 576 512">
        <path d="M528 64H384v96H192V64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM288 224c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm93.3 224H194.7c-10.4 0-18.8-10-15.6-19.8 8.3-25.6 32.4-44.2 60.9-44.2h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.8-5.2 19.8-15.6 19.8zM352 32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96h128V32z"></path>
    </symbol>
    <symbol id="icon-info" viewBox="0 0 192 512">
        <path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path>
    </symbol>
    <symbol id="icon-info-circle" viewBox="0 0 512 512">
        <path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path>
    </symbol>
    <symbol id="icon-list-ul" viewBox="0 0 512 512">
        <path d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path>
    </symbol>
    <symbol id="icon-lock" viewBox="0 0 448 512">
        <path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path>
    </symbol>
    <symbol id="icon-lock-open" viewBox="0 0 576 512">
        <path d="M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"></path>
    </symbol>
    <symbol id="icon-minus" viewBox="0 0 448 512">
        <path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path>
    </symbol>
    <symbol id="icon-minus-circle" viewBox="0 0 512 512">
        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"></path>
    </symbol>
    <symbol id="icon-minus-square" viewBox="0 0 448 512">
        <path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"></path>
    </symbol>
    <symbol id="icon-paper-plane" viewBox="0 0 512 512">
        <path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"></path>
    </symbol>
    <symbol id="icon-paperclip" viewBox="0 0 448 512">
        <path d="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"></path>
    </symbol>
    <symbol id="icon-pencil-alt" viewBox="0 0 512 512">
        <path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path>
    </symbol>
    <symbol id="icon-phone" viewBox="0 0 512 512">
        <path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"></path>
    </symbol>
    <symbol id="icon-plus" viewBox="0 0 448 512">
        <path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path>
    </symbol>
    <symbol id="icon-plus-circle" viewBox="0 0 512 512">
        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path>
    </symbol>
    <symbol id="icon-plus-square" viewBox="0 0 448 512">
        <path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path>
    </symbol>
    <symbol id="icon-save" viewBox="0 0 448 512">
        <path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path>
    </symbol>
    <symbol id="icon-sign-out-alt" viewBox="0 0 512 512">
        <path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path>
    </symbol>
    <symbol id="icon-smile" viewBox="0 0 496 512">
        <path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"></path>
    </symbol>
    <symbol id="icon-snowflake" viewBox="0 0 448 512">
        <path d="M440.3 345.2l-33.8-19.5 26-7c8.2-2.2 13.1-10.7 10.9-18.9l-4-14.9c-2.2-8.2-10.7-13.1-18.9-10.9l-70.8 19-63.9-37 63.8-36.9 70.8 19c8.2 2.2 16.7-2.7 18.9-10.9l4-14.9c2.2-8.2-2.7-16.7-10.9-18.9l-26-7 33.8-19.5c7.4-4.3 9.9-13.7 5.7-21.1L430.4 119c-4.3-7.4-13.7-9.9-21.1-5.7l-33.8 19.5 7-26c2.2-8.2-2.7-16.7-10.9-18.9l-14.9-4c-8.2-2.2-16.7 2.7-18.9 10.9l-19 70.8-62.8 36.2v-77.5l53.7-53.7c6.2-6.2 6.2-16.4 0-22.6l-11.3-11.3c-6.2-6.2-16.4-6.2-22.6 0L256 56.4V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v40.4l-19.7-19.7c-6.2-6.2-16.4-6.2-22.6 0L138.3 48c-6.3 6.2-6.3 16.4 0 22.6l53.7 53.7v77.5l-62.8-36.2-19-70.8c-2.2-8.2-10.7-13.1-18.9-10.9l-14.9 4c-8.2 2.2-13.1 10.7-10.9 18.9l7 26-33.8-19.5c-7.4-4.3-16.8-1.7-21.1 5.7L2.1 145.7c-4.3 7.4-1.7 16.8 5.7 21.1l33.8 19.5-26 7c-8.3 2.2-13.2 10.7-11 19l4 14.9c2.2 8.2 10.7 13.1 18.9 10.9l70.8-19 63.8 36.9-63.8 36.9-70.8-19c-8.2-2.2-16.7 2.7-18.9 10.9l-4 14.9c-2.2 8.2 2.7 16.7 10.9 18.9l26 7-33.8 19.6c-7.4 4.3-9.9 13.7-5.7 21.1l15.5 26.8c4.3 7.4 13.7 9.9 21.1 5.7l33.8-19.5-7 26c-2.2 8.2 2.7 16.7 10.9 18.9l14.9 4c8.2 2.2 16.7-2.7 18.9-10.9l19-70.8 62.8-36.2v77.5l-53.7 53.7c-6.3 6.2-6.3 16.4 0 22.6l11.3 11.3c6.2 6.2 16.4 6.2 22.6 0l19.7-19.7V496c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-40.4l19.7 19.7c6.2 6.2 16.4 6.2 22.6 0l11.3-11.3c6.2-6.2 6.2-16.4 0-22.6L256 387.7v-77.5l62.8 36.2 19 70.8c2.2 8.2 10.7 13.1 18.9 10.9l14.9-4c8.2-2.2 13.1-10.7 10.9-18.9l-7-26 33.8 19.5c7.4 4.3 16.8 1.7 21.1-5.7l15.5-26.8c4.3-7.3 1.8-16.8-5.6-21z"></path>
    </symbol>
    <symbol id="icon-spinner" viewBox="0 0 512 512">
        <path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"></path>
    </symbol>
    <symbol id="icon-sync" viewBox="0 0 512 512">
        <path d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path>
    </symbol>
    <symbol id="icon-times" viewBox="0 0 352 512">
        <path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path>
    </symbol>
    <symbol id="icon-times-circle" viewBox="0 0 512 512">
        <path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path>
    </symbol>
    <symbol id="icon-trash" viewBox="0 0 448 512">
        <path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path>
    </symbol>
    <symbol id="icon-trash-alt" viewBox="0 0 448 512">
        <path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path>
    </symbol>
    <symbol id="icon-unlock" viewBox="0 0 448 512">
        <path d="M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path>
    </symbol>
    <symbol id="icon-user" viewBox="0 0 448 512">
        <path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path>
    </symbol>
    <symbol id="icon-user-cog" viewBox="0 0 640 512">
        <path d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z"></path>
    </symbol>
    <symbol id="icon-user-plus" viewBox="0 0 640 512">
        <path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path>
    </symbol>
    <symbol id="icon-user-secret" viewBox="0 0 448 512">
        <path d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path>
    </symbol>
    <symbol id="icon-users" viewBox="0 0 640 512">
        <path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path>
    </symbol>
    <symbol id="icon-wrench" viewBox="0 0 512 512">
        <path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path>
    </symbol>
    </svg>
`}}),customElements.define("converse-root",class extends Uf{render(){return(()=>{let e=Cl.settings.get("singleton")?"converse-singleton":"";return e+=`converse-${Cl.settings.get("view_mode")}`,Qc`
        <converse-chats class="converse-chatboxes row no-gutters ${e}"></converse-chats>
        <div id="converse-modals" class="modals"></div>
        <converse-fontawesome></converse-fontawesome>
    `})()}connectedCallback(){super.connectedCallback(),this.classList.add("conversejs"),this.classList.add(`converse-${Cl.settings.get("view_mode")}`),this.classList.add(`theme-${Cl.settings.get("theme")}`),this.setAttribute("id","conversejs")}}),jl.plugins.add("converse-rootview",{initialize(){Cl.settings.extend({auto_insert:!0}),Cl.listen.on("chatBoxesInitialized",LS)}});const{Strophe:zS}=jl.env,PS=jl.env.utils,FS=Kg.extend({id:"add-contact-modal",events:{"submit form":"addContactFromForm"},initialize(){Kg.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change",this.render)},toHTML(){const e=Cl.settings.get("xhr_user_search_url")?vh("Contact name"):vh("Optional nickname");return(e=>{const t=vh("name@example.org"),n=vh("Add"),s=vh("Please enter a valid XMPP address"),i=vh("Add a Contact"),r=vh("XMPP Address"),o=vh("Nickname");return Qc`
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addContactModalLabel">${i}</h5>
                    ${Qg}
                </div>
                <form class="converse-form add-xmpp-contact">
                    <div class="modal-body">
                        <span class="modal-alert"></span>
                        <div class="form-group add-xmpp-contact__jid">
                            <label class="clearfix" for="jid">${r}:</label>
                            <div class="suggestion-box suggestion-box__jid">
                                <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>
                                <input type="text" name="jid" ?required=${!e._converse.xhr_user_search_url}
                                    value="${e.jid||""}"
                                    class="form-control suggestion-box__input"
                                    placeholder="${t}"/>
                                <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>
                            </div>
                        </div>
                        <div class="form-group add-xmpp-contact__name">
                            <label class="clearfix" for="name">${o}:</label>
                            <div class="suggestion-box suggestion-box__name">
                                <ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul>
                                <input type="text" name="name" value="${e.nickname||""}"
                                    class="form-control suggestion-box__input"
                                    placeholder="${o}"/>
                                <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="invalid-feedback">${s}</div>
                        </div>
                        <button type="submit" class="btn btn-primary">${n}</button>
                    </div>
                </form>
            </div>
        </div>
    `})(Object.assign(this.model.toJSON(),{_converse:va,label_nickname:e}))},afterRender(){"string"==typeof Cl.settings.get("xhr_user_search_url")?this.initXHRAutoComplete():this.initJIDAutoComplete();const e=this.el.querySelector('input[name="jid"]');this.el.addEventListener("shown.bs.modal",(()=>e.focus()),!1)},initJIDAutoComplete(){if(!Cl.settings.get("autocomplete_add_contact"))return;const e=this.el.querySelector(".suggestion-box__jid").parentElement;this.jid_auto_complete=new va.AutoComplete(e,{data:(e,t)=>`${t.slice(0,t.indexOf("@"))}@${e}`,filter:va.FILTER_STARTSWITH,list:[...new Set(va.roster.map((e=>zS.getDomainFromJid(e.get("jid")))))]})},initXHRAutoComplete(){if(!Cl.settings.get("autocomplete_add_contact"))return this.initXHRFetch();const e=this.el.querySelector(".suggestion-box__name").parentElement;this.name_auto_complete=new va.AutoComplete(e,{auto_evaluate:!1,filter:va.FILTER_STARTSWITH,list:[]});const t=new window.XMLHttpRequest;t.onload=()=>{if(t.responseText){const e=t.responseText;this.name_auto_complete.list=JSON.parse(e).map((e=>({label:e.fullname||e.jid,value:e.jid}))),this.name_auto_complete.auto_completing=!0,this.name_auto_complete.evaluate()}};const n=this.el.querySelector('input[name="name"]');n.addEventListener("input",hc((()=>{t.open("GET",`${Cl.settings.get("xhr_user_search_url")}q=${encodeURIComponent(n.value)}`,!0),t.send()}),300)),this.name_auto_complete.on("suggestion-box-selectcomplete",(e=>{this.el.querySelector('input[name="name"]').value=e.text.label,this.el.querySelector('input[name="jid"]').value=e.text.value}))},initXHRFetch(){this.xhr=new window.XMLHttpRequest,this.xhr.onload=()=>{if(this.xhr.responseText){const e=this.xhr.responseText,t=JSON.parse(e).map((e=>({label:e.fullname||e.jid,value:e.jid})));if(1!==t.length){const e=this.el.querySelector(".invalid-feedback");return e.textContent=vh("Sorry, could not find a contact with that name"),void PS.addClass("d-block",e)}const n=t[0].value;if(this.validateSubmission(n)){const e=this.el.querySelector("form"),s=t[0].label;this.afterSubmission(e,n,s)}}}},validateSubmission(e){const t=this.el.querySelector(".invalid-feedback");return!e||Oo(e.split("@")).length<2?(PS.addClass("is-invalid",this.el.querySelector('input[name="jid"]')),PS.addClass("d-block",t),!1):va.roster.get(zS.getBareJidFromJid(e))?(t.textContent=vh("This contact has already been added"),PS.addClass("d-block",t),!1):(PS.removeClass("d-block",t),!0)},afterSubmission(e,t,n){va.roster.addAndSubscribe(t,n),this.model.clear(),this.modal.hide()},addContactFromForm(e){e.preventDefault();const t=new FormData(e.target),n=(t.get("jid")||"").trim();if(!n&&"string"==typeof Cl.settings.get("xhr_user_search_url")){const e=this.el.querySelector('input[name="name"]');return this.xhr.open("GET",`${Cl.settings.get("xhr_user_search_url")}q=${encodeURIComponent(e.value)}`,!0),void this.xhr.send()}this.validateSubmission(n)&&this.afterSubmission(e.target,n,t.get("name"))}});function US(e){var t,n;null===(t=va.roster)||void 0===t||null===(n=t.findWhere({jid:e.get("jid")}))||void 0===n||n.trigger("highlight")}function BS(e,t){const n=va.roster_filter,s=n.get("filter_type"),i="state"===s?n.get("chat_state").toLowerCase():n.get("filter_text").toLowerCase();return!!i&&("state"===s?![va.HEADER_REQUESTING_CONTACTS,va.HEADER_UNREAD].includes(t)&&("unread_messages"===i?0===e.get("num_unread"):"online"===i?["offline","unavailable"].includes(e.presence.get("show")):!e.presence.get("show").includes(i)):"contacts"===s?!e.getFilterCriteria().includes(i):void 0)}function qS(e){const t=va.roster_filter;if("groups"===t.get("filter_type")){var n;const s=null===(n=t.get("filter_text"))||void 0===n?void 0:n.toLowerCase();if(!s)return!0;if(!e.toLowerCase().includes(s))return!1}return!0}va.AddContactModal=FS;const{u:HS}=jl.env;function GS(e){const t=e.get("jid"),n=[];if(va.isUniView()){const e=va.chatboxes.get(t);e&&!e.get("hidden")&&n.push("open")}const s=e.get("ask"),i=e.get("requesting"),r=e.get("subscription");return"subscribe"===s||"from"===r?n.push("pending-xmpp-contact"):!0===i?n.push("requesting-xmpp-contact"):("both"===r||"to"===r||HS.isSameBareJID(t,va.connection.jid))&&(n.push("current-xmpp-contact"),n.push(r),n.push(e.presence.get("show"))),Qc`
        <li class="list-item d-flex controlbox-padded ${n.join(" ")}" data-status="${e.presence.get("show")}">
            <converse-roster-contact .model=${e}></converse-roster-contact>
        </li>`}const WS=e=>{const t=vh("Contacts"),n=vh("Add a contact"),s=vh("Re-sync your contacts"),i=(va.roster||[]).reduce(((e,t)=>function(e,t){if("subscribe"===t.get("ask")){const n=va.HEADER_PENDING_CONTACTS;e[n]?e[n].push(t):e[n]=[t]}else if(t.get("requesting")){const n=va.HEADER_REQUESTING_CONTACTS;e[n]?e[n].push(t):e[n]=[t]}else{let n;Cl.settings.get("roster_groups")?(n=t.get("groups"),n=0===n.length?[va.HEADER_UNGROUPED]:n):n=[va.HEADER_CURRENT_CONTACTS];for(const s of n)e[s]?e[s].push(t):e[s]=[t]}if(t.get("num_unread")){const n=va.HEADER_UNREAD;e[n]?e[n].push(t):e[n]=[t]}return e}(e,t)),{}),r=Object.keys(i).filter(qS);return r.sort(tf),Qc`
        <div class="d-flex controlbox-padded">
            <span class="w-100 controlbox-heading controlbox-heading--contacts">${t}</span>
            <a class="controlbox-heading__btn sync-contacts" @click=${t=>e.syncContacts(t)} title="${s}">
                <converse-icon class="fa fa-sync right ${e.syncing_contacts?"fa-spin":""}" color="var(--subdued-color)" path-prefix="/dist" size="1em"></converse-icon>
            </a>
            ${Cl.settings.get("allow_contact_requests")?Qc`
                <a class="controlbox-heading__btn add-contact"
                    @click=${t=>e.showAddContactModal(t)}
                    title="${n}"
                    data-toggle="modal"
                    data-target="#add-contact-modal">
                    <converse-icon class="fa fa-user-plus right" color="var(--subdued-color)" path-prefix="/dist" size="1.25em"></converse-icon>
                </a>`:""}
        </div>
        <converse-roster-filter></converse-roster-filter>
        <div class="list-container roster-contacts">
            ${jg(r,(e=>e),(e=>{const t=i[e].filter((t=>function(e,t){const n=e.presence.get("show");return Cl.settings.get("hide_offline_users")&&"offline"===n?("subscribe"===e.get("ask")||"from"===e.get("subscription")||!0===e.get("requesting"))&&!BS(e,t):!BS(e,t)}(t,e)));return t.sort(ef),t.length?(e=>{const t=vh("Click to hide these contacts"),n=va.roster.state.get("collapsed_groups");return Qc`
        <div class="roster-group" data-group="${e.name}">
            <a href="#" class="list-toggle group-toggle controlbox-padded" title="${t}" @click=${t=>function(e,t){var n;null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const s=va.roster.state.get("collapsed_groups");s.includes(t)?va.roster.state.save("collapsed_groups",s.filter((e=>e!==t))):va.roster.state.save("collapsed_groups",[...s,t])}(t,e.name)}>
                <converse-icon color="var(--chat-head-color)" size="1em" class="fa ${n.includes(e.name)?"fa-caret-right":"fa-caret-down"}"></converse-icon> ${e.name}
            </a>
            <ul class="items-list roster-group-contacts ${n.includes(e.name)?"collapsed":""}" data-group="${e.name}">
                ${e.contacts.map(GS)}
            </ul>
        </div>`})({contacts:t,name:e}):""}))}
        </div>
    `};Cl.elements.define("converse-roster",class extends Uf{constructor(){super(),this.initialize()}async initialize(){await Cl.waitUntil("rosterInitialized"),this.listenTo(va,"rosterContactsFetched",this.requestUpdate),this.listenTo(va.presences,"change:show",this.requestUpdate),this.listenTo(va.roster,"add",this.requestUpdate),this.listenTo(va.roster,"destroy",this.requestUpdate),this.listenTo(va.roster,"remove",this.requestUpdate),this.listenTo(va.roster,"change",this.requestUpdate),this.listenTo(va.roster.state,"change",this.requestUpdate),Cl.trigger("rosterViewInitialized")}firstUpdated(){this.listenToRosterFilter()}render(){return WS(this)}listenToRosterFilter(){this.filter_view=this.querySelector("converse-roster-filter"),this.filter_view.addEventListener("update",(()=>this.requestUpdate()))}showAddContactModal(e){Cl.modal.show(va.AddContactModal,{model:new Zo},e)}async syncContacts(e){e.preventDefault(),this.syncing_contacts=!0,this.requestUpdate(),va.roster.data.save("version",null),await va.roster.fetchFromServer(),Cl.user.presence.send(),this.syncing_contacts=!1,this.requestUpdate()}});const VS=e=>Qc`<span class="pending-contact-name" title="JID: ${e.jid}">${e.display_name}</span>`,JS=e=>Qc`<span class="req-contact-name w-100" title="JID: ${e.jid}">${e.display_name}</span>`,KS=jl.env.utils;class YS extends Uf{static get properties(){return{model:{type:Object}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change",this.requestUpdate),this.listenTo(this.model,"highlight",this.requestUpdate),this.listenTo(this.model,"vcard:change",this.requestUpdate)}render(){const e=this.model.get("ask"),t=this.model.get("requesting"),n=this.model.get("subscription"),s=this.model.get("jid");if("subscribe"===e||"from"===n){const e=this.model.getDisplayName();return(e=>{const t=vh("Click to remove %1$s as a contact",e.display_name);return Qc`
        ${Cl.settings.get("allow_chat_pending_contacts")?Qc`<a class="list-item-link open-chat w-100" href="#" @click=${e.openChat}>${VS(e)}</a>`:VS(e)}
        <a class="list-item-action remove-xmpp-contact far fa-trash-alt" @click=${e.removeContact} title="${t}" href="#"></a>`})(Object.assign(this.model.toJSON(),{display_name:e,openChat:e=>this.openChat(e),removeContact:e=>this.removeContact(e)}))}if(!0===t){const e=this.model.getDisplayName();return(e=>Qc`
   ${Cl.settings.get("allow_chat_pending_contacts")?Qc`<a class="open-chat w-100" href="#" @click=${e.openChat}>${JS(e)}</a>`:JS(e)}
   <a class="accept-xmpp-request list-item-action list-item-action--visible fa fa-check"
      @click=${e.acceptRequest}
      aria-label="${e.desc_accept}" title="${e.desc_accept}" href="#"></a>
   <a class="decline-xmpp-request list-item-action list-item-action--visible  fa fa-times"
      @click=${e.declineRequest}
      aria-label="${e.desc_decline}" title="${e.desc_decline}" href="#"></a>`)(Object.assign(this.model.toJSON(),{display_name:e,openChat:e=>this.openChat(e),acceptRequest:e=>this.acceptRequest(e),declineRequest:e=>this.declineRequest(e),desc_accept:vh("Click to accept the contact request from %1$s",e),desc_decline:vh("Click to decline the contact request from %1$s",e),allow_chat_pending_contacts:Cl.settings.get("allow_chat_pending_contacts")}))}if("both"===n||"to"===n||KS.isSameBareJID(s,va.connection.jid))return this.renderRosterItem(this.model)}renderRosterItem(e){const t={dnd:vh("This contact is busy"),online:vh("This contact is online"),offline:vh("This contact is offline"),unavailable:vh("This contact is unavailable"),xa:vh("This contact is away for an extended period"),away:vh("This contact is away")},n=e.presence.get("show")||"offline";let s;s="online"===n?"fa fa-circle chat-status chat-status--online":"away"===n?"fa fa-circle chat-status chat-status--away":"xa"===n?"far fa-circle chat-status chat-status-xa":"dnd"===n?"fa fa-minus-circle chat-status chat-status--busy":"fa fa-times-circle chat-status chat-status--offline";const i=e.getDisplayName();return(e=>{const t=vh("Click to chat with %1$s (XMPP address: %2$s)",e.display_name,e.jid),n=vh("Click to remove %1$s as a contact",e.display_name);return Qc`
   <a class="list-item-link cbox-list-item open-chat ${e.num_unread?"unread-msgs":""}" title="${t}" href="#" @click=${e.openChat}>
      ${_v(e.getAvatarData())}
      <span class="${e.status_icon}" title="${e.desc_status}"></span>
      ${e.num_unread?Qc`<span class="msgs-indicator">${e.num_unread}</span>`:""}
      <span class="contact-name contact-name--${e.show} ${e.num_unread?"unread-msgs":""}">${e.display_name}</span>
   </a>
   ${Cl.settings.get("allow_contact_removal")?Qc`<a class="list-item-action remove-xmpp-contact far fa-trash-alt" @click=${e.removeContact} title="${n}" href="#"></a>`:""}`})(Object.assign(e.toJSON(),{show:n,display_name:i,status_icon:s,openChat:e=>this.openChat(e),removeContact:e=>this.removeContact(e),getAvatarData:()=>this.getAvatarData(),desc_status:t[n],num_unread:e.get("num_unread")||0}))}getAvatarData(){var e,t;return{classes:"avatar",height:30,width:30,image:"data:"+((null===(e=this.model.vcard)||void 0===e?void 0:e.get("image_type"))||va.DEFAULT_IMAGE_TYPE)+";base64,"+((null===(t=this.model.vcard)||void 0===t?void 0:t.get("image"))||va.DEFAULT_IMAGE)}}openChat(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),this.model.openChat()}removeContact(e){var t;if(null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),Cl.settings.get("allow_contact_removal")&&confirm(vh("Are you sure you want to remove this contact?")))try{this.model.removeFromRoster(),this.model.collection&&this.model.destroy()}catch(e){M.error(e),Cl.alert("error",vh("Error"),[vh("Sorry, there was an error while trying to remove %1$s as a contact.",this.model.getDisplayName())])}}async acceptRequest(e){var t;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),await va.roster.sendContactAddIQ(this.model.get("jid"),this.model.getFullname(),[]),this.model.authorize().subscribe()}declineRequest(e){return e&&e.preventDefault&&e.preventDefault(),!0===confirm(vh("Are you sure you want to decline this contact request?"))&&this.model.unauthorize().destroy(),this}}Cl.elements.define("converse-roster-contact",YS);const QS=Zo.extend({initialize(){this.set({filter_text:"",filter_type:"contacts",chat_state:"online"})}});class XS extends Uf{constructor(){super(),this.initialize()}initialize(){const e=new va.RosterFilter;e.id=`_converse.rosterfilter-${va.bare_jid}`,_o(e,e.id),this.model=e,va.roster_filter=e,this.liveFilter=hc((()=>{this.model.save({filter_text:this.querySelector(".roster-filter").value})}),250),this.listenTo(va,"rosterContactsFetched",this.requestUpdate),this.listenTo(va.presences,"change:show",this.requestUpdate),this.listenTo(va.roster,"add",this.requestUpdate),this.listenTo(va.roster,"destroy",this.requestUpdate),this.listenTo(va.roster,"remove",this.requestUpdate),this.listenTo(this.model,"change",this.dispatchUpdateEvent),this.listenTo(this.model,"change",this.requestUpdate),this.model.fetch()}render(){return(e=>{const t=vh("Filter"),n=vh("Filter by contact name"),s=vh("Filter by group name"),i=vh("Filter by status"),r=vh("Any"),o=vh("Unread"),a=vh("Online"),c=vh("Chatty"),l=vh("Busy"),d=vh("Away"),u=vh("Extended Away"),h=vh("Offline");return Qc`
        <form class="controlbox-padded roster-filter-form input-button-group ${e.visible?"fade-in":"hidden"}"
            @submit=${e.submitFilter}>
            <div class="form-inline flex-nowrap">
                <div class="filter-by d-flex flex-nowrap">
                    <span @click=${e.changeTypeFilter} class="fa fa-user ${"contacts"===e.filter_type?"selected":""}" data-type="contacts" title="${n}"></span>
                    <span @click=${e.changeTypeFilter} class="fa fa-users ${"groups"===e.filter_type?"selected":""}" data-type="groups" title="${s}"></span>
                    <span @click=${e.changeTypeFilter} class="fa fa-circle ${"state"===e.filter_type?"selected":""}" data-type="state" title="${i}"></span>
                </div>
                <div class="btn-group">
                    <input .value="${e.filter_text||""}"
                        @keydown=${e.liveFilter}
                        class="roster-filter form-control ${"state"===e.filter_type?"hidden":""}"
                        placeholder="${t}"/>
                    <span class="clear-input fa fa-times ${e.filter_text&&"state"!==e.filter_type?"":"hidden"}"
                        @click=${e.clearFilter}>
                    </span>
                </div>
                <select class="form-control state-type ${"state"!==e.filter_type?"hidden":""}"
                        @change=${e.changeChatStateFilter}>
                    <option value="">${r}</option>
                    <option ?selected=${"unread_messages"===e.chat_state} value="unread_messages">${o}</option>
                    <option ?selected=${"online"===e.chat_state} value="online">${a}</option>
                    <option ?selected=${"chat"===e.chat_state} value="chat">${c}</option>
                    <option ?selected=${"dnd"===e.chat_state} value="dnd">${l}</option>
                    <option ?selected=${"away"===e.chat_state} value="away">${d}</option>
                    <option ?selected=${"xa"===e.chat_state} value="xa">${u}</option>
                    <option ?selected=${"offline"===e.chat_state} value="offline">${h}</option>
                </select>
            </div>
        </form>`})(Object.assign(this.model.toJSON(),{visible:this.shouldBeVisible(),changeChatStateFilter:e=>this.changeChatStateFilter(e),changeTypeFilter:e=>this.changeTypeFilter(e),clearFilter:e=>this.clearFilter(e),liveFilter:e=>this.liveFilter(e),submitFilter:e=>this.submitFilter(e)}))}dispatchUpdateEvent(){this.dispatchEvent(new CustomEvent("update",{detail:this.model.changed}))}changeChatStateFilter(e){e&&e.preventDefault(),this.model.save({chat_state:this.querySelector(".state-type").value})}changeTypeFilter(e){e&&e.preventDefault();const t=e.target.dataset.type;"state"===t?this.model.save({filter_type:t,chat_state:this.querySelector(".state-type").value}):this.model.save({filter_type:t,filter_text:this.querySelector(".roster-filter").value})}submitFilter(e){e&&e.preventDefault(),this.liveFilter()}isActive(){return"state"===this.model.get("filter_type")||this.model.get("filter_text")}shouldBeVisible(){var e;return(null===(e=va.roster)||void 0===e?void 0:e.length)>=5||this.isActive()}clearFilter(e){e&&e.preventDefault(),this.model.save({filter_text:""})}}Cl.elements.define("converse-roster-filter",XS);var ZS=n(74),ex={};ex.styleTagTransform=eg(),ex.setAttributes=Yf(),ex.insert=Jf().bind(null,"head"),ex.domAPI=Wf(),ex.insertStyleElement=Xf(),Hf()(ZS.Z,ex),ZS.Z&&ZS.Z.locals&&ZS.Z.locals,jl.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews"],initialize(){Cl.settings.extend({autocomplete_add_contact:!0,allow_chat_pending_contacts:!0,allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),Cl.promises.add("rosterViewInitialized"),va.RosterFilter=QS,va.RosterFilterView=XS,va.RosterContactView=YS,Cl.listen.on("chatBoxesInitialized",(()=>{va.chatboxes.on("destroy",(e=>US(e))),va.chatboxes.on("change:hidden",(e=>US(e)))})),Cl.listen.on("afterTearDown",(()=>{var e;return null===(e=va.rotergroups)||void 0===e?void 0:e.off().reset()}))}}),va.CustomElement=Uf;const tx=jl.initialize;jl.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(Bf):e.whitelisted_plugins=Bf,tx(e,t)};const nx=jl},6300:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3742:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7904:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4639:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6220:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9107:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7581:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6752:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},115:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8859:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7926:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1557:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2490:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},679:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1107:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},74:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8481:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8269:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9796:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5223:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7991:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7415:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1065:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3735:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3543:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4452:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var s=n(7620),i=n.n(s),r=n(1246),o=n.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9434:(e,t,n)=>{var s={"./af.js":[7905,9210],"./am.js":[2067,5073],"./ar-dz.js":[7171,9406],"./ar-kw.js":[6712,9897],"./ar-ly.js":[4198,3521],"./ar-ma.js":[5390,5313],"./ar-sa.js":[8916,485],"./ar-tn.js":[5507,8040],"./ar.js":[8817,6755],"./az.js":[978,4963],"./be.js":[8413,9478],"./bg.js":[7575,578],"./bi.js":[7186,2984],"./bm.js":[7646,2263],"./bn.js":[2760,280],"./bo.js":[10,9950],"./br.js":[5476,760],"./bs.js":[8581,9833],"./ca.js":[545,102],"./cs.js":[7831,7400],"./cv.js":[4598,4481],"./cy.js":[5401,6740],"./da.js":[3499,2548],"./de-at.js":[4026,7175],"./de-ch.js":[7423,1679],"./de.js":[1857,52],"./dv.js":[8027,5569],"./el.js":[4542,1606],"./en-au.js":[8781,5485],"./en-ca.js":[7867,4035],"./en-gb.js":[4147,6031],"./en-ie.js":[5454,8129],"./en-il.js":[7199,3463],"./en-in.js":[8109,6898],"./en-nz.js":[9102,8547],"./en-sg.js":[8113,1735],"./en-tt.js":[5859,6105],"./en.js":[1606,535],"./eo.js":[5545,5121],"./es-do.js":[5839,8758],"./es-pr.js":[3979,911],"./es-us.js":[8624,3208],"./es.js":[4153,3411],"./et.js":[7754,4153],"./eu.js":[2697,1396],"./fa.js":[9068,5544],"./fi.js":[6587,2130],"./fo.js":[26,8745],"./fr-ca.js":[3026,7363],"./fr-ch.js":[2246,7952],"./fr.js":[8278,1910],"./fy.js":[4172,6376],"./ga.js":[9691,688],"./gd.js":[2713,5050],"./gl.js":[6212,5818],"./gom-latn.js":[5516,825],"./gu.js":[945,3623],"./he.js":[7346,9372],"./hi.js":[802,8010],"./hr.js":[1804,7419],"./ht.js":[8259,5822],"./hu.js":[3650,8214],"./hy-am.js":[4800,5407],"./id.js":[5275,9513],"./is.js":[4039,1194],"./it-ch.js":[8846,6010],"./it.js":[6792,1880],"./ja.js":[4679,1107],"./jv.js":[4770,4305],"./ka.js":[7564,5186],"./kk.js":[7316,5206],"./km.js":[1209,2475],"./kn.js":[6713,7523],"./ko.js":[9735,3446],"./ku.js":[5121,7024],"./ky.js":[5901,5055],"./lb.js":[4565,5215],"./lo.js":[8525,1204],"./lt.js":[1305,7899],"./lv.js":[9629,631],"./me.js":[913,145],"./mi.js":[3389,7454],"./mk.js":[5524,4951],"./ml.js":[5321,7679],"./mn.js":[8082,8618],"./mr.js":[3838,5600],"./ms-my.js":[5435,882],"./ms.js":[1525,9095],"./mt.js":[2680,9665],"./my.js":[1390,5166],"./nb.js":[192,646],"./ne.js":[9534,9030],"./nl-be.js":[307,3155],"./nl.js":[808,1520],"./nn.js":[4644,7050],"./oc-lnc.js":[9099,7203],"./pa-in.js":[7117,5850],"./pl.js":[5406,1211],"./pt-br.js":[1291,5274],"./pt.js":[402,265],"./ro.js":[4491,8022],"./ru.js":[1187,559],"./rw.js":[8978,3221],"./sd.js":[454,1298],"./se.js":[1708,1942],"./si.js":[5334,9333],"./sk.js":[7506,6783],"./sl.js":[7608,9625],"./sq.js":[2402,8603],"./sr-cyrl.js":[7786,3435],"./sr.js":[8407,7390],"./ss.js":[2068,9238],"./sv-fi.js":[1057,9997],"./sv.js":[4316,9652],"./sw.js":[9716,9733],"./ta.js":[1541,7645],"./te.js":[5649,7714],"./tet.js":[6539,555],"./tg.js":[222,2446],"./th.js":[4805,1729],"./tk.js":[2679,5256],"./tl-ph.js":[821,9443],"./tlh.js":[9201,2814],"./tr.js":[8273,8665],"./tzl.js":[4837,2843],"./tzm-latn.js":[7003,3933],"./tzm.js":[2165,4342],"./ug-cn.js":[810,6890],"./uk.js":[6638,1619],"./ur.js":[9542,9568],"./uz-latn.js":[3089,1110],"./uz.js":[3380,3153],"./vi.js":[2718,8073],"./x-pseudo.js":[6316,4423],"./yo.js":[2863,8692],"./zh-cn.js":[4385,9630],"./zh-hk.js":[4338,3755],"./zh-tw.js":[1208,6776],"./zh.js":[8383,8458]};function i(e){if(!n.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,7)))}i.keys=()=>Object.keys(s),i.id=9434,e.exports=i},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var r={},o=[],a=0;a<e.length;a++){var c=e[a],l=s.base?c[0]+s.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var h=n(u),m={css:c[1],media:c[2],sourceMap:c[3]};-1!==h?(t[h].references++,t[h].updater(m)):t.push({identifier:u,updater:i(m,s),references:1}),o.push(u)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=s(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=n(r[o]);t[a].references--}for(var c=s(e,i),l=0;l<r.length;l++){var d=n(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s=n.css,i=n.media,r=n.sourceMap;i?e.setAttribute("media",i):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(s,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},7521:(e,t,n)=>{var s={"./af/LC_MESSAGES/converse.po":[2866,5830],"./ar/LC_MESSAGES/converse.po":[7693,4469],"./bg/LC_MESSAGES/converse.po":[5638,2551],"./ca/LC_MESSAGES/converse.po":[6124,1553],"./cs/LC_MESSAGES/converse.po":[4283,5301],"./da/LC_MESSAGES/converse.po":[8135,1163],"./de/LC_MESSAGES/converse.po":[254,2895],"./el/LC_MESSAGES/converse.po":[8778,5524],"./eo/LC_MESSAGES/converse.po":[4111,2433],"./es/LC_MESSAGES/converse.po":[3516,8269],"./eu/LC_MESSAGES/converse.po":[6160,3103],"./fa/LC_MESSAGES/converse.po":[7167,321],"./fi/LC_MESSAGES/converse.po":[5819,7618],"./fr/LC_MESSAGES/converse.po":[7500,5129],"./gl/LC_MESSAGES/converse.po":[8429,777],"./he/LC_MESSAGES/converse.po":[2233,4363],"./hi/LC_MESSAGES/converse.po":[7785,4468],"./hu/LC_MESSAGES/converse.po":[2325,6239],"./id/LC_MESSAGES/converse.po":[4938,6678],"./it/LC_MESSAGES/converse.po":[2755,3719],"./ja/LC_MESSAGES/converse.po":[2693,6249],"./lt/LC_MESSAGES/converse.po":[3547,513],"./mr/LC_MESSAGES/converse.po":[2260,1784],"./nb/LC_MESSAGES/converse.po":[9701,473],"./nl/LC_MESSAGES/converse.po":[3175,2473],"./nl_BE/LC_MESSAGES/converse.po":[658,8131],"./oc/LC_MESSAGES/converse.po":[506,5500],"./pl/LC_MESSAGES/converse.po":[275,3606],"./pt/LC_MESSAGES/converse.po":[8300,6227],"./pt_BR/LC_MESSAGES/converse.po":[7606,1455],"./ro/LC_MESSAGES/converse.po":[6899,3539],"./ru/LC_MESSAGES/converse.po":[499,7917],"./sv/LC_MESSAGES/converse.po":[164,8859],"./th/LC_MESSAGES/converse.po":[4307,457],"./tr/LC_MESSAGES/converse.po":[5882,4195],"./uk/LC_MESSAGES/converse.po":[6264,7979],"./vi/LC_MESSAGES/converse.po":[1937,2110],"./zh_CN/LC_MESSAGES/converse.po":[6592,3325],"./zh_TW/LC_MESSAGES/converse.po":[1288,1458]};function i(e){if(!n.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,3)))}i.keys=()=>Object.keys(s),i.id=7521,e.exports=i}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,s){if(1&s&&(n=this(n)),8&s)return n;if("object"==typeof n&&n){if(4&s&&n.__esModule)return n;if(16&s&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>n[e]));return r.default=()=>n,o.d(i,r),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({52:"locales/dayjs/de-js",102:"locales/dayjs/ca-js",145:"locales/dayjs/me-js",265:"locales/dayjs/pt-js",280:"locales/dayjs/bn-js",321:"locales/fa-LC_MESSAGES-converse-po",457:"locales/th-LC_MESSAGES-converse-po",473:"locales/nb-LC_MESSAGES-converse-po",485:"locales/dayjs/ar-sa-js",513:"locales/lt-LC_MESSAGES-converse-po",535:"locales/dayjs/en-js",555:"locales/dayjs/tet-js",559:"locales/dayjs/ru-js",578:"locales/dayjs/bg-js",631:"locales/dayjs/lv-js",646:"locales/dayjs/nb-js",688:"locales/dayjs/ga-js",760:"locales/dayjs/br-js",777:"locales/gl-LC_MESSAGES-converse-po",825:"locales/dayjs/gom-latn-js",882:"locales/dayjs/ms-my-js",911:"locales/dayjs/es-pr-js",1107:"locales/dayjs/ja-js",1110:"locales/dayjs/uz-latn-js",1163:"locales/da-LC_MESSAGES-converse-po",1194:"locales/dayjs/is-js",1204:"locales/dayjs/lo-js",1211:"locales/dayjs/pl-js",1298:"locales/dayjs/sd-js",1396:"locales/dayjs/eu-js",1455:"locales/pt_BR-LC_MESSAGES-converse-po",1458:"locales/zh_TW-LC_MESSAGES-converse-po",1520:"locales/dayjs/nl-js",1553:"locales/ca-LC_MESSAGES-converse-po",1606:"locales/dayjs/el-js",1619:"locales/dayjs/uk-js",1679:"locales/dayjs/de-ch-js",1729:"locales/dayjs/th-js",1735:"locales/dayjs/en-sg-js",1784:"locales/mr-LC_MESSAGES-converse-po",1880:"locales/dayjs/it-js",1910:"locales/dayjs/fr-js",1942:"locales/dayjs/se-js",2110:"locales/vi-LC_MESSAGES-converse-po",2130:"locales/dayjs/fi-js",2263:"locales/dayjs/bm-js",2433:"locales/eo-LC_MESSAGES-converse-po",2446:"locales/dayjs/tg-js",2473:"locales/nl-LC_MESSAGES-converse-po",2475:"locales/dayjs/km-js",2548:"locales/dayjs/da-js",2551:"locales/bg-LC_MESSAGES-converse-po",2814:"locales/dayjs/tlh-js",2843:"locales/dayjs/tzl-js",2895:"locales/de-LC_MESSAGES-converse-po",2984:"locales/dayjs/bi-js",3103:"locales/eu-LC_MESSAGES-converse-po",3153:"locales/dayjs/uz-js",3155:"locales/dayjs/nl-be-js",3208:"locales/dayjs/es-us-js",3221:"locales/dayjs/rw-js",3325:"locales/zh_CN-LC_MESSAGES-converse-po",3411:"locales/dayjs/es-js",3435:"locales/dayjs/sr-cyrl-js",3446:"locales/dayjs/ko-js",3463:"locales/dayjs/en-il-js",3521:"locales/dayjs/ar-ly-js",3539:"locales/ro-LC_MESSAGES-converse-po",3606:"locales/pl-LC_MESSAGES-converse-po",3623:"locales/dayjs/gu-js",3719:"locales/it-LC_MESSAGES-converse-po",3755:"locales/dayjs/zh-hk-js",3933:"locales/dayjs/tzm-latn-js",4035:"locales/dayjs/en-ca-js",4153:"locales/dayjs/et-js",4195:"locales/tr-LC_MESSAGES-converse-po",4305:"locales/dayjs/jv-js",4342:"locales/dayjs/tzm-js",4363:"locales/he-LC_MESSAGES-converse-po",4423:"locales/dayjs/x-pseudo-js",4468:"locales/hi-LC_MESSAGES-converse-po",4469:"locales/ar-LC_MESSAGES-converse-po",4481:"locales/dayjs/cv-js",4610:"emojis",4951:"locales/dayjs/mk-js",4963:"locales/dayjs/az-js",5050:"locales/dayjs/gd-js",5055:"locales/dayjs/ky-js",5073:"locales/dayjs/am-js",5121:"locales/dayjs/eo-js",5129:"locales/fr-LC_MESSAGES-converse-po",5166:"locales/dayjs/my-js",5186:"locales/dayjs/ka-js",5206:"locales/dayjs/kk-js",5215:"locales/dayjs/lb-js",5256:"locales/dayjs/tk-js",5274:"locales/dayjs/pt-br-js",5301:"locales/cs-LC_MESSAGES-converse-po",5313:"locales/dayjs/ar-ma-js",5407:"locales/dayjs/hy-am-js",5485:"locales/dayjs/en-au-js",5500:"locales/oc-LC_MESSAGES-converse-po",5524:"locales/el-LC_MESSAGES-converse-po",5544:"locales/dayjs/fa-js",5569:"locales/dayjs/dv-js",5600:"locales/dayjs/mr-js",5818:"locales/dayjs/gl-js",5822:"locales/dayjs/ht-js",5830:"locales/af-LC_MESSAGES-converse-po",5850:"locales/dayjs/pa-in-js",6010:"locales/dayjs/it-ch-js",6031:"locales/dayjs/en-gb-js",6105:"locales/dayjs/en-tt-js",6227:"locales/pt-LC_MESSAGES-converse-po",6239:"locales/hu-LC_MESSAGES-converse-po",6249:"locales/ja-LC_MESSAGES-converse-po",6376:"locales/dayjs/fy-js",6678:"locales/id-LC_MESSAGES-converse-po",6740:"locales/dayjs/cy-js",6755:"locales/dayjs/ar-js",6776:"locales/dayjs/zh-tw-js",6783:"locales/dayjs/sk-js",6890:"locales/dayjs/ug-cn-js",6898:"locales/dayjs/en-in-js",7024:"locales/dayjs/ku-js",7050:"locales/dayjs/nn-js",7175:"locales/dayjs/de-at-js",7203:"locales/dayjs/oc-lnc-js",7363:"locales/dayjs/fr-ca-js",7390:"locales/dayjs/sr-js",7400:"locales/dayjs/cs-js",7419:"locales/dayjs/hr-js",7454:"locales/dayjs/mi-js",7523:"locales/dayjs/kn-js",7618:"locales/fi-LC_MESSAGES-converse-po",7645:"locales/dayjs/ta-js",7679:"locales/dayjs/ml-js",7714:"locales/dayjs/te-js",7899:"locales/dayjs/lt-js",7917:"locales/ru-LC_MESSAGES-converse-po",7952:"locales/dayjs/fr-ch-js",7979:"locales/uk-LC_MESSAGES-converse-po",8010:"locales/dayjs/hi-js",8022:"locales/dayjs/ro-js",8040:"locales/dayjs/ar-tn-js",8073:"locales/dayjs/vi-js",8129:"locales/dayjs/en-ie-js",8131:"locales/nl_BE-LC_MESSAGES-converse-po",8214:"locales/dayjs/hu-js",8269:"locales/es-LC_MESSAGES-converse-po",8458:"locales/dayjs/zh-js",8547:"locales/dayjs/en-nz-js",8603:"locales/dayjs/sq-js",8618:"locales/dayjs/mn-js",8665:"locales/dayjs/tr-js",8692:"locales/dayjs/yo-js",8745:"locales/dayjs/fo-js",8758:"locales/dayjs/es-do-js",8859:"locales/sv-LC_MESSAGES-converse-po",9030:"locales/dayjs/ne-js",9095:"locales/dayjs/ms-js",9210:"locales/dayjs/af-js",9238:"locales/dayjs/ss-js",9333:"locales/dayjs/si-js",9372:"locales/dayjs/he-js",9406:"locales/dayjs/ar-dz-js",9443:"locales/dayjs/tl-ph-js",9478:"locales/dayjs/be-js",9513:"locales/dayjs/id-js",9568:"locales/dayjs/ur-js",9625:"locales/dayjs/sl-js",9630:"locales/dayjs/zh-cn-js",9652:"locales/dayjs/sv-js",9665:"locales/dayjs/mt-js",9733:"locales/dayjs/sw-js",9833:"locales/dayjs/bs-js",9897:"locales/dayjs/ar-kw-js",9950:"locales/dayjs/bo-js",9997:"locales/dayjs/sv-fi-js"}[e]+".js"),o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},s="converse.js:",o.l=(e,t,i,r)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==s+i){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",s+i),a.src=e),n[e]=[t];var h=(t,s)=>{a.onerror=a.onload=null,clearTimeout(m);var i=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(s))),t)return t(s)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="/dist/",(()=>{var e={179:0};o.f.j=(t,n)=>{var s=o.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var i=new Promise(((n,i)=>s=e[t]=[n,i]));n.push(s[2]=i);var r=o.p+o.u(t),a=new Error;o.l(r,(n=>{if(o.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,s[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var s,i,[r,a,c]=n,l=0;for(s in a)o.o(a,s)&&(o.m[s]=a[s]);for(c&&c(o),t&&t(n);l<r.length;l++)i=r[l],o.o(e,i)&&e[i]&&e[i][0](),e[r[l]]=0},n=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";const e={},t={plugins:{add(t,n){if(void 0!==e[t])throw new TypeError(`Error: plugin with name "${t}" has already been registered!`);e[t]=n}},initialize(e={}){t.load(e).initialize(e)},load:(n={})=>(n.assets_path&&(o.p=n.assets_path),o(6387),Object.keys(e).forEach((n=>t.plugins.add(n,e[n]))),t)};window.converse=t;const n=new CustomEvent("converse-loaded",{detail:{converse:t}});window.dispatchEvent(n)})()})();
//# sourceMappingURL=converse.min.js.map